<!DOCTYPE html>
<!-- saved from url=(0074)https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security -->
<html class="__variable_3a0388 __variable_c1e5c9 __variable_00879e scroll-smooth dark" lang="en" style="color-scheme: dark;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link rel="stylesheet" href="./A Hitchhiker&#39;s Guide to Solana Program Security_files/d996ddb0d453ffca.css" data-precedence="next"><link rel="stylesheet" href="./A Hitchhiker&#39;s Guide to Solana Program Security_files/712062295f89cccd.css" data-precedence="next"><link rel="stylesheet" href="./A Hitchhiker&#39;s Guide to Solana Program Security_files/96b8c2f2f79bc08e.css" data-precedence="next"><link rel="stylesheet" href="./A Hitchhiker&#39;s Guide to Solana Program Security_files/c69f9910787c2207.css" data-precedence="next"><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/47b11435-3c163b64cc340261.js.download" async=""></script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/8136-f260f4306cadda4f.js.download" async=""></script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/main-app-a4560e865c7b1d2d.js.download" async=""></script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/3f156bc3-c7ec4965a9cc93b3.js.download" async=""></script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/2184-3bc227e94bfd9be6.js.download" async=""></script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/783-c0e59f51eadafb23.js.download" async=""></script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/3775-39a1abeb2ac64be9.js.download" async=""></script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/8905-ce2dd6d13f95f765.js.download" async=""></script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/263-ee4ebd6fa173865d.js.download" async=""></script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/polyfills-42372ed130431b0a.js.download" nomodule=""></script><style id="mttstyle">
    #mttContainer {
      left: 0 !important;
      top: 0 !important;
      width: 1000px !important;
      margin: 0px !important;
      margin-left: -500px !important;
      position: fixed !important;
      z-index: 2147483647 !important; /* Maximum z-index to overcome overlays */
      background: none !important;
      pointer-events: none !important;
      display: inline-block !important;
      visibility: visible  !important;
      white-space: pre-line;
    }
    .tippy-box[data-theme~="custom"], .tippy-box[data-theme~="ocr"], .tippy-content *{
      font-size: 18px  !important;
      text-align: center !important;
      overflow-wrap: break-word !important;
      color: #ffffffff !important;
      font-family: 
        -apple-system, BlinkMacSystemFont,
        "Segoe UI", "Roboto", "Oxygen",
        "Ubuntu", "Cantarell", "Fira Sans",
        "Droid Sans", "Helvetica Neue", sans-serif  !important;
      white-space: pre-line;
    }
    .tippy-box[data-theme~="custom"]{
      max-width: 200px  !important;
      backdrop-filter: blur(6px) !important;
      background-color: #00000080 !important;
      border: 1px solid #ffffff00; 
      box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px;
      opacity: 1.0; /* Adjusted opacity for transparency */
    }
    .tippy-box[data-theme~="ocr"]{
      max-width: $1000px  !important;
      backdrop-filter: blur(6px) !important;
      background-color: #00000080 !important;
      border: 1px solid #ffffff00; 
      box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px;
      opacity: 1.0; /* Adjusted opacity for transparency */
    }
    .tippy-box[data-theme~="transparent"] {
      max-width: $1000px  !important;
      backdrop-filter: blur(6px) !important;
      background-color: #00000080 !important;
      border: 1px solid #ffffff00; 
      box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px;
      opacity: 0.0; /* Adjusted opacity for transparency */
      transition: opacity 0.3s ease-in-out; /* Added transition for opacity */
    }
    [data-tippy-root] {
      display: inline-block !important;
      visibility: visible  !important;
      position: absolute !important;
    }
    .tippy-box[data-theme~='custom'][data-placement^='top'] > .tippy-arrow::before, .tippy-box[data-theme~='ocr'][data-placement^='top'] > .tippy-arrow::before { 
      border-top-color: #00000080 !important;
    }
    .tippy-box[data-theme~='custom'][data-placement^='bottom'] > .tippy-arrow::before, .tippy-box[data-theme~='ocr'][data-placement^='bottom'] > .tippy-arrow::before {
      border-bottom-color: #00000080 !important;
    }
    .tippy-box[data-theme~='custom'][data-placement^='left'] > .tippy-arrow::before, .tippy-box[data-theme~='ocr'][data-placement^='left'] > .tippy-arrow::before {
      border-left-color: #00000080 !important;
    }
    .tippy-box[data-theme~='custom'][data-placement^='right'] > .tippy-arrow::before, .tippy-box[data-theme~='ocr'][data-placement^='right'] > .tippy-arrow::before {
      border-right-color: #00000080 !important;
    }

    .mtt-highlight{
      background-color: #21dc6d40  !important;
      position: absolute !important;   
      z-index: 2147483646 !important; /* Slightly lower than tooltip */
      pointer-events: none !important;
      display: inline !important;
      border-radius: 3px !important;
    }
    .mtt-image{
      width: 180px  !important;
      border-radius: 3px !important;
    }
    .ocr_text_div{
      position: absolute;
      opacity: 0.4;
      color: transparent !important;
      border: 2px solid CornflowerBlue;
      background: none !important;
      border-radius: 3px !important;
    }</style><style id="mttstyleSubtitle">
    #ytp-caption-window-container .ytp-caption-segment {
      cursor: text !important;
      user-select: text !important;
      font-family: 
      -apple-system, BlinkMacSystemFont,
      "Segoe UI", "Roboto", "Oxygen",
      "Ubuntu", "Cantarell", "Fira Sans",
      "Droid Sans", "Helvetica Neue", sans-serif  !important;
    }
    .caption-visual-line{
      display: flex  !important;
      align-items: stretch  !important;
      direction: ltr
    }
    .captions-text .caption-visual-line:first-of-type:after {
      content: '⣿⣿';
      border-radius: 3px !important;
      color: white !important;
      background: transparent !important;
      box-shadow: rgba(50, 50, 93, 0.25) 0px 30px 60px -12px inset, rgba(0, 0, 0, 0.3) 0px 18px 36px -18px inset;
      display: inline-block;
      vertical-align: top;
      opacity:0;
      transition: opacity 0.7s ease-in-out;
    }
    .ytp-caption-segment{
      color: white !important;
      text-shadow: 1px 1px 2px black !important;
      backdrop-filter: blur(3px) !important;
      background: rgba(8, 8, 8, 0.1)  !important;
    }
    .captions-text:hover .caption-visual-line:first-of-type:after {
      opacity:1;
    }
    .ytp-pause-overlay {
      display: none !important;
    }
    .ytp-expand-pause-overlay .caption-window {
      display: block !important;
    }
  </style><style type="text/css">:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
</style><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="next-size-adjust" content=""><title>A Hitchhiker's Guide to Solana Program Security</title><meta name="description" content="Learn about Solana program security and how to mitigate common vulnerabilities"><link rel="canonical" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security"><meta property="og:title" content="A Hitchhiker&#39;s Guide to Solana Program Security"><meta property="og:description" content="Learn about Solana program security and how to mitigate common vulnerabilities"><meta property="og:url" content="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security"><meta property="og:site_name" content="Helius"><meta property="og:image" content="https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp"><meta property="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="A Hitchhiker&#39;s Guide to Solana Program Security"><meta name="twitter:description" content="Learn about Solana program security and how to mitigate common vulnerabilities"><meta name="twitter:image" content="https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp"><link rel="icon" type="image/png" href="https://www.helius.dev/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="https://www.helius.dev/favicon.svg"><link rel="shortcut icon" href="https://www.helius.dev/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://www.helius.dev/apple-touch-icon.png"><meta name="apple-mobile-web-app-title" content="Helius"><link rel="manifest" href="https://www.helius.dev/site.webmanifest"><link href="https://www.googletagmanager.com/" rel="preconnect"><link href="https://www.google-analytics.com/" rel="preconnect"><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/script.js.download" defer="" data-sdkn="@vercel/speed-insights/next" data-sdkv="1.2.0" data-route="/blog/[slug]"></script><style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      @keyframes w3m-shake {
        0% {
          transform: scale(1) rotate(0deg);
        }
        20% {
          transform: scale(1) rotate(-1deg);
        }
        40% {
          transform: scale(1) rotate(1.5deg);
        }
        60% {
          transform: scale(1) rotate(-1.5deg);
        }
        80% {
          transform: scale(1) rotate(1deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes w3m-iframe-fade-out {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes w3m-iframe-zoom-in {
        0% {
          transform: translateY(50px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }
      @keyframes w3m-iframe-zoom-in-mobile {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      :root {
        --w3m-modal-width: 360px;
        --w3m-color-mix-strength: 0%;
        --w3m-font-family: Inter;
        --w3m-font-size-master: 10px;
        --w3m-border-radius-master: 3px;
        --w3m-z-index: 999;

        --wui-font-family: var(--w3m-font-family);

        --wui-font-size-mini: calc(var(--w3m-font-size-master) * 0.8);
        --wui-font-size-micro: var(--w3m-font-size-master);
        --wui-font-size-tiny: calc(var(--w3m-font-size-master) * 1.2);
        --wui-font-size-small: calc(var(--w3m-font-size-master) * 1.4);
        --wui-font-size-paragraph: calc(var(--w3m-font-size-master) * 1.6);
        --wui-font-size-medium: calc(var(--w3m-font-size-master) * 1.8);
        --wui-font-size-large: calc(var(--w3m-font-size-master) * 2);
        --wui-font-size-title-6: calc(var(--w3m-font-size-master) * 2.2);
        --wui-font-size-medium-title: calc(var(--w3m-font-size-master) * 2.4);
        --wui-font-size-2xl: calc(var(--w3m-font-size-master) * 4);

        --wui-border-radius-5xs: var(--w3m-border-radius-master);
        --wui-border-radius-4xs: calc(var(--w3m-border-radius-master) * 1.5);
        --wui-border-radius-3xs: calc(var(--w3m-border-radius-master) * 2);
        --wui-border-radius-xxs: calc(var(--w3m-border-radius-master) * 3);
        --wui-border-radius-xs: calc(var(--w3m-border-radius-master) * 4);
        --wui-border-radius-s: calc(var(--w3m-border-radius-master) * 5);
        --wui-border-radius-m: calc(var(--w3m-border-radius-master) * 7);
        --wui-border-radius-l: calc(var(--w3m-border-radius-master) * 9);
        --wui-border-radius-3xl: calc(var(--w3m-border-radius-master) * 20);

        --wui-font-weight-light: 400;
        --wui-font-weight-regular: 500;
        --wui-font-weight-medium: 600;
        --wui-font-weight-bold: 700;

        --wui-letter-spacing-2xl: -1.6px;
        --wui-letter-spacing-medium-title: -0.96px;
        --wui-letter-spacing-title-6: -0.88px;
        --wui-letter-spacing-large: -0.8px;
        --wui-letter-spacing-medium: -0.72px;
        --wui-letter-spacing-paragraph: -0.64px;
        --wui-letter-spacing-small: -0.56px;
        --wui-letter-spacing-tiny: -0.48px;
        --wui-letter-spacing-micro: -0.2px;
        --wui-letter-spacing-mini: -0.16px;

        --wui-spacing-0: 0px;
        --wui-spacing-4xs: 2px;
        --wui-spacing-3xs: 4px;
        --wui-spacing-xxs: 6px;
        --wui-spacing-2xs: 7px;
        --wui-spacing-xs: 8px;
        --wui-spacing-1xs: 10px;
        --wui-spacing-s: 12px;
        --wui-spacing-m: 14px;
        --wui-spacing-l: 16px;
        --wui-spacing-2l: 18px;
        --wui-spacing-xl: 20px;
        --wui-spacing-xxl: 24px;
        --wui-spacing-2xl: 32px;
        --wui-spacing-3xl: 40px;
        --wui-spacing-4xl: 90px;
        --wui-spacing-5xl: 95px;

        --wui-icon-box-size-xxs: 14px;
        --wui-icon-box-size-xs: 20px;
        --wui-icon-box-size-sm: 24px;
        --wui-icon-box-size-md: 32px;
        --wui-icon-box-size-mdl: 36px;
        --wui-icon-box-size-lg: 40px;
        --wui-icon-box-size-2lg: 48px;
        --wui-icon-box-size-xl: 64px;

        --wui-icon-size-inherit: inherit;
        --wui-icon-size-xxs: 10px;
        --wui-icon-size-xs: 12px;
        --wui-icon-size-sm: 14px;
        --wui-icon-size-md: 16px;
        --wui-icon-size-mdl: 18px;
        --wui-icon-size-lg: 20px;
        --wui-icon-size-xl: 24px;
        --wui-icon-size-xxl: 28px;

        --wui-wallet-image-size-inherit: inherit;
        --wui-wallet-image-size-sm: 40px;
        --wui-wallet-image-size-md: 56px;
        --wui-wallet-image-size-lg: 80px;

        --wui-visual-size-size-inherit: inherit;
        --wui-visual-size-sm: 40px;
        --wui-visual-size-md: 55px;
        --wui-visual-size-lg: 80px;

        --wui-box-size-md: 100px;
        --wui-box-size-lg: 120px;

        --wui-ease-out-power-2: cubic-bezier(0, 0, 0.22, 1);
        --wui-ease-out-power-1: cubic-bezier(0, 0, 0.55, 1);

        --wui-ease-in-power-3: cubic-bezier(0.66, 0, 1, 1);
        --wui-ease-in-power-2: cubic-bezier(0.45, 0, 1, 1);
        --wui-ease-in-power-1: cubic-bezier(0.3, 0, 1, 1);

        --wui-ease-inout-power-1: cubic-bezier(0.45, 0, 0.55, 1);

        --wui-duration-lg: 200ms;
        --wui-duration-md: 125ms;
        --wui-duration-sm: 75ms;

        --wui-path-network-sm: path(
          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'
        );

        --wui-path-network-md: path(
          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'
        );

        --wui-path-network-lg: path(
          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'
        );

        --wui-width-network-sm: 36px;
        --wui-width-network-md: 48px;
        --wui-width-network-lg: 86px;

        --wui-height-network-sm: 40px;
        --wui-height-network-md: 54px;
        --wui-height-network-lg: 96px;

        --wui-icon-size-network-xs: 12px;
        --wui-icon-size-network-sm: 16px;
        --wui-icon-size-network-md: 24px;
        --wui-icon-size-network-lg: 42px;

        --wui-color-inherit: inherit;

        --wui-color-inverse-100: #fff;
        --wui-color-inverse-000: #000;

        --wui-cover: rgba(20, 20, 20, 0.8);

        --wui-color-modal-bg: var(--wui-color-modal-bg-base);

        --wui-color-accent-100: var(--wui-color-accent-base-100);
        --wui-color-accent-090: var(--wui-color-accent-base-090);
        --wui-color-accent-080: var(--wui-color-accent-base-080);

        --wui-color-success-100: var(--wui-color-success-base-100);
        --wui-color-success-125: var(--wui-color-success-base-125);

        --wui-color-warning-100: var(--wui-color-warning-base-100);

        --wui-color-error-100: var(--wui-color-error-base-100);
        --wui-color-error-125: var(--wui-color-error-base-125);

        --wui-color-blue-100: var(--wui-color-blue-base-100);
        --wui-color-blue-90: var(--wui-color-blue-base-90);

        --wui-icon-box-bg-error-100: var(--wui-icon-box-bg-error-base-100);
        --wui-icon-box-bg-blue-100: var(--wui-icon-box-bg-blue-base-100);
        --wui-icon-box-bg-success-100: var(--wui-icon-box-bg-success-base-100);
        --wui-icon-box-bg-inverse-100: var(--wui-icon-box-bg-inverse-base-100);

        --wui-all-wallets-bg-100: var(--wui-all-wallets-bg-100);

        --wui-avatar-border: var(--wui-avatar-border-base);

        --wui-thumbnail-border: var(--wui-thumbnail-border-base);

        --wui-wallet-button-bg: var(--wui-wallet-button-bg-base);

        --wui-box-shadow-blue: var(--wui-color-accent-glass-020);
      }

      @supports (background: color-mix(in srgb, white 50%, black)) {
        :root {
          --wui-color-modal-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-modal-bg-base)
          );

          --wui-box-shadow-blue: color-mix(in srgb, var(--wui-color-accent-100) 20%, transparent);

          --wui-color-accent-100: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 100%,
            transparent
          );
          --wui-color-accent-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-glass-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-020: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 20%,
            transparent
          );
          --wui-color-accent-glass-015: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 15%,
            transparent
          );
          --wui-color-accent-glass-010: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 10%,
            transparent
          );
          --wui-color-accent-glass-005: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 5%,
            transparent
          );
          --wui-color-accent-002: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 2%,
            transparent
          );

          --wui-color-fg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-100)
          );
          --wui-color-fg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-125)
          );
          --wui-color-fg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-150)
          );
          --wui-color-fg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-175)
          );
          --wui-color-fg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-200)
          );
          --wui-color-fg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-225)
          );
          --wui-color-fg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-250)
          );
          --wui-color-fg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-275)
          );
          --wui-color-fg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-300)
          );
          --wui-color-fg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-325)
          );
          --wui-color-fg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-350)
          );

          --wui-color-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-100)
          );
          --wui-color-bg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-125)
          );
          --wui-color-bg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-150)
          );
          --wui-color-bg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-175)
          );
          --wui-color-bg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-200)
          );
          --wui-color-bg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-225)
          );
          --wui-color-bg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-250)
          );
          --wui-color-bg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-275)
          );
          --wui-color-bg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-300)
          );
          --wui-color-bg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-325)
          );
          --wui-color-bg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-350)
          );

          --wui-color-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-100)
          );
          --wui-color-success-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-125)
          );

          --wui-color-warning-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-warning-base-100)
          );

          --wui-color-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-100)
          );
          --wui-color-blue-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-100)
          );
          --wui-color-blue-90: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-90)
          );
          --wui-color-error-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-125)
          );

          --wui-icon-box-bg-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-error-base-100)
          );
          --wui-icon-box-bg-accent-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-blue-base-100)
          );
          --wui-icon-box-bg-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-success-base-100)
          );
          --wui-icon-box-bg-inverse-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-inverse-base-100)
          );

          --wui-all-wallets-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-all-wallets-bg-100)
          );

          --wui-avatar-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-avatar-border-base)
          );

          --wui-thumbnail-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-thumbnail-border-base)
          );

          --wui-wallet-button-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-wallet-button-bg-base)
          );
        }
      }
    </style><style media="enabled">
      :root {
        --w3m-color-mix: #000;
        --w3m-accent: #e84125;
        --w3m-default: #000;

        --wui-color-modal-bg-base: #fff;
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(231, 100%, 70%, 1);
        --wui-color-blueberry-090: hsla(231, 97%, 72%, 1);
        --wui-color-blueberry-080: hsla(231, 92%, 74%, 1);

        --wui-color-fg-100: #141414;
        --wui-color-fg-125: #2d3131;
        --wui-color-fg-150: #474d4d;
        --wui-color-fg-175: #636d6d;
        --wui-color-fg-200: #798686;
        --wui-color-fg-225: #828f8f;
        --wui-color-fg-250: #8b9797;
        --wui-color-fg-275: #95a0a0;
        --wui-color-fg-300: #9ea9a9;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #d0d0d0;

        --wui-color-bg-100: #ffffff;
        --wui-color-bg-125: #f5fafa;
        --wui-color-bg-150: #f3f8f8;
        --wui-color-bg-175: #eef4f4;
        --wui-color-bg-200: #eaf1f1;
        --wui-color-bg-225: #e5eded;
        --wui-color-bg-250: #e1e9e9;
        --wui-color-bg-275: #dce7e7;
        --wui-color-bg-300: #d8e3e3;
        --wui-color-bg-325: #f3f3f3;
        --wui-color-bg-350: #202020;

        --wui-color-success-base-100: #26b562;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f05142;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 181, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 181, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 181, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 181, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 181, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 181, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 181, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 181, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 181, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 181, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(240, 81, 66, 0.01);
        --wui-color-error-glass-002: rgba(240, 81, 66, 0.02);
        --wui-color-error-glass-005: rgba(240, 81, 66, 0.05);
        --wui-color-error-glass-010: rgba(240, 81, 66, 0.1);
        --wui-color-error-glass-015: rgba(240, 81, 66, 0.15);
        --wui-color-error-glass-020: rgba(240, 81, 66, 0.2);
        --wui-color-error-glass-025: rgba(240, 81, 66, 0.25);
        --wui-color-error-glass-030: rgba(240, 81, 66, 0.3);
        --wui-color-error-glass-060: rgba(240, 81, 66, 0.6);
        --wui-color-error-glass-080: rgba(240, 81, 66, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-icon-box-bg-error-base-100: #f4dfdd;
        --wui-icon-box-bg-blue-base-100: #d9ecfb;
        --wui-icon-box-bg-success-base-100: #daf0e4;
        --wui-icon-box-bg-inverse-base-100: #dcecfc;

        --wui-all-wallets-bg-100: #e8f1fa;

        --wui-avatar-border-base: #f3f4f4;

        --wui-thumbnail-border-base: #eaefef;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --wui-color-gray-glass-001: rgba(0, 0, 0, 0.01);
        --wui-color-gray-glass-002: rgba(0, 0, 0, 0.02);
        --wui-color-gray-glass-005: rgba(0, 0, 0, 0.05);
        --wui-color-gray-glass-010: rgba(0, 0, 0, 0.1);
        --wui-color-gray-glass-015: rgba(0, 0, 0, 0.15);
        --wui-color-gray-glass-020: rgba(0, 0, 0, 0.2);
        --wui-color-gray-glass-025: rgba(0, 0, 0, 0.25);
        --wui-color-gray-glass-030: rgba(0, 0, 0, 0.3);
        --wui-color-gray-glass-060: rgba(0, 0, 0, 0.6);
        --wui-color-gray-glass-080: rgba(0, 0, 0, 0.8);
        --wui-color-gray-glass-090: rgba(0, 0, 0, 0.9);

        --wui-color-dark-glass-100: rgba(233, 233, 233, 1);

        --w3m-card-embedded-shadow-color: rgb(224 225 233 / 25%);
      }
    </style><style>
      :root {
        --w3m-color-mix: #fff;
        --w3m-accent: #e84125;
        --w3m-default: #fff;

        --wui-color-modal-bg-base: #121313;
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(230, 100%, 67%, 1);
        --wui-color-blueberry-090: hsla(231, 76%, 61%, 1);
        --wui-color-blueberry-080: hsla(230, 59%, 55%, 1);
        --wui-color-blueberry-050: hsla(231, 100%, 70%, 0.1);

        --wui-color-fg-100: #e4e7e7;
        --wui-color-fg-125: #d0d5d5;
        --wui-color-fg-150: #a8b1b1;
        --wui-color-fg-175: #a8b0b0;
        --wui-color-fg-200: #949e9e;
        --wui-color-fg-225: #868f8f;
        --wui-color-fg-250: #788080;
        --wui-color-fg-275: #788181;
        --wui-color-fg-300: #6e7777;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #363636;

        --wui-color-bg-100: #141414;
        --wui-color-bg-125: #191a1a;
        --wui-color-bg-150: #1e1f1f;
        --wui-color-bg-175: #222525;
        --wui-color-bg-200: #272a2a;
        --wui-color-bg-225: #2c3030;
        --wui-color-bg-250: #313535;
        --wui-color-bg-275: #363b3b;
        --wui-color-bg-300: #3b4040;
        --wui-color-bg-325: #252525;
        --wui-color-bg-350: #ffffff;

        --wui-color-success-base-100: #26d962;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f25a67;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 217, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 217, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 217, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 217, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 217, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 217, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 217, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 217, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 217, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 217, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(242, 90, 103, 0.01);
        --wui-color-error-glass-002: rgba(242, 90, 103, 0.02);
        --wui-color-error-glass-005: rgba(242, 90, 103, 0.05);
        --wui-color-error-glass-010: rgba(242, 90, 103, 0.1);
        --wui-color-error-glass-015: rgba(242, 90, 103, 0.15);
        --wui-color-error-glass-020: rgba(242, 90, 103, 0.2);
        --wui-color-error-glass-025: rgba(242, 90, 103, 0.25);
        --wui-color-error-glass-030: rgba(242, 90, 103, 0.3);
        --wui-color-error-glass-060: rgba(242, 90, 103, 0.6);
        --wui-color-error-glass-080: rgba(242, 90, 103, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-color-gray-glass-001: rgba(255, 255, 255, 0.01);
        --wui-color-gray-glass-002: rgba(255, 255, 255, 0.02);
        --wui-color-gray-glass-005: rgba(255, 255, 255, 0.05);
        --wui-color-gray-glass-010: rgba(255, 255, 255, 0.1);
        --wui-color-gray-glass-015: rgba(255, 255, 255, 0.15);
        --wui-color-gray-glass-020: rgba(255, 255, 255, 0.2);
        --wui-color-gray-glass-025: rgba(255, 255, 255, 0.25);
        --wui-color-gray-glass-030: rgba(255, 255, 255, 0.3);
        --wui-color-gray-glass-060: rgba(255, 255, 255, 0.6);
        --wui-color-gray-glass-080: rgba(255, 255, 255, 0.8);
        --wui-color-gray-glass-090: rgba(255, 255, 255, 0.9);

        --wui-color-dark-glass-100: rgba(42, 42, 42, 1);

        --wui-icon-box-bg-error-base-100: #3c2426;
        --wui-icon-box-bg-blue-base-100: #20303f;
        --wui-icon-box-bg-success-base-100: #1f3a28;
        --wui-icon-box-bg-inverse-base-100: #243240;

        --wui-all-wallets-bg-100: #222b35;

        --wui-avatar-border-base: #252525;

        --wui-thumbnail-border-base: #252525;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --w3m-card-embedded-shadow-color: rgb(17 17 18 / 25%);
      }
    </style></head><body><script type="text/javascript" crossorigin="anonymous" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/surveys.js.download"></script><script type="text/javascript" crossorigin="anonymous" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/config.js.download"></script><script type="text/javascript" crossorigin="anonymous" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/recorder.js.download"></script><script>((e,t,r,i,s,a,o,l)=>{let d=document.documentElement,c=["light","dark"];function p(t){var r;(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,i=r&&a?s.map(e=>a[e]||e):s;r?(d.classList.remove(...i),d.classList.add(a&&a[t]?a[t]:t)):d.setAttribute(e,t)}),r=t,l&&c.includes(r)&&(d.style.colorScheme=r)}if(i)p(i);else try{let e=localStorage.getItem(t)||r,i=o&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;p(i)}catch(e){}})("class","theme","dark",null,["light","dark"],null,true,true)</script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/webpack-84619308a694dcc7.js.download" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[44645,[],\"\"]\n3:I[95905,[],\"\"]\n6:I[96315,[],\"OutletBoundary\"]\n9:I[96315,[],\"ViewportBoundary\"]\nb:I[96315,[],\"MetadataBoundary\"]\nd:I[88476,[],\"\"]\n:HL[\"/_next/static/media/66f30814ff6d7cdf.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/c9bf96f98f290dd8-s.p.otf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/otf\"}]\n:HL[\"/_next/static/media/e11418ac562b8ac1-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/fe8ee027c741a75e-s.p.otf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/otf\"}]\n:HL[\"/_next/static/css/d996ddb0d453ffca.css?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"style\"]\n:HL[\"/_next/static/css/712062295f89cccd.css?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"style\"]\n:HL[\"/_next/static/css/96b8c2f2f79bc08e.css?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"style\"]\n:HL[\"/_next/static/css/c69f9910787c2207.css?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"Wpy3f8FUafeQp8ARBxxSr\",\"p\":\"\",\"c\":[\"\",\"blog\",\"a-hitchhikers-guide-to-solana-program-security\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"(frontend)\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"a-hitchhikers-guide-to-solana-program-security\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true]}],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"(frontend)\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/d996ddb0d453ffca.css?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/712062295f89cccd.css?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],\"$L4\"]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"a-hitchhikers-guide-to-solana-program-security\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",\"$undefined\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/96b8c2f2f79bc08e.css?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c69f9910787c2207.css?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L6\",null,{\"children\":[\"$L7\",\"$L8\",null]}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"bPXnTfKdg_A0QYUuEA8ka\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:I[32731,[\"348\",\"static/chunks/3f156bc3-c7ec4965a9cc93b3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2606\",\"static/chunks/a5b57e93-83afed8b00e63955.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3775\",\"static/chunks/3775-39a1abeb2ac64be9.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8062\",\"static/chunks/8062-b208073f40d759f3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3971\",\"static/chunks/3971-5e62e63544cd1c92.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"9559\",\"static/chunks/app/(frontend)/layout-10f2cfdada9bda29.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"PostHogProvider\"]\nf:I[32686,[\"348\",\"static/chunks/3f156bc3-c7ec4965a9cc93b3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2606\",\"static/chunks/a5b57e93-83afed8b00e63955.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3775\",\"static/chunks/3775-39a1abeb2ac64be9.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8062\",\"static/chunks/8062-b208073f40d759f3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3971\",\"static/chunks/3971-5e62e63544cd1c92.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"9559\",\"static/chunks/app/(frontend)/layout-10f2cfdada9bda29.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"NuqsAdapter\"]\n10:I[77653,[\"348\",\"static/chunks/3f156bc3-c7ec4965a9cc93b3.js?dpl=dpl_HJgtearsg8"])</script><script>self.__next_f.push([1,"TACAnPZSMHfVFQVvNK\",\"2606\",\"static/chunks/a5b57e93-83afed8b00e63955.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3775\",\"static/chunks/3775-39a1abeb2ac64be9.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8062\",\"static/chunks/8062-b208073f40d759f3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3971\",\"static/chunks/3971-5e62e63544cd1c92.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"9559\",\"static/chunks/app/(frontend)/layout-10f2cfdada9bda29.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"PreviousPathProvider\"]\n11:I[62019,[\"348\",\"static/chunks/3f156bc3-c7ec4965a9cc93b3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2606\",\"static/chunks/a5b57e93-83afed8b00e63955.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3775\",\"static/chunks/3775-39a1abeb2ac64be9.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8062\",\"static/chunks/8062-b208073f40d759f3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3971\",\"static/chunks/3971-5e62e63544cd1c92.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"9559\",\"static/chunks/app/(frontend)/layout-10f2cfdada9bda29.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"ThemeProvider\"]\n12:I[47203,[\"348\",\"static/chunks/3f156bc3-c7ec4965a9cc93b3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2606\",\"static/chunks/a5b57e93-83afed8b00e63955.js?"])</script><script>self.__next_f.push([1,"dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3775\",\"static/chunks/3775-39a1abeb2ac64be9.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8062\",\"static/chunks/8062-b208073f40d759f3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3971\",\"static/chunks/3971-5e62e63544cd1c92.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"9559\",\"static/chunks/app/(frontend)/layout-10f2cfdada9bda29.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"AppKitProvider\"]\n14:I[13421,[\"2606\",\"static/chunks/a5b57e93-83afed8b00e63955.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"947\",\"static/chunks/app/(frontend)/not-found-9a323393acf8da8c.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"default\"]\n16:I[23526,[\"348\",\"static/chunks/3f156bc3-c7ec4965a9cc93b3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2606\",\"static/chunks/a5b57e93-83afed8b00e63955.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3775\",\"static/chunks/3775-39a1abeb2ac64be9.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8062\",\"static/chunks/8062-b208073f40d759f3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3971\",\"static/chunks/3971-5e62e63544cd1c92.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?d"])</script><script>self.__next_f.push([1,"pl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"9559\",\"static/chunks/app/(frontend)/layout-10f2cfdada9bda29.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"Toaster\"]\n17:I[96379,[\"348\",\"static/chunks/3f156bc3-c7ec4965a9cc93b3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2606\",\"static/chunks/a5b57e93-83afed8b00e63955.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3775\",\"static/chunks/3775-39a1abeb2ac64be9.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8062\",\"static/chunks/8062-b208073f40d759f3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3971\",\"static/chunks/3971-5e62e63544cd1c92.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"9559\",\"static/chunks/app/(frontend)/layout-10f2cfdada9bda29.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"SpeedInsights\"]\n18:I[9374,[\"348\",\"static/chunks/3f156bc3-c7ec4965a9cc93b3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2606\",\"static/chunks/a5b57e93-83afed8b00e63955.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3775\",\"static/chunks/3775-39a1abeb2ac64be9.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8062\",\"static/chunks/8062-b208073f40d759f3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3971\",\"static/chunks/3971-5e62e63544cd1c92.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"9559\",\"static/chunks/app/(frontend)/layout-10f2"])</script><script>self.__next_f.push([1,"cfdada9bda29.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"GoogleAnalytics\"]\n4:[\"$\",\"html\",null,{\"className\":\"__variable_3a0388 __variable_c1e5c9 __variable_00879e scroll-smooth\",\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"href\":\"/favicon-96x96.png\",\"sizes\":\"96x96\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/svg+xml\",\"href\":\"/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"shortcut icon\",\"href\":\"/favicon.ico\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"180x180\",\"href\":\"/apple-touch-icon.png\"}],[\"$\",\"meta\",null,{\"name\":\"apple-mobile-web-app-title\",\"content\":\"Helius\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/site.webmanifest\"}],[\"$\",\"link\",null,{\"href\":\"https://www.googletagmanager.com\",\"rel\":\"preconnect\"}],[\"$\",\"link\",null,{\"href\":\"https://www.google-analytics.com\",\"rel\":\"preconnect\"}]]}],[\"$\",\"body\",null,{\"children\":[[\"$\",\"$Le\",null,{\"children\":[\"$\",\"$Lf\",null,{\"children\":[\"$\",\"$L10\",null,{\"children\":[\"$\",\"$L11\",null,{\"attribute\":\"class\",\"defaultTheme\":\"dark\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[\"$\",\"$L12\",null,{\"children\":[\"$L13\",[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"$L14\",null,{}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],\"$L15\",[\"$\",\"$L16\",null,{}]]}]}]}]}]}],[\"$\",\"$L17\",null,{}]]}],[\"$\",\"$L18\",null,{\"gaId\":\"G-5NGYGFEVGG\"}]]}]\n"])</script><script>self.__next_f.push([1,"19:I[16614,[\"348\",\"static/chunks/3f156bc3-c7ec4965a9cc93b3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2606\",\"static/chunks/a5b57e93-83afed8b00e63955.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3775\",\"static/chunks/3775-39a1abeb2ac64be9.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8062\",\"static/chunks/8062-b208073f40d759f3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"3971\",\"static/chunks/3971-5e62e63544cd1c92.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"9559\",\"static/chunks/app/(frontend)/layout-10f2cfdada9bda29.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"HeaderClient\"]\n1a:I[52184,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"\"]\n1b:I[56545,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfV"])</script><script>self.__next_f.push([1,"FQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"Image\"]\n13:[\"$\",\"$L19\",null,{\"header\":{\"navItems\":[]}}]\n"])</script><script>self.__next_f.push([1,"15:[\"$\",\"footer\",null,{\"className\":\"bg-gradient-to-b from-[#0E0E11] from-10% to-black to-50%\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-7xl px-6 py-16 sm:py-30 lg:px-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"pt-12 xl:grid xl:grid-cols-8 xl:gap-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"xl:col-span-2 space-y-6 flex flex-col \",\"children\":[[\"$\",\"$L1a\",null,{\"href\":\"/\",\"children\":[\"$\",\"$L1b\",null,{\"alt\":\"Helius Logo\",\"width\":114,\"height\":24,\"src\":\"/logo-footer.svg\",\"quality\":90}]}],[\"$\",\"$L1a\",null,{\"href\":\"https://security.helius.dev\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[\"$\",\"$L1b\",null,{\"alt\":\"SOC\",\"width\":50,\"height\":50,\"src\":\"/logo-SOC.png\",\"quality\":90}]}]]}],[\"$\",\"div\",null,{\"className\":\"mt-16 grid grid-cols-2 gap-8 xl:col-span-6 xl:mt-0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"md:grid md:grid-cols-2 md:gap-8\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h3\",null,{\"className\":\"font-medium text-gray-50 font-mono text-afsm uppercase\",\"children\":\"Product\"}],[\"$\",\"ul\",null,{\"role\":\"list\",\"className\":\"mt-6 space-y-4\",\"children\":[[\"$\",\"li\",\"RPC Nodes\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/solana-rpc-nodes\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"RPC Nodes\",false]}]}],[\"$\",\"li\",\"LaserStream\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/laserstream\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"LaserStream\",false]}]}],[\"$\",\"li\",\"gRPC\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/solana-grpc\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"gRPC\",false]}]}],[\"$\",\"li\",\"Webhooks \u0026 WebSockets\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/solana-webhooks-websockets\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Webhooks \u0026 WebSockets\",false]}]}],[\"$\",\"li\",\"NFT APIs\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/solana-nft-apis\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"NFT APIs\",false]}]}],[\"$\",\"li\",\"Token APIs\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/solana-token-apis\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Token APIs\",false]}]}],[\"$\",\"li\",\"Transaction APIs\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/solana-transaction-apis\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Transaction APIs\",false]}]}],[\"$\",\"li\",\"ZK Compression\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/zk-compression\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"ZK Compression\",false]}]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mt-10 md:mt-0\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"font-medium text-gray-50 font-mono text-afsm uppercase\",\"children\":\"Validator\"}],[\"$\",\"ul\",null,{\"role\":\"list\",\"className\":\"mt-6 space-y-4\",\"children\":[[\"$\",\"li\",\"Our Validator\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/validator\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Our Validator\",false]}]}],[\"$\",\"li\",\"Validator-as-a-Service\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/validator-as-a-service\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Validator-as-a-Service\",false]}]}],[\"$\",\"li\",\"Stake with Us\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/stake\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Stake with Us\",false]}]}],[\"$\",\"li\",\"How to Buy hSOL\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/blog/what-is-hsol\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"How to Buy hSOL\",false]}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"md:grid md:grid-cols-2 md:gap-8\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h3\",null,{\"className\":\"font-medium text-gray-50 font-mono text-afsm uppercase\",\"children\":\"Resources\"}],[\"$\",\"ul\",null,{\"role\":\"list\",\"className\":\"mt-6 space-y-4\",\"children\":[[\"$\",\"li\",\"Blog\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/blog\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Blog\",false]}]}],[\"$\",\"li\",\"Docs\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/docs\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Docs\",false]}]}],[\"$\",\"li\",\"Status\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"https://helius.statuspage.io/\",\"className\":\"text-gray-500 hover:text-gray-400\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[\"Status\",false]}]}],[\"$\",\"li\",\"Pricing\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/pricing\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Pricing\",false]}]}],[\"$\",\"li\",\"Built with Helius\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/built-with-helius\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Built with Helius\",false]}]}],[\"$\",\"li\",\"Startup Launchpad\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/startup-launchpad\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Startup Launchpad\",false]}]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mt-10 md:mt-0\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"font-medium text-gray-50 font-mono text-afsm uppercase\",\"children\":\"Company\"}],[\"$\",\"ul\",null,{\"role\":\"list\",\"className\":\"mt-6 space-y-4\",\"children\":[[\"$\",\"li\",\"Careers\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/careers\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Careers\",false]}]}],[\"$\",\"li\",\"Contact Sales\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"https://form.typeform.com/to/KiacmxpZ\",\"className\":\"text-gray-500 hover:text-gray-400\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[\"Contact Sales\",false]}]}],[\"$\",\"li\",\"Support\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/docs/support\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Support\",false]}]}],[\"$\",\"li\",\"Media Kit\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"https://drive.google.com/drive/folders/1Kko7VCzcoDuQICiOAHZGXwZ-gB_xvUYj?usp=sharing\",\"className\":\"text-gray-500 hover:text-gray-400\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[\"Media Kit\",false]}]}],[\"$\",\"li\",\"Security\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"https://security.helius.dev/\",\"className\":\"text-gray-500 hover:text-gray-400\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[\"Security\",false]}]}],[\"$\",\"li\",\"Privacy Policy\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/privacy-policy\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Privacy Policy\",false]}]}],[\"$\",\"li\",\"Terms \u0026 Conditions\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"/terms\",\"className\":\"text-gray-500 hover:text-gray-400\",\"children\":[\"Terms \u0026 Conditions\",false]}]}],[\"$\",\"li\",\"Solana Roadmap\",{\"children\":[\"$\",\"$L1a\",null,{\"href\":\"https://www.solanaroadmap.com/\",\"className\":\"text-gray-500 hover:text-gray-400\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[\"Solana Roadmap\",false]}]}]]}]]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"mt-12 border-t border-gray-900 pt-6 md:flex md:items-center md:justify-between\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex gap-x-1 md:order-2\",\"children\":[[\"$\",\"$L1a\",\"X\",{\"href\":\"https://x.com/heliuslabs\",\"target\":\"_blank\",\"className\":\"inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground text-gray-400 hover:text-primary-light\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"X\"}],[\"$\",\"div\",null,{\"className\":\"size-4\",\"children\":[\"$\",\"svg\",null,{\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 18 18\",\"children\":[[\"$\",\"g\",null,{\"clipPath\":\"url(#xb)\",\"children\":[\"$\",\"path\",null,{\"fillRule\":\"evenodd\",\"clipRule\":\"evenodd\",\"d\":\"m11.96 17.25-4.163-5.932-5.21 5.932H.382L6.82 9.923.382.75h5.66l3.922 5.591L14.88.75h2.205l-6.138 6.987 6.673 9.513h-5.66Zm2.454-1.672H12.93L3.539 2.423h1.484L8.784 7.69l.65.914 4.98 6.974Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"defs\",null,{\"children\":[\"$\",\"clipPath\",null,{\"id\":\"xb\",\"children\":[\"$\",\"path\",null,{\"fill\":\"#fff\",\"d\":\"M0 0h18v18H0z\"}]}]}]]}]}]],\"ref\":null}],[\"$\",\"$L1a\",\"LinkedIn\",{\"href\":\"https://www.linkedin.com/company/heliusapi\",\"target\":\"_blank\",\"className\":\"inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground text-gray-400 hover:text-primary-light\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"LinkedIn\"}],[\"$\",\"div\",null,{\"className\":\"size-4\",\"children\":[\"$\",\"svg\",null,{\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 18 18\",\"children\":[[\"$\",\"g\",null,{\"clipPath\":\"url(#linkedina)\",\"children\":[\"$\",\"path\",null,{\"d\":\"M16.668 0H1.328C.595 0 0 .58 0 1.297V16.7C0 17.416.594 18 1.329 18h15.339c.734 0 1.332-.584 1.332-1.297V1.297C18 .58 17.402 0 16.668 0ZM5.34 15.339H2.668V6.746H5.34v8.593ZM4.004 5.576A1.548 1.548 0 1 1 4 2.48a1.548 1.548 0 0 1 .005 3.096Zm11.335 9.763H12.67v-4.177c0-.995-.017-2.278-1.388-2.278-1.389 0-1.6 1.086-1.6 2.208v4.247H7.017V6.746h2.56v1.175h.035c.355-.675 1.227-1.389 2.524-1.389 2.704 0 3.203 1.779 3.203 4.092v4.715Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"defs\",null,{\"children\":[\"$\",\"clipPath\",null,{\"id\":\"linkedina\",\"children\":[\"$\",\"path\",null,{\"fill\":\"#fff\",\"d\":\"M0 0h18v18H0z\"}]}]}]]}]}]],\"ref\":null}],[\"$\",\"$L1a\",\"Discord\",{\"href\":\"https://discord.com/invite/6GXdee3gBj\",\"target\":\"_blank\",\"className\":\"inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground text-gray-400 hover:text-primary-light\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"Discord\"}],[\"$\",\"div\",null,{\"className\":\"size-4\",\"children\":[\"$\",\"svg\",null,{\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 18 18\",\"children\":[\"$\",\"path\",null,{\"d\":\"M14.727 3.768a13.594 13.594 0 0 0-3.404-1.053 9.43 9.43 0 0 0-.436.89 12.61 12.61 0 0 0-3.778 0 9.464 9.464 0 0 0-.436-.89A13.69 13.69 0 0 0 3.266 3.77C1.112 6.974.528 10.1.82 13.18a13.694 13.694 0 0 0 4.175 2.106c.338-.457.637-.942.894-1.45a8.857 8.857 0 0 1-1.408-.675c.118-.086.234-.175.345-.26a9.764 9.764 0 0 0 8.348 0c.113.092.228.18.345.26-.45.267-.922.493-1.41.677.256.507.555.992.893 1.448a13.635 13.635 0 0 0 4.178-2.105c.343-3.572-.585-6.668-2.453-9.413ZM6.26 11.285c-.814 0-1.486-.742-1.486-1.656 0-.913.649-1.662 1.483-1.662.835 0 1.502.75 1.488 1.662-.015.914-.656 1.656-1.485 1.656Zm5.482 0c-.815 0-1.485-.742-1.485-1.656 0-.913.65-1.662 1.485-1.662.836 0 1.498.75 1.483 1.662-.014.914-.654 1.656-1.483 1.656Z\",\"fill\":\"currentColor\"}]}]}]],\"ref\":null}]]}],[\"$\",\"p\",null,{\"className\":\"mt-8 text-afsm text-gray-500 md:order-1 md:mt-0\",\"children\":[\"© \",2025,\" Helius, Inc. All rights reserved.\"]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"8:null\nc:[[\"$\",\"title\",\"0\",{\"children\":\"A Hitchhiker's Guide to Solana Program Security\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Learn about Solana program security and how to mitigate common vulnerabilities\"}],[\"$\",\"link\",\"2\",{\"rel\":\"canonical\",\"href\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:title\",\"content\":\"A Hitchhiker's Guide to Solana Program Security\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:description\",\"content\":\"Learn about Solana program security and how to mitigate common vulnerabilities\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:url\",\"content\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:site_name\",\"content\":\"Helius\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:image\",\"content\":\"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:title\",\"content\":\"A Hitchhiker's Guide to Solana Program Security\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:description\",\"content\":\"Learn about Solana program security and how to mitigate common vulnerabilities\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:image\",\"content\":\"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp\"}]]\n"])</script><script>self.__next_f.push([1,"1c:I[93284,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"default\"]\n1f:I[55251,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"ImageMedia\"]\n20:I[23764,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnP"])</script><script>self.__next_f.push([1,"ZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"BackButton\"]\n21:I[69471,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"PostAuthors\"]\n22:I[53809,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"Accordion\"]\n23:I[53809,[\"2"])</script><script>self.__next_f.push([1,"184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"AccordionItem\"]\n24:I[53809,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"AccordionTrigger\"]\n25:I[53809,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZS"])</script><script>self.__next_f.push([1,"MHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"AccordionContent\"]\n26:I[58313,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"TOC\"]\n2d:I[30377,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"Dialog\"]\n2e:I[30377,[\"2184\",\"s"])</script><script>self.__next_f.push([1,"tatic/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"DialogTrigger\"]\n2f:I[30377,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"DialogContent\"]\n30:I[30377,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK"])</script><script>self.__next_f.push([1,"\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"DialogHeader\"]\n31:I[30377,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"DialogTitle\"]\n59:I[63420,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"ScrollArea\"]\n5a:I[72843,[\"2184\",\"sta"])</script><script>self.__next_f.push([1,"tic/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"Card\"]\n5b:I[63420,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"ScrollBar\"]\n5c:I[75013,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"stati"])</script><script>self.__next_f.push([1,"c/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"Subscribe\"]\n1e:Tf9a,"])</script><script>self.__next_f.push([1,"{\"@context\":\"https://schema.org\",\"@graph\":[{\"@type\":\"Article\",\"@id\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#article\",\"isAccessibleForFree\":true,\"isPartOf\":{\"@id\":\"https://www.helius.dev/#website\"},\"author\":[{\"@type\":\"Person\",\"name\":\"0xIchigo\",\"jobTitle\":\"Developer Experience Engineer\",\"image\":{\"@type\":\"ImageObject\",\"url\":\"/api/media/file/ichi-bro.jpg\"},\"sameAs\":[\"https://x.com/0xIchigo\",\"https://www.linkedin.com/in/evan-wyatt/\"]}],\"editor\":[],\"contributor\":[],\"headline\":\"A Hitchhiker's Guide to Solana Program Security\",\"description\":\"Learn about Solana program security and how to mitigate common vulnerabilities\",\"datePublished\":\"2024-03-18T20:30:22.000Z\",\"dateModified\":\"2025-02-16T10:17:15.480Z\",\"mainEntityOfPage\":{\"@id\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#article\"},\"wordCount\":7616,\"publisher\":{\"@id\":\"https://www.helius.dev/#organization\"},\"image\":{\"@type\":\"ImageObject\",\"url\":\"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp\",\"width\":3840,\"height\":2160},\"thumbnailUrl\":\"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/\"]}]},{\"@type\":\"WebPage\",\"@id\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/\",\"url\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/\",\"name\":\"A Hitchhiker's Guide to Solana Program Security\",\"isPartOf\":{\"@id\":\"https://www.helius.dev/#website\"},\"primaryImageOfPage\":{\"@id\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#primaryimage\"},\"image\":{\"@id\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#primaryimage\"},\"thumbnailUrl\":\"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp\",\"datePublished\":\"2024-03-18T20:30:22.000Z\",\"dateModified\":\"2025-02-16T10:17:15.480Z\",\"breadcrumb\":{\"@id\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#breadcrumb\"},\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#primaryimage\",\"url\":\"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp\",\"contentUrl\":\"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp\",\"width\":3840,\"height\":2160},{\"@type\":\"BreadcrumbList\",\"@id\":\"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#breadcrumb\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"name\":\"Home\",\"item\":\"https://www.helius.dev/\"},{\"@type\":\"ListItem\",\"position\":2,\"name\":\"Blog\",\"item\":\"https://www.helius.dev/blog\"},{\"@type\":\"ListItem\",\"position\":3,\"name\":\"A Hitchhiker's Guide to Solana Program Security\"}]},{\"@type\":\"WebSite\",\"@id\":\"https://www.helius.dev/#website\",\"url\":\"https://www.helius.dev/\",\"name\":\"Helius - Solana's Leading RPC and API Platform\",\"description\":\"Solana RPCs, APIs, webhooks and dedicated infrastructure to build and ship crypto apps, fast. Get started for free in 1 click.\",\"inLanguage\":\"en-US\",\"publisher\":{\"@id\":\"https://www.helius.dev/#organization\"}},{\"@type\":[\"Organization\"],\"@id\":\"https://www.helius.dev/#organization\",\"name\":\"Helius\",\"image\":{\"@type\":\"ImageObject\",\"inLanguage\":\"en-US\",\"@id\":\"https://www.helius.dev/#logo\",\"url\":\"https://www.helius.dev/logo.svg\",\"contentUrl\":\"https://www.helius.dev/logo.svg\",\"width\":190,\"height\":40,\"caption\":\"Helius Logo\"},\"logo\":{\"@id\":\"https://www.helius.dev/#logo\"},\"description\":\"Solana RPCs, APIs, webhooks and dedicated infrastructure to build and ship crypto apps, fast. Get started for free in 1 click.\",\"sameAs\":[\"https://www.helius.dev/\",\"https://www.x.com/heliuslabs\",\"https://www.linkedin.com/company/heliusapi\",\"https://www.youtube.com/@helius_labs\"]}]}"])</script><script>self.__next_f.push([1,"27:T511,pub fn update_rewards(ctx: Context\u003cUpdateStakingRewards\u003e, amount: u64) -\u003e Result\u003c()\u003e {\n    let staking_seeds = \u0026[b\"stake\", ctx.accounts.staker.key().as_ref(), \u0026[ctx.accounts.staking_account.bump]];\n\n    let cpi_accounts = UpdateRewards {\n        staking_account: ctx.accounts.staking_account.to_account_info(),\n    };\n    let cpi_program = ctx.accounts.rewards_distribution_program.to_account_info();\n    let cpi_ctx = CpiContext::new_with_signer(cpi_program, cpi_accounts, staking_seeds);\n\n    rewards_distribution::cpi::update_rewards(cpi_ctx, amount)?;\n\n    // Attempt to log the \"updated\" reward balance\n    msg!(\"Rewards: {}\", ctx.accounts.staking_account.rewards);\n    \n    // Logic that uses the stale ctx.accounts.staking_account.rewards\n\n    Ok(())\n}\n\n#[derive(Accounts)]\npub struct UpdateStakingRewards\u003c'info\u003e {\n    #[account(mut)]\n    pub staker: Signer\u003c'info\u003e,\n    #[account(\n        mut,\n        seeds = [b\"stake\", staker.key().as_ref()],\n        bump,\n    )]\n    pub staking_account: Account\u003c'info, StakingAccount\u003e,\n    pub rewards_distribution_program: Program\u003c'info, RewardsDistribution\u003e,\n}\n\n#[account]\npub struct StakingAccount {\n    pub staker: Pubkey,\n    pub stake_amount: u64,\n    pub rewards: u64,\n    pub bump: u8,\n}28:T562,pub fn nominate_new_authority(ctx: Context\u003cNominateAuthority\u003e, new_authority: Pubkey) -\u003e Result\u003c()\u003e {\n    let state = \u0026mut ctx.accounts.state;\n    require_keys_eq!(\n        state.authority, \n        ctx.accounts.current_authority.key()\n    );\n\n    state.pending_authority = Some(new_authority);\n    Ok(())\n}\n\npub fn accept_authority(ctx: Context\u003cAcceptAuthority\u003e) -\u003e Result\u003c()\u003e {\n    let state = \u0026mut ctx.accounts.state;\n    require_keys_eq!(\n        Some(ctx.accounts.new_authority.key()), \n        state.pending_authority\n    );\n\n    state.authority = ctx.accounts.new_authority.key();\n    state.pending_authority = None;\n    Ok(())\n}\n\n#[derive(Accounts)]\npub struct NominateAuthority\u003c'info\u003e {\n "])</script><script>self.__next_f.push([1,"   #[account(\n        mut,\n        has_one = authority,\n    )]\n    pub state: Account\u003c'info, ProgramState\u003e,\n    pub current_authority: Signer\u003c'info\u003e,\n    pub system_program: Program\u003c'info, System\u003e,\n}\n\n#[derive(Accounts)]\npub struct AcceptAuthority\u003c'info\u003e {\n    #[account(\n        mut,\n        constraint = state.pending_authority == Some(new_authority.key())\n    )]\n    pub state: Account\u003c'info, ProgramState\u003e,\n    pub new_authority: Signer\u003c'info\u003e,\n}\n\n#[account]\npub struct ProgramState {\n    pub authority: Pubkey,\n    pub pending_authority: Option\u003cPubkey\u003e,\n    // Other relevant program state fields\n}29:T42a,pub fn create_profile(ctx: Context\u003cCreateProfile\u003e, user_id: u64, attributes: Vec\u003cu8\u003e, bump: u8) -\u003e Result\u003c()\u003e {\n    // Explicitly derive the PDA using create_program_address and a user-provided bump\n    let seeds: \u0026[\u0026[u8]] = \u0026[b\"profile\", \u0026user_id.to_le_bytes(),\u0026[bump]];\n    let (derived_address, _bump) = Pubkey::create_program_address(seeds, \u0026ctx.program_id)?;\n\n    if derived_address != ctx.accounts.profile.key() {\n        return Err(ProgramError::InvalidSeeds);\n    }\n\n    let profile_pda = \u0026mut ctx.accounts.profile;\n    profile_pda.user_id = user_id;\n    profile_pda.attributes = attributes;\n\n    Ok(())\n}\n\n#[derive(Accounts)]\npub struct CreateProfile\u003c'info\u003e {\n    #[account(mut)]\n    pub user: Signer\u003c'info\u003e,\n    /// The profile account, expected to be a PDA derived with the user_id and a user-provided bump seed\n    #[account(mut)]\n    pub profile: Account\u003c'info, UserProfile\u003e,\n    pub system_program: Program\u003c'info, System\u003e,\n}\n\n#[account]\npub struct UserProfile {\n    pub user_id: u64,\n    pub attributes: Vec\u003cu8\u003e,\n}2a:T47b,pub fn create_profile(ctx: Context\u003cCreateProfile\u003e, user_id: u64, attributes: Vec\u003cu8\u003e) -\u003e Result\u003c()\u003e {\n    // Securely derive the PDA using find_program_address to ensure the canonical bump is used\n    let seeds: \u0026[\u0026[u8]] = \u0026[b\"profile\", user_id.to_le_bytes()];\n    let (derived_address, bump) = Pubkey::find_program_a"])</script><script>self.__next_f.push([1,"ddress(seeds, \u0026ctx.program_id);\n\n    // Store the canonical bump in the profile for future validations\n    let profile_pda = \u0026mut ctx.accounts.profile;\n    profile_pda.user_id = user_id;\n    profile_pda.attributes = attributes;\n    profile_pda.bump = bump;\n\n    Ok(())\n}\n\n#[derive(Accounts)]\n#[instruction(user_id: u64)]\npub struct CreateProfile\u003c'info\u003e {\n    #[account(\n        init, \n        payer = user, \n        space = 8 + 1024 + 1, \n        seeds = [b\"profile\", user_id.to_le_bytes().as_ref()], \n        bump\n    )]\n    pub profile: Account\u003c'info, UserProfile\u003e,\n    #[account(mut)]\n    pub user: Signer\u003c'info\u003e,\n    pub system_program: Program\u003c'info, System\u003e,\n}\n\n#[account]\npub struct UserProfile {\n    pub user_id: u64,\n    pub attributes: Vec\u003cu8\u003e,\n    pub bump: u8,\n}2b:T766,use anchor_lang::__private::CLOSED_ACCOUNT_DISCRIMINATOR;\nuse anchor_lang::prelude::*;\nuse std::io::Cursor;\nuse std::ops::DerefMut;\n\n// Other code\n\npub fn close_account(ctx: Context\u003cCloseAccount\u003e) -\u003e ProgramResult {\n    let account = ctx.accounts.data_account.to_account_info();\n    let destination = ctx.accounts.destination.to_account_info();\n\n    **destination.lamports.borrow_mut() = destination\n        .lamports()\n        .checked_add(account.lamports())\n        .unwrap();\n    **account.lamports.borrow_mut() = 0;\n\n    // Zero out the account data\n    let mut data = account.try_borrow_mut_data()?;\n    for byte in data.deref_mut().iter_mut() {\n        *byte = 0;\n    }\n\n    // Mark the account as closed\n    let dst: \u0026mut [u8] = \u0026mut data;\n    let mut cursor = Cursor::new(dst);\n    cursor.write_all(\u0026CLOSED_ACCOUNT_DISCRIMINATOR).unwrap();\n\n    Ok(())\n}\n\npub fn force_defund(ctx: Context\u003cForceDefund\u003e) -\u003e ProgramResult {\n    let account = \u0026ctx.accounts.account;\n    let data = account.try_borrow_data()?;\n\n    if data.len() \u003c 8 || data[0..8] != CLOSED_ACCOUNT_DISCRIMINATOR {\n        return Err(ProgramError::InvalidAccountData);\n    }\n\n    let destin"])</script><script>self.__next_f.push([1,"ation = ctx.accounts.destination.to_account_info();\n\n    **destination.lamports.borrow_mut() = destination\n        .lamports()\n        .checked_add(account.lamports())\n        .unwrap();\n    **account.lamports.borrow_mut() = 0;\n\n    Ok(())\n}\n\n#[derive(Accounts)]\npub struct ForceDefund\u003c'info\u003e {\n    #[account(mut)]\n    pub account: AccountInfo\u003c'info\u003e,\n    #[account(mut)]\n    pub destination: AccountInfo\u003c'info\u003e,\n}\n\n#[derive(Accounts)]\npub struct CloseAccount\u003c'info\u003e {\n    #[account(mut)]\n    pub data_account: Account\u003c'info, Data\u003e,\n    #[account(mut)]\n    pub destination: AccountInfo\u003c'info\u003e,\n}\n\n#[account]\npub struct Data {\n    data: u64,\n}2c:T46e,use anchor_lang::prelude::*;\nuse crate::program::MyProgram;\n\ndeclare_id!(\"Cum9tTyj5HwcEiAmhgaS7Bbj4UczCwsucrCkxRECzM4e\");\n\n#[program]\npub mod my_program {\n    use super::*;\n\n    pub fn set_initial_admin(\n        ctx: Context\u003cSetInitialAdmin\u003e,\n        admin_key: Pubkey\n    ) -\u003e Result\u003c()\u003e {\n        ctx.accounts.admin_settings.admin_key = admin_key;\n        Ok(())\n    }\n\n    pub fn set_admin(...){...}\n\n    pub fn set_settings(...){...}\n}\n\n#[account]\n#[derive(Default, Debug)]\npub struct AdminSettings {\n    admin_key: Pubkey\n}\n\n#[derive(Accounts)]\npub struct SetInitialAdmin\u003c'info\u003e {\n    #[account(init, payer = authority, seeds = [b\"admin\"], bump)]\n    pub admin_settings: Account\u003c'info, AdminSettings\u003e,\n    #[account(mut)]\n    pub authority: Signer\u003c'info\u003e,\n    #[account(constraint = program.programdata_address()? == Some(program_data.key()))]\n    pub program: Program\u003c'info, MyProgram\u003e,\n    #[account(constraint = program_data.upgrade_authority_address == Some(authority.key()))]\n    pub program_data: Account\u003c'info, ProgramData\u003e,\n    pub system_program: Program\u003c'info, System\u003e,\n}"])</script><script>self.__next_f.push([1,"5:[\"$\",\"article\",null,{\"className\":\"pt-24 md:pt-30 pb-24\",\"children\":[[\"$\",\"$L1c\",null,{}],\"$L1d\",false,[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"$1e\"}}],[\"$\",\"div\",null,{\"className\":\"container\",\"children\":[\"$\",\"div\",null,{\"className\":\"mt-5 mb-6 lg:mb-14 aspect-[21/10] max-h-[450px] overflow-hidden rounded-2xl mx-auto flex items-center justify-center\",\"children\":[\"$\",\"$L1f\",null,{\"resource\":{\"id\":510,\"alt\":\"A Hitchhiker's Guide to Solana Program Security\",\"caption\":null,\"prefix\":\"production\",\"updatedAt\":\"2025-01-06T08:11:08.763Z\",\"createdAt\":\"2025-01-06T08:11:08.763Z\",\"url\":\"/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp\",\"thumbnailURL\":\"/_next/image?url=/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp\u0026w=384\u0026q=80\",\"filename\":\"a-hitchhikers-guide-to-solana-program-security.webp\",\"mimeType\":\"image/webp\",\"filesize\":115950,\"width\":3840,\"height\":2160,\"focalX\":50,\"focalY\":50},\"priority\":true,\"width\":945,\"height\":450}]}]}],[\"$\",\"div\",null,{\"className\":\"xl:grid xl:grid-cols-5 pb-24\",\"children\":[[\"$\",\"div\",null,{\"className\":\"xl:col-start-2 xl:col-span-3 container\",\"children\":[[\"$\",\"div\",null,{\"className\":\"max-w-[42rem] mx-auto mb-8 flex justify-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex gap-2 text-afsm text-gray-500\",\"children\":[[\"$\",\"$L20\",null,{\"className\":\"hover:text-primary-light flex items-center gap-2\",\"children\":[[\"$\",\"svg\",null,{\"height\":\"16\",\"strokeLinejoin\":\"round\",\"viewBox\":\"0 0 16 16\",\"width\":\"16\",\"children\":[\"$\",\"path\",null,{\"fillRule\":\"evenodd\",\"clipRule\":\"evenodd\",\"d\":\"M6.46966 13.7803L6.99999 14.3107L8.06065 13.25L7.53032 12.7197L3.56065 8.75001H14.25H15V7.25001H14.25H3.56065L7.53032 3.28034L8.06065 2.75001L6.99999 1.68935L6.46966 2.21968L1.39644 7.2929C1.00592 7.68342 1.00592 8.31659 1.39644 8.70711L6.46966 13.7803Z\",\"fill\":\"currentColor\"}]}],\" Blog\"]}],[[\"$\",\"span\",null,{\"className\":\"text-gray-500\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"text-gray-50\",\"children\":\"Fundamentals\"}]]]}]}],[\"$\",\"div\",null,{\"className\":\"max-w-[56rem] mx-auto prose sm:prose-lg lg:prose-xl mb-6 text-center\",\"children\":[\"$\",\"h1\",null,{\"children\":\"A Hitchhiker's Guide to Solana Program Security\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-[42rem] mx-auto mb-12 flex justify-center gap-2 px-8\",\"children\":[\"$\",\"$L21\",null,{\"authors\":[{\"id\":12,\"name\":\"0xIchigo\",\"title\":\"Developer Experience Engineer\",\"avatar\":{\"id\":110,\"alt\":\"0xIchigo Author Image\",\"caption\":null,\"prefix\":\"production\",\"updatedAt\":\"2025-01-30T20:55:35.672Z\",\"createdAt\":\"2024-12-19T15:02:11.553Z\",\"url\":\"/api/media/file/ichi-bro.jpg\",\"thumbnailURL\":\"/_next/image?url=/api/media/file/ichi-bro.jpg\u0026w=384\u0026q=80\",\"filename\":\"ichi-bro.jpg\",\"mimeType\":\"image/jpeg\",\"filesize\":29205,\"width\":400,\"height\":400,\"focalX\":50,\"focalY\":50},\"xProfileUrl\":\"https://x.com/0xIchigo\",\"linkedInProfileUrl\":\"https://www.linkedin.com/in/evan-wyatt/\",\"updatedAt\":\"2025-01-30T20:55:47.716Z\",\"createdAt\":\"2024-12-17T09:47:55.593Z\"}]}]}],[\"$\",\"div\",null,{\"className\":\"max-w-[42rem] mx-auto flex justify-between text-gray-500 mb-8\",\"children\":[[\"$\",\"div\",null,{\"children\":[39,\" min read\"]}],[\"$\",\"time\",null,{\"dateTime\":\"2024-03-18T20:30:22.000Z\",\"children\":\"March 18, 2024\"}]]}],[\"$\",\"div\",null,{\"className\":\"xl:hidden max-w-[42rem] mx-auto bg-gray-900 rounded-lg px-4 mb-8\",\"children\":[\"$\",\"$L22\",null,{\"type\":\"single\",\"collapsible\":true,\"children\":[\"$\",\"$L23\",null,{\"value\":\"on-this-page\",\"className\":\"border-none\",\"children\":[[\"$\",\"$L24\",null,{\"className\":\"flex items-center gap-2\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center gap-2 font-medium text-gray-100\",\"children\":[[\"$\",\"svg\",null,{\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 16 16\",\"className\":\"w-5 h-5\",\"children\":[\"$\",\"path\",null,{\"d\":\"M3.833 3a1.833 1.833 0 1 0 0 3.667 1.833 1.833 0 0 0 0-3.667ZM7.833 4.333a.5.5 0 0 0 0 1H13.5a.5.5 0 0 0 0-1H7.833ZM3.833 9.333a1.833 1.833 0 1 0 0 3.667 1.833 1.833 0 0 0 0-3.667ZM7.833 10.667a.5.5 0 1 0 0 1H13.5a.5.5 0 0 0 0-1H7.833Z\",\"fill\":\"currentColor\"}]}],\"Table of Contents\"]}]}],[\"$\",\"$L25\",null,{\"children\":[\"$\",\"$L26\",null,{\"content\":{\"root\":{\"type\":\"root\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"This article was co-authored by \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c388\",\"type\":\"link\",\"fields\":{\"url\":\"https://twitter.com/bl0ckpain\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"bl0ckpain\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\", a security researcher and smart contract developer who previously worked with \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c389\",\"type\":\"link\",\"fields\":{\"url\":\"https://kudelskisecurity.com/\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Kudelski Security\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" and \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c38a\",\"type\":\"link\",\"fields\":{\"url\":\"https://www.halborn.com/\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Halborn\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Introduction\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Solana program security is not just about preventing hackers from stealing a project’s funds — it’s about ensuring a program behaves as intended, adhering to the project’s specifications and user expectations. Solana program security can affect a dApp's performance, scalability, and interoperability. Thus, developers must be aware of potential attack vectors and common vulnerabilities before building consumer-grade applications.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"This article explores common vulnerabilities that developers will encounter when creating Solana programs. We start with an introduction to the attacker mindset for exploiting Solana programs, covering topics such as Solana’s programming model, how Solana’s design is inherently attacker-controlled, potential attack vectors, and common mitigation strategies. Then, we cover a variety of different vulnerabilities, giving an explanation of the vulnerability as well as insecure and secure code examples where applicable. \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Note this article is intended for a more intermediate or advanced audience as it assumes knowledge of Solana’s programming model and program development. \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"This article will not go through the process of building a program or Solana-specific concepts — we are focused on examining common vulnerabilities and learning how to mitigate them. If you’re new to Solana, we recommend that you read these previous blog posts before going through this article:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":\"ltr\",\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c38b\",\"type\":\"link\",\"fields\":{\"url\":\"https://www.helius.dev/blog/the-solana-programming-model-an-introduction-to-developing-on-solana\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"The Solana Programming Model: An Introduction to Developing on Solana\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"direction\":null},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c38c\",\"type\":\"link\",\"fields\":{\"url\":\"https://www.helius.dev/blog/an-introduction-to-anchor-a-beginners-guide-to-building-solana-programs\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"An Introduction to Anchor: A Beginner’s Guide to Building Solana Programs\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"direction\":null}],\"listType\":\"bullet\",\"direction\":null},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Attacker Mindset in Exploiting Solana Programs\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Solana’s Programming Model\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ed3\",\"media\":{\"id\":302,\"alt\":\"Solana programs\",\"caption\":null,\"prefix\":\"production\",\"updatedAt\":\"2025-01-05T05:52:01.839Z\",\"createdAt\":\"2025-01-05T05:52:01.839Z\",\"url\":\"/api/media/file/solana-programs.webp\",\"thumbnailURL\":\"/_next/image?url=/api/media/file/solana-programs.webp\u0026w=384\u0026q=80\",\"filename\":\"solana-programs.webp\",\"mimeType\":\"image/webp\",\"filesize\":371406,\"width\":3840,\"height\":2160,\"focalX\":50,\"focalY\":50},\"blockName\":\"\",\"blockType\":\"mediaBlock\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c38d\",\"type\":\"link\",\"fields\":{\"url\":\"https://www.helius.dev/blog/the-solana-programming-model-an-introduction-to-developing-on-solana\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Solana's programming model\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" shapes the security landscape of applications built on its network. On Solana, accounts act as containers for data, similar to files on a computer. We can separate accounts into two general types: executable and non-executable. Executable accounts, or \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"programs\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":2,\"version\":1},{\"mode\":\"normal\",\"text\":\", are accounts capable of running code. Non-executable accounts are used for data storage without the ability to execute code (because they don't store any code). This decoupling of code and data means that programs are stateless — they interact with data stored in other accounts, passed by reference during transactions.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Solana is Attacker-Controlled\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ed4\",\"media\":{\"id\":303,\"alt\":\"Solana transaction\",\"caption\":null,\"prefix\":\"production\",\"updatedAt\":\"2025-01-05T05:53:22.398Z\",\"createdAt\":\"2025-01-05T05:53:22.398Z\",\"url\":\"/api/media/file/solana-transaction.webp\",\"thumbnailURL\":\"/_next/image?url=/api/media/file/solana-transaction.webp\u0026w=384\u0026q=80\",\"filename\":\"solana-transaction.webp\",\"mimeType\":\"image/webp\",\"filesize\":427004,\"width\":3840,\"height\":2160,\"focalX\":50,\"focalY\":50},\"blockName\":\"\",\"blockType\":\"mediaBlock\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"A transaction specifies the program to call, a list of accounts, and a byte array of instruction data. This model relies on the program to parse and interpret the accounts and instructions a given transaction provides. Allowing any account to be passed into a program's function grants attackers significant control over the data a program will operate on. Understanding Solana's inherently attacker-controlled programming model is crucial to developing secure programs.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Given an attacker's ability to pass \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"any\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":2,\"version\":1},{\"mode\":\"normal\",\"text\":\" account into a program's function, data validation becomes a fundamental pillar of Solana program security. Developers must ensure that their program can distinguish between legitimate and malicious inputs. This includes verifying account ownership, ensuring accounts are of an expected type, and whether an account is a signer.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Potential Attack Vectors\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Solana's unique programming model and execution environment give rise to specific attack vectors. Understanding these vectors is crucial for developers to safeguard their programs against potential exploits. These attack vectors include:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Logic Bugs\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": flaws in program logic could be manipulated to cause unintended behavior, such as a loss of assets or unauthorized access. This also includes failing to implement project specifications correctly — if a program claims to do \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"x\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":2,\"version\":1},{\"mode\":\"normal\",\"text\":\", then it should do \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"x\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":2,\"version\":1},{\"mode\":\"normal\",\"text\":\" and all of its idiosyncrasies\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":\"ltr\"},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Data Validation Flaws\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": inadequately validating input data can allow attackers to pass in malicious data and manipulate program state or execution\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":\"ltr\"},{\"type\":\"listitem\",\"value\":3,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Rust-Specific Issues\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": despite Rust's safety features, unsafe code blocks, concurrency issues, and panics can introduce vulnerabilities\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":\"ltr\"},{\"type\":\"listitem\",\"value\":4,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Access Control Vulnerabilities\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": failing to correctly implement access control checks, such as verifying an account’s owner, can lead to unauthorized actions by a malicious actor\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":\"ltr\"},{\"type\":\"listitem\",\"value\":5,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Arithmetic and Precision Errors\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": overflows/underflows and precision errors can be exploited for financial gain or cause a program to malfunction\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":\"ltr\"},{\"type\":\"listitem\",\"value\":6,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Cross-Program Invocation (CPI) Issues\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": flaws in handling CPIs can lead to unexpected state changes or errors if a called program behaves maliciously or unexpectedly\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":\"ltr\"},{\"type\":\"listitem\",\"value\":7,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Program Derived Addresses (PDAs) Misuse\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": incorrectly generating or handling PDAs can lead to vulnerabilities where attackers can hijack or spoof PDAs to gain unauthorized access or manipulate program-controlled accounts\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":\"ltr\"}],\"listType\":\"bullet\",\"direction\":\"ltr\"},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Note that reentrancy is inherently limited on Solana due to its execution model. The Solana runtime restricts CPIs to a maximum depth of four and enforces strict account rules, such as only allowing an account's owner to modify its data. These constraints prevent reentrancy attacks by limiting direct self-recursion and ensuring a program cannot be involuntarily invoked in an intermediary state.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Mitigation Strategies\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate these potential attacks, developers should employ a combination of rigorous testing, code auditing, and adherence to best practices:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Implement comprehensive input validation and access control checks\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Use Rust's type system and safety features to its fullest extent, avoiding unsafe code unless necessary\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":3,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Follow Solana and Rust security best practices and stay up to date with new developments\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":4,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Conduct internal code reviews and use automated tools to identify common vulnerabilities and logic errors during program development\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":5,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Have your codebase audited by reputable third parties, including security firms and independent security researchers\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":6,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Create a bug bounty platform for your program to incentivize the reporting of vulnerabilities rather than relying on \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c38e\",\"type\":\"link\",\"fields\":{\"url\":\"https://en.wikipedia.org/wiki/Grey_hat\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"grey hats\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"direction\":null}],\"listType\":\"bullet\",\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The following sections will explore different vulnerabilities alphabetically. Each section will describe a potential vulnerability, explain how to mitigate the vulnerability and give example scenarios whenever possible.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Account Data Matching\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Account data matching is a vulnerability that arises when developers fail to check the data stored on an account matches an expected set of values. Without proper data validation checks, a program may inadvertently operate with incorrect or maliciously substituted accounts. This vulnerability is particularly acute in scenarios involving permission-related checks.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a program with functionality to manage its administrative settings. The program includes an instruction to update the current administrative configurations, such as feature flags or operational parameters. The instruction must validate that the request comes from an authorized administrator. However, the program fails to verify that the account requesting the change matches the administrator account stored in the configuration data:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ed5\",\"code\":\"pub fn update_admin_settings(ctx: Context\u003cUpdateAdminSettings\u003e, new_settings: AdminSettings) -\u003e Result\u003c()\u003e {\\n  ctx.accounts.config_data.settings = new_settings;\\n  \\n  Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct UpdateAdminSettings\u003c'info\u003e {\\n  #[account(mut)]\\n  pub config_data: Account\u003c'info, ConfigData\u003e,\\n  pub admin: Signer\u003c'info\u003e,\\n}\\n\\n#[account]\\npub struct ConfigData {\\n  admin: Pubkey,\\n  settings: AdminSettings\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate this vulnerability, developers can implement explicit checks comparing the account keys and stored data against expected values. For instance, verify that the depositor's public key matches the owner field of the token account being used for the deposit:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ed6\",\"code\":\"pub fn update_admin_settings(ctx: Context\u003cUpdateAdminSettings\u003e, new_settings: AdminSettings) -\u003e Result\u003c()\u003e {\\n  if ctx.accounts.admin.key() != ctx.accounts.config_data.admin {\\n    return Err(ProgramError::Unauthorized);\\n  }  \\n\\n  ctx.accounts.config_data.settings = new_settings;\\n  \\n  Ok(())\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Developers can also use Anchor's \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"has_one\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" and \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"constraint\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" attributes to enforce data validation checks declaratively. Using our example above, we could use the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"constraint\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" attribute to check the depositor's public key and the deposit token account's owner are equivalent:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ed7\",\"code\":\"pub struct UpdateAdminSettings\u003c'info\u003e {\\n  #[account(\\n    mut,\\n    constraint = config_data.admin == admin.key()\\n  )]\\n  pub config_data: Account\u003c'info, ConfigData\u003e,\\n  pub admin: Signer\u003c'info\u003e,\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Account Data Reallocation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"In Anchor, the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"realloc \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"function provided by the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"AccountInfo \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"struct introduces a nuanced vulnerability related to memory management. This function allows for reallocating an account's data size, which could be useful for dynamic data handling within programs. However, improper use of \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"realloc \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"can lead to unintended consequences, including wasting compute units or potentially exposing stale data.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"realloc \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"method has two parameters:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"new_len\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"usize \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"that specifies the new length of the account's data\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"zero_init\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"bool \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"that determines whether the new memory space should be zero-initialized\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"listType\":\"bullet\",\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"realloc \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"is defined as follows:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":1},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ed8\",\"code\":\"pub fn realloc(\\n    \u0026self,\\n    new_len: usize,\\n    zero_init: bool\\n) -\u003e Result\u003c(), ProgramError\u003e\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Memory allocated for account data is already zero-initialized at the program's entry point. This means the new memory space is already zeroed out when data is reallocated to a larger size within a single transaction. Re-zeroing this memory is unnecessary and results in additional compute unit consumption. Conversely, reallocating to a smaller size and then back to a larger one within the same transaction could expose stale data if \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"zero_init \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"is \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"false\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\".\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a dynamic to-do list program where users can add, remove, or modify entries within a single transaction. This program needs to reallocate its data size dynamically based on user actions:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ed9\",\"code\":\"pub fn modify_todo_list(ctx: Context\u003cModifyTodoList\u003e, modifications: Vec\u003cTodoModification\u003e) -\u003e ProgramResult {\\n    // Logic to process modifications\\n    for modification in modifications {\\n        match modification {\\n            TodoModification::Add(entry) =\u003e {\\n                // Add logic\\n            },\\n            TodoModification::Remove(index) =\u003e {\\n                // Remove logic, potentially requiring data reallocation\\n            },\\n            TodoModification::Edit(index, new_entry) =\u003e {\\n                // Edit logic\\n            },\\n        }\\n    }\\n\\n    // Reallocation logic to adjust the data size based on modifications\\n    let required_data_len = calculate_required_data_len(\u0026modifications);\\n    ctx.accounts.todo_list_data.realloc(required_data_len, false)?;\\n\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct ModifyTodoList\u003c'info\u003e {\\n    #[account(mut)]\\n    todo_list_data: AccountInfo\u003c'info\u003e,\\n    // Other relevant accounts\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"In this scenario, the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"modify_todo_list\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"function might reallocate \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"to_do_list_data\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"multiple times to accommodate the size required by the modifications. If the data size is reduced to remove a to-do entry and then increased again to add new entries within the same transaction, setting \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"zero_init\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"false\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"could expose stale data.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate this issue, using the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"zero_init\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"parameter prudently is crucial:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Set \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"zero_init\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"true\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"when increasing the data size after a prior decrease within the same transaction call. This ensures that any new memory space is zero-initialized, preventing stale data from being exposed\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Set \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"zero_init\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"false\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"when increasing the data size without a prior decrease in the same transaction call since the memory will already be zero-initialized\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"listType\":\"bullet\",\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Instead of reallocating data to meet specific size requirements, developers should use\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c38f\",\"type\":\"link\",\"fields\":{\"url\":\"https://docs.rs/solana-sdk/latest/solana_sdk/address_lookup_table/struct.AddressLookupTableAccount.html\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" Address Lookup Tables (ALTs)\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\". ALTs allow developers to compress a transaction's data by storing up to 256 addresses in a single on-chain account. Each address within the table can then be referenced by a 1-byte index, significantly reducing the data needed for address references in a given transaction. ALTs are much more helpful for scenarios requiring dynamic account interactions without the need for frequent memory resizing.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Account Reloading\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Account reloading is a vulnerability that arises when developers fail to update deserialized accounts after performing a CPI. Anchor does not automatically refresh the state of deserialized accounts after a CPI. This could lead to scenarios where program logic operates on stale data, leading to logical errors or incorrect calculations.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a protocol where users can stake tokens to earn rewards over time. The program facilitating this includes functionality to update a user's staking rewards based on certain conditions or external triggers. A user's rewards are calculated and updated through a CPI to a rewards distribution program. However, the program fails to update the original staking account after the CPI to reflect the new rewards balance:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1eda\",\"code\":\"$27\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"In this example, the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"update_rewards\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"function attempts to update the rewards for a user's staking account through a CPI call to a rewards distribution program. Initially, the program logs \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ctx.accounts.staking_account.rewards\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" (i.e., the rewards balance) after the CPI and then continues onto logic that uses the stale \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ctx.accounts.staking_account.rewards\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" data. The issue is that the staking account's state is not automatically updated post-CPI, which is why the data is stale.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate this issue, explicitly call Anchor's\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c390\",\"type\":\"link\",\"fields\":{\"url\":\"https://docs.rs/anchor-lang/latest/src/anchor_lang/accounts/account.rs.html#271-275\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"reload\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" method to reload a given account from storage. Reloading an account post-CPI will accurately reflect its state:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1edb\",\"code\":\"pub fn update_rewards(ctx: Context\u003cUpdateStakingRewards\u003e, amount: u64) -\u003e Result\u003c()\u003e {\\n    let staking_seeds = \u0026[b\\\"stake\\\", ctx.accounts.staker.key().as_ref(), \u0026[ctx.accounts.staking_account.bump]];\\n\\n    let cpi_accounts = UpdateRewards {\\n        staking_account: ctx.accounts.staking_account.to_account_info(),\\n    };\\n    let cpi_program = ctx.accounts.rewards_distribution_program.to_account_info();\\n    let cpi_ctx = CpiContext::new_with_signer(cpi_program, cpi_accounts, staking_seeds);\\n\\n    rewards_distribution::cpi::update_rewards(cpi_ctx, amount)?;\\n\\n    // Reload the staking account to reflect the updated reward balance\\n    ctx.accounts.staking_account.reload()?;\\n\\n    // Log the updated reward balance\\n    msg!(\\\"Rewards: {}\\\", ctx.accounts.staking_account.rewards);\\n    \\n    // Logic that uses ctx.accounts.staking_account.rewards\\n\\n    Ok(())\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Arbitrary CPI\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Arbitrary CPIs occur when a program invokes another program without verifying the target program's identity. This vulnerability exists because the Solana runtime allows any program to call another program if the caller has the callee's program ID and adheres to the callee's interface. If a program performs CPIs based on user input without validating the callee's program ID, it could execute code in an attacker-controlled program.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a program that distributes awards to participants based on their contributions to a project. After distributing the rewards, the program records the details in a separate ledger program for auditing and tracking purposes. The ledger program is assumed to be a trusted program, providing a public interface for keeping track of specific entries from authorized programs. The program includes a function to distribute and record rewards, which takes in the ledger program as an account. However, the function fails to verify the provided \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ledger_program\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"before making a CPI to it:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1edc\",\"code\":\"pub fn distribute_and_record_rewards(ctx: Context\u003cDistributeAndRecord\u003e, reward_amount: u64) -\u003e ProgramResult {\\n    // Reward distribution logic\\n\\n    let instruction = custom_ledger_program::instruction::record_transaction(\\n        \u0026ctx.accounts.ledger_program.key(),\\n        \u0026ctx.accounts.reward_account.key(),\\n        reward_amount,\\n    )?;\\n\\n    invoke(\\n        \u0026instruction,\\n        \u0026[\\n            ctx.accounts.reward_account.clone(),\\n            ctx.accounts.ledger_program.clone(),\\n        ],\\n    )\\n}\\n\\n#[derive(Accounts)]\\npub struct DistributeAndRecord\u003c'info\u003e {\\n    reward_account: AccountInfo\u003c'info\u003e,\\n    ledger_program: AccountInfo\u003c'info\u003e,\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"An attacker could exploit this by passing a malicious program's ID as the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ledger_program\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\", leading to unintended consequences.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To secure against this issue, developers can add a check that verifies the ledger program's identity before performing the CPI. This check would ensure that the CPI call is made to the intended program, preventing arbitrary CPIs:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1edd\",\"code\":\"pub fn distribute_and_record_rewards(ctx: Context\u003cDistributeAndRecord\u003e, reward_amount: u64) -\u003e ProgramResult {\\n    // Reward distribution logic\\n\\n    // Verify the ledger_program is the expected custom ledger program\\n    if ctx.accounts.ledger_program.key() != \u0026custom_ledger_program::ID {\\n        return Err(ProgramError::IncorrectProgramId.into())\\n    }\\n    \\n    let instruction = custom_ledger_program::instruction::record_transaction(\\n        \u0026ctx.accounts.ledger_program.key(),\\n        \u0026ctx.accounts.reward_account.key(),\\n        reward_amount,\\n    )?;\\n\\n    invoke(\\n        \u0026instruction,\\n        \u0026[\\n            ctx.accounts.reward_account.clone(),\\n            ctx.accounts.ledger_program.clone(),\\n        ],\\n    )\\n}\\n\\n#[derive(Accounts)]\\npub struct DistributeAndRecord\u003c'info\u003e {\\n    reward_account: AccountInfo\u003c'info\u003e,\\n    ledger_program: AccountInfo\u003c'info\u003e,\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"A program may have a publicly available CPI module if it was written using Anchor. This makes invoking the program from another Anchor program easy and secure. The Anchor CPI module automatically checks that the program's address passed in matches the program's address stored in the module. Alternatively, hardcoding the address can be a possible solution instead of having the user pass it in.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Authority Transfer Functionality\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Solana programs often designate specific public keys as authorities for critical functions, such as updating program parameters or withdrawing funds. However, the inability to transfer this authority to another address can pose significant risks. This limitation becomes problematic in scenarios such as team changes, protocol sales, or if the authority becomes compromised.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a program where a global admin authority is responsible for setting specific protocol parameters through a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"set_params\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" function. The program does not include a mechanism to change the global admin:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ede\",\"code\":\"pub fn set_params(ctx: Context\u003cSetParams\u003e, /* parameters to be set */) -\u003e Result\u003c()\u003e {\\n    require_keys_eq!(\\n        ctx.accounts.current_admin.key(),\\n        ctx.accounts.global_admin.authority,\\n    );\\n\\n    // Logic to set parameters\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Here, the authority is statically defined without the ability to update it to a new address.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"A secure approach to mitigating this issue is to create a two-step process for transferring authority. This process would allow the current authority to nominate a new \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"pending_authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", which must explicitly accept the role. Not only would this provide authority transfer functionality, but it would also protect against accidental transfers or malicious takeovers. The flow would be as follows:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Nomination by the Current Authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": the current authority would nominate a new \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"pending_authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" by calling \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"nominate_new_authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", which sets the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"pending_authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" field in the program state\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Acceptance by New Authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": the nominated \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"pending_authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" calls \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"accept_authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" to take on their new role, transferring authority from the current authority to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"pending_authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null}],\"listType\":\"bullet\",\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"This would look something like:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1edf\",\"code\":\"$28\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"In this example, the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ProgramState\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"account structure holds the current \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"and an optional \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"pending_authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\". The \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"NominateAuthority \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"context ensures that the current authority signs the transaction, allowing them to nominate a new authority. The \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"AcceptAuthority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"context checks that the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"pending_authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"matches the signer of the transaction, allowing them to accept and become the new authority. This setup ensures a secure and controlled transition of authority within the program.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Bump Seed Canonicalization\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Bump seed canonicalization refers to using the highest valid bump seed (i.e., canonical bump) when deriving PDAs. Using the canonical bump is a deterministic and secure way to find an address given a set of seeds. Failing to use the canonical bump can lead to vulnerabilities, such as malicious actors creating or manipulating PDAs that compromise program logic or data integrity.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a program designed to create unique user profiles, each with an associated PDA derived explicitly using \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"create_program_address\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\". The program allows for creating a profile by taking a user-provided bump. However, this is problematic as it introduces the risk of using the non-canonical bump:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ee0\",\"code\":\"$29\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"In this scenario, the program derives a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"UserProfile\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"PDA using \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"create_program_address\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"with seeds that include a user-provided bump. Using a user-provided bump is problematic because it fails to ensure the use of the canonical bump. This would allow a malicious actor to create multiple PDAs with different bumps for the same user ID.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate this issue, we can refactor our example to derive PDAs using \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"find_program_address\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"and validate the bump seed explicitly:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ee1\",\"code\":\"$2a\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Here, \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"find_program_address\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"is used to derive the PDA with the canonical bump seed to ensure a deterministic and secure PDA creation. The canonical bump is stored in the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"UserProfile \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"account, allowing for efficient and secure validation in subsequent operations. We prefer \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"find_program_address\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"over \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"create_program_address\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"because the latter creates a valid PDA \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"without searching for a bump seed\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":2,\"version\":1},{\"mode\":\"normal\",\"text\":\". Because it doesn't search for a bump seed, it may unpredictably return an error for any given set of seeds and is not generally suitable for creating PDAs. \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"find_program_address\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"will \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"always\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":2,\"version\":1},{\"mode\":\"normal\",\"text\":\" use the canonical bump when creating a PDA. This is because it iterates through various \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"create_program_address\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"calls, starting with a bump of 255 and decrementing with each iteration. Once a valid address is found, the function returns the derived PDA and the canonical bump used to derive it.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"block\",\"fields\":{\"id\":\"6791ea39f065da17b863c5fe\",\"style\":\"default\",\"title\":\"Note:\",\"blockName\":\"\",\"blockType\":\"alert\",\"description\":{\"root\":{\"type\":\"root\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Anchor enforces the canonical bump for PDA derivations through its \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"seeds \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"and \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"bump \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"constraints, streamlining this entire process to ensure secure and deterministic PDA creation and validation.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":\"ltr\",\"textStyle\":\"\",\"textFormat\":0}],\"direction\":\"ltr\"}}},\"format\":\"\",\"version\":2},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Closing Accounts\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Improperly closing accounts in a program can lead to several vulnerabilities, including the potential for \\\"closed\\\" accounts to be reinitialized or misused. The issue arises from a failure to properly mark an account as closed or failing to prevent its reuse in subsequent transactions. This oversight can allow malicious actors to exploit a given account, leading to unauthorized action or access within the program.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a program that allows users to create and close data storage accounts. The program closes an account by transferring out its lamports:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ee2\",\"code\":\"pub fn close_account(ctx: Context\u003cCloseAccount\u003e) -\u003e ProgramResult {\\n    let account = ctx.accounts.data_account.to_account_info();\\n    let destination = ctx.accounts.destination.to_account_info();\\n\\n    **destination.lamports.borrow_mut() = destination\\n        .lamports()\\n        .checked_add(account.lamports())\\n        .unwrap();\\n    **account.lamports.borrow_mut() = 0;\\n    \\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct CloseAccount\u003c'info\u003e {\\n    #[account(mut)]\\n    pub data_account: Account\u003c'info, Data\u003e,\\n    #[account(mut)]\\n    pub destination: AccountInfo\u003c'info\u003e,\\n}\\n\\n#[account]\\npub struct Data {\\n    data: u64,\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"This is problematic as the program fails to zero out the account's data or mark it as closed. Merely transferring out its remaining lamports does not close the account.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate this issue, not only should the program transfer out all lamposts, it should also zero out the account's data and mark it with a discriminator (i.e., \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"\\\"CLOSED_ACCOUNT_DISCRIMINATOR\\\"\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"). The program should also implement checks to prevent closed accounts from being reused in future transactions:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ee3\",\"code\":\"$2b\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"However, zeroing out the data and adding the closed discriminator is not enough. A user can keep an account from being garbage collected by refunding the account's lamports before the end of an instruction. This will put the account in a weird limbo state where it cannot be used or garbage collected. Thus, we added a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"force_defund \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"function to address this edge case; now anyone can defund closed accounts.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Anchor simplifies this process with the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"#[account(close = destination)]\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" constraint, automating the secure closure of accounts by transferring lamports, zeroing data, and setting the closed account discriminator, all in one operation.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Duplicate Mutable Accounts\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Duplicate mutable accounts refers to a scenario where the same account is passed more than once as a mutable parameter to an instruction. This occurs when an instruction requires two mutable accounts of the same type. A malicious actor could pass in the same account twice, causing the account to be mutated in unintended ways (e.g., overwriting data). The severity of this vulnerability varies based on the specific scenario.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a program designed to reward users based on their participation in a certain on-chain activity. The program has an instruction to update the balance of two accounts: a reward account and a bonus account. A user should receive a standard reward in one account and a potential bonus in another account based on specific predetermined criteria:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ee4\",\"code\":\"pub fn distribute_rewards(ctx: Context\u003cDistributeRewards\u003e, reward_amount: u64, bonus_amount: u64) -\u003e Result\u003c()\u003e {\\n    let reward_account = \u0026mut ctx.accounts.reward_account;\\n    let bonus_reward = \u0026mut ctx.accounts.bonus_account;\\n\\n    // Intended to increment the reward and bonus accounts separately\\n    reward_account.balance += reward_amount;\\n    bonus_account.balance += bonus_amount;\\n\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct DistributeRewards\u003c'info\u003e {\\n    #[account(mut)]\\n    reward_account: Account\u003c'info, RewardAccount\u003e,\\n    #[account(mut)]\\n    bonus_account: Account\u003c'info, RewardAccount\u003e,\\n}\\n\\n#[account]\\npub struct RewardAccount {\\n    pub balance: u64,\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"If a malicious actor passes the same account for \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"reward_account \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"and \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"bonus_account\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", the account's balance will be incorrectly updated twice.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate this issue, add a check within the instruction logic to verify that the public keys of the two accounts are not identical:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ee5\",\"code\":\"pub fn distribute_rewards(ctx: Context\u003cDistributeRewards\u003e, reward_amount: u64, bonus_amount: u64) -\u003e Result\u003c()\u003e {\\n    if ctx.accounts.reward_account.key() == ctx.accounts.bonus_account.key() {\\n        return Err(ProgramError::InvalidArgument.into())\\n    }\\n    \\n    let reward_account = \u0026mut ctx.accounts.reward_account;\\n    let bonus_reward = \u0026mut ctx.accounts.bonus_account;\\n\\n    // Intended to increment the reward and bonus accounts separately\\n    reward_account.balance += reward_amount;\\n    bonus_account.balance += bonus_amount;\\n\\n    Ok(())\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Developers can use Anchor's account constraints to add a more explicit check on the account. This can be done using the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"#[account]\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" attribute and the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"constraint\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" keyword:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ee6\",\"code\":\"pub fn distribute_rewards(ctx: Context\u003cDistributeRewards\u003e, reward_amount: u64, bonus_amount: u64) -\u003e Result\u003c()\u003e {\\n    let reward_account = \u0026mut ctx.accounts.reward_account;\\n    let bonus_reward = \u0026mut ctx.accounts.bonus_account;\\n\\n    // Intended to increment the reward and bonus accounts separately\\n    reward_account.balance += reward_amount;\\n    bonus_account.balance += bonus_amount;\\n\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct DistributeRewards\u003c'info\u003e {\\n    #[account(\\n        mut,\\n        constraint = reward_account.key() != bonus_account.key()\\n    )]\\n    reward_account: Account\u003c'info, RewardAccount\u003e,\\n    #[account(mut)]\\n    bonus_account: Account\u003c'info, RewardAccount\u003e,\\n}\\n\\n#[account]\\npub struct RewardAccount {\\n    pub balance: u64,\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Frontrunning\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"With the rising popularity of transaction bundlers, frontrunning is a concern that should be taken seriously by protocols built on Solana. \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c391\",\"type\":\"link\",\"fields\":{\"url\":\"https://x.com/jito_labs/status/1766228889888514501?s=20\",\"newTab\":false,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"With the removal of Jito’s mempool\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\", we refer to frontrunning here as a malicious actor’s ability to manipulate expected versus actual values through carefully constructed transactions. \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Imagine a protocol that handles purchasing and bidding for a product, storing the seller's pricing information in an account named \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"SellInfo\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\":\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ee7\",\"code\":\"#[derive(Accounts)]\\npub struct SellProduct\u003c'info\u003e {\\n  product_listing: Account\u003c'info, ProductListing\u003e,\\n  sale_token_mint: Account\u003c'info, Mint\u003e,\\n  sale_token_destination: Account\u003c'info, TokenAccount\u003e,\\n  product_owner: Signer\u003c'info\u003e,\\n  purchaser_token_source: Account\u003c'info, TokenAccount\u003e,\\n  product: Account\u003cinfo, Product\u003e\\n}\\n\\n#[derive(Accounts)]\\npub struct PurchaseProduct\u003c'info\u003e {\\n  product_listing: Account\u003c'info, ProductListing\u003e,\\n  token_destination: Account\u003c'info, TokenAccount\u003e,\\n  token_source: Account\u003c'info, TokenAccount\u003e,\\n  buyer: Signer\u003c'info\u003e,\\n  product_account: Account\u003c'info, Product\u003e,\\n  token_mint_sale: Account\u003c'info, Mint\u003e,\\n}\\n\\n#[account]\\npub struct ProductListing {\\n  sale_price: u64,\\n  token_mint: Pubkey,\\n  destination_token_account: Pubkey,\\n  product_owner: Pubkey,\\n  product: Pubkey,\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To purchase a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Product \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"listed, a buyer must pass in the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ProductListing \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"account related to the product they want. But what if the seller can change the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"sale_price \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"of their listing?\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ee8\",\"code\":\"pub fn change_sale_price(ctx: Context\u003cChangeSalePrice\u003e, new_price: u64) -\u003e Result\u003c()\u003e {...}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"This would introduce a frontrunning opportunity for the seller, especially if the buyer's purchasing transaction doesn't include \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"expected_price\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"checks to ensure they are paying no more than expected for the product they want. If the purchaser submits a transaction to buy the given Product\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"is would be possible for the seller to call \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"change_sale_price\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\", and, using Jito, ensure this transaction is included before the purchaser's transaction. A malicious seller could change the price in the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ProductListing \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"account to an exorbitant amount, unbeknownst to the purchaser, forcing them to pay much more than expected for the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Product!\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"A simple solution would be including \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"expected_price \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"checks on the purchasing side of the deal, preventing the buyer from paying more than expected for the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Product \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"they want to buy:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ee9\",\"code\":\"pub fn purchase_product(ctx: Context\u003cPurchaseProduct\u003e, expected_price: u64) -\u003e Result\u003c()\u003e {\\n  assert!(ctx.accounts.product_listing.sale_price \u003c= expected_price);\\n  ...\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Insecure Initialization\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Unlike contracts deployed to the EVM, Solana programs are not deployed with a constructor to set state variables. Instead, they are initialized manually (normally by a function called \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"initialize \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"or something similar). Initialization functions typically set data such as the program’s authority or create accounts that form the base of the program being deployed (i.e., a central state account or something of the sort).\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Since the initialization function is called manually, and not automatically on program deployment, this instruction must be called by a known address under the control of the program’s development team. Otherwise, it is possible for an attacker to frontrun initialization, possibly setting up the program using accounts under the attacker's control.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"A common practice is to use the program’s \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"upgrade_authority \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"as the authorized address to call the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"initialize \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"function, if the program has an upgrade authority.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Insecure Example and How to Mitigate\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1eea\",\"code\":\"pub fn initialize(ctx: Context\u003cInitialize\u003e) -\u003e Result\u003c()\u003e {\\n  ctx.accounts.central_state.authority = authority.key();\\n  ...  \\n}\\n\\n#[derive(Accounts)]\\npub struct Initialize\u003c'info\u003e {\\n  authority: Signer\u003c'info\u003e,\\n  #[account(mut,\\n    init,\\n    payer = authority,\\n    space = CentralState::SIZE,\\n    seeds = [b\\\"central_state\\\"],\\n    bump\\n  )]\\n  central_state: Account\u003c'info, CentralState\u003e,\\n  ...\\n}\\n\\n#[account]\\npub struct CentralState {\\n  authority: Pubkey,\\n  ...\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The example above is a stripped-down initialize function that sets the authority of a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"CentralState \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"account for the instruction caller. However, this could be any account that calls initialize! As previously mentioned, a common way to secure an initialization function is to use the program’s \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"upgrade_authority\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", known at deployment.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c392\",\"type\":\"link\",\"fields\":{\"url\":\"https://docs.rs/anchor-lang/latest/anchor_lang/accounts/account/struct.Account.html#example-1\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Below is an example from the Anchor documentation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\", which uses constraint to ensure only the program's upgrade authority can call initialize:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1eeb\",\"code\":\"$2c\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Loss of Precision\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Loss of precision, albeit minuscule in appearance, can pose a significant threat to a program. It can lead to incorrect calculations, arbitrage opportunities, and unexpected program behavior.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Precision loss in arithmetic operations is a common source of errors. With Solana programs, fixed-point arithmetic is recommended whenever possible. This is because programs only support a\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c393\",\"type\":\"link\",\"fields\":{\"url\":\"https://solana.com/docs/programs/limitations#float-rust-types-support\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" limited subset of Rust's float operations\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\". If a program attempts to use an unsupported float operation, the runtime will return an unresolved symbol error. Additionally, float operations require more instructions compared to their integer equivalents. The use of fixed-point arithmetic and the need to handle large numbers of tokens and fractional amounts accurately can exacerbate precision loss.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Multiplication After Division\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"While the\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c394\",\"type\":\"link\",\"fields\":{\"url\":\"https://en.wikipedia.org/wiki/Associative_property\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" associative property\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" holds for most mathematical operations, its application in computer arithmetic can lead to unexpected precision loss. A classic example of precision loss occurs when performing multiplication after division, which can yield different results from performing multiplication before division. For example, consider the following expressions: \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"(a / c) * b\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" and \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"(a * b) / c\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\". Mathematically, these expressions are associative - they \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"should\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":2,\"version\":1},{\"mode\":\"normal\",\"text\":\" yield the same result. However, in the context of Solana and fixed-point arithmetic, the order of operations matters significantly. Performing division first \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"(a / c)\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" may result in a loss of precision if the quotient is rounded down before it's multiplied by \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"b\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\". This could result in a smaller result than expected. Conversely, multiplying \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"(a * b)\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" before dividing by \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"c\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" could preserve more of the original precision. This difference can lead to incorrect calculations, creating unexpected program behavior and/or arbitrage opportunities.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"saturating_* \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"Arithmetic Functions\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"While \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"saturating_*\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" arithmetic functions prevent overflow and underflow by capping values at their maximum or minimum possible values, they can lead to subtle bugs and precision loss if this cap is reached unexpectedly. This occurs when the program's logic assumes that saturation alone will guarantee an accurate result and ignores handling the potential loss of precision or accuracy.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"For example, imagine a program designed to calculate and distribute rewards to users based on the amount of tokens they trade within a specific period:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1eec\",\"code\":\"pub fn calculate_reward(transaction_amount: u64, reward_multiplier: u64) -\u003e u64 {\\n    transaction_amount.saturating_mul(reward_multiplier)\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider the scenario where the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"transaction_amount\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" is 100,000 tokens, and the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"reward_multiplier\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":16,\"version\":1},{\"mode\":\"normal\",\"text\":\" is 100 tokens per transaction. Multiplying the two will exceed the maximum value a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"u64\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" can hold. This means their product will be capped, leading to a substantial loss of precision by under-rewarding the user.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Rounding Errors\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Rounding operations are a common loss of precision in programming. The choice of rounding method can significantly impact the accuracy of calculations and the behavior of Solana programs. The \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"try_round_u64()\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" function rounds decimal values to the nearest whole number. Rounding up is problematic as it can artificially inflate values, leading to discrepancies between the actual and expected calculations.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a Solana program that converts collateral into liquidity based on market conditions. The program uses \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"try_round_u64()\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" to round the result of a division operation:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1eed\",\"code\":\"pub fn collateral_to_liquidity(\u0026self, collateral_amount: u64) -\u003e Result\u003cu64, ProgramError\u003e {\\n    Decimal::from(collateral_amount)\\n        .try_div(self.0)?\\n        .try_round_u64()\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"In this scenario, rounding up can lead to issuing more liquidity tokens than the collateral amount justifies. Malicious actors can exploit this discrepancy to perform arbitrage attacks to extract value from the protocol via favorably influenced rounding outcomes. To mitigate, use \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"try_floor_u64\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" to round down to the nearest whole number. This approach minimizes the risk of artificially inflating values and ensures that any rounding does not give the user an advantage at the expense of the system. Alternatively, implement logic to handle scenarios where rounding could explicitly impact the outcome. This might include setting specific thresholds for rounding decisions or applying different logic based on the size of the values involved.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Missing Ownership Check\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Ownership checks are crucial to validate that the expected program owns an account involved in a transaction or operation. Accounts include an\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c395\",\"type\":\"link\",\"fields\":{\"url\":\"https://docs.rs/crate/solana-program/latest\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"owner\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" field, which indicates the program with the authority to write to the account's data. This field ensures that only authorized programs can modify an account's state. Moreover, this field is useful for ensuring that accounts passed into an instruction are owned by the expected program. Missing ownership checks can lead to severe vulnerabilities, including unauthorized fund transfers and the execution of privileged operations.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a program function defined to allow admin-only withdrawals from a vault. The function takes in a configuration account (i.e., \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"config\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\") and uses its \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"admin \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"field to check whether the provided admin account's public key is the same as the one stored in the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"config \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"account. However, it fails to verify the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"config\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" account's ownership, assuming it is trustworthy:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1eee\",\"code\":\"pub fn admin_token_withdraw(program_id: \u0026Pubkey, accounts: \u0026[AccountInfo], amount: u64) -\u003e ProgramResult {\\n    // Account setup\\n\\n    if config.admin != admin.pubkey() {\\n        return Err(ProgramError::InvalidAdminAccount)\\n    }\\n\\n    // Transfer funds logic\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"A malicious actor could exploit this by supplying a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"config \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"account they control with a matching \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"admin \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"field, effectively tricking the program into executing the withdrawal.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate this, perform an ownership check that verifies the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"owner \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"field of the account:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1eef\",\"code\":\"pub fn admin_token_withdraw(program_id: \u0026Pubkey, accounts: \u0026[AccountInfo], amount: u64) -\u003e ProgramResult {\\n    // Account setup\\n\\n    if config.admin != admin.pubkey() {\\n        return Err(ProgramError::InvalidAdminAccount)\\n    }\\n\\n    if config.owner != program_id {\\n        return Err(ProgramError::InvalidConfigAccount)\\n    }\\n\\n    // Transfer funds logic\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Anchor streamlines this check with the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Account \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"type. \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Account\u003c'info, T\u003e\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" is a wrapper around \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"AccountInfo\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", which verifies program ownership and deserializes the underlying data into \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"T\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" (i.e., the specified account type). This allows developers to use \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Account\u003c'info, T\u003e\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" to validate account ownership easily. Developers can also use the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"#[account]\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" attribute to add the\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c396\",\"type\":\"link\",\"fields\":{\"url\":\"https://docs.rs/anchor-lang/latest/anchor_lang/trait.Owner.html\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Owner\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"trait to a given account. This trait defines an address expected to own the account. In addition, developers can use the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"owner \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"constraint to define the program that should own a given account if it's different from the currently executing one. This is useful, for example, when writing an instruction that expects an account to be a PDA derived from a different program. The \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"owner \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"constraint is defined as \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"#[account(owner = \u003cexpr\u003e)]\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", where \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"\u003cexpr\u003e\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" is an arbitrary expression.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Read-Only Accounts\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"It's equally important to verify the validity of accounts specified as read-only within a program's execution context. This is crucial because a malicious actor could pass accounts with arbitrary or crafted data instead of legitimate accounts. This could lead to unexpected or harmful program behavior. Developers should still perform checks to ensure that accounts a program needs to read from are genuine and not tampered with. This could involve verifying the account's address against known values or confirming the account's owner is as expected, especially for sysvars (i.e., read-only system accounts, such as \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Clock \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"or \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"EpochSchedule\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"). Access sysvars using the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"get()\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" method, which doesn't require any manual address or ownership checks. This is a safer approach to accessing these accounts; however, not all sysvars support the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"get()\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" method. In this case, access them using their public address.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Missing Signer Check\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Transactions are signed with a wallet's private key to ensure authentication, integrity, non-repudiation, and the authorization of a specific transaction by a specific wallet. By requiring transactions to be signed with the sender's private key, Solana's runtime can verify that the proper account initiates a transaction and has not been tampered with. This mechanism underpins the trustless nature of decentralized networks. Without this verification, any account that supplies the correct account as an argument can execute a transaction. This could lead to unauthorized access to privileged information, funds, or functionality. This vulnerability arises from failing to validate whether an operation is signed by the appropriate account's private key before executing certain privileged functionality.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Take the following function:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ef0\",\"code\":\"pub fn update_admin(program_id: \u0026Pubkey, accounts \u0026[AccountInfo]) -\u003e ProgramResult {\\n    let account_iter = \u0026mut accounts.iter();\\n    let config = ConfigAccount::unpack(next_account_info(account_iter)?)?;\\n    let admin = next_account_info(account_iter)?;\\n    let new_admin = next_account_info (account_iter)?;\\n\\n    if admin.pubkey() != config.admin {\\n        return Err(ProgramError::InvalidAdminAccount);\\n    }\\n\\n    config.admin = new_admin.pubkey();\\n\\n    Ok(())\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"This function intends to update the program's admin. It includes a check to ensure that the current admin initiates the operation, which is good access control. However, the function fails to verify that the current admin's private key signed the transaction. Thus, anyone calling this function can pass the proper \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"admin \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"account such that \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"admin.pubkey() = config.admin\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", irrespective of whether the account calling this function is actually the current admin. This allows a malicious actor to execute the instruction with their account passed in as the new admin, directly bypassing the need for the current admin's authorization.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Programs must include checks to verify that an account has been signed by the appropriate wallet. This can be done by checking the\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c397\",\"type\":\"link\",\"fields\":{\"url\":\"https://docs.rs/solana-program/latest/solana_program/account_info/struct.AccountInfo.html#structfield.is_signer\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"AccountInfo::is_signer\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" field of the accounts involved in the transaction. The program can enforce that only authorized accounts can perform certain actions by checking whether the account executing the privileged operation has the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"is_signer \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"flag set to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"true\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\".\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The updated code example would look like this:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ef1\",\"code\":\"pub fn update_admin(program_id: \u0026Pubkey, accounts \u0026[AccountInfo]) -\u003e ProgramResult {\\n    let account_iter = \u0026mut accounts.iter();\\n    let config = ConfigAccount::unpack(next_account_info(account_iter)?)?;\\n    let admin = next_account_info(account_iter)?;\\n    let new_admin = next_account_info (account_iter)?;\\n\\n    if admin.pubkey() != config.admin {\\n        return Err(ProgramError::InvalidAdminAccount);\\n    }\\n\\n    // Add in a check for the admin's signature\\n    if !admin.is_signer {\\n        return Err(ProgramError::NotSigner);\\n    }\\n\\n    config.admin = new_admin.pubkey();\\n\\n    Ok(())\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Anchor streamlines this entire process with the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c398\",\"type\":\"link\",\"fields\":{\"url\":\"https://docs.rs/anchor-lang/latest/anchor_lang/accounts/signer/struct.Signer.html\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Signer\u003c’info\u003e\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" account type\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\".\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":1},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Overflow and Underflow\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"An integer is a number without a fractional component. Rust stores integers as fixed-size variables. These variables are defined by their\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c399\",\"type\":\"link\",\"fields\":{\"url\":\"https://en.wikipedia.org/wiki/Signedness\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" signedness\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" (i.e., signed or unsigned) and the amount of space they occupy in memory. For example, the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"u8\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" type denotes an unsigned integer that occupies 8 bits of space. It's capable of holding values from 0 to 255. Storing a value outside of that range would result in an integer overflow or underflow. An integer overflow is when a variable exceeds its maximum capacity and wraps around to its minimum value. An integer underflow is when a variable drops below its minimum capacity and wraps around to its maximum value.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Rust includes checks for integer overflows and underflows when compiling in debug mode. These checks will cause the program to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"panic\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":2,\"version\":1},{\"mode\":\"normal\",\"text\":\" at runtime if such a condition is detected. However, Rust does not include checks that panic for integer overflows and underflows when compiling in release mode with the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"--release\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" flag. This behavior can introduce subtle vulnerabilities as the overflow or underflow occurs silently. The\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c39a\",\"type\":\"link\",\"fields\":{\"url\":\"https://en.wikipedia.org/wiki/Signedness\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" Berkley Packet Filter (BPF)\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" toolchain is integral to Solana's development environment as it compiles Solana programs. The \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"cargo build-bpf\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" command compiles Rust projects into BPF bytecode for deployment. \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"The issue with this is that it compiles programs in release mode by default\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":2,\"version\":1},{\"mode\":\"normal\",\"text\":\". Thus, Solana programs are vulnerable to integer overflows and underflows.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"An attacker can exploit this vulnerability by taking advantage of the silent overflow/underflow behavior in release mode, especially functions that handle token balances. Take the following example:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ef2\",\"code\":\"pub fn process_instruction(\\n    _program_id: \u0026 Pubkey,\\n    accounts: [\u0026AccountInfo],\\n    _instruction_data: \u0026[u8],\\n) -\u003e ProgramResult {\\n    let account_info_iter = \u0026mut accounts.iter();\\n    let account = next_account_info(account_info_iter)?;\\n\\n    let mut balance: u8 = account.data.borrow()[0];\\n    let tokens_to_subtract: u8 = 100;\\n\\n    balance = balance - tokens_to_subtract;\\n\\n    account.data.borrow_mut()[0] = balance;\\n    msg!(\\\"Updated balance to {}\\\", balance);\\n    \\n    Ok(())\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"This function assumes the balance is stored in the first byte for simplicity. It takes the account's balance and subtracts \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"tokens_to_subtract \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"from it. If the user's balance is less than \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"tokens_to_subtract\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", it'll cause an underflow. For example, a user with 10 tokens would underflow to a total balance of 165 tokens\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h4\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"overflow-checks\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The easiest way to mitigate this vulnerability is to set the key \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"overflow-checks\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"true \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"in the project's \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Cargo.toml\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" file. Here, Rust will add overflow and underflow checks in the compiler. However, adding overflow and underflow checks increases the\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c39b\",\"type\":\"link\",\"fields\":{\"url\":\"https://solana.com/docs/core/runtime#compute-budget\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" compute cost\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" of a transaction. In cases where compute needs to be optimized for, it may be more beneficial to set \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"overflow-checks\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"false\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\".\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h4\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"checked_* \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"Arithmetic\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Use Rust's \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"checked_*\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" arithmetic functions on each integer type to strategically check for overflows and underflows throughout your program. These functions will return \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"None \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"if an overflow or underflow occurs. This allows the program to handle the error gracefully. For example, you could refactor the previous code to:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ef3\",\"code\":\"pub fn process_instruction(\\n    _program_id: \u0026 Pubkey,\\n    accounts: [\u0026AccountInfo],\\n    _instruction_data: \u0026[u8],\\n) -\u003e ProgramResult {\\n    let account_info_iter = \u0026mut accounts.iter();\\n    let account = next_account_info(account_info_iter)?;\\n\\n    let mut balance: u8 = account.data.borrow()[0];\\n    let tokens_to_subtract: u8 = 100;\\n\\n    match balance.checked_sub(tokens_to_subtract) {\\n        Some(new_balance) =\u003e {\\n            account.data.borrow_mut()[0] = new_balance;\\n            msg!(\\\"Updated balance to {}\\\", new_balance);\\n        },\\n        None =\u003e {\\n            return Err(ProgramErrorr::InsufficientFunds);\\n        }\\n    }\\n\\n    Ok(())\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"In the revised example, \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"checked_sub \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"is used to subtract \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"tokens_to_subtract \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"from \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"balance\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\". Thus, if \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"balance \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"is sufficient to cover the subtraction, \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"checked_sub \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"will return \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Some(new_balance)\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\". The program continues to update the account's balance safely and logs it. However, if the subtraction would result in an underflow, \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"checked_sub \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"returns \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"None\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", which we can handle by returning an error.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h4\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Checked Math Macro\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c39c\",\"type\":\"link\",\"fields\":{\"url\":\"https://github.com/blockworks-foundation/checked-math\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Checked Math\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" is a\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c39d\",\"type\":\"link\",\"fields\":{\"url\":\"https://doc.rust-lang.org/book/ch19-06-macros.html#procedural-macros-for-generating-code-from-attributes\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" procedural macro\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" for changing the properties for checking mathematical expressions without altering those expressions, for the most part. The issue with \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"checked_*\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" arithmetic functions is the loss of mathematical notation. Instead, cumbersome methods like \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"a.checked_add(b).unwrap()\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" must be used instead of \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"a + b\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\". For example, if we want to write \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"(x * y) + z\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" using the checked arithmetic functions, we'd write \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"x.checked_mul(y).unwrap().checked_add(z).unwrap()\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\".\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Instead, the following expression would look like this using the Checked Math macro:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ef4\",\"code\":\"use checked_math::checked_math as cm;\\n\\ncm!((x * y) + z).unwrap()\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"This is more convenient to write, preserves the expression's mathematical notation, and only requires one \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\".unwrap()\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\". This is because the macro converts normal math expressions into an expression that returns \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"None \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"if any of the checked steps return \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"None\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\". \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Some(_)\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" is returned, if successful, which is why we unwrap the expression at the end.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Casting\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Similarly, casting between integer types using the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"as\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" keyword without proper checks can introduce an integer overflow or underflow vulnerability. This is because casting can either truncate or extend values in unintended ways. When casting from a larger integer type to a smaller one (e.g., \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"u64 \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"u32\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"), Rust will truncate the higher bits of the original value that do not fit into the target type. This is problematic when the original value exceeds the maximum value that the target type can store. When casting from a smaller integer type to a larger one (e.g., \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"i16 \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"i32\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"), Rust will extend the value. This is straightforward for unsigned types. However, this can lead to\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c39e\",\"type\":\"link\",\"fields\":{\"url\":\"https://en.wikipedia.org/wiki/Sign_extension\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" sign extension\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" with signed integers to introduce unintended negative values.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h4\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Use Rust's safe casting methods to mitigate this vulnerability. This includes methods such as\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c39f\",\"type\":\"link\",\"fields\":{\"url\":\"https://doc.rust-lang.org/std/convert/trait.TryFrom.html#tymethod.try_from\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" try_from\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"and\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c3a0\",\"type\":\"link\",\"fields\":{\"url\":\"https://doc.rust-lang.org/std/convert/trait.From.html#tymethod.from\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"from\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\". Using \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"try_from \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"returns a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Result \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"type, allowing for the explicit handling of cases where the value does not fit into the target type gracefully. Using Rust's \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"from \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"method can be used for a safe, implicit conversion for conversions that are guaranteed to be lossless (e.g., \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"u8 \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"to \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"u32\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"). For example, suppose a program needs to safely convert a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"u64 \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"token amount to a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"u32 \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"type for processing. In that case, it can do the following:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ef5\",\"code\":\"pub fn convert_token_amount(amount: u64) -\u003e Result\u003cu32, ProgramError\u003e {\\n    u32::try_from(amount).map_err(|_| ProgramError::InvalidArgument)\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"In this example, if \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"amount \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"exceeds the maximum value a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"u32 \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"can hold (i.e., 4 294 967 295), the conversion fails, and the program returns an error. This prevents a potential overflow/underflow from occurring.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"PDA Sharing\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"PDA sharing is a common vulnerability that arises when the same PDA is used across multiple authority domains or roles. This could allow a malicious actor to access data or funds that do not belong to them via the misuse of PDAs as a signer without the proper access control checks in place.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a program designed to facilitate token staking and distributing rewards. The program uses a single PDA to transfer tokens into a given pool and withdraw rewards. The PDA is derived using a static seed (e.g., the name of the staking pool), making it common across all operations:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ef6\",\"code\":\"pub fn stake_tokens(ctx: Context\u003cStakeTokens\u003e, amount: u64) -\u003e ProgramResult {\\n    // Logic to stake tokens\\n    Ok(())\\n}\\n\\npub fn withdraw_rewards(ctx: Context\u003cWithdrawRewards\u003e, amount: u64) -\u003e ProgramResult {\\n    // Logic to withdraw rewards\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct StakeTokens\u003c'info\u003e {\\n    #[account(\\n        mut, \\n        seeds = [b\\\"staking_pool_pda\\\"], \\n        bump\\n    )]\\n    staking_pool: AccountInfo\u003c'info\u003e,\\n    // Other staking-related accounts\\n}\\n\\n#[derive(Accounts)]\\npub struct WithdrawRewards\u003c'info\u003e {\\n    #[account(\\n        mut, \\n        seeds = [b\\\"staking_pool_pda\\\"], \\n        bump\\n    )]\\n    rewards_pool: AccountInfo\u003c'info\u003e,\\n    // Other rewards withdrawal-related accounts\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"This is problematic as the staking and rewards withdrawal functionalities rely on the same PDA derived from \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"staking_pool_pda\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\". This could allow users to manipulate the contract into unauthorized reward withdrawal or staking manipulation.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate against this vulnerability, use distinct PDAs for different functionalities. Ensure that each PDA serves a specific context and is derived using unique, operation-specific seeds:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ef7\",\"code\":\"pub fn stake_tokens(ctx: Context\u003cStakeTokens\u003e, amount: u64) -\u003e ProgramResult {\\n    // Logic to stake tokens\\n    Ok(())\\n}\\n\\npub fn withdraw_rewards(ctx: Context\u003cWithdrawRewards\u003e, amount: u64) -\u003e ProgramResult {\\n    // Logic to withdraw rewards\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct StakeTokens\u003c'info\u003e {\\n    #[account(\\n        mut,\\n        seeds = [b\\\"staking_pool\\\", \u0026staking_pool.key().as_ref()],\\n        bump\\n    )]\\n    staking_pool: AccountInfo\u003c'info\u003e,\\n    // Other staking-related accounts\\n}\\n\\n#[derive(Accounts)]\\npub struct WithdrawRewards\u003c'info\u003e {\\n    #[account(\\n        mut,\\n        seeds = [b\\\"rewards_pool\\\", \u0026rewards_pool.key().as_ref()],\\n        bump\\n    )]\\n    rewards_pool: AccountInfo\u003c'info\u003e,\\n    // Other rewards withdrawal-related accounts\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"In the example above, the PDAs for staking tokens and withdrawing rewards are derived using distinct seeds (\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"staking_pool\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" and \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"rewards_pool\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", respectively) combined with the specific account's key. This ensures that the PDAs are uniquely tied to their intended functionalities, mitigating the risk of unauthorized actions.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Remaining Accounts\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"ctx.remaining_accounts \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"provides a way to pass additional accounts into a function that weren’t specified in the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Accounts \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"struct initially. This gives more flexibility to the developer, allowing them to handle scenarios requiring a dynamic number of accounts (i.e., processing a variable number of users or interacting with different programs. However, this increased flexibility comes with a caveat: accounts passed through \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ctx.remaining_accounts \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"do not undergo the same validation applied to accounts defined in the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Accounts \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"struct. Because \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ctx.remaining_accounts \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"does not validate the accounts passed in, a malicious actor could exploit this by passing in accounts the program did not intend to interact with, leading to unauthorized actions or access.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":1},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a rewards program that uses \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ctx.remaining_accounts \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"to receive user PDAs and calculate rewards dynamically:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ef8\",\"code\":\"pub fn calculate_rewards(ctx: Context\u003cCalculateRewards\u003e) -\u003e Result\u003c()\u003e {\\n    let rewards_account = \u0026ctx.accounts.rewards_account;\\n    let authority = \u0026ctx.accounts.authority;\\n\\n    // Iterate over accounts passed in via ctx.remaining_accounts\\n    for user_pda_info in ctx.remaining_accounts.iter() {\\n        // logic to check user activity and calculate rewards\\n    }\\n\\n    // Logic to distribute calculated rewards\\n\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct CalculateRewards\u003c'info\u003e {\\n    #[account(mut)]\\n    pub rewards_account: Account\u003c'info, RewardsAccount\u003e,\\n    pub authority : Signer\u003c'info\u003e,\\n}\\n\\n#[account]\\npub struct RewardsAccount {\\n    pub total_rewards: u64,\\n    // Other relevant fields\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The issue here is that there aren’t any explicit checks to validate the accounts passed in via \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ctx.remaining_accounts\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", meaning it fails to ensure that only valid and eligible users’ accounts are processed in the rewards calculation and distribution. A malicious actor could, therefore, pass in accounts they do not own, or ones created by themselves, to receive more rewards than they are actually owed.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate this vulnerability, developers should manually verify each account’s validity within the function. This would include checking the account’s owner to ensure it matches an expected user’s and validate any relevant data within the account. By incorporating these manual checks, developers can leverage the flexibility of \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"ctx.remaining_acocunts \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"while mitigating the risk of unauthorized access or manipulation.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Rust-Specific Errors\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Rust is the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"lingua franca\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":2,\"version\":1},{\"mode\":\"normal\",\"text\":\" of program development on Solana. Developing in Rust brings forth a unique set of challenges and considerations, particularly around unsafe code and Rust-specific errors. Understanding Rust's caveats aids in developing secure, efficient, and reliable programs.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Unsafe Rust\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Rust is celebrated for its memory safety guarantees, achieved through a strict ownership and borrowing system. However, these guarantees can sometimes hinder, so Rust offers the\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c3a1\",\"type\":\"link\",\"fields\":{\"url\":\"https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" keyword to bypass Safety checks. \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"Rust is used in four primary contexts:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Unsafe Functions\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": functions that perform operations that may violate Rust's safety guarantees must be marked with the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"keyword. For example, \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe fn dangerous_function() {}\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Unsafe Blocks\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": blocks of code where unsafe operations are permitted. For example, \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe { // Unsafe operations }\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":3,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Unsafe Traits\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": traits that imply certain invariants that the compiler can't verify. For example, \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe trait BadTrait {}\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":4,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Implementing Unsafe Traits\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": implementations of \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"traits must also be marked as \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\". For example, \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe impl UnsafeTrait for UnsafeType {}\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null}],\"listType\":\"bullet\",\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Unsafe Rust exists because static analysis is conservative. When the compiler tries to determine if the code upholds a certain set of guarantees, it's better to reject a few instances of valid code than to accept a few instances of invalid code. Although the code might run perfectly fine, the Rust compiler will reject the code if it doesn’t have enough information to be confident in whether it upholds Rust's safety guarantees. Unsafe code allows developers to bypass these checks at their own risk. Moreover, computer hardware is inherently unsafe. Developers must be allowed to do unsafe operations to do low-level programming with Rust.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"With the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"keyword, developers can:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Dereference Raw Pointers\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": enables direct memory access to raw pointers that can point to any memory location, which might not hold valid data\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Call Unsafe Functions\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": these functions may not adhere to Rust's safety guarantees, and can lead to potentially undefined behavior\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":3,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Access Mutable Static Variables\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": global mutable state can cause data races\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"listType\":\"bullet\",\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The best way to mitigate unsafe Rust is to minimize the use of \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"blocks. If \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unsafe \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"code is absolutely necessary, for whatever reason, ensure that it is well-documented, regularly audited, and, if possible, is encapsulated in a safe abstraction that can be provided to the rest of the program.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Panics and Error Management\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"A panic occurs when a Rust program encounters an unrecoverable error and terminates execution. Panics are used for unexpected errors that are not meant to be caught. In the context of Solana programs, a panic can lead to unexpected behavior as the runtime expects programs to handle errors gracefully without crashing.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"When a panic occurs, Rust starts unwinding the stack and cleaning it up as it goes. This returns a stack trace, which includes detailed information on the error involved. This could supply an attacker with information about the underlying file structure. While this doesn't apply to Solana programs directly, the dependencies a program uses could be vulnerable to such an attack. Ensure dependencies are kept up-to-date and use versions that do not contain known vulnerabilities.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Common panic scenarios include:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Division by Zero\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": Rust will panic when attempting to divide by zero. Thus, always check for a zero divisor before performing a division\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Array Index Out of Bounds\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": accessing an array with an index that exceeds its bounds will cause a panic. To mitigate, use methods that return an \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Option \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"type (like \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"get\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\") to safely access array elements\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":3,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Unwrapping None Values\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\": calling \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\".unwrap()\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" on an \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Option \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"that holds a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"None \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"value will cause a panic. Always use pattern matching or methods like \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unwrap_or\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"unwrap_or_else\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", or the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"? \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"operator in functions that return a \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Result\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1}],\"direction\":null}],\"listType\":\"bullet\",\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate issues associated with panics, it's essential to avoid operations that cause panics, validate all inputs and conditions that could give rise to problematic operations, and use the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Result \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"and \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Option \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"types for error handling. Additionally, writing comprehensive program tests will help uncover and address potential panic scenarios before deployment.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Seed Collisions\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Seed collisions occur when different inputs (i.e., seeds and program IDs) used to generate a PDA result in the same PDA address. This is problematic when PDAs are used within a program for different purposes, as it can lead to unexpected behavior, including denial of service attacks or complete compromise.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a program for a decentralized voting platform for various proposals and initiatives. Each voting session for a given proposal or initiative is created with a unique identifier, and users submit votes. The program uses PDAs for both voting sessions and individual votes:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1ef9\",\"code\":\"// Creating a Voting Session PDA\\n#[derive(Accounts)]\\n#[instruction(session_id: String)]\\npub struct CreateVotingSession\u003c'info\u003e {\\n    #[account(mut)]\\n    pub organizer: Signer\u003c'info\u003e,\\n    #[account(\\n        init,\\n        payer = organizer,\\n        space = 8 + Product::SIZE,\\n        seeds = [b\\\"session\\\", session_id.as_bytes()],\\n    )]\\n    pub voting_session: Account\u003c'info, VotingSession\u003e,\\n    pub system_program: Program\u003c'info, System\u003e,\\n}\\n\\n// Submitting a Vote PDA\\n#[derive(Accounts)]\\n#[instruction(session_id: String)]\\npub struct SubmitVote\u003c'info\u003e {\\n    #[account(mut)]\\n    pub voter: Signer\u003c'info\u003e,\\n    #[account(\\n        init,\\n        payer = voter,\\n        space = 8 + Vote::SIZE,\\n        seeds = [session_id.as_bytes(), voter.key().as_ref()]\\n    )]\\n    pub vote: Account\u003c'info, Vote\u003e,\\n    pub system_program: Program\u003c'info, System\u003e,\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"In this scenario, an attacker would try to carefully craft a voting session that, when combined with the static seed \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"\\\"session\\\"\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\", would result in a PDA that coincidentally matches the PDA generated for a different voting session. Deliberately creating a PDA that clashes with another voting session's PDA could disrupt the platform's operations by, for example, preventing legitimate votes for proposals or denying new initiatives from being added to the platform since Solana's runtime cannot distinguish between the colliding PDAs.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate the risk of seed collisions, developers can:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Use unique prefixes for seeds across different PDAs in the same program. This approach will help ensure that PDAs remain distinct\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Use unique identifiers (e.g., timestamps, user IDs, nonce values) to guarantee that a unique PDA is generated every time\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"listitem\",\"value\":3,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Programmatically validate a generated PDA does not collide with existing PDAs\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"listType\":\"bullet\",\"direction\":null},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Type Cosplay\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The Vulnerability\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Type cosplay is a vulnerability where one account type is misrepresented as another due to a lack of type checks during deserialization. This can lead to the execution of unauthorized actions or data corruption, as the program would operate based on the incorrect assumption of the account's role or permissions. Always check the account's intended type during deserialization explicitly.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Example Scenario\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Consider a program that manages access to admin operations based on a user's role. Each user account includes a role discriminator to distinguish between regular users and administrators. The program contains a function to update admin settings intended only for administrators. However, the program fails to check the account's discriminator and deserializes user account data without confirming whether the account is an administrator:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1efa\",\"code\":\"pub fn update_admin_settings(ctx: Context\u003cUpdateSettings\u003e) -\u003e ProgramResult {\\n    // Deserialize without checking the discriminator\\n    let user = User::try_from_slice(\u0026ctx.accounts.user.data.borrow()).unwrap();\\n\\n    // Sensitive update logic\\n\\n    msg!(\\\"Admin settings updated by: {}\\\", user.authority)\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct UpdateSettings\u003c'info\u003e {\\n    user: AccountInfo\u003c'info\u003e\\n}\\n\\n#[derive(BorshSerialize, BorshDeserialize)]\\npub struct User {\\n    authority: Pubkey,\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The issue is that \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"update_admin_settings \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"deserializes the user account passed in without checking the account's role discriminator, partly because the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"User \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"struct is missing a discriminator field!\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h3\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Recommended Mitigation\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"To mitigate against this issue, developers can introduce a discriminator field in the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"User \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"struct and verify it during the deserialization process:\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"block\",\"fields\":{\"id\":\"677b8eb83fb3bb0003ba1efb\",\"code\":\"pub fn update_admin_settings(ctx: Context\u003cUpdateSettings\u003e) -\u003e ProgramResult {\\n    let user = User::try_from_slice(\u0026ctx.accounts.user.data.borrow()).unwrap();\\n\\n    // Verify the user's discriminator\\n    if user.discriminant != AccountDiscriminant::Admin {\\n        return Err(ProgramError::InvalidAccountData.into())\\n    }\\n    \\n    // Sensitive update logic\\n\\n    msg!(\\\"Admin settings updated by: {}\\\", user.authority)\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct UpdateSettings\u003c'info\u003e {\\n    user: AccountInfo\u003c'info\u003e\\n}\\n\\n#[derive(BorshSerialize, BorshDeserialize)]\\npub struct User {\\n    discriminant: AccountDiscriminant,\\n    authority: Pubkey,\\n}\\n\\n#[derive(BorshSerialize, BorshDeserialize, PartialEq)]\\npub enum AccountDiscriminant {\\n    Admin,\\n    // Other account types\\n}\",\"language\":\"rust\",\"blockName\":\"\",\"blockType\":\"code\"},\"format\":\"\",\"version\":2}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Anchor simplifies the mitigation of type cosplay vulnerabilities by automatically managing discriminators for account times. This is done via the \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"Account\u003c'info, T\u003e\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\" wrapper, where Anchor ensures type safety by automatically checking the discriminator during deserialization. This allows developers to focus more on their program's business logic rather than manually implementing various type checks.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Conclusion\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"The importance of program security cannot be overstated. This article has traversed the spectrum of common vulnerabilities, from Rust-specific errors to the complexities of Anchor’s \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"mode\":\"normal\",\"text\":\"realloc \",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":1,\"version\":1},{\"mode\":\"normal\",\"text\":\"method. The path to mastering each of these vulnerabilities, and program security in general, is ongoing and demands continuous learning, adaptation, and collaboration. As developers, our commitment to security is not just about safeguarding assets; it’s about fostering trust, ensuring the integrity of our applications, and contributing to Solana’s growth and stability.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"type\":\"paragraph\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"If you’ve read this far, thank you anon! Be sure to enter your email address below so you’ll never miss an update about what’s new on Solana. Ready to dive deeper? Explore the latest articles on the\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1},{\"id\":\"67614970cdc1ebf4b6f9c3a2\",\"type\":\"link\",\"fields\":{\"url\":\"https://www.helius.dev/blog\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\" Helius blog\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"mode\":\"normal\",\"text\":\" and continue your Solana journey, today.\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null,\"textStyle\":\"\",\"textFormat\":0},{\"tag\":\"h2\",\"type\":\"heading\",\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"mode\":\"normal\",\"text\":\"Additional Resources\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null},{\"tag\":\"ul\",\"type\":\"list\",\"start\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"type\":\"listitem\",\"value\":1,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c3a3\",\"type\":\"link\",\"fields\":{\"url\":\"https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"How to Become a Smart Contract Auditor\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"direction\":null},{\"type\":\"listitem\",\"value\":2,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c3a4\",\"type\":\"link\",\"fields\":{\"url\":\"https://immunefi.com/explore/?filter=ecosystem%3DSolana\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Immunefi\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"direction\":null},{\"type\":\"listitem\",\"value\":3,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c3a5\",\"type\":\"link\",\"fields\":{\"url\":\"https://cmichel.io/how-to-become-a-smart-contract-auditor/\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Neodyme’s Solana Security Workshop\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"direction\":null},{\"type\":\"listitem\",\"value\":4,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c3a6\",\"type\":\"link\",\"fields\":{\"url\":\"https://github.com/coral-xyz/sealevel-attacks\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Sealevel Attacks\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"direction\":null},{\"type\":\"listitem\",\"value\":5,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c3a7\",\"type\":\"link\",\"fields\":{\"url\":\"https://osec.io/blog/2022-03-14-solana-security-intro\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Solana: An Auditor’s Introduction\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"direction\":null},{\"type\":\"listitem\",\"value\":6,\"format\":\"\",\"indent\":0,\"version\":1,\"children\":[{\"id\":\"67614970cdc1ebf4b6f9c3a8\",\"type\":\"link\",\"fields\":{\"url\":\"https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html\",\"newTab\":true,\"linkType\":\"custom\"},\"format\":\"\",\"indent\":0,\"version\":3,\"children\":[{\"mode\":\"normal\",\"text\":\"Unsafe Rust\",\"type\":\"text\",\"style\":\"\",\"detail\":0,\"format\":0,\"version\":1}],\"direction\":null}],\"direction\":null}],\"listType\":\"bullet\",\"direction\":null}],\"direction\":\"ltr\"}},\"className\":\"[\u0026_a]:py-1 [\u0026_a]:flex\"}]}]]}]}]}],[\"$\",\"div\",null,{\"className\":\"max-w-[42rem] mx-auto\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-none prose sm:prose-lg lg:prose-xl\",\"children\":[[\"$\",\"p\",\"0\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"This article was co-authored by \"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://twitter.com/bl0ckpain\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"bl0ckpain\"}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\", a security researcher and smart contract developer who previously worked with \"}],[\"$\",\"$L1a\",\"3\",{\"className\":\"\",\"href\":\"https://kudelskisecurity.com/\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"Kudelski Security\"}]]]}],[\"$\",\"$1\",\"4\",{\"children\":\" and \"}],[\"$\",\"$L1a\",\"5\",{\"className\":\"\",\"href\":\"https://www.halborn.com/\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"Halborn\"}]]]}]]}],[\"$\",\"h2\",\"1\",{\"id\":\"introduction\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#introduction\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Introduction\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"2\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Solana program security is not just about preventing hackers from stealing a project’s funds — it’s about ensuring a program behaves as intended, adhering to the project’s specifications and user expectations. Solana program security can affect a dApp's performance, scalability, and interoperability. Thus, developers must be aware of potential attack vectors and common vulnerabilities before building consumer-grade applications.\"}]]}],[\"$\",\"p\",\"3\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"This article explores common vulnerabilities that developers will encounter when creating Solana programs. We start with an introduction to the attacker mindset for exploiting Solana programs, covering topics such as Solana’s programming model, how Solana’s design is inherently attacker-controlled, potential attack vectors, and common mitigation strategies. Then, we cover a variety of different vulnerabilities, giving an explanation of the vulnerability as well as insecure and secure code examples where applicable. \"}]]}],[\"$\",\"p\",\"4\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Note this article is intended for a more intermediate or advanced audience as it assumes knowledge of Solana’s programming model and program development. \"}]]}],[\"$\",\"p\",\"5\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"This article will not go through the process of building a program or Solana-specific concepts — we are focused on examining common vulnerabilities and learning how to mitigate them. If you’re new to Solana, we recommend that you read these previous blog posts before going through this article:\"}]]}],[\"$\",\"ul\",\"6\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://www.helius.dev/blog/the-solana-programming-model-an-introduction-to-developing-on-solana\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"The Solana Programming Model: An Introduction to Developing on Solana\"}]]]}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://www.helius.dev/blog/an-introduction-to-anchor-a-beginners-guide-to-building-solana-programs\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"An Introduction to Anchor: A Beginner’s Guide to Building Solana Programs\"}]]]}]]}]]}],[\"$\",\"h2\",\"7\",{\"id\":\"the-attacker-mindset-in-exploiting-solana-programs\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-attacker-mindset-in-exploiting-solana-programs\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Attacker Mindset in Exploiting Solana Programs\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"8\",{\"id\":\"solanas-programming-model\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#solanas-programming-model\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Solana’s Programming Model\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"9\",{\"children\":[[\"$\",\"$L2d\",\"0\",{\"children\":[[\"$\",\"figure\",null,{\"className\":\"\",\"children\":[\"$\",\"$L2e\",null,{\"className\":\"cursor-pointer md:cursor-zoom-in pointer-events-none md:pointer-events-auto w-full \",\"children\":[[\"$\",\"$L1f\",null,{\"imgClassName\":\"m-0 w-full not-prose\",\"resource\":\"$5:props:children:5:props:children:0:props:children:4:props:children:props:children:props:children:1:props:children:props:content:root:children:9:children:0:fields:media\",\"src\":\"$undefined\"}],null]}]}],[\"$\",\"$L2f\",null,{\"className\":\"p-10 container h-[90vh]\",\"children\":[[\"$\",\"$L30\",null,{\"className\":\"sr-only\",\"children\":[\"$\",\"$L31\",null,{\"children\":\"Enlarged image\"}]}],[\"$\",\"figure\",null,{\"className\":\"relative\",\"children\":[[\"$\",\"$L1f\",null,{\"resource\":\"$5:props:children:5:props:children:0:props:children:4:props:children:props:children:props:children:1:props:children:props:content:root:children:9:children:0:fields:media\",\"src\":\"$undefined\",\"fill\":true,\"imgClassName\":\"object-contain pb-8\"}],[\"$\",\"figcaption\",null,{\"className\":\"font-mono [\u0026_p]:text-afmd [\u0026_p]:text-gray-500 flex items-center justify-center gap-2 absolute bottom-0 left-0 text-center w-full\",\"children\":null}]]}]]}]]}]]}],[\"$\",\"p\",\"10\",{\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://www.helius.dev/blog/the-solana-programming-model-an-introduction-to-developing-on-solana\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"Solana's programming model\"}]]]}],[\"$\",\"$1\",\"1\",{\"children\":\" shapes the security landscape of applications built on its network. On Solana, accounts act as containers for data, similar to files on a computer. We can separate accounts into two general types: executable and non-executable. Executable accounts, or \"}],[\"$\",\"em\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"programs\"}]}],[\"$\",\"$1\",\"3\",{\"children\":\", are accounts capable of running code. Non-executable accounts are used for data storage without the ability to execute code (because they don't store any code). This decoupling of code and data means that programs are stateless — they interact with data stored in other accounts, passed by reference during transactions.\"}]]}],[\"$\",\"h3\",\"11\",{\"id\":\"solana-is-attacker-controlled\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#solana-is-attacker-controlled\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Solana is Attacker-Controlled\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"12\",{\"children\":[[\"$\",\"$L2d\",\"0\",{\"children\":[[\"$\",\"figure\",null,{\"className\":\"\",\"children\":[\"$\",\"$L2e\",null,{\"className\":\"cursor-pointer md:cursor-zoom-in pointer-events-none md:pointer-events-auto w-full \",\"children\":[[\"$\",\"$L1f\",null,{\"imgClassName\":\"m-0 w-full not-prose\",\"resource\":\"$5:props:children:5:props:children:0:props:children:4:props:children:props:children:props:children:1:props:children:props:content:root:children:12:children:0:fields:media\",\"src\":\"$undefined\"}],null]}]}],[\"$\",\"$L2f\",null,{\"className\":\"p-10 container h-[90vh]\",\"children\":[[\"$\",\"$L30\",null,{\"className\":\"sr-only\",\"children\":[\"$\",\"$L31\",null,{\"children\":\"Enlarged image\"}]}],[\"$\",\"figure\",null,{\"className\":\"relative\",\"children\":[[\"$\",\"$L1f\",null,{\"resource\":\"$5:props:children:5:props:children:0:props:children:4:props:children:props:children:props:children:1:props:children:props:content:root:children:12:children:0:fields:media\",\"src\":\"$undefined\",\"fill\":true,\"imgClassName\":\"object-contain pb-8\"}],[\"$\",\"figcaption\",null,{\"className\":\"font-mono [\u0026_p]:text-afmd [\u0026_p]:text-gray-500 flex items-center justify-center gap-2 absolute bottom-0 left-0 text-center w-full\",\"children\":null}]]}]]}]]}]]}],[\"$\",\"p\",\"13\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"A transaction specifies the program to call, a list of accounts, and a byte array of instruction data. This model relies on the program to parse and interpret the accounts and instructions a given transaction provides. Allowing any account to be passed into a program's function grants attackers significant control over the data a program will operate on. Understanding Solana's inherently attacker-controlled programming model is crucial to developing secure programs.\"}]]}],[\"$\",\"p\",\"14\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Given an attacker's ability to pass \"}],[\"$\",\"em\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"any\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" account into a program's function, data validation becomes a fundamental pillar of Solana program security. Developers must ensure that their program can distinguish between legitimate and malicious inputs. This includes verifying account ownership, ensuring accounts are of an expected type, and whether an account is a signer.\"}]]}],[\"$\",\"h3\",\"15\",{\"id\":\"potential-attack-vectors\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#potential-attack-vectors\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Potential Attack Vectors\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"16\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Solana's unique programming model and execution environment give rise to specific attack vectors. Understanding these vectors is crucial for developers to safeguard their programs against potential exploits. These attack vectors include:\"}]]}],[\"$\",\"ul\",\"17\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Logic Bugs\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": flaws in program logic could be manipulated to cause unintended behavior, such as a loss of assets or unauthorized access. This also includes failing to implement project specifications correctly — if a program claims to do \"}],[\"$\",\"em\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"x\"}]}],[\"$\",\"$1\",\"3\",{\"children\":\", then it should do \"}],[\"$\",\"em\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\"x\"}]}],[\"$\",\"$1\",\"5\",{\"children\":\" and all of its idiosyncrasies\"}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Data Validation Flaws\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": inadequately validating input data can allow attackers to pass in malicious data and manipulate program state or execution\"}]]}],[\"$\",\"li\",\"2\",{\"value\":3,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Rust-Specific Issues\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": despite Rust's safety features, unsafe code blocks, concurrency issues, and panics can introduce vulnerabilities\"}]]}],[\"$\",\"li\",\"3\",{\"value\":4,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Access Control Vulnerabilities\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": failing to correctly implement access control checks, such as verifying an account’s owner, can lead to unauthorized actions by a malicious actor\"}]]}],[\"$\",\"li\",\"4\",{\"value\":5,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Arithmetic and Precision Errors\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": overflows/underflows and precision errors can be exploited for financial gain or cause a program to malfunction\"}]]}],[\"$\",\"li\",\"5\",{\"value\":6,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Cross-Program Invocation (CPI) Issues\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": flaws in handling CPIs can lead to unexpected state changes or errors if a called program behaves maliciously or unexpectedly\"}]]}],[\"$\",\"li\",\"6\",{\"value\":7,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Program Derived Addresses (PDAs) Misuse\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": incorrectly generating or handling PDAs can lead to vulnerabilities where attackers can hijack or spoof PDAs to gain unauthorized access or manipulate program-controlled accounts\"}]]}]]}],[\"$\",\"p\",\"18\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Note that reentrancy is inherently limited on Solana due to its execution model. The Solana runtime restricts CPIs to a maximum depth of four and enforces strict account rules, such as only allowing an account's owner to modify its data. These constraints prevent reentrancy attacks by limiting direct self-recursion and ensuring a program cannot be involuntarily invoked in an intermediary state.\"}]]}],[\"$\",\"h3\",\"19\",{\"id\":\"mitigation-strategies\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#mitigation-strategies\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Mitigation Strategies\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"20\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate these potential attacks, developers should employ a combination of rigorous testing, code auditing, and adherence to best practices:\"}]]}],[\"$\",\"ul\",\"21\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Implement comprehensive input validation and access control checks\"}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Use Rust's type system and safety features to its fullest extent, avoiding unsafe code unless necessary\"}]]}],[\"$\",\"li\",\"2\",{\"value\":3,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Follow Solana and Rust security best practices and stay up to date with new developments\"}]]}],[\"$\",\"li\",\"3\",{\"value\":4,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Conduct internal code reviews and use automated tools to identify common vulnerabilities and logic errors during program development\"}]]}],[\"$\",\"li\",\"4\",{\"value\":5,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Have your codebase audited by reputable third parties, including security firms and independent security researchers\"}]]}],[\"$\",\"li\",\"5\",{\"value\":6,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Create a bug bounty platform for your program to incentivize the reporting of vulnerabilities rather than relying on \"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://en.wikipedia.org/wiki/Grey_hat\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"grey hats\"}]]]}]]}]]}],[\"$\",\"p\",\"22\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"The following sections will explore different vulnerabilities alphabetically. Each section will describe a potential vulnerability, explain how to mitigate the vulnerability and give example scenarios whenever possible.\"}]]}],[\"$\",\"h2\",\"23\",{\"id\":\"account-data-matching\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#account-data-matching\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Account Data Matching\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"24\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"25\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Account data matching is a vulnerability that arises when developers fail to check the data stored on an account matches an expected set of values. Without proper data validation checks, a program may inadvertently operate with incorrect or maliciously substituted accounts. This vulnerability is particularly acute in scenarios involving permission-related checks.\"}]]}],[\"$\",\"h3\",\"26\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"27\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a program with functionality to manage its administrative settings. The program includes an instruction to update the current administrative configurations, such as feature flags or operational parameters. The instruction must validate that the request comes from an authorized administrator. However, the program fails to verify that the account requesting the change matches the administrator account stored in the configuration data:\"}]]}],[\"$\",\"p\",\"28\",{\"children\":[\"$L32\"]}],[\"$\",\"h3\",\"29\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"30\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate this vulnerability, developers can implement explicit checks comparing the account keys and stored data against expected values. For instance, verify that the depositor's public key matches the owner field of the token account being used for the deposit:\"}]]}],[\"$\",\"p\",\"31\",{\"children\":[\"$L33\"]}],[\"$\",\"p\",\"32\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Developers can also use Anchor's \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"has_one\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" and \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"constraint\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\" attributes to enforce data validation checks declaratively. Using our example above, we could use the \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"constraint\"}]}],[\"$\",\"$1\",\"6\",{\"children\":\" attribute to check the depositor's public key and the deposit token account's owner are equivalent:\"}]]}],[\"$\",\"p\",\"33\",{\"children\":[\"$L34\"]}],[\"$\",\"h2\",\"34\",{\"id\":\"account-data-reallocation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#account-data-reallocation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Account Data Reallocation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"35\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"36\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"In Anchor, the \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"realloc \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"function provided by the \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"AccountInfo \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"struct introduces a nuanced vulnerability related to memory management. This function allows for reallocating an account's data size, which could be useful for dynamic data handling within programs. However, improper use of \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"realloc \"}]}],[\"$\",\"$1\",\"6\",{\"children\":\"can lead to unintended consequences, including wasting compute units or potentially exposing stale data.\"}]]}],[\"$\",\"p\",\"37\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"The \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"realloc \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"method has two parameters:\"}]]}],[\"$\",\"ul\",\"38\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"new_len\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": a \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"usize \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"that specifies the new length of the account's data\"}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"zero_init\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": a \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"bool \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"that determines whether the new memory space should be zero-initialized\"}]]}]]}],[\"$\",\"p\",\"39\",{\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"realloc \"}]}],[\"$\",\"$1\",\"1\",{\"children\":\"is defined as follows:\"}]]}],[\"$\",\"p\",\"40\",{\"children\":[\"$L35\"]}],[\"$\",\"p\",\"41\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Memory allocated for account data is already zero-initialized at the program's entry point. This means the new memory space is already zeroed out when data is reallocated to a larger size within a single transaction. Re-zeroing this memory is unnecessary and results in additional compute unit consumption. Conversely, reallocating to a smaller size and then back to a larger one within the same transaction could expose stale data if \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"zero_init \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"is \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"false\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\".\"}]]}],[\"$\",\"h3\",\"42\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"43\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a dynamic to-do list program where users can add, remove, or modify entries within a single transaction. This program needs to reallocate its data size dynamically based on user actions:\"}]]}],[\"$\",\"p\",\"44\",{\"children\":[\"$L36\"]}],[\"$\",\"p\",\"45\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"In this scenario, the \"}],[\"$\",\"code\",\"1\",{\"children\":\"modify_todo_list\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"function might reallocate \"}],[\"$\",\"code\",\"4\",{\"children\":\"to_do_list_data\"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"6\",{\"children\":\"multiple times to accommodate the size required by the modifications. If the data size is reduced to remove a to-do entry and then increased again to add new entries within the same transaction, setting \"}],[\"$\",\"code\",\"7\",{\"children\":\"zero_init\"}],[\"$\",\"strong\",\"8\",{\"children\":[\"$\",\"$1\",\"8\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"9\",{\"children\":\"to \"}],[\"$\",\"code\",\"10\",{\"children\":\"false\"}],[\"$\",\"strong\",\"11\",{\"children\":[\"$\",\"$1\",\"11\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"12\",{\"children\":\"could expose stale data.\"}]]}],[\"$\",\"h3\",\"46\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"47\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate this issue, using the \"}],[\"$\",\"code\",\"1\",{\"children\":\"zero_init\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"parameter prudently is crucial:\"}]]}],[\"$\",\"ul\",\"48\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Set \"}],[\"$\",\"code\",\"1\",{\"children\":\"zero_init\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"to \"}],[\"$\",\"code\",\"4\",{\"children\":\"true\"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"6\",{\"children\":\"when increasing the data size after a prior decrease within the same transaction call. This ensures that any new memory space is zero-initialized, preventing stale data from being exposed\"}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Set \"}],[\"$\",\"code\",\"1\",{\"children\":\"zero_init\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"to \"}],[\"$\",\"code\",\"4\",{\"children\":\"false\"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"6\",{\"children\":\"when increasing the data size without a prior decrease in the same transaction call since the memory will already be zero-initialized\"}]]}]]}],[\"$\",\"p\",\"49\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Instead of reallocating data to meet specific size requirements, developers should use\"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://docs.rs/solana-sdk/latest/solana_sdk/address_lookup_table/struct.AddressLookupTableAccount.html\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" Address Lookup Tables (ALTs)\"}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\". ALTs allow developers to compress a transaction's data by storing up to 256 addresses in a single on-chain account. Each address within the table can then be referenced by a 1-byte index, significantly reducing the data needed for address references in a given transaction. ALTs are much more helpful for scenarios requiring dynamic account interactions without the need for frequent memory resizing.\"}]]}],[\"$\",\"h2\",\"50\",{\"id\":\"account-reloading\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#account-reloading\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Account Reloading\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"51\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"52\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Account reloading is a vulnerability that arises when developers fail to update deserialized accounts after performing a CPI. Anchor does not automatically refresh the state of deserialized accounts after a CPI. This could lead to scenarios where program logic operates on stale data, leading to logical errors or incorrect calculations.\"}]]}],[\"$\",\"h3\",\"53\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"54\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a protocol where users can stake tokens to earn rewards over time. The program facilitating this includes functionality to update a user's staking rewards based on certain conditions or external triggers. A user's rewards are calculated and updated through a CPI to a rewards distribution program. However, the program fails to update the original staking account after the CPI to reflect the new rewards balance:\"}]]}],[\"$\",\"p\",\"55\",{\"children\":[\"$L37\"]}],[\"$\",\"p\",\"56\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"In this example, the \"}],[\"$\",\"code\",\"1\",{\"children\":\"update_rewards\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"function attempts to update the rewards for a user's staking account through a CPI call to a rewards distribution program. Initially, the program logs \"}],[\"$\",\"code\",\"4\",{\"children\":\"ctx.accounts.staking_account.rewards\"}],[\"$\",\"$1\",\"5\",{\"children\":\" (i.e., the rewards balance) after the CPI and then continues onto logic that uses the stale \"}],[\"$\",\"code\",\"6\",{\"children\":\"ctx.accounts.staking_account.rewards\"}],[\"$\",\"$1\",\"7\",{\"children\":\" data. The issue is that the staking account's state is not automatically updated post-CPI, which is why the data is stale.\"}]]}],[\"$\",\"h3\",\"57\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"58\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate this issue, explicitly call Anchor's\"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://docs.rs/anchor-lang/latest/src/anchor_lang/accounts/account.rs.html#271-275\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"reload\"}]}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\" method to reload a given account from storage. Reloading an account post-CPI will accurately reflect its state:\"}]]}],[\"$\",\"p\",\"59\",{\"children\":[\"$L38\"]}],[\"$\",\"h2\",\"60\",{\"id\":\"arbitrary-cpi\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#arbitrary-cpi\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Arbitrary CPI\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"61\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"62\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Arbitrary CPIs occur when a program invokes another program without verifying the target program's identity. This vulnerability exists because the Solana runtime allows any program to call another program if the caller has the callee's program ID and adheres to the callee's interface. If a program performs CPIs based on user input without validating the callee's program ID, it could execute code in an attacker-controlled program.\"}]]}],[\"$\",\"h3\",\"63\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"64\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a program that distributes awards to participants based on their contributions to a project. After distributing the rewards, the program records the details in a separate ledger program for auditing and tracking purposes. The ledger program is assumed to be a trusted program, providing a public interface for keeping track of specific entries from authorized programs. The program includes a function to distribute and record rewards, which takes in the ledger program as an account. However, the function fails to verify the provided \"}],[\"$\",\"code\",\"1\",{\"children\":\"ledger_program\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"before making a CPI to it:\"}]]}],[\"$\",\"p\",\"65\",{\"children\":[\"$L39\"]}],[\"$\",\"p\",\"66\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"An attacker could exploit this by passing a malicious program's ID as the \"}],[\"$\",\"code\",\"1\",{\"children\":\"ledger_program\"}],[\"$\",\"$1\",\"2\",{\"children\":\", leading to unintended consequences.\"}]]}],[\"$\",\"h3\",\"67\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"68\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To secure against this issue, developers can add a check that verifies the ledger program's identity before performing the CPI. This check would ensure that the CPI call is made to the intended program, preventing arbitrary CPIs:\"}]]}],[\"$\",\"p\",\"69\",{\"children\":[\"$L3a\"]}],[\"$\",\"p\",\"70\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"A program may have a publicly available CPI module if it was written using Anchor. This makes invoking the program from another Anchor program easy and secure. The Anchor CPI module automatically checks that the program's address passed in matches the program's address stored in the module. Alternatively, hardcoding the address can be a possible solution instead of having the user pass it in.\"}]]}],[\"$\",\"h2\",\"71\",{\"id\":\"authority-transfer-functionality\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#authority-transfer-functionality\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Authority Transfer Functionality\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"72\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"73\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Solana programs often designate specific public keys as authorities for critical functions, such as updating program parameters or withdrawing funds. However, the inability to transfer this authority to another address can pose significant risks. This limitation becomes problematic in scenarios such as team changes, protocol sales, or if the authority becomes compromised.\"}]]}],[\"$\",\"h3\",\"74\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"75\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a program where a global admin authority is responsible for setting specific protocol parameters through a \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"set_params\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" function. The program does not include a mechanism to change the global admin:\"}]]}],[\"$\",\"p\",\"76\",{\"children\":[\"$L3b\"]}],[\"$\",\"p\",\"77\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Here, the authority is statically defined without the ability to update it to a new address.\"}]]}],[\"$\",\"h3\",\"78\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"79\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"A secure approach to mitigating this issue is to create a two-step process for transferring authority. This process would allow the current authority to nominate a new \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"pending_authority\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\", which must explicitly accept the role. Not only would this provide authority transfer functionality, but it would also protect against accidental transfers or malicious takeovers. The flow would be as follows:\"}]]}],[\"$\",\"ul\",\"80\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Nomination by the Current Authority\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": the current authority would nominate a new \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"pending_authority\"}]}],[\"$\",\"$1\",\"3\",{\"children\":\" by calling \"}],[\"$\",\"strong\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\"nominate_new_authority\"}]}],[\"$\",\"$1\",\"5\",{\"children\":\", which sets the \"}],[\"$\",\"strong\",\"6\",{\"children\":[\"$\",\"$1\",\"6\",{\"children\":\"pending_authority\"}]}],[\"$\",\"$1\",\"7\",{\"children\":\" field in the program state\"}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Acceptance by New Authority\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": the nominated \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"pending_authority\"}]}],[\"$\",\"$1\",\"3\",{\"children\":\" calls \"}],[\"$\",\"strong\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\"accept_authority\"}]}],[\"$\",\"$1\",\"5\",{\"children\":\" to take on their new role, transferring authority from the current authority to \"}],[\"$\",\"strong\",\"6\",{\"children\":[\"$\",\"$1\",\"6\",{\"children\":\"pending_authority\"}]}]]}]]}],[\"$\",\"p\",\"81\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"This would look something like:\"}]]}],[\"$\",\"p\",\"82\",{\"children\":[\"$L3c\"]}],[\"$\",\"p\",\"83\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"In this example, the \"}],[\"$\",\"code\",\"1\",{\"children\":\"ProgramState\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"account structure holds the current \"}],[\"$\",\"code\",\"4\",{\"children\":\"authority\"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"6\",{\"children\":\"and an optional \"}],[\"$\",\"code\",\"7\",{\"children\":\"pending_authority\"}],[\"$\",\"$1\",\"8\",{\"children\":\". The \"}],[\"$\",\"strong\",\"9\",{\"children\":[\"$\",\"$1\",\"9\",{\"children\":\"NominateAuthority \"}]}],[\"$\",\"$1\",\"10\",{\"children\":\"context ensures that the current authority signs the transaction, allowing them to nominate a new authority. The \"}],[\"$\",\"code\",\"11\",{\"children\":\"AcceptAuthority\"}],[\"$\",\"strong\",\"12\",{\"children\":[\"$\",\"$1\",\"12\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"13\",{\"children\":\"context checks that the \"}],[\"$\",\"code\",\"14\",{\"children\":\"pending_authority\"}],[\"$\",\"strong\",\"15\",{\"children\":[\"$\",\"$1\",\"15\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"16\",{\"children\":\"matches the signer of the transaction, allowing them to accept and become the new authority. This setup ensures a secure and controlled transition of authority within the program.\"}]]}],[\"$\",\"h2\",\"84\",{\"id\":\"bump-seed-canonicalization\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#bump-seed-canonicalization\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Bump Seed Canonicalization\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"85\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"86\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Bump seed canonicalization refers to using the highest valid bump seed (i.e., canonical bump) when deriving PDAs. Using the canonical bump is a deterministic and secure way to find an address given a set of seeds. Failing to use the canonical bump can lead to vulnerabilities, such as malicious actors creating or manipulating PDAs that compromise program logic or data integrity.\"}]]}],[\"$\",\"h3\",\"87\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"88\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a program designed to create unique user profiles, each with an associated PDA derived explicitly using \"}],[\"$\",\"code\",\"1\",{\"children\":\"create_program_address\"}],[\"$\",\"$1\",\"2\",{\"children\":\". The program allows for creating a profile by taking a user-provided bump. However, this is problematic as it introduces the risk of using the non-canonical bump:\"}]]}],[\"$\",\"p\",\"89\",{\"children\":[\"$L3d\"]}],[\"$\",\"p\",\"90\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"In this scenario, the program derives a \"}],[\"$\",\"code\",\"1\",{\"children\":\"UserProfile\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"PDA using \"}],[\"$\",\"code\",\"4\",{\"children\":\"create_program_address\"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"6\",{\"children\":\"with seeds that include a user-provided bump. Using a user-provided bump is problematic because it fails to ensure the use of the canonical bump. This would allow a malicious actor to create multiple PDAs with different bumps for the same user ID.\"}]]}],[\"$\",\"h3\",\"91\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"92\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate this issue, we can refactor our example to derive PDAs using \"}],[\"$\",\"code\",\"1\",{\"children\":\"find_program_address\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"and validate the bump seed explicitly:\"}]]}],[\"$\",\"p\",\"93\",{\"children\":[\"$L3e\"]}],[\"$\",\"p\",\"94\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Here, \"}],[\"$\",\"code\",\"1\",{\"children\":\"find_program_address\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"is used to derive the PDA with the canonical bump seed to ensure a deterministic and secure PDA creation. The canonical bump is stored in the \"}],[\"$\",\"strong\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\"UserProfile \"}]}],[\"$\",\"$1\",\"5\",{\"children\":\"account, allowing for efficient and secure validation in subsequent operations. We prefer \"}],[\"$\",\"code\",\"6\",{\"children\":\"find_program_address\"}],[\"$\",\"strong\",\"7\",{\"children\":[\"$\",\"$1\",\"7\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"8\",{\"children\":\"over \"}],[\"$\",\"code\",\"9\",{\"children\":\"create_program_address\"}],[\"$\",\"strong\",\"10\",{\"children\":[\"$\",\"$1\",\"10\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"11\",{\"children\":\"because the latter creates a valid PDA \"}],[\"$\",\"em\",\"12\",{\"children\":[\"$\",\"$1\",\"12\",{\"children\":\"without searching for a bump seed\"}]}],[\"$\",\"$1\",\"13\",{\"children\":\". Because it doesn't search for a bump seed, it may unpredictably return an error for any given set of seeds and is not generally suitable for creating PDAs. \"}],[\"$\",\"code\",\"14\",{\"children\":\"find_program_address\"}],[\"$\",\"strong\",\"15\",{\"children\":[\"$\",\"$1\",\"15\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"16\",{\"children\":\"will \"}],[\"$\",\"em\",\"17\",{\"children\":[\"$\",\"$1\",\"17\",{\"children\":\"always\"}]}],[\"$\",\"$1\",\"18\",{\"children\":\" use the canonical bump when creating a PDA. This is because it iterates through various \"}],[\"$\",\"code\",\"19\",{\"children\":\"create_program_address\"}],[\"$\",\"strong\",\"20\",{\"children\":[\"$\",\"$1\",\"20\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"21\",{\"children\":\"calls, starting with a bump of 255 and decrementing with each iteration. Once a valid address is found, the function returns the derived PDA and the canonical bump used to derive it.\"}]]}],[\"$\",\"div\",\"95\",{\"className\":\"mx-auto w-full mb-4\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"role\":\"alert\",\"className\":\"relative w-full rounded-lg p-4 [\u0026\u003esvg~*]:pl-7 [\u0026\u003esvg+div]:translate-y-[-3px] [\u0026\u003esvg]:absolute [\u0026\u003esvg]:left-4 [\u0026\u003esvg]:top-4 bg-gray-900 text-gray-300 [\u0026_p]:text-gray-400\",\"children\":[[\"$\",\"svg\",null,{\"fill\":\"none\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 18 18\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fillRule\":\"evenodd\",\"clipRule\":\"evenodd\",\"d\":\"M9 1.5a7.5 7.5 0 1 0 0 15 7.5 7.5 0 0 0 0-15ZM7.5 8.25a.75.75 0 0 1 .75-.75H9a.75.75 0 0 1 .75.75V12a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1-.75-.75Zm1.5-3a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Z\",\"fill\":\"currentColor\"}]}],[\"$\",\"h5\",null,{\"ref\":\"$undefined\",\"className\":\"mb-1 text-base font-medium leading-none tracking-tight\",\"children\":\"Note:\"}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"text-base [\u0026_p]:leading-relaxed [\u0026_a]:text-primary [\u0026_a]:underline [\u0026_a]:hover:text-primary-lightest\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-none prose sm:prose-md lg:prose-md\",\"children\":[[\"$\",\"p\",\"0\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Anchor enforces the canonical bump for PDA derivations through its \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"seeds \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"and \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"bump \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"constraints, streamlining this entire process to ensure secure and deterministic PDA creation and validation.\"}]]}]]}]}]]}]}],[\"$\",\"h2\",\"96\",{\"id\":\"closing-accounts\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#closing-accounts\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Closing Accounts\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"97\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"98\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Improperly closing accounts in a program can lead to several vulnerabilities, including the potential for \\\"closed\\\" accounts to be reinitialized or misused. The issue arises from a failure to properly mark an account as closed or failing to prevent its reuse in subsequent transactions. This oversight can allow malicious actors to exploit a given account, leading to unauthorized action or access within the program.\"}]]}],[\"$\",\"h3\",\"99\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"100\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a program that allows users to create and close data storage accounts. The program closes an account by transferring out its lamports:\"}]]}],[\"$\",\"p\",\"101\",{\"children\":[\"$L3f\"]}],[\"$\",\"p\",\"102\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"This is problematic as the program fails to zero out the account's data or mark it as closed. Merely transferring out its remaining lamports does not close the account.\"}]]}],[\"$\",\"h3\",\"103\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"104\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate this issue, not only should the program transfer out all lamposts, it should also zero out the account's data and mark it with a discriminator (i.e., \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"\\\"CLOSED_ACCOUNT_DISCRIMINATOR\\\"\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"). The program should also implement checks to prevent closed accounts from being reused in future transactions:\"}]]}],[\"$\",\"p\",\"105\",{\"children\":[\"$L40\"]}],[\"$\",\"p\",\"106\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"However, zeroing out the data and adding the closed discriminator is not enough. A user can keep an account from being garbage collected by refunding the account's lamports before the end of an instruction. This will put the account in a weird limbo state where it cannot be used or garbage collected. Thus, we added a \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"force_defund \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"function to address this edge case; now anyone can defund closed accounts.\"}]]}],[\"$\",\"p\",\"107\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Anchor simplifies this process with the \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"#[account(close = destination)]\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" constraint, automating the secure closure of accounts by transferring lamports, zeroing data, and setting the closed account discriminator, all in one operation.\"}]]}],[\"$\",\"h2\",\"108\",{\"id\":\"duplicate-mutable-accounts\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#duplicate-mutable-accounts\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Duplicate Mutable Accounts\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"109\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"110\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Duplicate mutable accounts refers to a scenario where the same account is passed more than once as a mutable parameter to an instruction. This occurs when an instruction requires two mutable accounts of the same type. A malicious actor could pass in the same account twice, causing the account to be mutated in unintended ways (e.g., overwriting data). The severity of this vulnerability varies based on the specific scenario.\"}]]}],[\"$\",\"h3\",\"111\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"112\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a program designed to reward users based on their participation in a certain on-chain activity. The program has an instruction to update the balance of two accounts: a reward account and a bonus account. A user should receive a standard reward in one account and a potential bonus in another account based on specific predetermined criteria:\"}]]}],[\"$\",\"p\",\"113\",{\"children\":[\"$L41\"]}],[\"$\",\"p\",\"114\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"If a malicious actor passes the same account for \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"reward_account \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"and \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"bonus_account\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\", the account's balance will be incorrectly updated twice.\"}]]}],[\"$\",\"h3\",\"115\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"116\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate this issue, add a check within the instruction logic to verify that the public keys of the two accounts are not identical:\"}]]}],[\"$\",\"p\",\"117\",{\"children\":[\"$L42\"]}],[\"$\",\"p\",\"118\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Developers can use Anchor's account constraints to add a more explicit check on the account. This can be done using the \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"#[account]\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" attribute and the \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"constraint\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\" keyword:\"}]]}],[\"$\",\"p\",\"119\",{\"children\":[\"$L43\"]}],[\"$\",\"h2\",\"120\",{\"id\":\"frontrunning\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#frontrunning\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Frontrunning\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"121\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"122\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"With the rising popularity of transaction bundlers, frontrunning is a concern that should be taken seriously by protocols built on Solana. \"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://x.com/jito_labs/status/1766228889888514501?s=20\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"With the removal of Jito’s mempool\"}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\", we refer to frontrunning here as a malicious actor’s ability to manipulate expected versus actual values through carefully constructed transactions. \"}]]}],[\"$\",\"h3\",\"123\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"124\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Imagine a protocol that handles purchasing and bidding for a product, storing the seller's pricing information in an account named \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"SellInfo\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\":\"}]]}],[\"$\",\"p\",\"125\",{\"children\":[\"$L44\"]}],[\"$\",\"p\",\"126\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To purchase a \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"Product \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"listed, a buyer must pass in the \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"ProductListing \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"account related to the product they want. But what if the seller can change the \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"sale_price \"}]}],[\"$\",\"$1\",\"6\",{\"children\":\"of their listing?\"}]]}],[\"$\",\"p\",\"127\",{\"children\":[\"$L45\"]}],[\"$\",\"p\",\"128\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"This would introduce a frontrunning opportunity for the seller, especially if the buyer's purchasing transaction doesn't include \"}],[\"$\",\"code\",\"1\",{\"children\":\"expected_price\"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"checks to ensure they are paying no more than expected for the product they want. If the purchaser submits a transaction to buy the given Product\"}],[\"$\",\"strong\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"5\",{\"children\":\"is would be possible for the seller to call \"}],[\"$\",\"code\",\"6\",{\"children\":\"change_sale_price\"}],[\"$\",\"$1\",\"7\",{\"children\":\", and, using Jito, ensure this transaction is included before the purchaser's transaction. A malicious seller could change the price in the \"}],[\"$\",\"strong\",\"8\",{\"children\":[\"$\",\"$1\",\"8\",{\"children\":\"ProductListing \"}]}],[\"$\",\"$1\",\"9\",{\"children\":\"account to an exorbitant amount, unbeknownst to the purchaser, forcing them to pay much more than expected for the \"}],[\"$\",\"code\",\"10\",{\"children\":\"Product!\"}]]}],[\"$\",\"h3\",\"129\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"130\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"A simple solution would be including \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"expected_price \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"checks on the purchasing side of the deal, preventing the buyer from paying more than expected for the \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"Product \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"they want to buy:\"}]]}],[\"$\",\"p\",\"131\",{\"children\":[\"$L46\"]}],[\"$\",\"h2\",\"132\",{\"id\":\"insecure-initialization\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#insecure-initialization\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Insecure Initialization\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"133\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Unlike contracts deployed to the EVM, Solana programs are not deployed with a constructor to set state variables. Instead, they are initialized manually (normally by a function called \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"initialize \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"or something similar). Initialization functions typically set data such as the program’s authority or create accounts that form the base of the program being deployed (i.e., a central state account or something of the sort).\"}]]}],[\"$\",\"p\",\"134\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Since the initialization function is called manually, and not automatically on program deployment, this instruction must be called by a known address under the control of the program’s development team. Otherwise, it is possible for an attacker to frontrun initialization, possibly setting up the program using accounts under the attacker's control.\"}]]}],[\"$\",\"p\",\"135\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"A common practice is to use the program’s \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"upgrade_authority \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"as the authorized address to call the \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"initialize \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"function, if the program has an upgrade authority.\"}]]}],[\"$\",\"h3\",\"136\",{\"id\":\"insecure-example-and-how-to-mitigate\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#insecure-example-and-how-to-mitigate\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Insecure Example and How to Mitigate\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"137\",{\"children\":[\"$L47\"]}],[\"$\",\"p\",\"138\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"The example above is a stripped-down initialize function that sets the authority of a \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"CentralState \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"account for the instruction caller. However, this could be any account that calls initialize! As previously mentioned, a common way to secure an initialization function is to use the program’s \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"upgrade_authority\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\", known at deployment.\"}]]}],[\"$\",\"p\",\"139\",{\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://docs.rs/anchor-lang/latest/anchor_lang/accounts/account/struct.Account.html#example-1\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"Below is an example from the Anchor documentation\"}]]]}],[\"$\",\"$1\",\"1\",{\"children\":\", which uses constraint to ensure only the program's upgrade authority can call initialize:\"}]]}],[\"$\",\"p\",\"140\",{\"children\":[\"$L48\"]}],[\"$\",\"h2\",\"141\",{\"id\":\"loss-of-precision\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#loss-of-precision\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Loss of Precision\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"142\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"143\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Loss of precision, albeit minuscule in appearance, can pose a significant threat to a program. It can lead to incorrect calculations, arbitrage opportunities, and unexpected program behavior.\"}]]}],[\"$\",\"p\",\"144\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Precision loss in arithmetic operations is a common source of errors. With Solana programs, fixed-point arithmetic is recommended whenever possible. This is because programs only support a\"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://solana.com/docs/programs/limitations#float-rust-types-support\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" limited subset of Rust's float operations\"}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\". If a program attempts to use an unsupported float operation, the runtime will return an unresolved symbol error. Additionally, float operations require more instructions compared to their integer equivalents. The use of fixed-point arithmetic and the need to handle large numbers of tokens and fractional amounts accurately can exacerbate precision loss.\"}]]}],[\"$\",\"h3\",\"145\",{\"id\":\"multiplication-after-division\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#multiplication-after-division\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Multiplication After Division\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"146\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"While the\"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://en.wikipedia.org/wiki/Associative_property\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" associative property\"}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\" holds for most mathematical operations, its application in computer arithmetic can lead to unexpected precision loss. A classic example of precision loss occurs when performing multiplication after division, which can yield different results from performing multiplication before division. For example, consider the following expressions: \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"(a / c) * b\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\" and \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"(a * b) / c\"}]}],[\"$\",\"$1\",\"6\",{\"children\":\". Mathematically, these expressions are associative - they \"}],[\"$\",\"em\",\"7\",{\"children\":[\"$\",\"$1\",\"7\",{\"children\":\"should\"}]}],[\"$\",\"$1\",\"8\",{\"children\":\" yield the same result. However, in the context of Solana and fixed-point arithmetic, the order of operations matters significantly. Performing division first \"}],[\"$\",\"strong\",\"9\",{\"children\":[\"$\",\"$1\",\"9\",{\"children\":\"(a / c)\"}]}],[\"$\",\"$1\",\"10\",{\"children\":\" may result in a loss of precision if the quotient is rounded down before it's multiplied by \"}],[\"$\",\"strong\",\"11\",{\"children\":[\"$\",\"$1\",\"11\",{\"children\":\"b\"}]}],[\"$\",\"$1\",\"12\",{\"children\":\". This could result in a smaller result than expected. Conversely, multiplying \"}],[\"$\",\"strong\",\"13\",{\"children\":[\"$\",\"$1\",\"13\",{\"children\":\"(a * b)\"}]}],[\"$\",\"$1\",\"14\",{\"children\":\" before dividing by \"}],[\"$\",\"strong\",\"15\",{\"children\":[\"$\",\"$1\",\"15\",{\"children\":\"c\"}]}],[\"$\",\"$1\",\"16\",{\"children\":\" could preserve more of the original precision. This difference can lead to incorrect calculations, creating unexpected program behavior and/or arbitrage opportunities.\"}]]}],[\"$\",\"h3\",\"147\",{\"id\":\"saturating_-\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#saturating_-\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"saturating_* \"}]}],[\"$\",\"$1\",\"1\",{\"children\":\"Arithmetic Functions\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"148\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"While \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"saturating_*\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" arithmetic functions prevent overflow and underflow by capping values at their maximum or minimum possible values, they can lead to subtle bugs and precision loss if this cap is reached unexpectedly. This occurs when the program's logic assumes that saturation alone will guarantee an accurate result and ignores handling the potential loss of precision or accuracy.\"}]]}],[\"$\",\"p\",\"149\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"For example, imagine a program designed to calculate and distribute rewards to users based on the amount of tokens they trade within a specific period:\"}]]}],[\"$\",\"p\",\"150\",{\"children\":[\"$L49\"]}],[\"$\",\"p\",\"151\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider the scenario where the \"}],[\"$\",\"code\",\"1\",{\"children\":\"transaction_amount\"}],[\"$\",\"$1\",\"2\",{\"children\":\" is 100,000 tokens, and the \"}],[\"$\",\"code\",\"3\",{\"children\":\"reward_multiplier\"}],[\"$\",\"$1\",\"4\",{\"children\":\" is 100 tokens per transaction. Multiplying the two will exceed the maximum value a \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"u64\"}]}],[\"$\",\"$1\",\"6\",{\"children\":\" can hold. This means their product will be capped, leading to a substantial loss of precision by under-rewarding the user.\"}]]}],[\"$\",\"h3\",\"152\",{\"id\":\"rounding-errors\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#rounding-errors\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Rounding Errors\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"153\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Rounding operations are a common loss of precision in programming. The choice of rounding method can significantly impact the accuracy of calculations and the behavior of Solana programs. The \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"try_round_u64()\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" function rounds decimal values to the nearest whole number. Rounding up is problematic as it can artificially inflate values, leading to discrepancies between the actual and expected calculations.\"}]]}],[\"$\",\"p\",\"154\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a Solana program that converts collateral into liquidity based on market conditions. The program uses \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"try_round_u64()\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" to round the result of a division operation:\"}]]}],[\"$\",\"p\",\"155\",{\"children\":[\"$L4a\"]}],[\"$\",\"p\",\"156\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"In this scenario, rounding up can lead to issuing more liquidity tokens than the collateral amount justifies. Malicious actors can exploit this discrepancy to perform arbitrage attacks to extract value from the protocol via favorably influenced rounding outcomes. To mitigate, use \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"try_floor_u64\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" to round down to the nearest whole number. This approach minimizes the risk of artificially inflating values and ensures that any rounding does not give the user an advantage at the expense of the system. Alternatively, implement logic to handle scenarios where rounding could explicitly impact the outcome. This might include setting specific thresholds for rounding decisions or applying different logic based on the size of the values involved.\"}]]}],[\"$\",\"h2\",\"157\",{\"id\":\"missing-ownership-check\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#missing-ownership-check\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Missing Ownership Check\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"158\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"159\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Ownership checks are crucial to validate that the expected program owns an account involved in a transaction or operation. Accounts include an\"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://docs.rs/crate/solana-program/latest\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"owner\"}]}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\" field, which indicates the program with the authority to write to the account's data. This field ensures that only authorized programs can modify an account's state. Moreover, this field is useful for ensuring that accounts passed into an instruction are owned by the expected program. Missing ownership checks can lead to severe vulnerabilities, including unauthorized fund transfers and the execution of privileged operations.\"}]]}],[\"$\",\"h3\",\"160\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"161\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a program function defined to allow admin-only withdrawals from a vault. The function takes in a configuration account (i.e., \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"config\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\") and uses its \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"admin \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"field to check whether the provided admin account's public key is the same as the one stored in the \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"config \"}]}],[\"$\",\"$1\",\"6\",{\"children\":\"account. However, it fails to verify the \"}],[\"$\",\"strong\",\"7\",{\"children\":[\"$\",\"$1\",\"7\",{\"children\":\"config\"}]}],[\"$\",\"$1\",\"8\",{\"children\":\" account's ownership, assuming it is trustworthy:\"}]]}],[\"$\",\"p\",\"162\",{\"children\":[\"$L4b\"]}],[\"$\",\"p\",\"163\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"A malicious actor could exploit this by supplying a \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"config \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"account they control with a matching \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"admin \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"field, effectively tricking the program into executing the withdrawal.\"}]]}],[\"$\",\"h3\",\"164\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"165\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate this, perform an ownership check that verifies the \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"owner \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"field of the account:\"}]]}],[\"$\",\"p\",\"166\",{\"children\":[\"$L4c\"]}],[\"$\",\"p\",\"167\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Anchor streamlines this check with the \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"Account \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"type. \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"Account\u003c'info, T\u003e\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\" is a wrapper around \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"AccountInfo\"}]}],[\"$\",\"$1\",\"6\",{\"children\":\", which verifies program ownership and deserializes the underlying data into \"}],[\"$\",\"strong\",\"7\",{\"children\":[\"$\",\"$1\",\"7\",{\"children\":\"T\"}]}],[\"$\",\"$1\",\"8\",{\"children\":\" (i.e., the specified account type). This allows developers to use \"}],[\"$\",\"strong\",\"9\",{\"children\":[\"$\",\"$1\",\"9\",{\"children\":\"Account\u003c'info, T\u003e\"}]}],[\"$\",\"$1\",\"10\",{\"children\":\" to validate account ownership easily. Developers can also use the \"}],[\"$\",\"strong\",\"11\",{\"children\":[\"$\",\"$1\",\"11\",{\"children\":\"#[account]\"}]}],[\"$\",\"$1\",\"12\",{\"children\":\" attribute to add the\"}],[\"$\",\"$L1a\",\"13\",{\"className\":\"\",\"href\":\"https://docs.rs/anchor-lang/latest/anchor_lang/trait.Owner.html\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"Owner\"}]}]]]}],[\"$\",\"strong\",\"14\",{\"children\":[\"$\",\"$1\",\"14\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"15\",{\"children\":\"trait to a given account. This trait defines an address expected to own the account. In addition, developers can use the \"}],[\"$\",\"strong\",\"16\",{\"children\":[\"$\",\"$1\",\"16\",{\"children\":\"owner \"}]}],[\"$\",\"$1\",\"17\",{\"children\":\"constraint to define the program that should own a given account if it's different from the currently executing one. This is useful, for example, when writing an instruction that expects an account to be a PDA derived from a different program. The \"}],[\"$\",\"strong\",\"18\",{\"children\":[\"$\",\"$1\",\"18\",{\"children\":\"owner \"}]}],[\"$\",\"$1\",\"19\",{\"children\":\"constraint is defined as \"}],[\"$\",\"strong\",\"20\",{\"children\":[\"$\",\"$1\",\"20\",{\"children\":\"#[account(owner = \u003cexpr\u003e)]\"}]}],[\"$\",\"$1\",\"21\",{\"children\":\", where \"}],[\"$\",\"strong\",\"22\",{\"children\":[\"$\",\"$1\",\"22\",{\"children\":\"\u003cexpr\u003e\"}]}],[\"$\",\"$1\",\"23\",{\"children\":\" is an arbitrary expression.\"}]]}],[\"$\",\"h3\",\"168\",{\"id\":\"read-only-accounts\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#read-only-accounts\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Read-Only Accounts\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"169\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"It's equally important to verify the validity of accounts specified as read-only within a program's execution context. This is crucial because a malicious actor could pass accounts with arbitrary or crafted data instead of legitimate accounts. This could lead to unexpected or harmful program behavior. Developers should still perform checks to ensure that accounts a program needs to read from are genuine and not tampered with. This could involve verifying the account's address against known values or confirming the account's owner is as expected, especially for sysvars (i.e., read-only system accounts, such as \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"Clock \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"or \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"EpochSchedule\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"). Access sysvars using the \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"get()\"}]}],[\"$\",\"$1\",\"6\",{\"children\":\" method, which doesn't require any manual address or ownership checks. This is a safer approach to accessing these accounts; however, not all sysvars support the \"}],[\"$\",\"strong\",\"7\",{\"children\":[\"$\",\"$1\",\"7\",{\"children\":\"get()\"}]}],[\"$\",\"$1\",\"8\",{\"children\":\" method. In this case, access them using their public address.\"}]]}],[\"$\",\"h2\",\"170\",{\"id\":\"missing-signer-check\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#missing-signer-check\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Missing Signer Check\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"171\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"172\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Transactions are signed with a wallet's private key to ensure authentication, integrity, non-repudiation, and the authorization of a specific transaction by a specific wallet. By requiring transactions to be signed with the sender's private key, Solana's runtime can verify that the proper account initiates a transaction and has not been tampered with. This mechanism underpins the trustless nature of decentralized networks. Without this verification, any account that supplies the correct account as an argument can execute a transaction. This could lead to unauthorized access to privileged information, funds, or functionality. This vulnerability arises from failing to validate whether an operation is signed by the appropriate account's private key before executing certain privileged functionality.\"}]]}],[\"$\",\"h3\",\"173\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"174\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Take the following function:\"}]]}],[\"$\",\"p\",\"175\",{\"children\":[\"$L4d\"]}],[\"$\",\"p\",\"176\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"This function intends to update the program's admin. It includes a check to ensure that the current admin initiates the operation, which is good access control. However, the function fails to verify that the current admin's private key signed the transaction. Thus, anyone calling this function can pass the proper \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"admin \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"account such that \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"admin.pubkey() = config.admin\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\", irrespective of whether the account calling this function is actually the current admin. This allows a malicious actor to execute the instruction with their account passed in as the new admin, directly bypassing the need for the current admin's authorization.\"}]]}],[\"$\",\"h3\",\"177\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"178\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Programs must include checks to verify that an account has been signed by the appropriate wallet. This can be done by checking the\"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://docs.rs/solana-program/latest/solana_program/account_info/struct.AccountInfo.html#structfield.is_signer\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"AccountInfo::is_signer\"}]}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\" field of the accounts involved in the transaction. The program can enforce that only authorized accounts can perform certain actions by checking whether the account executing the privileged operation has the \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"is_signer \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"flag set to \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"true\"}]}],[\"$\",\"$1\",\"6\",{\"children\":\".\"}]]}],[\"$\",\"p\",\"179\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"The updated code example would look like this:\"}]]}],[\"$\",\"p\",\"180\",{\"children\":[\"$L4e\"]}],[\"$\",\"p\",\"181\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Anchor streamlines this entire process with the \"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://docs.rs/anchor-lang/latest/anchor_lang/accounts/signer/struct.Signer.html\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Signer\u003c’info\u003e\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\" account type\"}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\".\"}]]}],[\"$\",\"h2\",\"182\",{\"id\":\"overflow-and-underflow\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#overflow-and-underflow\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Overflow and Underflow\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"183\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"184\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"An integer is a number without a fractional component. Rust stores integers as fixed-size variables. These variables are defined by their\"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://en.wikipedia.org/wiki/Signedness\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" signedness\"}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\" (i.e., signed or unsigned) and the amount of space they occupy in memory. For example, the \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"u8\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\" type denotes an unsigned integer that occupies 8 bits of space. It's capable of holding values from 0 to 255. Storing a value outside of that range would result in an integer overflow or underflow. An integer overflow is when a variable exceeds its maximum capacity and wraps around to its minimum value. An integer underflow is when a variable drops below its minimum capacity and wraps around to its maximum value.\"}]]}],[\"$\",\"p\",\"185\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Rust includes checks for integer overflows and underflows when compiling in debug mode. These checks will cause the program to \"}],[\"$\",\"em\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"panic\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" at runtime if such a condition is detected. However, Rust does not include checks that panic for integer overflows and underflows when compiling in release mode with the \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"--release\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\" flag. This behavior can introduce subtle vulnerabilities as the overflow or underflow occurs silently. The\"}],[\"$\",\"$L1a\",\"5\",{\"className\":\"\",\"href\":\"https://en.wikipedia.org/wiki/Signedness\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" Berkley Packet Filter (BPF)\"}]]]}],[\"$\",\"$1\",\"6\",{\"children\":\" toolchain is integral to Solana's development environment as it compiles Solana programs. The \"}],[\"$\",\"strong\",\"7\",{\"children\":[\"$\",\"$1\",\"7\",{\"children\":\"cargo build-bpf\"}]}],[\"$\",\"$1\",\"8\",{\"children\":\" command compiles Rust projects into BPF bytecode for deployment. \"}],[\"$\",\"em\",\"9\",{\"children\":[\"$\",\"$1\",\"9\",{\"children\":\"The issue with this is that it compiles programs in release mode by default\"}]}],[\"$\",\"$1\",\"10\",{\"children\":\". Thus, Solana programs are vulnerable to integer overflows and underflows.\"}]]}],[\"$\",\"h3\",\"186\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"187\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"An attacker can exploit this vulnerability by taking advantage of the silent overflow/underflow behavior in release mode, especially functions that handle token balances. Take the following example:\"}]]}],[\"$\",\"p\",\"188\",{\"children\":[\"$L4f\"]}],[\"$\",\"p\",\"189\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"This function assumes the balance is stored in the first byte for simplicity. It takes the account's balance and subtracts \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"tokens_to_subtract \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"from it. If the user's balance is less than \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"tokens_to_subtract\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\", it'll cause an underflow. For example, a user with 10 tokens would underflow to a total balance of 165 tokens\"}]]}],[\"$\",\"h3\",\"190\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h4\",\"191\",{\"id\":\"overflow-checks\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#overflow-checks\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"overflow-checks\"}]}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"192\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"The easiest way to mitigate this vulnerability is to set the key \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"overflow-checks\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" to \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"true \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"in the project's \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"Cargo.toml\"}]}],[\"$\",\"$1\",\"6\",{\"children\":\" file. Here, Rust will add overflow and underflow checks in the compiler. However, adding overflow and underflow checks increases the\"}],[\"$\",\"$L1a\",\"7\",{\"className\":\"\",\"href\":\"https://solana.com/docs/core/runtime#compute-budget\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" compute cost\"}]]]}],[\"$\",\"$1\",\"8\",{\"children\":\" of a transaction. In cases where compute needs to be optimized for, it may be more beneficial to set \"}],[\"$\",\"strong\",\"9\",{\"children\":[\"$\",\"$1\",\"9\",{\"children\":\"overflow-checks\"}]}],[\"$\",\"$1\",\"10\",{\"children\":\" to \"}],[\"$\",\"strong\",\"11\",{\"children\":[\"$\",\"$1\",\"11\",{\"children\":\"false\"}]}],[\"$\",\"$1\",\"12\",{\"children\":\".\"}]]}],[\"$\",\"h4\",\"193\",{\"id\":\"checked_-\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#checked_-\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"checked_* \"}]}],[\"$\",\"$1\",\"1\",{\"children\":\"Arithmetic\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"194\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Use Rust's \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"checked_*\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" arithmetic functions on each integer type to strategically check for overflows and underflows throughout your program. These functions will return \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"None \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"if an overflow or underflow occurs. This allows the program to handle the error gracefully. For example, you could refactor the previous code to:\"}]]}],[\"$\",\"p\",\"195\",{\"children\":[\"$L50\"]}],[\"$\",\"p\",\"196\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"In the revised example, \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"checked_sub \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"is used to subtract \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"tokens_to_subtract \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"from \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"balance\"}]}],[\"$\",\"$1\",\"6\",{\"children\":\". Thus, if \"}],[\"$\",\"strong\",\"7\",{\"children\":[\"$\",\"$1\",\"7\",{\"children\":\"balance \"}]}],[\"$\",\"$1\",\"8\",{\"children\":\"is sufficient to cover the subtraction, \"}],[\"$\",\"strong\",\"9\",{\"children\":[\"$\",\"$1\",\"9\",{\"children\":\"checked_sub \"}]}],[\"$\",\"$1\",\"10\",{\"children\":\"will return \"}],[\"$\",\"strong\",\"11\",{\"children\":[\"$\",\"$1\",\"11\",{\"children\":\"Some(new_balance)\"}]}],[\"$\",\"$1\",\"12\",{\"children\":\". The program continues to update the account's balance safely and logs it. However, if the subtraction would result in an underflow, \"}],[\"$\",\"strong\",\"13\",{\"children\":[\"$\",\"$1\",\"13\",{\"children\":\"checked_sub \"}]}],[\"$\",\"$1\",\"14\",{\"children\":\"returns \"}],[\"$\",\"strong\",\"15\",{\"children\":[\"$\",\"$1\",\"15\",{\"children\":\"None\"}]}],[\"$\",\"$1\",\"16\",{\"children\":\", which we can handle by returning an error.\"}]]}],[\"$\",\"h4\",\"197\",{\"id\":\"checked-math-macro\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#checked-math-macro\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Checked Math Macro\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"198\",{\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://github.com/blockworks-foundation/checked-math\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"Checked Math\"}]]]}],[\"$\",\"$1\",\"1\",{\"children\":\" is a\"}],[\"$\",\"$L1a\",\"2\",{\"className\":\"\",\"href\":\"https://doc.rust-lang.org/book/ch19-06-macros.html#procedural-macros-for-generating-code-from-attributes\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" procedural macro\"}]]]}],[\"$\",\"$1\",\"3\",{\"children\":\" for changing the properties for checking mathematical expressions without altering those expressions, for the most part. The issue with \"}],[\"$\",\"strong\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\"checked_*\"}]}],[\"$\",\"$1\",\"5\",{\"children\":\" arithmetic functions is the loss of mathematical notation. Instead, cumbersome methods like \"}],[\"$\",\"strong\",\"6\",{\"children\":[\"$\",\"$1\",\"6\",{\"children\":\"a.checked_add(b).unwrap()\"}]}],[\"$\",\"$1\",\"7\",{\"children\":\" must be used instead of \"}],[\"$\",\"strong\",\"8\",{\"children\":[\"$\",\"$1\",\"8\",{\"children\":\"a + b\"}]}],[\"$\",\"$1\",\"9\",{\"children\":\". For example, if we want to write \"}],[\"$\",\"strong\",\"10\",{\"children\":[\"$\",\"$1\",\"10\",{\"children\":\"(x * y) + z\"}]}],[\"$\",\"$1\",\"11\",{\"children\":\" using the checked arithmetic functions, we'd write \"}],[\"$\",\"strong\",\"12\",{\"children\":[\"$\",\"$1\",\"12\",{\"children\":\"x.checked_mul(y).unwrap().checked_add(z).unwrap()\"}]}],[\"$\",\"$1\",\"13\",{\"children\":\".\"}]]}],[\"$\",\"p\",\"199\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Instead, the following expression would look like this using the Checked Math macro:\"}]]}],[\"$\",\"p\",\"200\",{\"children\":[\"$L51\"]}],[\"$\",\"p\",\"201\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"This is more convenient to write, preserves the expression's mathematical notation, and only requires one \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\".unwrap()\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\". This is because the macro converts normal math expressions into an expression that returns \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"None \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"if any of the checked steps return \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"None\"}]}],[\"$\",\"$1\",\"6\",{\"children\":\". \"}],[\"$\",\"strong\",\"7\",{\"children\":[\"$\",\"$1\",\"7\",{\"children\":\"Some(_)\"}]}],[\"$\",\"$1\",\"8\",{\"children\":\" is returned, if successful, which is why we unwrap the expression at the end.\"}]]}],[\"$\",\"h3\",\"202\",{\"id\":\"casting\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#casting\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Casting\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"203\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Similarly, casting between integer types using the \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"as\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" keyword without proper checks can introduce an integer overflow or underflow vulnerability. This is because casting can either truncate or extend values in unintended ways. When casting from a larger integer type to a smaller one (e.g., \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"u64 \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"to \"}],[\"$\",\"strong\",\"5\",{\"children\":[\"$\",\"$1\",\"5\",{\"children\":\"u32\"}]}],[\"$\",\"$1\",\"6\",{\"children\":\"), Rust will truncate the higher bits of the original value that do not fit into the target type. This is problematic when the original value exceeds the maximum value that the target type can store. When casting from a smaller integer type to a larger one (e.g., \"}],[\"$\",\"strong\",\"7\",{\"children\":[\"$\",\"$1\",\"7\",{\"children\":\"i16 \"}]}],[\"$\",\"$1\",\"8\",{\"children\":\"to \"}],[\"$\",\"strong\",\"9\",{\"children\":[\"$\",\"$1\",\"9\",{\"children\":\"i32\"}]}],[\"$\",\"$1\",\"10\",{\"children\":\"), Rust will extend the value. This is straightforward for unsigned types. However, this can lead to\"}],[\"$\",\"$L1a\",\"11\",{\"className\":\"\",\"href\":\"https://en.wikipedia.org/wiki/Sign_extension\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" sign extension\"}]]]}],[\"$\",\"$1\",\"12\",{\"children\":\" with signed integers to introduce unintended negative values.\"}]]}],[\"$\",\"h4\",\"204\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"205\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Use Rust's safe casting methods to mitigate this vulnerability. This includes methods such as\"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://doc.rust-lang.org/std/convert/trait.TryFrom.html#tymethod.try_from\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\" try_from\"}]}]]]}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\" \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"and\"}],[\"$\",\"$L1a\",\"4\",{\"className\":\"\",\"href\":\"https://doc.rust-lang.org/std/convert/trait.From.html#tymethod.from\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"from\"}]}]]]}],[\"$\",\"$1\",\"5\",{\"children\":\". Using \"}],[\"$\",\"strong\",\"6\",{\"children\":[\"$\",\"$1\",\"6\",{\"children\":\"try_from \"}]}],[\"$\",\"$1\",\"7\",{\"children\":\"returns a \"}],[\"$\",\"strong\",\"8\",{\"children\":[\"$\",\"$1\",\"8\",{\"children\":\"Result \"}]}],[\"$\",\"$1\",\"9\",{\"children\":\"type, allowing for the explicit handling of cases where the value does not fit into the target type gracefully. Using Rust's \"}],[\"$\",\"strong\",\"10\",{\"children\":[\"$\",\"$1\",\"10\",{\"children\":\"from \"}]}],[\"$\",\"$1\",\"11\",{\"children\":\"method can be used for a safe, implicit conversion for conversions that are guaranteed to be lossless (e.g., \"}],[\"$\",\"strong\",\"12\",{\"children\":[\"$\",\"$1\",\"12\",{\"children\":\"u8 \"}]}],[\"$\",\"$1\",\"13\",{\"children\":\"to \"}],[\"$\",\"strong\",\"14\",{\"children\":[\"$\",\"$1\",\"14\",{\"children\":\"u32\"}]}],[\"$\",\"$1\",\"15\",{\"children\":\"). For example, suppose a program needs to safely convert a \"}],[\"$\",\"strong\",\"16\",{\"children\":[\"$\",\"$1\",\"16\",{\"children\":\"u64 \"}]}],[\"$\",\"$1\",\"17\",{\"children\":\"token amount to a \"}],[\"$\",\"strong\",\"18\",{\"children\":[\"$\",\"$1\",\"18\",{\"children\":\"u32 \"}]}],[\"$\",\"$1\",\"19\",{\"children\":\"type for processing. In that case, it can do the following:\"}]]}],[\"$\",\"p\",\"206\",{\"children\":[\"$L52\"]}],[\"$\",\"p\",\"207\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"In this example, if \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"amount \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"exceeds the maximum value a \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"u32 \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"can hold (i.e., 4 294 967 295), the conversion fails, and the program returns an error. This prevents a potential overflow/underflow from occurring.\"}]]}],[\"$\",\"h2\",\"208\",{\"id\":\"pda-sharing\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#pda-sharing\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"PDA Sharing\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"209\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"210\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"PDA sharing is a common vulnerability that arises when the same PDA is used across multiple authority domains or roles. This could allow a malicious actor to access data or funds that do not belong to them via the misuse of PDAs as a signer without the proper access control checks in place.\"}]]}],[\"$\",\"h3\",\"211\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"212\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a program designed to facilitate token staking and distributing rewards. The program uses a single PDA to transfer tokens into a given pool and withdraw rewards. The PDA is derived using a static seed (e.g., the name of the staking pool), making it common across all operations:\"}]]}],[\"$\",\"p\",\"213\",{\"children\":[\"$L53\"]}],[\"$\",\"p\",\"214\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"This is problematic as the staking and rewards withdrawal functionalities rely on the same PDA derived from \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"staking_pool_pda\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\". This could allow users to manipulate the contract into unauthorized reward withdrawal or staking manipulation.\"}]]}],[\"$\",\"h3\",\"215\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"216\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate against this vulnerability, use distinct PDAs for different functionalities. Ensure that each PDA serves a specific context and is derived using unique, operation-specific seeds:\"}]]}],[\"$\",\"p\",\"217\",{\"children\":[\"$L54\"]}],[\"$\",\"p\",\"218\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"In the example above, the PDAs for staking tokens and withdrawing rewards are derived using distinct seeds (\"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"staking_pool\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" and \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"rewards_pool\"}]}],[\"$\",\"$1\",\"4\",{\"children\":\", respectively) combined with the specific account's key. This ensures that the PDAs are uniquely tied to their intended functionalities, mitigating the risk of unauthorized actions.\"}]]}],[\"$\",\"h2\",\"219\",{\"id\":\"remaining-accounts\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#remaining-accounts\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Remaining Accounts\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"220\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"221\",{\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"ctx.remaining_accounts \"}]}],[\"$\",\"$1\",\"1\",{\"children\":\"provides a way to pass additional accounts into a function that weren’t specified in the \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"Accounts \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"struct initially. This gives more flexibility to the developer, allowing them to handle scenarios requiring a dynamic number of accounts (i.e., processing a variable number of users or interacting with different programs. However, this increased flexibility comes with a caveat: accounts passed through \"}],[\"$\",\"strong\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\"ctx.remaining_accounts \"}]}],[\"$\",\"$1\",\"5\",{\"children\":\"do not undergo the same validation applied to accounts defined in the \"}],[\"$\",\"strong\",\"6\",{\"children\":[\"$\",\"$1\",\"6\",{\"children\":\"Accounts \"}]}],[\"$\",\"$1\",\"7\",{\"children\":\"struct. Because \"}],[\"$\",\"strong\",\"8\",{\"children\":[\"$\",\"$1\",\"8\",{\"children\":\"ctx.remaining_accounts \"}]}],[\"$\",\"$1\",\"9\",{\"children\":\"does not validate the accounts passed in, a malicious actor could exploit this by passing in accounts the program did not intend to interact with, leading to unauthorized actions or access.\"}]]}],[\"$\",\"h3\",\"222\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"223\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a rewards program that uses \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"ctx.remaining_accounts \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"to receive user PDAs and calculate rewards dynamically:\"}]]}],[\"$\",\"p\",\"224\",{\"children\":[\"$L55\"]}],[\"$\",\"p\",\"225\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"The issue here is that there aren’t any explicit checks to validate the accounts passed in via \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"ctx.remaining_accounts\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\", meaning it fails to ensure that only valid and eligible users’ accounts are processed in the rewards calculation and distribution. A malicious actor could, therefore, pass in accounts they do not own, or ones created by themselves, to receive more rewards than they are actually owed.\"}]]}],[\"$\",\"h3\",\"226\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"227\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate this vulnerability, developers should manually verify each account’s validity within the function. This would include checking the account’s owner to ensure it matches an expected user’s and validate any relevant data within the account. By incorporating these manual checks, developers can leverage the flexibility of \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"ctx.remaining_acocunts \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"while mitigating the risk of unauthorized access or manipulation.\"}]]}],[\"$\",\"h2\",\"228\",{\"id\":\"rust-specific-errors\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#rust-specific-errors\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Rust-Specific Errors\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"229\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Rust is the \"}],[\"$\",\"em\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"lingua franca\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" of program development on Solana. Developing in Rust brings forth a unique set of challenges and considerations, particularly around unsafe code and Rust-specific errors. Understanding Rust's caveats aids in developing secure, efficient, and reliable programs.\"}]]}],[\"$\",\"h3\",\"230\",{\"id\":\"unsafe-rust\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#unsafe-rust\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Unsafe Rust\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"231\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Rust is celebrated for its memory safety guarantees, achieved through a strict ownership and borrowing system. However, these guarantees can sometimes hinder, so Rust offers the\"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"unsafe\"}]}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\" keyword to bypass Safety checks. \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"unsafe \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"Rust is used in four primary contexts:\"}]]}],[\"$\",\"ul\",\"232\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Unsafe Functions\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": functions that perform operations that may violate Rust's safety guarantees must be marked with the \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"unsafe \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"keyword. For example, \"}],[\"$\",\"strong\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\"unsafe fn dangerous_function() {}\"}]}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Unsafe Blocks\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": blocks of code where unsafe operations are permitted. For example, \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"unsafe { // Unsafe operations }\"}]}]]}],[\"$\",\"li\",\"2\",{\"value\":3,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Unsafe Traits\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": traits that imply certain invariants that the compiler can't verify. For example, \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"unsafe trait BadTrait {}\"}]}]]}],[\"$\",\"li\",\"3\",{\"value\":4,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Implementing Unsafe Traits\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": implementations of \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"unsafe \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"traits must also be marked as \"}],[\"$\",\"strong\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\"unsafe\"}]}],[\"$\",\"$1\",\"5\",{\"children\":\". For example, \"}],[\"$\",\"strong\",\"6\",{\"children\":[\"$\",\"$1\",\"6\",{\"children\":\"unsafe impl UnsafeTrait for UnsafeType {}\"}]}]]}]]}],[\"$\",\"p\",\"233\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Unsafe Rust exists because static analysis is conservative. When the compiler tries to determine if the code upholds a certain set of guarantees, it's better to reject a few instances of valid code than to accept a few instances of invalid code. Although the code might run perfectly fine, the Rust compiler will reject the code if it doesn’t have enough information to be confident in whether it upholds Rust's safety guarantees. Unsafe code allows developers to bypass these checks at their own risk. Moreover, computer hardware is inherently unsafe. Developers must be allowed to do unsafe operations to do low-level programming with Rust.\"}]]}],[\"$\",\"p\",\"234\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"With the \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"unsafe \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"keyword, developers can:\"}]]}],[\"$\",\"ul\",\"235\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Dereference Raw Pointers\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": enables direct memory access to raw pointers that can point to any memory location, which might not hold valid data\"}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Call Unsafe Functions\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": these functions may not adhere to Rust's safety guarantees, and can lead to potentially undefined behavior\"}]]}],[\"$\",\"li\",\"2\",{\"value\":3,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Access Mutable Static Variables\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": global mutable state can cause data races\"}]]}]]}],[\"$\",\"p\",\"236\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"The best way to mitigate unsafe Rust is to minimize the use of \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"unsafe \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"blocks. If \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"unsafe \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"code is absolutely necessary, for whatever reason, ensure that it is well-documented, regularly audited, and, if possible, is encapsulated in a safe abstraction that can be provided to the rest of the program.\"}]]}],[\"$\",\"h3\",\"237\",{\"id\":\"panics-and-error-management\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#panics-and-error-management\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Panics and Error Management\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"238\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"A panic occurs when a Rust program encounters an unrecoverable error and terminates execution. Panics are used for unexpected errors that are not meant to be caught. In the context of Solana programs, a panic can lead to unexpected behavior as the runtime expects programs to handle errors gracefully without crashing.\"}]]}],[\"$\",\"p\",\"239\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"When a panic occurs, Rust starts unwinding the stack and cleaning it up as it goes. This returns a stack trace, which includes detailed information on the error involved. This could supply an attacker with information about the underlying file structure. While this doesn't apply to Solana programs directly, the dependencies a program uses could be vulnerable to such an attack. Ensure dependencies are kept up-to-date and use versions that do not contain known vulnerabilities.\"}]]}],[\"$\",\"p\",\"240\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Common panic scenarios include:\"}]]}],[\"$\",\"ul\",\"241\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Division by Zero\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": Rust will panic when attempting to divide by zero. Thus, always check for a zero divisor before performing a division\"}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Array Index Out of Bounds\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": accessing an array with an index that exceeds its bounds will cause a panic. To mitigate, use methods that return an \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\"Option \"}]}],[\"$\",\"$1\",\"3\",{\"children\":\"type (like \"}],[\"$\",\"strong\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\"get\"}]}],[\"$\",\"$1\",\"5\",{\"children\":\") to safely access array elements\"}]]}],[\"$\",\"li\",\"2\",{\"value\":3,\"children\":[[\"$\",\"strong\",\"0\",{\"children\":[\"$\",\"$1\",\"0\",{\"children\":\"Unwrapping None Values\"}]}],[\"$\",\"$1\",\"1\",{\"children\":\": calling \"}],[\"$\",\"strong\",\"2\",{\"children\":[\"$\",\"$1\",\"2\",{\"children\":\".unwrap()\"}]}],[\"$\",\"$1\",\"3\",{\"children\":\" on an \"}],[\"$\",\"strong\",\"4\",{\"children\":[\"$\",\"$1\",\"4\",{\"children\":\"Option \"}]}],[\"$\",\"$1\",\"5\",{\"children\":\"that holds a \"}],[\"$\",\"strong\",\"6\",{\"children\":[\"$\",\"$1\",\"6\",{\"children\":\"None \"}]}],[\"$\",\"$1\",\"7\",{\"children\":\"value will cause a panic. Always use pattern matching or methods like \"}],[\"$\",\"strong\",\"8\",{\"children\":[\"$\",\"$1\",\"8\",{\"children\":\"unwrap_or\"}]}],[\"$\",\"$1\",\"9\",{\"children\":\", \"}],[\"$\",\"strong\",\"10\",{\"children\":[\"$\",\"$1\",\"10\",{\"children\":\"unwrap_or_else\"}]}],[\"$\",\"$1\",\"11\",{\"children\":\", or the \"}],[\"$\",\"strong\",\"12\",{\"children\":[\"$\",\"$1\",\"12\",{\"children\":\"? \"}]}],[\"$\",\"$1\",\"13\",{\"children\":\"operator in functions that return a \"}],[\"$\",\"strong\",\"14\",{\"children\":[\"$\",\"$1\",\"14\",{\"children\":\"Result\"}]}]]}]]}],[\"$\",\"p\",\"242\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate issues associated with panics, it's essential to avoid operations that cause panics, validate all inputs and conditions that could give rise to problematic operations, and use the \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"Result \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"and \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"Option \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"types for error handling. Additionally, writing comprehensive program tests will help uncover and address potential panic scenarios before deployment.\"}]]}],[\"$\",\"h2\",\"243\",{\"id\":\"seed-collisions\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#seed-collisions\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Seed Collisions\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"244\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"245\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Seed collisions occur when different inputs (i.e., seeds and program IDs) used to generate a PDA result in the same PDA address. This is problematic when PDAs are used within a program for different purposes, as it can lead to unexpected behavior, including denial of service attacks or complete compromise.\"}]]}],[\"$\",\"h3\",\"246\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"247\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a program for a decentralized voting platform for various proposals and initiatives. Each voting session for a given proposal or initiative is created with a unique identifier, and users submit votes. The program uses PDAs for both voting sessions and individual votes:\"}]]}],[\"$\",\"p\",\"248\",{\"children\":[\"$L56\"]}],[\"$\",\"p\",\"249\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"In this scenario, an attacker would try to carefully craft a voting session that, when combined with the static seed \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"\\\"session\\\"\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\", would result in a PDA that coincidentally matches the PDA generated for a different voting session. Deliberately creating a PDA that clashes with another voting session's PDA could disrupt the platform's operations by, for example, preventing legitimate votes for proposals or denying new initiatives from being added to the platform since Solana's runtime cannot distinguish between the colliding PDAs.\"}]]}],[\"$\",\"h3\",\"250\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"251\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate the risk of seed collisions, developers can:\"}]]}],[\"$\",\"ul\",\"252\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Use unique prefixes for seeds across different PDAs in the same program. This approach will help ensure that PDAs remain distinct\"}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Use unique identifiers (e.g., timestamps, user IDs, nonce values) to guarantee that a unique PDA is generated every time\"}]]}],[\"$\",\"li\",\"2\",{\"value\":3,\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Programmatically validate a generated PDA does not collide with existing PDAs\"}]]}]]}],[\"$\",\"h2\",\"253\",{\"id\":\"type-cosplay\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#type-cosplay\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Type Cosplay\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"h3\",\"254\",{\"id\":\"the-vulnerability\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#the-vulnerability\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"The Vulnerability\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"255\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Type cosplay is a vulnerability where one account type is misrepresented as another due to a lack of type checks during deserialization. This can lead to the execution of unauthorized actions or data corruption, as the program would operate based on the incorrect assumption of the account's role or permissions. Always check the account's intended type during deserialization explicitly.\"}]]}],[\"$\",\"h3\",\"256\",{\"id\":\"example-scenario\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#example-scenario\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Example Scenario\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"257\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Consider a program that manages access to admin operations based on a user's role. Each user account includes a role discriminator to distinguish between regular users and administrators. The program contains a function to update admin settings intended only for administrators. However, the program fails to check the account's discriminator and deserializes user account data without confirming whether the account is an administrator:\"}]]}],[\"$\",\"p\",\"258\",{\"children\":[\"$L57\"]}],[\"$\",\"p\",\"259\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"The issue is that \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"update_admin_settings \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"deserializes the user account passed in without checking the account's role discriminator, partly because the \"}],[\"$\",\"strong\",\"3\",{\"children\":[\"$\",\"$1\",\"3\",{\"children\":\"User \"}]}],[\"$\",\"$1\",\"4\",{\"children\":\"struct is missing a discriminator field!\"}]]}],[\"$\",\"h3\",\"260\",{\"id\":\"recommended-mitigation\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#recommended-mitigation\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Recommended Mitigation\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"261\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"To mitigate against this issue, developers can introduce a discriminator field in the \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"User \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"struct and verify it during the deserialization process:\"}]]}],[\"$\",\"p\",\"262\",{\"children\":[\"$L58\"]}],[\"$\",\"p\",\"263\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"Anchor simplifies the mitigation of type cosplay vulnerabilities by automatically managing discriminators for account times. This is done via the \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"Account\u003c'info, T\u003e\"}]}],[\"$\",\"$1\",\"2\",{\"children\":\" wrapper, where Anchor ensures type safety by automatically checking the discriminator during deserialization. This allows developers to focus more on their program's business logic rather than manually implementing various type checks.\"}]]}],[\"$\",\"h2\",\"264\",{\"id\":\"conclusion\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#conclusion\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Conclusion\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"p\",\"265\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"The importance of program security cannot be overstated. This article has traversed the spectrum of common vulnerabilities, from Rust-specific errors to the complexities of Anchor’s \"}],[\"$\",\"strong\",\"1\",{\"children\":[\"$\",\"$1\",\"1\",{\"children\":\"realloc \"}]}],[\"$\",\"$1\",\"2\",{\"children\":\"method. The path to mastering each of these vulnerabilities, and program security in general, is ongoing and demands continuous learning, adaptation, and collaboration. As developers, our commitment to security is not just about safeguarding assets; it’s about fostering trust, ensuring the integrity of our applications, and contributing to Solana’s growth and stability.\"}]]}],[\"$\",\"p\",\"266\",{\"children\":[[\"$\",\"$1\",\"0\",{\"children\":\"If you’ve read this far, thank you anon! Be sure to enter your email address below so you’ll never miss an update about what’s new on Solana. Ready to dive deeper? Explore the latest articles on the\"}],[\"$\",\"$L1a\",\"1\",{\"className\":\"\",\"href\":\"https://www.helius.dev/blog\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\" Helius blog\"}]]]}],[\"$\",\"$1\",\"2\",{\"children\":\" and continue your Solana journey, today.\"}]]}],[\"$\",\"h2\",\"267\",{\"id\":\"additional-resources\",\"children\":[\"$\",\"$L1a\",null,{\"href\":\"#additional-resources\",\"scroll\":true,\"className\":\"not-prose flex items-center group\",\"children\":[[[\"$\",\"$1\",\"0\",{\"children\":\"Additional Resources\"}]],[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":\"1.5\",\"shapeRendering\":\"geometricPrecision\",\"viewBox\":\"0 0 24 24\",\"height\":24,\"width\":24,\"fill\":\"none\",\"className\":\"ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71\"}],[\"$\",\"path\",null,{\"d\":\"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71\"}]]}]]}]}],[\"$\",\"ul\",\"268\",{\"className\":\"list max-w-[42rem]\",\"children\":[[\"$\",\"li\",\"0\",{\"value\":1,\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"How to Become a Smart Contract Auditor\"}]]]}]]}],[\"$\",\"li\",\"1\",{\"value\":2,\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://immunefi.com/explore/?filter=ecosystem%3DSolana\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"Immunefi\"}]]]}]]}],[\"$\",\"li\",\"2\",{\"value\":3,\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://cmichel.io/how-to-become-a-smart-contract-auditor/\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"Neodyme’s Solana Security Workshop\"}]]]}]]}],[\"$\",\"li\",\"3\",{\"value\":4,\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://github.com/coral-xyz/sealevel-attacks\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"Sealevel Attacks\"}]]]}]]}],[\"$\",\"li\",\"4\",{\"value\":5,\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://osec.io/blog/2022-03-14-solana-security-intro\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"Solana: An Auditor’s Introduction\"}]]]}]]}],[\"$\",\"li\",\"5\",{\"value\":6,\"children\":[[\"$\",\"$L1a\",\"0\",{\"className\":\"\",\"href\":\"https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html\",\"rel\":\"noopener noreferrer\",\"target\":\"_blank\",\"children\":[\"$undefined\",[[\"$\",\"$1\",\"0\",{\"children\":\"Unsafe Rust\"}]]]}]]}]]}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"hidden xl:block col-span-1\",\"children\":[\"$\",\"nav\",null,{\"data-toc\":true,\"className\":\"hidden lg:block sticky top-28 w-full transition-all duration-300 opacity-30 hover:opacity-100 px-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-2 hidden xl:block\",\"children\":\"Table of Contents\"}],[\"$\",\"$L59\",null,{\"className\":\"h-[360px] w-56 rounded-md border p-4\",\"children\":[\"$\",\"$L26\",null,{\"content\":\"$5:props:children:5:props:children:0:props:children:4:props:children:props:children:props:children:1:props:children:props:content\"}]}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"container mb-12 lg:grid lg:grid-cols-subgrid col-start-1 col-span-3 grid-rows-[2fr]\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-afdsm md:text-afdmd lg:text-afdxl font-bold mb-8\",\"children\":\"Related Articles\"}],\"$undefined\",[\"$\",\"$L59\",null,{\"className\":\"$undefined\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex lg:grid lg:grid-cols-3 lg:items-stretch gap-4 px-4 md:px-8 lg:px-0\",\"children\":[[\"$\",\"$L5a\",\"0\",{\"doc\":{\"id\":95,\"title\":\"An Introduction to Anchor: A Beginner’s Guide to Building Solana Programs\",\"slug\":\"an-introduction-to-anchor-a-beginners-guide-to-building-solana-programs\",\"meta\":{\"title\":\"A Beginner’s Guide to Building Solana Programs with Anchor\",\"image\":{\"id\":132,\"alt\":\"Intro to Anchor\",\"caption\":null,\"prefix\":\"production\",\"updatedAt\":\"2024-12-21T08:34:02.105Z\",\"createdAt\":\"2024-12-21T08:34:02.105Z\",\"url\":\"/api/media/file/intro-to-anchor.webp\",\"thumbnailURL\":\"/_next/image?url=/api/media/file/intro-to-anchor.webp\u0026w=384\u0026q=80\",\"filename\":\"intro-to-anchor.webp\",\"mimeType\":\"image/webp\",\"filesize\":872568,\"width\":3840,\"height\":2160,\"focalX\":50,\"focalY\":50},\"description\":\"Learn everything you need to know to get started building on Solana with Anchor\"}},\"relationTo\":\"blog\",\"showCategories\":true,\"className\":\"w-[90vw] sm:w-[40vw] lg:w-auto\"}],[\"$\",\"$L5a\",\"1\",{\"doc\":{\"id\":38,\"title\":\"The Solana Programming Model: An Introduction to Developing on Solana\",\"slug\":\"the-solana-programming-model-an-introduction-to-developing-on-solana\",\"meta\":{\"title\":\"The Solana Programming Model: An Introduction to Developing on Solana\",\"image\":{\"id\":298,\"alt\":\"The Solana Programming Model\",\"caption\":null,\"prefix\":\"production\",\"updatedAt\":\"2025-01-29T14:12:50.247Z\",\"createdAt\":\"2025-01-05T05:45:14.993Z\",\"url\":\"/api/media/file/the-solana-programming-model-an-introduction-to-developing-on-solana-1.webp\",\"thumbnailURL\":\"/_next/image?url=/api/media/file/the-solana-programming-model-an-introduction-to-developing-on-solana-1.webp\u0026w=384\u0026q=80\",\"filename\":\"the-solana-programming-model-an-introduction-to-developing-on-solana-1.webp\",\"mimeType\":\"image/webp\",\"filesize\":772708,\"width\":3840,\"height\":2160,\"focalX\":50,\"focalY\":50},\"description\":\"Learn about the complexities of Solana's architecture, the role of accounts, and how transactions facilitate on-chain interactions.\"}},\"relationTo\":\"blog\",\"showCategories\":true,\"className\":\"w-[90vw] sm:w-[40vw] lg:w-auto\"}],[\"$\",\"$L5a\",\"2\",{\"doc\":{\"id\":86,\"title\":\"Poseidon: Build Solana Programs with TypeScript\",\"slug\":\"build-solana-programs-with-typescript-poseidon\",\"meta\":{\"title\":\"Poseidon: Build Solana Programs with TypeScript\",\"image\":{\"id\":166,\"alt\":\"Build Solana Programs with TypeScript Poseidon\",\"caption\":null,\"prefix\":\"production\",\"updatedAt\":\"2025-01-01T14:45:57.915Z\",\"createdAt\":\"2025-01-01T14:45:57.915Z\",\"url\":\"/api/media/file/build-solana-programs-with-typescript-poseidon.webp\",\"thumbnailURL\":\"/_next/image?url=/api/media/file/build-solana-programs-with-typescript-poseidon.webp\u0026w=384\u0026q=80\",\"filename\":\"build-solana-programs-with-typescript-poseidon.webp\",\"mimeType\":\"image/webp\",\"filesize\":835308,\"width\":3840,\"height\":2160,\"focalX\":50,\"focalY\":50},\"description\":\"Poseidon is a new transpiler framework that empowers web developers to create Solana on-chain programs with TypeScript.\"}},\"relationTo\":\"blog\",\"showCategories\":true,\"className\":\"w-[90vw] sm:w-[40vw] lg:w-auto\"}]]}],[\"$\",\"$L5b\",null,{\"orientation\":\"horizontal\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"container mb-16\",\"children\":[\"$\",\"$L5c\",null,{}]}]]}]\n"])</script><script>self.__next_f.push([1,"5d:I[86218,[\"2184\",\"static/chunks/2184-3bc227e94bfd9be6.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"783\",\"static/chunks/783-c0e59f51eadafb23.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"8905\",\"static/chunks/8905-ce2dd6d13f95f765.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"891\",\"static/chunks/891-49fb82ec1daa7f0e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"263\",\"static/chunks/263-ee4ebd6fa173865d.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2392\",\"static/chunks/2392-d93359bae926213e.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"2278\",\"static/chunks/2278-5eb2f97fc75ea073.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"5757\",\"static/chunks/5757-30f6c1d000351fd3.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\",\"1639\",\"static/chunks/app/(frontend)/blog/%5Bslug%5D/page-f5714e7457a43fde.js?dpl=dpl_HJgtearsg8TACAnPZSMHfVFQVvNK\"],\"CopyToClipboard\"]\n1d:null\n5e:T1292,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e update_admin_settings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eUpdateAdminSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, new_settings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AdminSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003econfig_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003esettings \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e new_settings;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e  Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e UpdateAdminSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e  pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e config_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eConfigData\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e  pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ConfigData\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  settings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AdminSettings\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"32:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn update_admin_settings(ctx: Context\u003cUpdateAdminSettings\u003e, new_settings: AdminSettings) -\u003e Result\u003c()\u003e {\\n  ctx.accounts.config_data.settings = new_settings;\\n  \\n  Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct UpdateAdminSettings\u003c'info\u003e {\\n  #[account(mut)]\\n  pub config_data: Account\u003c'info, ConfigData\u003e,\\n  pub admin: Signer\u003c'info\u003e,\\n}\\n\\n#[account]\\npub struct ConfigData {\\n  admin: Pubkey,\\n  settings: AdminSettings\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$5e\"}}]}]]}]\n5f:Td9f,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e update_admin_settings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eUpdateAdminSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, new_settings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AdminSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e  if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003econfig_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eUnauthorized\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  }  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003econfig_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003esettings \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e new_settings;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e  Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"33:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn update_admin_settings(ctx: Context\u003cUpdateAdminSettings\u003e, new_settings: AdminSettings) -\u003e Result\u003c()\u003e {\\n  if ctx.accounts.admin.key() != ctx.accounts.config_data.admin {\\n    return Err(ProgramError::Unauthorized);\\n  }  \\n\\n  ctx.accounts.config_data.settings = new_settings;\\n  \\n  Ok(())\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$5f\"}}]}]]}]\n60:T9a1,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e UpdateAdminSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    constraint \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e config_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e==\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ekey()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e  pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e config_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eConfigData\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e  pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"34:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub struct UpdateAdminSettings\u003c'info\u003e {\\n  #[account(\\n    mut,\\n    constraint = config_data.admin == admin.key()\\n  )]\\n  pub config_data: Account\u003c'info, ConfigData\u003e,\\n  pub admin: Signer\u003c'info\u003e,\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$60\"}}]}]]}]\n61:T571,\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e realloc\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eself,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--sh"])</script><script>self.__next_f.push([1,"iki-foreground)\"\u003e    new_len\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e usize\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    zero_init\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e bool\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;(), \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e35:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn realloc(\\n    \u0026self,\\n    new_len: usize,\\n    zero_init: bool\\n) -\u003e Result\u003c(), ProgramError\u003e\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto te"])</script><script>self.__next_f.push([1,"xt-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$61\"}}]}]]}]\n62:T1ad8,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e modify_todo_list\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eModifyTodoList\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, modifications\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Vec\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eTodoModification\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Logic to process modifications\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    for\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e modification \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003ein\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e modifications {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        match\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e modification {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e            TodoModification\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAdd\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(entry) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e                // Add logic\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e            },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e            TodoModification\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eRemove\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(index) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e                // Remove logic, potentially requiring data reallocation\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e            },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e            TodoModification\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eEdit\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(index, new_entry) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e                // Edit logic\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e            },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Reallocation logic to adjust the data size based on modifications\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e required_data_len \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e calculate_required_data_len\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003emodifications);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003etodo_list_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003erealloc\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(required_data_len, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003efalse\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ModifyTodoList\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    todo_list_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Other relevant accounts\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"36:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn modify_todo_list(ctx: Context\u003cModifyTodoList\u003e, modifications: Vec\u003cTodoModification\u003e) -\u003e ProgramResult {\\n    // Logic to process modifications\\n    for modification in modifications {\\n        match modification {\\n            TodoModification::Add(entry) =\u003e {\\n                // Add logic\\n            },\\n            TodoModification::Remove(index) =\u003e {\\n                // Remove logic, potentially requiring data reallocation\\n            },\\n            TodoModification::Edit(index, new_entry) =\u003e {\\n                // Edit logic\\n            },\\n        }\\n    }\\n\\n    // Reallocation logic to adjust the data size based on modifications\\n    let required_data_len = calculate_required_data_len(\u0026modifications);\\n    ctx.accounts.todo_list_data.realloc(required_data_len, false)?;\\n\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct ModifyTodoList\u003c'info\u003e {\\n    #[account(mut)]\\n    todo_list_data: AccountInfo\u003c'info\u003e,\\n    // Other relevant accounts\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$62\"}}]}]]}]\n"])</script><script>self.__next_f.push([1,"63:T511,pub fn update_rewards(ctx: Context\u003cUpdateStakingRewards\u003e, amount: u64) -\u003e Result\u003c()\u003e {\n    let staking_seeds = \u0026[b\"stake\", ctx.accounts.staker.key().as_ref(), \u0026[ctx.accounts.staking_account.bump]];\n\n    let cpi_accounts = UpdateRewards {\n        staking_account: ctx.accounts.staking_account.to_account_info(),\n    };\n    let cpi_program = ctx.accounts.rewards_distribution_program.to_account_info();\n    let cpi_ctx = CpiContext::new_with_signer(cpi_program, cpi_accounts, staking_seeds);\n\n    rewards_distribution::cpi::update_rewards(cpi_ctx, amount)?;\n\n    // Attempt to log the \"updated\" reward balance\n    msg!(\"Rewards: {}\", ctx.accounts.staking_account.rewards);\n    \n    // Logic that uses the stale ctx.accounts.staking_account.rewards\n\n    Ok(())\n}\n\n#[derive(Accounts)]\npub struct UpdateStakingRewards\u003c'info\u003e {\n    #[account(mut)]\n    pub staker: Signer\u003c'info\u003e,\n    #[account(\n        mut,\n        seeds = [b\"stake\", staker.key().as_ref()],\n        bump,\n    )]\n    pub staking_account: Account\u003c'info, StakingAccount\u003e,\n    pub rewards_distribution_program: Program\u003c'info, RewardsDistribution\u003e,\n}\n\n#[account]\npub struct StakingAccount {\n    pub staker: Pubkey,\n    pub stake_amount: u64,\n    pub rewards: u64,\n    pub bump: u8,\n}64:T2e29,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e update_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eUpdateStakingRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e staking_seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"stake\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estaker\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eas_ref\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(), \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estaking_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebump]];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e cpi_accounts \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e UpdateRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        staking_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estaking_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e cpi_program \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003erewards_distribution_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e cpi_ctx \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e CpiContext\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003enew_with_signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(cpi_program, cpi_accounts, staking_seeds);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    rewards_distribution\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ecpi\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eupdate_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(cpi_ctx, amount)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Attempt to log the \"updated\" reward balance\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    msg!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003e\"Rewards: {}\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estaking_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003erewards);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Logic that uses the stale ctx.accounts.staking_account.rewards\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e UpdateStakingRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e staker\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"stake\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, staker\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ekey()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eas_ref()],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        bump,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e staking_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eStakingAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e rewards_distribution_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eRewardsDistribution\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e StakingAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e staker\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e stake_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e bump\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"37:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"$63\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$64\"}}]}]]}]\n65:T1ccb,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e update_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eUpdateStakingRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e staking_seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"stake\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estaker\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eas_ref\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(), \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estaking_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebump]];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e cpi_accounts \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e UpdateRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        staking_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estaking_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    };\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e cpi_program \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003erewards_distribution_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e cpi_ctx \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e CpiContext\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003enew_with_signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(cpi_program, cpi_accounts, staking_seeds);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    rewards_distribution\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ecpi\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eupdate_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(cpi_ctx, amount)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Reload the staking account to reflect the updated reward balance\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estaking_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ereload\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Log the updated reward balance\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    msg!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003e\"Rewards: {}\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estaking_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003erewards);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Logic that uses ctx.accounts.staking_account.rewards\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"38:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn update_rewards(ctx: Context\u003cUpdateStakingRewards\u003e, amount: u64) -\u003e Result\u003c()\u003e {\\n    let staking_seeds = \u0026[b\\\"stake\\\", ctx.accounts.staker.key().as_ref(), \u0026[ctx.accounts.staking_account.bump]];\\n\\n    let cpi_accounts = UpdateRewards {\\n        staking_account: ctx.accounts.staking_account.to_account_info(),\\n    };\\n    let cpi_program = ctx.accounts.rewards_distribution_program.to_account_info();\\n    let cpi_ctx = CpiContext::new_with_signer(cpi_program, cpi_accounts, staking_seeds);\\n\\n    rewards_distribution::cpi::update_rewards(cpi_ctx, amount)?;\\n\\n    // Reload the staking account to reflect the updated reward balance\\n    ctx.accounts.staking_account.reload()?;\\n\\n    // Log the updated reward balance\\n    msg!(\\\"Rewards: {}\\\", ctx.accounts.staking_account.rewards);\\n    \\n    // Logic that uses ctx.accounts.staking_account.rewards\\n\\n    Ok(())\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$65\"}}]}]]}]\n"])</script><script>self.__next_f.push([1,"66:T1926,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e distribute_and_record_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eDistributeAndRecord\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, reward_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Reward distribution logic\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e instruction \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e custom_ledger_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003einstruction\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003erecord_transaction\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eledger_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ereward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        reward_amount,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    invoke\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003einstruction,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e            ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ereward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eclone\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e            ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eledger_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eclone\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        ],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e DistributeAndRecord\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    reward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    ledger_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"39:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn distribute_and_record_rewards(ctx: Context\u003cDistributeAndRecord\u003e, reward_amount: u64) -\u003e ProgramResult {\\n    // Reward distribution logic\\n\\n    let instruction = custom_ledger_program::instruction::record_transaction(\\n        \u0026ctx.accounts.ledger_program.key(),\\n        \u0026ctx.accounts.reward_account.key(),\\n        reward_amount,\\n    )?;\\n\\n    invoke(\\n        \u0026instruction,\\n        \u0026[\\n            ctx.accounts.reward_account.clone(),\\n            ctx.accounts.ledger_program.clone(),\\n        ],\\n    )\\n}\\n\\n#[derive(Accounts)]\\npub struct DistributeAndRecord\u003c'info\u003e {\\n    reward_account: AccountInfo\u003c'info\u003e,\\n    ledger_program: AccountInfo\u003c'info\u003e,\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$66\"}}]}]]}]\n67:T1ff3,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e distribute_and_record_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eDistributeAndRecord\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, reward_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Reward distribution logic\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Verify the ledger_program is the expected custom ledger program\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eledger_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ecustom_ledger_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eID {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eIncorrectProgramId\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einto\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e instruction \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e custom_ledger_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003einstruction\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003erecord_transaction\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eledger_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ereward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        reward_amount,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    invoke\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003einstruction,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e            ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ereward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eclone\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e            ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eledger_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eclone\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        ],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e DistributeAndRecord\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    reward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    ledger_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3a:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn distribute_and_record_rewards(ctx: Context\u003cDistributeAndRecord\u003e, reward_amount: u64) -\u003e ProgramResult {\\n    // Reward distribution logic\\n\\n    // Verify the ledger_program is the expected custom ledger program\\n    if ctx.accounts.ledger_program.key() != \u0026custom_ledger_program::ID {\\n        return Err(ProgramError::IncorrectProgramId.into())\\n    }\\n    \\n    let instruction = custom_ledger_program::instruction::record_transaction(\\n        \u0026ctx.accounts.ledger_program.key(),\\n        \u0026ctx.accounts.reward_account.key(),\\n        reward_amount,\\n    )?;\\n\\n    invoke(\\n        \u0026instruction,\\n        \u0026[\\n            ctx.accounts.reward_account.clone(),\\n            ctx.accounts.ledger_program.clone(),\\n        ],\\n    )\\n}\\n\\n#[derive(Accounts)]\\npub struct DistributeAndRecord\u003c'info\u003e {\\n    reward_account: AccountInfo\u003c'info\u003e,\\n    ledger_program: AccountInfo\u003c'info\u003e,\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$67\"}}]}]]}]\n"])</script><script>self.__next_f.push([1,"68:T966,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e set_params\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSetParams\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e/* parameters to be set */\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    require_keys_eq!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ecurrent_admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eglobal_admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eauthority,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Logic to set parameters\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3b:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn set_params(ctx: Context\u003cSetParams\u003e, /* parameters to be set */) -\u003e Result\u003c()\u003e {\\n    require_keys_eq!(\\n        ctx.accounts.current_admin.key(),\\n        ctx.accounts.global_admin.authority,\\n    );\\n\\n    // Logic to set parameters\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$68\"}}]}]]}]\n69:T562,pub fn nominate_new_authority(ctx: Context\u003cNominateAuthority\u003e, new_authority: Pubkey) -\u003e Result\u003c()\u003e {\n    let state = \u0026mut ctx.accounts.state;\n    require_keys_eq!(\n        state.authority, \n        ctx.accounts.current_authority.key()\n    );\n\n    state.pending_authority = Some(new_authority);\n    Ok(())\n}\n\npub fn accept_authority(ctx: Context\u003cAcceptAuthority\u003e) -\u003e Result\u003c()\u003e {\n    let state = \u0026mut ctx.accounts.state;\n    require_keys_eq!(\n        Some(ctx.accounts.new_authority.key()), \n        sta"])</script><script>self.__next_f.push([1,"te.pending_authority\n    );\n\n    state.authority = ctx.accounts.new_authority.key();\n    state.pending_authority = None;\n    Ok(())\n}\n\n#[derive(Accounts)]\npub struct NominateAuthority\u003c'info\u003e {\n    #[account(\n        mut,\n        has_one = authority,\n    )]\n    pub state: Account\u003c'info, ProgramState\u003e,\n    pub current_authority: Signer\u003c'info\u003e,\n    pub system_program: Program\u003c'info, System\u003e,\n}\n\n#[derive(Accounts)]\npub struct AcceptAuthority\u003c'info\u003e {\n    #[account(\n        mut,\n        constraint = state.pending_authority == Some(new_authority.key())\n    )]\n    pub state: Account\u003c'info, ProgramState\u003e,\n    pub new_authority: Signer\u003c'info\u003e,\n}\n\n#[account]\npub struct ProgramState {\n    pub authority: Pubkey,\n    pub pending_authority: Option\u003cPubkey\u003e,\n    // Other relevant program state fields\n}6a:T358f,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e nominate_new_authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eNominateAuthority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, new_authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e state \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estate;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    require_keys_eq!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        state\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eauthority, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ecurrent_authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    state\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003epending_authority \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Some\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(new_authority);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e accept_authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAcceptAuthority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e state \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estate;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    require_keys_eq!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e        Some\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003enew_authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()), \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        state\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003epending_authority\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    state\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eauthority \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003enew_authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    state\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003epending_authority \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e None\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e NominateAuthority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        has_one \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e authority,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e state\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramState\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e current_authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e system_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSystem\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AcceptAuthority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        constraint \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e state\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003epending_authority \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e==\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Some\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(new_authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ekey())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e state\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramState\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e new_authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramState\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e pending_authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Option\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ePubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Other relevant program state fields\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3c:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"$69\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$6a\"}}]}]]}]\n6b:T42a,pub fn create_profile(ctx: Context\u003cCreateProfile\u003e, user_id: u64, attributes: Vec\u003cu8\u003e, bump: u8) -\u003e Result\u003c()\u003e {\n    // Explicitly derive the PDA using create_program_address and a user-provided bump\n    let seeds: \u0026[\u0026[u8]] = \u0026[b\"profile\", \u0026user_id.to_le_bytes(),\u0026[bump]];\n    let (derived_address, _bump) = Pubkey::create_program_address(seeds, \u0026ctx.program_id)?;\n\n    if derived_address != ctx.accounts.profile.key() {\n        return Err(ProgramError::InvalidSeeds);\n    }\n\n    let profile_pda = \u0026mut ctx.accounts.profile;\n    profile_pda.user_id = user_id;\n    profile_pda.attributes = attributes;\n\n    Ok(())\n}\n\n#[derive(Accounts)]\npub struct CreateProfile\u003c'info\u003e {\n    #[account(mut)]\n    pub user: Signer\u003c'info\u003e,\n    /// The profile account, expected to "])</script><script>self.__next_f.push([1,"be a PDA derived with the user_id and a user-provided bump seed\n    #[account(mut)]\n    pub profile: Account\u003c'info, UserProfile\u003e,\n    pub system_program: Program\u003c'info, System\u003e,\n}\n\n#[account]\npub struct UserProfile {\n    pub user_id: u64,\n    pub attributes: Vec\u003cu8\u003e,\n}6c:T290d,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e create_profile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eCreateProfile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, user_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, attributes\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Vec\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, bump\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Explicitly derive the PDA using create_program_address and a user-provided bump\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e seeds\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e]] \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"profile\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003euser_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_le_bytes\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(),\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[bump]];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e (derived_address, _bump) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ecreate_program_address\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(seeds, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eprogram_id)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e derived_address \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eprofile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInvalidSeeds\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e profile_pda \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eprofile;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    profile_pda\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003euser_id \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user_id;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    profile_pda\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eattributes \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e attributes;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e CreateProfile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    /// The profile account, expected to be a PDA derived with the user_id and a user-provided bump seed\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e profile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eUserProfile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e system_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSystem\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e UserProfile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e attributes\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Vec\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3d:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"$6b\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$6c\"}}]}]]}]\n6d:T47b,pub fn create_profile(ctx: Context\u003cCreateProfile\u003e, user_id: u64, attributes: Vec\u003cu8\u003e) -\u003e Result\u003c()\u003e {\n    // Securely derive the PDA using find_program_address to ensure the canonical bump is used\n    let seeds: \u0026[\u0026[u8]] = \u0026[b\"profile\", user_id.to_le_bytes()];\n    let (derived_address, bump) = Pubkey::find_program_address(seeds, \u0026ctx.program_id);\n\n    // Store the canonical bump in the profile for future validations\n    let profile_pda = \u0026mut ctx.accounts.profile;\n    profile_pda.user_id = user_id;\n    profile_pda.attributes = attributes;\n    profile_pda.bump = bump;\n\n    Ok(())\n}\n\n#[derive(Accounts)]\n#[instruction(user_id: u64)]\npub struct CreateProfile\u003c'info\u003e {\n    #[account(\n        init, \n        payer = user, \n        space = 8 + 1024 + 1, "])</script><script>self.__next_f.push([1,"\n        seeds = [b\"profile\", user_id.to_le_bytes().as_ref()], \n        bump\n    )]\n    pub profile: Account\u003c'info, UserProfile\u003e,\n    #[account(mut)]\n    pub user: Signer\u003c'info\u003e,\n    pub system_program: Program\u003c'info, System\u003e,\n}\n\n#[account]\npub struct UserProfile {\n    pub user_id: u64,\n    pub attributes: Vec\u003cu8\u003e,\n    pub bump: u8,\n}6e:T2b09,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e create_profile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eCreateProfile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, user_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, attributes\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Vec\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Securely derive the PDA using find_program_address to ensure the canonical bump is used\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e seeds\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e]] \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"profile\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, user_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_le_bytes\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e (derived_address, bump) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003efind_program_address\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(seeds, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eprogram_id);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Store the canonical bump in the profile for future validations\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e profile_pda \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eprofile;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    profile_pda\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003euser_id \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user_id;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    profile_pda\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eattributes \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e attributes;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    profile_pda\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebump \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e bump;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[instruction(user_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e CreateProfile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        init, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        payer \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        space \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e 8 \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e 1024 \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e 1, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"profile\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, user_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eto_le_bytes()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eas_ref()], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        bump\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e profile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eUserProfile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e system_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSystem\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e UserProfile\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e attributes\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Vec\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e bump\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3e:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"$6d\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$6e\"}}]}]]}]\n6f:T1ca6,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e close_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eCloseAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edata_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e destination \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edestination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    **\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edestination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow_mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e destination\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003echecked_add\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eunwrap\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    **\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow_mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e CloseAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e data_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eData\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e destination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3f:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn close_account(ctx: Context\u003cCloseAccount\u003e) -\u003e ProgramResult {\\n    let account = ctx.accounts.data_account.to_account_info();\\n    let destination = ctx.accounts.destination.to_account_info();\\n\\n    **destination.lamports.borrow_mut() = destination\\n        .lamports()\\n        .checked_add(account.lamports())\\n        .unwrap();\\n    **account.lamports.borrow_mut() = 0;\\n    \\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct CloseAccount\u003c'info\u003e {\\n    #[account(mut)]\\n    pub data_account: Account\u003c'info, Data\u003e,\\n    #[account(mut)]\\n    pub destination: AccountInfo\u003c'info\u003e,\\n}\\n\\n#[account]\\npub struct Data {\\n    data: u64,\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$6f\"}}]}]]}]\n70:T766,use anchor_lang::__private::CLOSED_ACCOUNT_DISCRIMINATOR;\nuse anchor_lang::prelude::*;\nuse std::io::Cursor;\nuse st"])</script><script>self.__next_f.push([1,"d::ops::DerefMut;\n\n// Other code\n\npub fn close_account(ctx: Context\u003cCloseAccount\u003e) -\u003e ProgramResult {\n    let account = ctx.accounts.data_account.to_account_info();\n    let destination = ctx.accounts.destination.to_account_info();\n\n    **destination.lamports.borrow_mut() = destination\n        .lamports()\n        .checked_add(account.lamports())\n        .unwrap();\n    **account.lamports.borrow_mut() = 0;\n\n    // Zero out the account data\n    let mut data = account.try_borrow_mut_data()?;\n    for byte in data.deref_mut().iter_mut() {\n        *byte = 0;\n    }\n\n    // Mark the account as closed\n    let dst: \u0026mut [u8] = \u0026mut data;\n    let mut cursor = Cursor::new(dst);\n    cursor.write_all(\u0026CLOSED_ACCOUNT_DISCRIMINATOR).unwrap();\n\n    Ok(())\n}\n\npub fn force_defund(ctx: Context\u003cForceDefund\u003e) -\u003e ProgramResult {\n    let account = \u0026ctx.accounts.account;\n    let data = account.try_borrow_data()?;\n\n    if data.len() \u003c 8 || data[0..8] != CLOSED_ACCOUNT_DISCRIMINATOR {\n        return Err(ProgramError::InvalidAccountData);\n    }\n\n    let destination = ctx.accounts.destination.to_account_info();\n\n    **destination.lamports.borrow_mut() = destination\n        .lamports()\n        .checked_add(account.lamports())\n        .unwrap();\n    **account.lamports.borrow_mut() = 0;\n\n    Ok(())\n}\n\n#[derive(Accounts)]\npub struct ForceDefund\u003c'info\u003e {\n    #[account(mut)]\n    pub account: AccountInfo\u003c'info\u003e,\n    #[account(mut)]\n    pub destination: AccountInfo\u003c'info\u003e,\n}\n\n#[derive(Accounts)]\npub struct CloseAccount\u003c'info\u003e {\n    #[account(mut)]\n    pub data_account: Account\u003c'info, Data\u003e,\n    #[account(mut)]\n    pub destination: AccountInfo\u003c'info\u003e,\n}\n\n#[account]\npub struct Data {\n    data: u64,\n}71:T517b,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003euse\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e anchor_lang\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e__private\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eCLOSED_ACCOUNT_DISCRIMINATOR\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003euse\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e anchor_lang\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eprelude\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::*\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003euse\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e std\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eio\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eCursor\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003euse\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e std\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eops\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eDerefMut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e// Other code\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e close_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eCloseAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edata_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e destination \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edestination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    **\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edestination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow_mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e destination\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003echecked_add\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eunwrap\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    **\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow_mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Zero out the account data\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e data \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003etry_borrow_mut_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    for\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e byte \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003ein\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ederef_mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eiter_mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        *\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebyte \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Mark the account as closed\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e dst\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e] \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e data;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e cursor \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Cursor\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003enew\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(dst);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    cursor\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ewrite_all\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eCLOSED_ACCOUNT_DISCRIMINATOR)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eunwrap\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e force_defund\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eForceDefund\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e data \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003etry_borrow_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003elen\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u0026#x3C; \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e ||\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e data[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e0\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e..\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e] \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e CLOSED_ACCOUNT_DISCRIMINATOR {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInvalidAccountData\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e destination \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edestination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eto_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    **\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edestination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow_mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e destination\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003echecked_add\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eunwrap\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    **\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003elamports\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow_mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ForceDefund\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e destination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e CloseAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e data_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eData\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e destination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"40:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"$70\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$71\"}}]}]]}]\n72:T18e5,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e distribute_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eDistributeRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, reward_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, bonus_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e reward_account \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ereward_account;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e bonus_reward \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebonus_account;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Intended to increment the reward and bonus accounts separately\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    reward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebalance \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e reward_amount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    bonus_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebalance \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e bonus_amount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e DistributeRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    reward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eRewardAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    bonus_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eRewardAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e RewardAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e balance\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"41:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn distribute_rewards(ctx: Context\u003cDistributeRewards\u003e, reward_amount: u64, bonus_amount: u64) -\u003e Result\u003c()\u003e {\\n    let reward_account = \u0026mut ctx.accounts.reward_account;\\n    let bonus_reward = \u0026mut ctx.accounts.bonus_account;\\n\\n    // Intended to increment the reward and bonus accounts separately\\n    reward_account.balance += reward_amount;\\n    bonus_account.balance += bonus_amount;\\n\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct DistributeRewards\u003c'info\u003e {\\n    #[account(mut)]\\n    reward_account: Account\u003c'info, RewardAccount\u003e,\\n    #[account(mut)]\\n    bonus_account: Account\u003c'info, RewardAccount\u003e,\\n}\\n\\n#[account]\\npub struct RewardAccount {\\n    pub balance: u64,\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$72\"}}]}]]}]\n73:T149b,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e distribute_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eDistributeRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, reward_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, bonus_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ereward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e==\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebonus_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInvalidArgument\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einto\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e reward_account \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ereward_account;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e bonus_reward \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebonus_account;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Intended to increment the reward and bonus accounts separately\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    reward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebalance \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e reward_amount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    bonus_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebalance \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e bonus_amount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"42:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn distribute_rewards(ctx: Context\u003cDistributeRewards\u003e, reward_amount: u64, bonus_amount: u64) -\u003e Result\u003c()\u003e {\\n    if ctx.accounts.reward_account.key() == ctx.accounts.bonus_account.key() {\\n        return Err(ProgramError::InvalidArgument.into())\\n    }\\n    \\n    let reward_account = \u0026mut ctx.accounts.reward_account;\\n    let bonus_reward = \u0026mut ctx.accounts.bonus_account;\\n\\n    // Intended to increment the reward and bonus accounts separately\\n    reward_account.balance += reward_amount;\\n    bonus_account.balance += bonus_amount;\\n\\n    Ok(())\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$73\"}}]}]]}]\n74:T1b97,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e distribute_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eDistributeRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, reward_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, bonus_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e reward_account \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ereward_account;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e bonus_reward \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebonus_account;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Intended to increment the reward and bonus accounts separately\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    reward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebalance \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e reward_amount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    bonus_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ebalance \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e bonus_amount;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e DistributeRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        constraint \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e reward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ekey() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e bonus_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ekey()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    reward_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eRewardAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    bonus_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eRewardAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e RewardAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e balance\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"43:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn distribute_rewards(ctx: Context\u003cDistributeRewards\u003e, reward_amount: u64, bonus_amount: u64) -\u003e Result\u003c()\u003e {\\n    let reward_account = \u0026mut ctx.accounts.reward_account;\\n    let bonus_reward = \u0026mut ctx.accounts.bonus_account;\\n\\n    // Intended to increment the reward and bonus accounts separately\\n    reward_account.balance += reward_amount;\\n    bonus_account.balance += bonus_amount;\\n\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct DistributeRewards\u003c'info\u003e {\\n    #[account(\\n        mut,\\n        constraint = reward_account.key() != bonus_account.key()\\n    )]\\n    reward_account: Account\u003c'info, RewardAccount\u003e,\\n    #[account(mut)]\\n    bonus_account: Account\u003c'info, RewardAccount\u003e,\\n}\\n\\n#[account]\\npub struct RewardAccount {\\n    pub balance: u64,\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$74\"}}]}]]}]\n"])</script><script>self.__next_f.push([1,"75:T22f3,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e SellProduct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  product_listing\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProductListing\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  sale_token_mint\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eMint\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  sale_token_destination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eTokenAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  product_owner\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  purchaser_token_source\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eTokenAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  product\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;info, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProduct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e PurchaseProduct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  product_listing\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProductListing\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  token_destination\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eTokenAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  token_source\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eTokenAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  buyer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  product_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProduct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  token_mint_sale\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eMint\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProductListing\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  sale_price\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  token_mint\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  destination_token_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  product_owner\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  product\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"44:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"#[derive(Accounts)]\\npub struct SellProduct\u003c'info\u003e {\\n  product_listing: Account\u003c'info, ProductListing\u003e,\\n  sale_token_mint: Account\u003c'info, Mint\u003e,\\n  sale_token_destination: Account\u003c'info, TokenAccount\u003e,\\n  product_owner: Signer\u003c'info\u003e,\\n  purchaser_token_source: Account\u003c'info, TokenAccount\u003e,\\n  product: Account\u003cinfo, Product\u003e\\n}\\n\\n#[derive(Accounts)]\\npub struct PurchaseProduct\u003c'info\u003e {\\n  product_listing: Account\u003c'info, ProductListing\u003e,\\n  token_destination: Account\u003c'info, TokenAccount\u003e,\\n  token_source: Account\u003c'info, TokenAccount\u003e,\\n  buyer: Signer\u003c'info\u003e,\\n  product_account: Account\u003c'info, Product\u003e,\\n  token_mint_sale: Account\u003c'info, Mint\u003e,\\n}\\n\\n#[account]\\npub struct ProductListing {\\n  sale_price: u64,\\n  token_mint: Pubkey,\\n  destination_token_account: Pubkey,\\n  product_owner: Pubkey,\\n  product: Pubkey,\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$75\"}}]}]]}]\n"])</script><script>self.__next_f.push([1,"76:T498,\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e change_sale_price\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eChangeSalePrice\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, new_price\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e...\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e45:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022"])</script><script>self.__next_f.push([1,"a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn change_sale_price(ctx: Context\u003cChangeSalePrice\u003e, new_price: u64) -\u003e Result\u003c()\u003e {...}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$76\"}}]}]]}]\n77:T749,\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e purchase_product\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ePurchaseProduct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, expected_price\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e  assert!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eproduct_listing\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003esale_price \u003c/span\u003e\u003cspan style=\""])</script><script>self.__next_f.push([1,"color:var(--shiki-token-keyword)\"\u003e\u0026#x3C;=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e expected_price);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e  ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e46:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn purchase_product(ctx: Context\u003cPurchaseProduct\u003e, expected_price: u64) -\u003e Result\u003c()\u003e {\\n  assert!(ctx.accounts.product_listing.sale_price \u003c= expected_price);\\n  ...\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$77\"}}]}]]}]\n78:T1618,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e initialize\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInitialize\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ecentral_state\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eauthority \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e  ...\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Initialize\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    init,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    payer \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e authority,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    space \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e CentralState\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSIZE\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"central_state\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    bump\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  central_state\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eCentralState\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e  ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e CentralState\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e  authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e  ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"47:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn initialize(ctx: Context\u003cInitialize\u003e) -\u003e Result\u003c()\u003e {\\n  ctx.accounts.central_state.authority = authority.key();\\n  ...  \\n}\\n\\n#[derive(Accounts)]\\npub struct Initialize\u003c'info\u003e {\\n  authority: Signer\u003c'info\u003e,\\n  #[account(mut,\\n    init,\\n    payer = authority,\\n    space = CentralState::SIZE,\\n    seeds = [b\\\"central_state\\\"],\\n    bump\\n  )]\\n  central_state: Account\u003c'info, CentralState\u003e,\\n  ...\\n}\\n\\n#[account]\\npub struct CentralState {\\n  authority: Pubkey,\\n  ...\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$78\"}}]}]]}]\n79:T46e,use anchor_lang::prelude::*;\nuse crate::program::MyProgram;\n\ndeclare_id!(\"Cum9tTyj5HwcEiAmhgaS7Bbj4UczCwsucrCkxRECzM4e\");\n\n#[program]\npub mod my_program {\n    use super::*;\n\n    pub fn set_initial_admin(\n        ctx: Context\u003cSetInitialAdmin\u003e,\n        admin_key: Pubkey\n    )"])</script><script>self.__next_f.push([1," -\u003e Result\u003c()\u003e {\n        ctx.accounts.admin_settings.admin_key = admin_key;\n        Ok(())\n    }\n\n    pub fn set_admin(...){...}\n\n    pub fn set_settings(...){...}\n}\n\n#[account]\n#[derive(Default, Debug)]\npub struct AdminSettings {\n    admin_key: Pubkey\n}\n\n#[derive(Accounts)]\npub struct SetInitialAdmin\u003c'info\u003e {\n    #[account(init, payer = authority, seeds = [b\"admin\"], bump)]\n    pub admin_settings: Account\u003c'info, AdminSettings\u003e,\n    #[account(mut)]\n    pub authority: Signer\u003c'info\u003e,\n    #[account(constraint = program.programdata_address()? == Some(program_data.key()))]\n    pub program: Program\u003c'info, MyProgram\u003e,\n    #[account(constraint = program_data.upgrade_authority_address == Some(authority.key()))]\n    pub program_data: Account\u003c'info, ProgramData\u003e,\n    pub system_program: Program\u003c'info, System\u003e,\n}7a:T2bee,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003euse\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e anchor_lang\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eprelude\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::*\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003euse\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e crate::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eprogram\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eMyProgram\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003edeclare_id!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003e\"Cum9tTyj5HwcEiAmhgaS7Bbj4UczCwsucrCkxRECzM4e\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[program]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e mod\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e my_program {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    use\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e super\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::*\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e set_initial_admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSetInitialAdmin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        admin_key\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    ) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin_settings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin_key \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin_key;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e        Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e set_admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e...\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e){\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e...\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e set_settings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e...\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e){\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e...\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eDefault\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eDebug\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AdminSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    admin_key\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e SetInitialAdmin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(init, payer \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e authority, seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"admin\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e], bump)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin_settings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAdminSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(constraint \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eprogramdata_address()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e ==\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Some\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(program_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ekey()))]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eMyProgram\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(constraint \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e program_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eupgrade_authority_address \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e==\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Some\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ekey()))]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e program_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramData\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e system_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSystem\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"48:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"$79\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$7a\"}}]}]]}]\n7b:T528,\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e calculate_reward\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(transaction_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, reward_multiplier\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki"])</script><script>self.__next_f.push([1,"-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    transaction_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003esaturating_mul\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(reward_multiplier)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e49:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn calculate_reward(transaction_amount: u64, reward_multiplier: u64) -\u003e u64 {\\n    transaction_amount.saturating_mul(reward_multiplier)\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$7b\"}}]}]]}]\n7c:T84f,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e collateral_to_liquidity\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eself, collateral_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Decimal\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(collateral_amount)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003etry_div\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(self\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e0\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        .\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003etry_round_u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"4a:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn collateral_to_liquidity(\u0026self, collateral_amount: u64) -\u003e Result\u003cu64, ProgramError\u003e {\\n    Decimal::from(collateral_amount)\\n        .try_div(self.0)?\\n        .try_round_u64()\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$7c\"}}]}]]}]\n7d:Taac,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e admin_token_withdraw\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(program_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ePubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, accounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e], amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Account setup\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e config\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003epubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInvalidAdminAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Transfer funds logic\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"4b:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn admin_token_withdraw(program_id: \u0026Pubkey, accounts: \u0026[AccountInfo], amount: u64) -\u003e ProgramResult {\\n    // Account setup\\n\\n    if config.admin != admin.pubkey() {\\n        return Err(ProgramError::InvalidAdminAccount)\\n    }\\n\\n    // Transfer funds logic\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$7d\"}}]}]]}]\n7e:Te63,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e admin_token_withdraw\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(program_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ePubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, accounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e], amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Account setup\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e config\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003epubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInvalidAdminAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e config\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eowner \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e program_id {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInvalidConfigAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Transfer funds logic\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"4c:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn admin_token_withdraw(program_id: \u0026Pubkey, accounts: \u0026[AccountInfo], amount: u64) -\u003e ProgramResult {\\n    // Account setup\\n\\n    if config.admin != admin.pubkey() {\\n        return Err(ProgramError::InvalidAdminAccount)\\n    }\\n\\n    if config.owner != program_id {\\n        return Err(ProgramError::InvalidConfigAccount)\\n    }\\n\\n    // Transfer funds logic\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$7e\"}}]}]]}]\n7f:T13dd,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e update_admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(program_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ePubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, accounts \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e]) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account_iter \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e accounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eiter\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e config \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ConfigAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eunpack\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003enext_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(account_iter)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e next_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(account_iter)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e new_admin \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e next_account_info (account_iter)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003epubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e config\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInvalidAdminAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    config\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e new_admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003epubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"4d:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn update_admin(program_id: \u0026Pubkey, accounts \u0026[AccountInfo]) -\u003e ProgramResult {\\n    let account_iter = \u0026mut accounts.iter();\\n    let config = ConfigAccount::unpack(next_account_info(account_iter)?)?;\\n    let admin = next_account_info(account_iter)?;\\n    let new_admin = next_account_info (account_iter)?;\\n\\n    if admin.pubkey() != config.admin {\\n        return Err(ProgramError::InvalidAdminAccount);\\n    }\\n\\n    config.admin = new_admin.pubkey();\\n\\n    Ok(())\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$7f\"}}]}]]}]\n80:T17cf,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e update_admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(program_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ePubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, accounts \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e]) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account_iter \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e accounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eiter\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e config \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ConfigAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eunpack\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003enext_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(account_iter)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e next_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(account_iter)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e new_admin \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e next_account_info (account_iter)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003epubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e config\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInvalidAdminAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Add in a check for the admin's signature\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e !\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eis_signer {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eNotSigner\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    config\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eadmin \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e new_admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003epubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"4e:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn update_admin(program_id: \u0026Pubkey, accounts \u0026[AccountInfo]) -\u003e ProgramResult {\\n    let account_iter = \u0026mut accounts.iter();\\n    let config = ConfigAccount::unpack(next_account_info(account_iter)?)?;\\n    let admin = next_account_info(account_iter)?;\\n    let new_admin = next_account_info (account_iter)?;\\n\\n    if admin.pubkey() != config.admin {\\n        return Err(ProgramError::InvalidAdminAccount);\\n    }\\n\\n    // Add in a check for the admin's signature\\n    if !admin.is_signer {\\n        return Err(ProgramError::NotSigner);\\n    }\\n\\n    config.admin = new_admin.pubkey();\\n\\n    Ok(())\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$80\"}}]}]]}]\n81:T15d8,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e process_instruction\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    _program_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    accounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    _instruction_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account_info_iter \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e accounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eiter\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e next_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(account_info_iter)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e balance\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e =\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edata\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e0\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e tokens_to_subtract\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e =\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e 100\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    balance \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e balance \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e tokens_to_subtract;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edata\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow_mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e0\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e] \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e balance;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    msg!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003e\"Updated balance to {}\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, balance);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"4f:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn process_instruction(\\n    _program_id: \u0026 Pubkey,\\n    accounts: [\u0026AccountInfo],\\n    _instruction_data: \u0026[u8],\\n) -\u003e ProgramResult {\\n    let account_info_iter = \u0026mut accounts.iter();\\n    let account = next_account_info(account_info_iter)?;\\n\\n    let mut balance: u8 = account.data.borrow()[0];\\n    let tokens_to_subtract: u8 = 100;\\n\\n    balance = balance - tokens_to_subtract;\\n\\n    account.data.borrow_mut()[0] = balance;\\n    msg!(\\\"Updated balance to {}\\\", balance);\\n    \\n    Ok(())\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$81\"}}]}]]}]\n82:T1a6d,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e process_instruction\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    _program_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    accounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    _instruction_data\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account_info_iter \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e accounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eiter\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e next_account_info\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(account_info_iter)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e?\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e balance\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e =\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edata\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e0\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e tokens_to_subtract\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u8\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e =\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e 100\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    match\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e balance\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003echecked_sub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(tokens_to_subtract) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e        Some\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(new_balance) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e            account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edata\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow_mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()[\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-constant)\"\u003e0\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e] \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e new_balance;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e            msg!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003e\"Updated balance to {}\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, new_balance);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e        None\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e            return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramErrorr\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInsufficientFunds\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"50:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn process_instruction(\\n    _program_id: \u0026 Pubkey,\\n    accounts: [\u0026AccountInfo],\\n    _instruction_data: \u0026[u8],\\n) -\u003e ProgramResult {\\n    let account_info_iter = \u0026mut accounts.iter();\\n    let account = next_account_info(account_info_iter)?;\\n\\n    let mut balance: u8 = account.data.borrow()[0];\\n    let tokens_to_subtract: u8 = 100;\\n\\n    match balance.checked_sub(tokens_to_subtract) {\\n        Some(new_balance) =\u003e {\\n            account.data.borrow_mut()[0] = new_balance;\\n            msg!(\\\"Updated balance to {}\\\", new_balance);\\n        },\\n        None =\u003e {\\n            return Err(ProgramErrorr::InsufficientFunds);\\n        }\\n    }\\n\\n    Ok(())\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$82\"}}]}]]}]\n83:T435,\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shi"])</script><script>self.__next_f.push([1,"ki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003euse\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e checked_math\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003echecked_math \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003eas\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e cm;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ecm!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e((x \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e*\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e y) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e z)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eunwrap\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e51:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"use checked_"])</script><script>self.__next_f.push([1,"math::checked_math as cm;\\n\\ncm!((x * y) + z).unwrap()\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$83\"}}]}]]}]\n84:T779,\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e convert_token_amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eu32\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    u32\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003etry_from\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(amount)\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003emap_err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e|\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e_\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e|\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInvalidArgument\u003c/span"])</script><script>self.__next_f.push([1,"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e52:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn convert_token_amount(amount: u64) -\u003e Result\u003cu32, ProgramError\u003e {\\n    u32::try_from(amount).map_err(|_| ProgramError::InvalidArgument)\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$84\"}}]}]]}]\n85:T19d7,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e stake_tokens\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eStakeTokens\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Logic to stake tokens\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e withdraw_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eWithdrawRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Logic to withdraw rewards\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e StakeTokens\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"staking_pool_pda\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        bump\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    staking_pool\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Other staking-related accounts\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e WithdrawRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"staking_pool_pda\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e], \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        bump\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    rewards_pool\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Other rewards withdrawal-related accounts\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"53:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn stake_tokens(ctx: Context\u003cStakeTokens\u003e, amount: u64) -\u003e ProgramResult {\\n    // Logic to stake tokens\\n    Ok(())\\n}\\n\\npub fn withdraw_rewards(ctx: Context\u003cWithdrawRewards\u003e, amount: u64) -\u003e ProgramResult {\\n    // Logic to withdraw rewards\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct StakeTokens\u003c'info\u003e {\\n    #[account(\\n        mut, \\n        seeds = [b\\\"staking_pool_pda\\\"], \\n        bump\\n    )]\\n    staking_pool: AccountInfo\u003c'info\u003e,\\n    // Other staking-related accounts\\n}\\n\\n#[derive(Accounts)]\\npub struct WithdrawRewards\u003c'info\u003e {\\n    #[account(\\n        mut, \\n        seeds = [b\\\"staking_pool_pda\\\"], \\n        bump\\n    )]\\n    rewards_pool: AccountInfo\u003c'info\u003e,\\n    // Other rewards withdrawal-related accounts\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$85\"}}]}]]}]\n86:T1c8"])</script><script>self.__next_f.push([1,"7,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e stake_tokens\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eStakeTokens\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Logic to stake tokens\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e withdraw_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eWithdrawRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e, amount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Logic to withdraw rewards\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e StakeTokens\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"staking_pool\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003estaking_pool\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ekey()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eas_ref()],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        bump\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    staking_pool\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Other staking-related accounts\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e WithdrawRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        mut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"rewards_pool\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003erewards_pool\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ekey()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eas_ref()],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        bump\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    rewards_pool\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Other rewards withdrawal-related accounts\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"54:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn stake_tokens(ctx: Context\u003cStakeTokens\u003e, amount: u64) -\u003e ProgramResult {\\n    // Logic to stake tokens\\n    Ok(())\\n}\\n\\npub fn withdraw_rewards(ctx: Context\u003cWithdrawRewards\u003e, amount: u64) -\u003e ProgramResult {\\n    // Logic to withdraw rewards\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct StakeTokens\u003c'info\u003e {\\n    #[account(\\n        mut,\\n        seeds = [b\\\"staking_pool\\\", \u0026staking_pool.key().as_ref()],\\n        bump\\n    )]\\n    staking_pool: AccountInfo\u003c'info\u003e,\\n    // Other staking-related accounts\\n}\\n\\n#[derive(Accounts)]\\npub struct WithdrawRewards\u003c'info\u003e {\\n    #[account(\\n        mut,\\n        seeds = [b\\\"rewards_pool\\\", \u0026rewards_pool.key().as_ref()],\\n        bump\\n    )]\\n    rewards_pool: AccountInfo\u003c'info\u003e,\\n    // Other rewards withdrawal-related accounts\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$86\"}}]}]]}]\n"])</script><script>self.__next_f.push([1,"87:T1825,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e calculate_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eCalculateRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e rewards_account \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003erewards_account;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e authority \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eauthority;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Iterate over accounts passed in via ctx.remaining_accounts\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    for\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user_pda_info \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003ein\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eremaining_accounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eiter\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e        // logic to check user activity and calculate rewards\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Logic to distribute calculated rewards\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e CalculateRewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e rewards_account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eRewardsAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e authority \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[account]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e RewardsAccount\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e total_rewards\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e u64\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Other relevant fields\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"55:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn calculate_rewards(ctx: Context\u003cCalculateRewards\u003e) -\u003e Result\u003c()\u003e {\\n    let rewards_account = \u0026ctx.accounts.rewards_account;\\n    let authority = \u0026ctx.accounts.authority;\\n\\n    // Iterate over accounts passed in via ctx.remaining_accounts\\n    for user_pda_info in ctx.remaining_accounts.iter() {\\n        // logic to check user activity and calculate rewards\\n    }\\n\\n    // Logic to distribute calculated rewards\\n\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct CalculateRewards\u003c'info\u003e {\\n    #[account(mut)]\\n    pub rewards_account: Account\u003c'info, RewardsAccount\u003e,\\n    pub authority : Signer\u003c'info\u003e,\\n}\\n\\n#[account]\\npub struct RewardsAccount {\\n    pub total_rewards: u64,\\n    // Other relevant fields\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$87\"}}]}]]}]\n88:T222b,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e// Creating a Voting Session PDA\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[instruction(session_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e String\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e CreateVotingSession\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e organizer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        init,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        payer \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e organizer,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        space \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e 8 \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Product\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSIZE\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003eb\"session\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, session_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eas_bytes()],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e voting_session\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eVotingSession\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e system_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSystem\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e// Submitting a Vote PDA\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[instruction(session_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e String\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e SubmitVote\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003emut\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e voter\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Signer\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    #[account(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        init,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        payer \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e voter,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        space \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e 8 \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e+\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Vote\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSIZE\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e        seeds \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e [session_id\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eas_bytes(), voter\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ekey()\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eas_ref()]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    )]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e vote\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Account\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eVote\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    pub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e system_program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Program\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eSystem\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"56:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"// Creating a Voting Session PDA\\n#[derive(Accounts)]\\n#[instruction(session_id: String)]\\npub struct CreateVotingSession\u003c'info\u003e {\\n    #[account(mut)]\\n    pub organizer: Signer\u003c'info\u003e,\\n    #[account(\\n        init,\\n        payer = organizer,\\n        space = 8 + Product::SIZE,\\n        seeds = [b\\\"session\\\", session_id.as_bytes()],\\n    )]\\n    pub voting_session: Account\u003c'info, VotingSession\u003e,\\n    pub system_program: Program\u003c'info, System\u003e,\\n}\\n\\n// Submitting a Vote PDA\\n#[derive(Accounts)]\\n#[instruction(session_id: String)]\\npub struct SubmitVote\u003c'info\u003e {\\n    #[account(mut)]\\n    pub voter: Signer\u003c'info\u003e,\\n    #[account(\\n        init,\\n        payer = voter,\\n        space = 8 + Vote::SIZE,\\n        seeds = [session_id.as_bytes(), voter.key().as_ref()]\\n    )]\\n    pub vote: Account\u003c'info, Vote\u003e,\\n    pub system_program: Program\u003c'info, System\u003e,\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$88\"}}]}]]}]\n"])</script><script>self.__next_f.push([1,"89:T13e2,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e update_admin_settings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eUpdateSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Deserialize without checking the discriminator\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e User\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003etry_from_slice\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003euser\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edata\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e())\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eunwrap\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Sensitive update logic\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    msg!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003e\"Admin settings updated by: {}\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, user\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eauthority)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e UpdateSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    user\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eBorshSerialize\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eBorshDeserialize\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e User\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"57:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn update_admin_settings(ctx: Context\u003cUpdateSettings\u003e) -\u003e ProgramResult {\\n    // Deserialize without checking the discriminator\\n    let user = User::try_from_slice(\u0026ctx.accounts.user.data.borrow()).unwrap();\\n\\n    // Sensitive update logic\\n\\n    msg!(\\\"Admin settings updated by: {}\\\", user.authority)\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct UpdateSettings\u003c'info\u003e {\\n    user: AccountInfo\u003c'info\u003e\\n}\\n\\n#[derive(BorshSerialize, BorshDeserialize)]\\npub struct User {\\n    authority: Pubkey,\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$89\"}}]}]]}]\n8a:T1e3d,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki css-variables\" style=\"background-color:var(--shiki-background);color:var(--shiki-foreground)\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e update_admin_settings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(ctx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Context\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eUpdateSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e) \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e ProgramResult\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e User\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003etry_from_slice\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eaccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003euser\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003edata\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eborrow\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e())\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eunwrap\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Verify the user's discriminator\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e user\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003ediscriminant \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e!=\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountDiscriminant\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAdmin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e        return\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Err\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eProgramError\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e::\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eInvalidAccountData\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einto\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Sensitive update logic\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    msg!\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-string-expression)\"\u003e\"Admin settings updated by: {}\"\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, user\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e.\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003eauthority)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Ok\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e(())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eAccounts\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e UpdateSettings\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    user\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountInfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u0026#x3C;'\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003einfo\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eBorshSerialize\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eBorshDeserialize\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e struct\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e User\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    discriminant\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountDiscriminant\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e    authority\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e:\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e Pubkey\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e#[derive(\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eBorshSerialize\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003eBorshDeserialize\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e, \u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003ePartialEq\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e)]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003epub\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-keyword)\"\u003e enum\u003c/span\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e AccountDiscriminant\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-function)\"\u003e    Admin\u003c/span\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-token-comment)\"\u003e    // Other account types\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:var(--shiki-foreground)\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"58:[\"$\",\"div\",\"0\",{\"className\":\"group dark:bg-white/2.5 border border-border rounded-lg p-1\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center justify-between pl-5 pr-3 py-3\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-3\",\"children\":[false,false,false,[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 32 32\",\"className\":\"h-5 w-5\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10\"}]}],false,false,false,false,[\"$\",\"span\",null,{\"className\":\"text-aflg font-medium\",\"children\":\"Code\"}]]}],[\"$\",\"$L5d\",null,{\"code\":\"pub fn update_admin_settings(ctx: Context\u003cUpdateSettings\u003e) -\u003e ProgramResult {\\n    let user = User::try_from_slice(\u0026ctx.accounts.user.data.borrow()).unwrap();\\n\\n    // Verify the user's discriminator\\n    if user.discriminant != AccountDiscriminant::Admin {\\n        return Err(ProgramError::InvalidAccountData.into())\\n    }\\n    \\n    // Sensitive update logic\\n\\n    msg!(\\\"Admin settings updated by: {}\\\", user.authority)\\n    Ok(())\\n}\\n\\n#[derive(Accounts)]\\npub struct UpdateSettings\u003c'info\u003e {\\n    user: AccountInfo\u003c'info\u003e\\n}\\n\\n#[derive(BorshSerialize, BorshDeserialize)]\\npub struct User {\\n    discriminant: AccountDiscriminant,\\n    authority: Pubkey,\\n}\\n\\n#[derive(BorshSerialize, BorshDeserialize, PartialEq)]\\npub enum AccountDiscriminant {\\n    Admin,\\n    // Other account types\\n}\"}]]}],[\"$\",\"div\",null,{\"className\":\"relative\",\"children\":[\"$\",\"div\",null,{\"className\":\"overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers\",\"dangerouslySetInnerHTML\":{\"__html\":\"$8a\"}}]}]]}]\n"])</script><script nonce="">((e,t,n,r,a,i,s,o)=>{let c=document.documentElement,l=["light","dark"];function u(t){var n;(Array.isArray(e)?e:[e]).forEach(e=>{let n="class"===e,r=n&&i?a.map(e=>i[e]||e):a;n?(c.classList.remove(...r),c.classList.add(i&&i[t]?i[t]:t)):c.setAttribute(e,t)}),n=t,o&&l.includes(n)&&(c.style.colorScheme=n)}if(r)u(r);else try{let e=localStorage.getItem(t)||n,r=s&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;u(r)}catch(e){}})("class","theme","dark",null,["light","dark"],null,true,true)</script><div class="fixed top-0 h-[44px] left-0 right-0 z-[40] bg-[#0F0F0F] text-white"><div class="flex items-center justify-between py-2"><div class="container"><div class="flex items-center justify-center gap-x-2 sm:gap-x-3 flex-1 min-w-0"><a class="text-sm font-medium truncate underline sm:hidden" href="https://www.helius.dev/laserstream">🚀&nbsp;&nbsp;LaserStream is now available!</a><span class="text-sm font-medium truncate hidden sm:inline">🚀&nbsp;&nbsp;New: LaserStream - Ultra-low latency data streaming is now available!</span><a class="items-center justify-center whitespace-nowrap rounded-full font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 text-white hover:bg-white/20 hover:text-white h-6 sm:h-7 text-afsm px-2 sm:px-3 flex-shrink-0 hidden sm:flex" href="https://www.helius.dev/laserstream">Learn More →</a></div></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-6 w-6 mr-2 sm:h-7 sm:w-7 text-white hover:bg-white/20 hover:text-white flex-shrink-0 ml-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x h-4 w-4"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg><span class="sr-only">Dismiss</span></button></div></div><div class="fixed left-0 right-0 z-50 transition-all duration-200 top-[44px] bg-transparent border-transparent"><header class="container"><nav aria-label="Global" class="mx-auto flex items-center justify-between py-4"><a href="https://www.helius.dev/"><img alt="Helius Logo" width="190" height="40" decoding="async" data-nimg="1" class="h-6 w-auto" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/logo.svg" style="color: transparent;"><span class="sr-only">Helius</span></a><div class="flex lg:hidden"><a target="_blank" class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-9 px-4 bg-primary text-primary-foreground hover:bg-primary/90 font-medium" href="https://dashboard.helius.dev/signup">Sign Up</a><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-card hover:text-accent-foreground h-9 w-9"><span class="sr-only">Open main menu</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" class="w-5 h-5"><path d="M17.5 10a.624.624 0 0 1-.625.625H3.125a.625.625 0 1 1 0-1.25h13.75A.625.625 0 0 1 17.5 10ZM3.125 5.625h13.75a.625.625 0 1 0 0-1.25H3.125a.625.625 0 0 0 0 1.25Zm13.75 8.75H3.125a.625.625 0 1 0 0 1.25h13.75a.624.624 0 1 0 0-1.25Z" fill="currentColor"></path></svg></button></div><div class="hidden lg:flex lg:gap-x-9"><nav aria-label="Main" data-orientation="horizontal" dir="ltr" class="relative z-10 flex flex-1 items-center justify-center"><div style="position: relative;"><ul data-orientation="horizontal" class="group flex flex-1 list-none items-center justify-center space-x-1" dir="ltr"><li><button id="radix-«r0»-trigger-radix-«r1»" data-state="closed" aria-expanded="false" aria-controls="radix-«r0»-content-radix-«r1»" class="group text-gray-400 inline-flex h-10 w-max items-center justify-center px-4 py-2 transition-colors hover:text-gray-50 focus:text-gray-50 focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:text-gray-50 data-[state=open]:text-gray-50 group" data-radix-collection-item="">Products <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down relative top-[1px] ml-1 h-3 w-3" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button></li><li><button id="radix-«r0»-trigger-radix-«r2»" data-state="closed" aria-expanded="false" aria-controls="radix-«r0»-content-radix-«r2»" class="group text-gray-400 inline-flex h-10 w-max items-center justify-center px-4 py-2 transition-colors hover:text-gray-50 focus:text-gray-50 focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:text-gray-50 data-[state=open]:text-gray-50 group" data-radix-collection-item="">Resources <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down relative top-[1px] ml-1 h-3 w-3" aria-hidden="true"><path d="m6 9 6 6 6-6"></path></svg></button></li><li><a class="group text-gray-400 inline-flex h-10 w-max items-center justify-center px-4 py-2 transition-colors hover:text-gray-50 focus:text-gray-50 focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:text-gray-50 data-[state=open]:text-gray-50" href="https://www.helius.dev/blog" data-radix-collection-item="">Blog</a></li><li><a class="group text-gray-400 inline-flex h-10 w-max items-center justify-center px-4 py-2 transition-colors hover:text-gray-50 focus:text-gray-50 focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:text-gray-50 data-[state=open]:text-gray-50" href="https://www.helius.dev/docs" data-radix-collection-item="">Docs</a></li><li><a class="group text-gray-400 inline-flex h-10 w-max items-center justify-center px-4 py-2 transition-colors hover:text-gray-50 focus:text-gray-50 focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:text-gray-50 data-[state=open]:text-gray-50" href="https://www.helius.dev/pricing" data-radix-collection-item="">Pricing</a></li></ul></div><div class="absolute origin-center top-full flex justify-center"></div></nav><div class="flex gap-x-3"><a target="_blank" class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-9 px-4 border border-border text-gray-50 hover:bg-gray-700" href="https://dashboard.helius.dev/login">Log In</a><a class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-9 px-4 border border-border text-gray-50 hover:bg-gray-700" href="https://www.helius.dev/stake">Stake</a><a target="_blank" class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-9 px-4 bg-primary text-primary-foreground hover:bg-primary/90 font-medium" href="https://dashboard.helius.dev/signup">Sign Up</a></div></div></nav></header></div><article class="pt-24 md:pt-30 pb-24"><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#article","isAccessibleForFree":true,"isPartOf":{"@id":"https://www.helius.dev/#website"},"author":[{"@type":"Person","name":"0xIchigo","jobTitle":"Developer Experience Engineer","image":{"@type":"ImageObject","url":"/api/media/file/ichi-bro.jpg"},"sameAs":["https://x.com/0xIchigo","https://www.linkedin.com/in/evan-wyatt/"]}],"editor":[],"contributor":[],"headline":"A Hitchhiker's Guide to Solana Program Security","description":"Learn about Solana program security and how to mitigate common vulnerabilities","datePublished":"2024-03-18T20:30:22.000Z","dateModified":"2025-02-16T10:17:15.480Z","mainEntityOfPage":{"@id":"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#article"},"wordCount":7616,"publisher":{"@id":"https://www.helius.dev/#organization"},"image":{"@type":"ImageObject","url":"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp","width":3840,"height":2160},"thumbnailUrl":"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/"]}]},{"@type":"WebPage","@id":"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/","url":"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/","name":"A Hitchhiker's Guide to Solana Program Security","isPartOf":{"@id":"https://www.helius.dev/#website"},"primaryImageOfPage":{"@id":"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#primaryimage"},"image":{"@id":"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#primaryimage"},"thumbnailUrl":"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp","datePublished":"2024-03-18T20:30:22.000Z","dateModified":"2025-02-16T10:17:15.480Z","breadcrumb":{"@id":"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#breadcrumb"},"inLanguage":"en-US"},{"@type":"ImageObject","inLanguage":"en-US","@id":"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#primaryimage","url":"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp","contentUrl":"https://www.helius.dev/api/media/file/a-hitchhikers-guide-to-solana-program-security.webp","width":3840,"height":2160},{"@type":"BreadcrumbList","@id":"https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://www.helius.dev/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://www.helius.dev/blog"},{"@type":"ListItem","position":3,"name":"A Hitchhiker's Guide to Solana Program Security"}]},{"@type":"WebSite","@id":"https://www.helius.dev/#website","url":"https://www.helius.dev/","name":"Helius - Solana's Leading RPC and API Platform","description":"Solana RPCs, APIs, webhooks and dedicated infrastructure to build and ship crypto apps, fast. Get started for free in 1 click.","inLanguage":"en-US","publisher":{"@id":"https://www.helius.dev/#organization"}},{"@type":["Organization"],"@id":"https://www.helius.dev/#organization","name":"Helius","image":{"@type":"ImageObject","inLanguage":"en-US","@id":"https://www.helius.dev/#logo","url":"https://www.helius.dev/logo.svg","contentUrl":"https://www.helius.dev/logo.svg","width":190,"height":40,"caption":"Helius Logo"},"logo":{"@id":"https://www.helius.dev/#logo"},"description":"Solana RPCs, APIs, webhooks and dedicated infrastructure to build and ship crypto apps, fast. Get started for free in 1 click.","sameAs":["https://www.helius.dev/","https://www.x.com/heliuslabs","https://www.linkedin.com/company/heliusapi","https://www.youtube.com/@helius_labs"]}]}</script><div class="container"><div class="mt-5 mb-6 lg:mb-14 aspect-[21/10] max-h-[450px] overflow-hidden rounded-2xl mx-auto flex items-center justify-center"><img alt="A Hitchhiker&#39;s Guide to Solana Program Security" width="945" height="450" decoding="async" data-nimg="1" class="" srcset="/_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fa-hitchhikers-guide-to-solana-program-security.webp&amp;w=1080&amp;q=90 1x, /_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fa-hitchhikers-guide-to-solana-program-security.webp&amp;w=1920&amp;q=90 2x" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/a-hitchhikers-guide-to-solana-program-security.webp" style="color: transparent;"></div></div><div class="xl:grid xl:grid-cols-5 pb-24"><div class="xl:col-start-2 xl:col-span-3 container"><div class="max-w-[42rem] mx-auto mb-8 flex justify-center"><div class="flex gap-2 text-afsm text-gray-500"><button class="hover:text-primary-light flex items-center gap-2" aria-label="Back to blog"><svg height="16" stroke-linejoin="round" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.46966 13.7803L6.99999 14.3107L8.06065 13.25L7.53032 12.7197L3.56065 8.75001H14.25H15V7.25001H14.25H3.56065L7.53032 3.28034L8.06065 2.75001L6.99999 1.68935L6.46966 2.21968L1.39644 7.2929C1.00592 7.68342 1.00592 8.31659 1.39644 8.70711L6.46966 13.7803Z" fill="currentColor"></path></svg> Blog</button><span class="text-gray-500">/</span><span class="text-gray-50">Fundamentals</span></div></div><div class="max-w-[56rem] mx-auto prose sm:prose-lg lg:prose-xl mb-6 text-center"><h1>A Hitchhiker's Guide to Solana Program Security</h1></div><div class="max-w-[42rem] mx-auto mb-12 flex justify-center gap-2 px-8"><div><div class="flex"><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«r9»" data-state="closed" class="cursor-pointer"><div class="flex items-center gap-4 sm:gap-2"><img alt="0xIchigo" loading="lazy" width="40" height="40" decoding="async" data-nimg="1" class="w-6 h-6 hover:ring-2 hover:ring-primary-lighter rounded-full" srcset="/_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fichi-bro.jpg&amp;w=48&amp;q=90 1x, /_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fichi-bro.jpg&amp;w=96&amp;q=90 2x" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/ichi-bro.jpg" style="color: transparent;"><div class="flex flex-col sm:flex-row items-start gap-x-2"><span class="text-afsm text-gray-300 font-medium">0xIchigo</span></div></div></button></div></div></div><div class="max-w-[42rem] mx-auto flex justify-between text-gray-500 mb-8"><div>39 min read</div><time datetime="2024-03-18T20:30:22.000Z">March 18, 2024</time></div><div class="xl:hidden max-w-[42rem] mx-auto bg-gray-900 rounded-lg px-4 mb-8"><div data-orientation="vertical"><div data-state="closed" data-orientation="vertical" class="border-b border-gray-900 border-none"><h3 data-orientation="vertical" data-state="closed" class="flex"><button type="button" aria-controls="radix-«rb»" aria-expanded="false" data-state="closed" data-orientation="vertical" id="radix-«ra»" class="flex-1 justify-between text-gray-100 py-3 font-medium transition-all [&amp;[data-state=open]&gt;[data-chevron]]:rotate-180 flex items-center gap-2" data-radix-collection-item=""><div class="flex items-center gap-2 font-medium text-gray-100"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="w-5 h-5"><path d="M3.833 3a1.833 1.833 0 1 0 0 3.667 1.833 1.833 0 0 0 0-3.667ZM7.833 4.333a.5.5 0 0 0 0 1H13.5a.5.5 0 0 0 0-1H7.833ZM3.833 9.333a1.833 1.833 0 1 0 0 3.667 1.833 1.833 0 0 0 0-3.667ZM7.833 10.667a.5.5 0 1 0 0 1H13.5a.5.5 0 0 0 0-1H7.833Z" fill="currentColor"></path></svg>Table of Contents</div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down h-5 w-5 shrink-0 transition-transform duration-200 text-gray-600" data-chevron="true"><path d="m6 9 6 6 6-6"></path></svg></button></h3><div data-state="closed" id="radix-«rb»" hidden="" role="region" aria-labelledby="radix-«ra»" data-orientation="vertical" class="overflow-hidden text-afsm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down" style="--radix-accordion-content-height: var(--radix-collapsible-content-height); --radix-accordion-content-width: var(--radix-collapsible-content-width);"></div></div></div></div><div class="max-w-[42rem] mx-auto"><div class="max-w-none prose sm:prose-lg lg:prose-xl"><p>This article was co-authored by <a class="" rel="noopener noreferrer" target="_blank" href="https://twitter.com/bl0ckpain">bl0ckpain</a>, a security researcher and smart contract developer who previously worked with&nbsp;<a class="" rel="noopener noreferrer" target="_blank" href="https://kudelskisecurity.com/">Kudelski Security</a> and <a class="" rel="noopener noreferrer" target="_blank" href="https://www.halborn.com/">Halborn</a></p><h2 id="introduction"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#introduction">Introduction<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><p>Solana program security is not just about preventing hackers from stealing a project’s funds — it’s about ensuring a program behaves as intended, adhering to the project’s specifications and user expectations. Solana program security can affect a dApp's performance, scalability, and interoperability. Thus, developers must be aware of potential attack vectors and common vulnerabilities before building consumer-grade applications.</p><p>This article explores common vulnerabilities that developers will encounter when creating Solana programs. We start with an introduction to the attacker mindset for exploiting Solana programs, covering topics such as Solana’s programming model, how Solana’s design is inherently attacker-controlled, potential attack vectors, and common mitigation strategies. Then, we cover a variety of different vulnerabilities, giving an explanation of the vulnerability as well as insecure and secure code examples where applicable.&nbsp;</p><p>Note this article is intended for a more intermediate or advanced audience as it assumes knowledge of Solana’s programming model and program development. </p><p>This article will not go through the process of building a program or Solana-specific concepts — we are focused on examining common vulnerabilities and learning how to mitigate them. If you’re new to Solana, we recommend that you read these previous blog posts before going through this article:</p><ul class="list max-w-[42rem]"><li value="1"><a class="" rel="noopener noreferrer" target="_blank" href="https://www.helius.dev/blog/the-solana-programming-model-an-introduction-to-developing-on-solana">The Solana Programming Model: An Introduction to Developing on Solana</a></li><li value="2"><a class="" rel="noopener noreferrer" target="_blank" href="https://www.helius.dev/blog/an-introduction-to-anchor-a-beginners-guide-to-building-solana-programs">An Introduction to Anchor: A Beginner’s Guide to Building Solana Programs</a></li></ul><h2 id="the-attacker-mindset-in-exploiting-solana-programs"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-attacker-mindset-in-exploiting-solana-programs">The Attacker Mindset in Exploiting Solana Programs<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="solanas-programming-model"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#solanas-programming-model">Solana’s Programming Model<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p><figure class=""><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«rc»" data-state="closed" class="cursor-pointer md:cursor-zoom-in pointer-events-none md:pointer-events-auto w-full "><img alt="Solana programs" loading="lazy" width="3840" height="2160" decoding="async" data-nimg="1" class="m-0 w-full not-prose" srcset="/_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fsolana-programs.webp&amp;w=3840&amp;q=90 1x" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/solana-programs.webp" style="color: transparent;"></button></figure></p><p><a class="" rel="noopener noreferrer" target="_blank" href="https://www.helius.dev/blog/the-solana-programming-model-an-introduction-to-developing-on-solana">Solana's programming model</a> shapes the security landscape of applications built on its network. On Solana, accounts act as containers for data, similar to files on a computer. We can separate accounts into two general types: executable and non-executable. Executable accounts, or <em>programs</em>, are accounts capable of running code. Non-executable accounts are used for data storage without the ability to execute code (because they don't store any code). This decoupling of code and data means that programs are stateless — they interact with data stored in other accounts, passed by reference during transactions.</p><h3 id="solana-is-attacker-controlled"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#solana-is-attacker-controlled">Solana is Attacker-Controlled<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p><figure class=""><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«rf»" data-state="closed" class="cursor-pointer md:cursor-zoom-in pointer-events-none md:pointer-events-auto w-full "><img alt="Solana transaction" loading="lazy" width="3840" height="2160" decoding="async" data-nimg="1" class="m-0 w-full not-prose" srcset="/_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fsolana-transaction.webp&amp;w=3840&amp;q=90 1x" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/solana-transaction.webp" style="color: transparent;"></button></figure></p><p>A transaction specifies the program to call, a list of accounts, and a byte array of instruction data. This model relies on the program to parse and interpret the accounts and instructions a given transaction provides. Allowing any account to be passed into a program's function grants attackers significant control over the data a program will operate on. Understanding Solana's inherently attacker-controlled programming model is crucial to developing secure programs.</p><p>Given an attacker's ability to pass <em>any</em> account into a program's function, data validation becomes a fundamental pillar of Solana program security. Developers must ensure that their program can distinguish between legitimate and malicious inputs. This includes verifying account ownership, ensuring accounts are of an expected type, and whether an account is a signer.</p><h3 id="potential-attack-vectors"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#potential-attack-vectors">Potential Attack Vectors<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Solana's unique programming model and execution environment give rise to specific attack vectors. Understanding these vectors is crucial for developers to safeguard their programs against potential exploits. These attack vectors include:</p><ul class="list max-w-[42rem]"><li value="1"><strong>Logic Bugs</strong>: flaws in program logic could be manipulated to cause unintended behavior, such as a loss of assets or unauthorized access. This also includes failing to implement project specifications correctly — if a program claims to do <em>x</em>, then it should do <em>x</em> and all of its idiosyncrasies</li><li value="2"><strong>Data Validation Flaws</strong>: inadequately validating input data can allow attackers to pass in malicious data and manipulate program state or execution</li><li value="3"><strong>Rust-Specific Issues</strong>: despite Rust's safety features, unsafe code blocks, concurrency issues, and panics can introduce vulnerabilities</li><li value="4"><strong>Access Control Vulnerabilities</strong>: failing to correctly implement access control checks, such as verifying an account’s owner, can lead to unauthorized actions by a malicious actor</li><li value="5"><strong>Arithmetic and Precision Errors</strong>: overflows/underflows and precision errors can be exploited for financial gain or cause a program to malfunction</li><li value="6"><strong>Cross-Program Invocation (CPI) Issues</strong>: flaws in handling CPIs can lead to unexpected state changes or errors if a called program behaves maliciously or unexpectedly</li><li value="7"><strong>Program Derived Addresses (PDAs) Misuse</strong>: incorrectly generating or handling PDAs can lead to vulnerabilities where attackers can hijack or spoof PDAs to gain unauthorized access or manipulate program-controlled accounts</li></ul><p>Note that reentrancy is inherently limited on Solana due to its execution model. The Solana runtime restricts CPIs to a maximum depth of four and enforces strict account rules, such as only allowing an account's owner to modify its data. These constraints prevent reentrancy attacks by limiting direct self-recursion and ensuring a program cannot be involuntarily invoked in an intermediary state.</p><h3 id="mitigation-strategies"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#mitigation-strategies">Mitigation Strategies<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate these potential attacks, developers should employ a combination of rigorous testing, code auditing, and adherence to best practices:</p><ul class="list max-w-[42rem]"><li value="1">Implement comprehensive input validation and access control checks</li><li value="2">Use Rust's type system and safety features to its fullest extent, avoiding unsafe code unless necessary</li><li value="3">Follow Solana and Rust security best practices and stay up to date with new developments</li><li value="4">Conduct internal code reviews and use automated tools to identify common vulnerabilities and logic errors during program development</li><li value="5">Have your codebase audited by reputable third parties, including security firms and independent security researchers</li><li value="6">Create a bug bounty platform for your program to incentivize the reporting of vulnerabilities rather than relying on <a class="" rel="noopener noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Grey_hat">grey hats</a></li></ul><p>The following sections will explore different vulnerabilities alphabetically. Each section will describe a potential vulnerability, explain how to mitigate the vulnerability and give example scenarios whenever possible.</p><h2 id="account-data-matching"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#account-data-matching">Account Data Matching<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Account data matching is a vulnerability that arises when developers fail to check the data stored on an account matches an expected set of values. Without proper data validation checks, a program may inadvertently operate with incorrect or maliciously substituted accounts. This vulnerability is particularly acute in scenarios involving permission-related checks.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a program with functionality to manage its administrative settings. The program includes an instruction to update the current administrative configurations, such as feature flags or operational parameters. The instruction must validate that the request comes from an authorized administrator. However, the program fails to verify that the account requesting the change matches the administrator account stored in the configuration data:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> update_admin_settings</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">UpdateAdminSettings</span><span style="color:var(--shiki-foreground)">&gt;, new_settings</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AdminSettings</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">config_data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">settings </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> new_settings;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> UpdateAdminSettings</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp;pub</span><span style="color:var(--shiki-foreground)"> config_data</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">ConfigData</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp;pub</span><span style="color:var(--shiki-foreground)"> admin</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> ConfigData</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;admin</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;settings</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AdminSettings</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate this vulnerability, developers can implement explicit checks comparing the account keys and stored data against expected values. For instance, verify that the depositor's public key matches the owner field of the token account being used for the deposit:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> update_admin_settings</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">UpdateAdminSettings</span><span style="color:var(--shiki-foreground)">&gt;, new_settings</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AdminSettings</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp;if</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">config_data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">Unauthorized</span><span style="color:var(--shiki-foreground)">);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;} &nbsp;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">config_data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">settings </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> new_settings;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>Developers can also use Anchor's <strong>has_one</strong> and <strong>constraint</strong> attributes to enforce data validation checks declaratively. Using our example above, we could use the <strong>constraint</strong> attribute to check the depositor's public key and the deposit token account's owner are equivalent:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> UpdateAdminSettings</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;mut</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;constraint </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> config_data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-foreground)"> admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">key()</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp;pub</span><span style="color:var(--shiki-foreground)"> config_data</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">ConfigData</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp;pub</span><span style="color:var(--shiki-foreground)"> admin</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><h2 id="account-data-reallocation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#account-data-reallocation">Account Data Reallocation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>In Anchor, the <strong>realloc </strong>function provided by the <strong>AccountInfo </strong>struct introduces a nuanced vulnerability related to memory management. This function allows for reallocating an account's data size, which could be useful for dynamic data handling within programs. However, improper use of <strong>realloc </strong>can lead to unintended consequences, including wasting compute units or potentially exposing stale data.</p><p>The <strong>realloc </strong>method has two parameters:</p><ul class="list max-w-[42rem]"><li value="1"><strong>new_len</strong>: a <strong>usize </strong>that specifies the new length of the account's data</li><li value="2"><strong>zero_init</strong>: a <strong>bool </strong>that determines whether the new memory space should be zero-initialized</li></ul><p><strong>realloc </strong>is defined as follows:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> realloc</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;&amp;</span><span style="color:var(--shiki-foreground)">self,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;new_len</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> usize</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;zero_init</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> bool</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;(), </span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-foreground)">&gt;</span></span></code></pre></div></div></div></p><p>Memory allocated for account data is already zero-initialized at the program's entry point. This means the new memory space is already zeroed out when data is reallocated to a larger size within a single transaction. Re-zeroing this memory is unnecessary and results in additional compute unit consumption. Conversely, reallocating to a smaller size and then back to a larger one within the same transaction could expose stale data if <strong>zero_init </strong>is <strong>false</strong>.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a dynamic to-do list program where users can add, remove, or modify entries within a single transaction. This program needs to reallocate its data size dynamically based on user actions:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> modify_todo_list</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">ModifyTodoList</span><span style="color:var(--shiki-foreground)">&gt;, modifications</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Vec</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">TodoModification</span><span style="color:var(--shiki-foreground)">&gt;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Logic to process modifications</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;for</span><span style="color:var(--shiki-foreground)"> modification </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-foreground)"> modifications {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;match</span><span style="color:var(--shiki-foreground)"> modification {</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TodoModification</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">Add</span><span style="color:var(--shiki-foreground)">(entry) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Add logic</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TodoModification</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">Remove</span><span style="color:var(--shiki-foreground)">(index) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Remove logic, potentially requiring data reallocation</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TodoModification</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">Edit</span><span style="color:var(--shiki-foreground)">(index, new_entry) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Edit logic</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Reallocation logic to adjust the data size based on modifications</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> required_data_len </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> calculate_required_data_len</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">modifications);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">todo_list_data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">realloc</span><span style="color:var(--shiki-foreground)">(required_data_len, </span><span style="color:var(--shiki-token-constant)">false</span><span style="color:var(--shiki-foreground)">)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> ModifyTodoList</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;todo_list_data</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Other relevant accounts</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>In this scenario, the <code>modify_todo_list</code><strong> </strong>function might reallocate <code>to_do_list_data</code><strong> </strong>multiple times to accommodate the size required by the modifications. If the data size is reduced to remove a to-do entry and then increased again to add new entries within the same transaction, setting <code>zero_init</code><strong> </strong>to <code>false</code><strong> </strong>could expose stale data.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate this issue, using the <code>zero_init</code><strong> </strong>parameter prudently is crucial:</p><ul class="list max-w-[42rem]"><li value="1">Set <code>zero_init</code><strong> </strong>to <code>true</code><strong> </strong>when increasing the data size after a prior decrease within the same transaction call. This ensures that any new memory space is zero-initialized, preventing stale data from being exposed</li><li value="2">Set <code>zero_init</code><strong> </strong>to <code>false</code><strong> </strong>when increasing the data size without a prior decrease in the same transaction call since the memory will already be zero-initialized</li></ul><p>Instead of reallocating data to meet specific size requirements, developers should use<a class="" rel="noopener noreferrer" target="_blank" href="https://docs.rs/solana-sdk/latest/solana_sdk/address_lookup_table/struct.AddressLookupTableAccount.html"> Address Lookup Tables (ALTs)</a>. ALTs allow developers to compress a transaction's data by storing up to 256 addresses in a single on-chain account. Each address within the table can then be referenced by a 1-byte index, significantly reducing the data needed for address references in a given transaction. ALTs are much more helpful for scenarios requiring dynamic account interactions without the need for frequent memory resizing.</p><h2 id="account-reloading"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#account-reloading">Account Reloading<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Account reloading is a vulnerability that arises when developers fail to update deserialized accounts after performing a CPI. Anchor does not automatically refresh the state of deserialized accounts after a CPI. This could lead to scenarios where program logic operates on stale data, leading to logical errors or incorrect calculations.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a protocol where users can stake tokens to earn rewards over time. The program facilitating this includes functionality to update a user's staking rewards based on certain conditions or external triggers. A user's rewards are calculated and updated through a CPI to a rewards distribution program. However, the program fails to update the original staking account after the CPI to reflect the new rewards balance:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> update_rewards</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">UpdateStakingRewards</span><span style="color:var(--shiki-foreground)">&gt;, amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> staking_seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-string-expression)">b"stake"</span><span style="color:var(--shiki-foreground)">, ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">staker</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">as_ref</span><span style="color:var(--shiki-foreground)">(), </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">[ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">staking_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">bump]];</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> cpi_accounts </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> UpdateRewards</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;staking_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">staking_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_account_info</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;};</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> cpi_program </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">rewards_distribution_program</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_account_info</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> cpi_ctx </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> CpiContext</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">new_with_signer</span><span style="color:var(--shiki-foreground)">(cpi_program, cpi_accounts, staking_seeds);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;rewards_distribution</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">cpi</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">update_rewards</span><span style="color:var(--shiki-foreground)">(cpi_ctx, amount)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Attempt to log the "updated" reward balance</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;msg!</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">"Rewards: {}"</span><span style="color:var(--shiki-foreground)">, ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">staking_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">rewards);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Logic that uses the stale ctx.accounts.staking_account.rewards</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> UpdateStakingRewards</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> staker</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;mut</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-string-expression)">b"stake"</span><span style="color:var(--shiki-foreground)">, staker</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">key()</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">as_ref()],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;bump,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> staking_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">StakingAccount</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> rewards_distribution_program</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Program</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">RewardsDistribution</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> StakingAccount</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> staker</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> stake_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> rewards</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> bump</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u8</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>In this example, the <code>update_rewards</code><strong> </strong>function attempts to update the rewards for a user's staking account through a CPI call to a rewards distribution program. Initially, the program logs <code>ctx.accounts.staking_account.rewards</code> (i.e., the rewards balance) after the CPI and then continues onto logic that uses the stale <code>ctx.accounts.staking_account.rewards</code> data. The issue is that the staking account's state is not automatically updated post-CPI, which is why the data is stale.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate this issue, explicitly call Anchor's<a class="" rel="noopener noreferrer" target="_blank" href="https://docs.rs/anchor-lang/latest/src/anchor_lang/accounts/account.rs.html#271-275"> <strong>reload</strong></a> method to reload a given account from storage. Reloading an account post-CPI will accurately reflect its state:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> update_rewards</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">UpdateStakingRewards</span><span style="color:var(--shiki-foreground)">&gt;, amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> staking_seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-string-expression)">b"stake"</span><span style="color:var(--shiki-foreground)">, ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">staker</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">as_ref</span><span style="color:var(--shiki-foreground)">(), </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">[ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">staking_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">bump]];</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> cpi_accounts </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> UpdateRewards</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;staking_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">staking_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_account_info</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;};</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> cpi_program </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">rewards_distribution_program</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_account_info</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> cpi_ctx </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> CpiContext</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">new_with_signer</span><span style="color:var(--shiki-foreground)">(cpi_program, cpi_accounts, staking_seeds);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;rewards_distribution</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">cpi</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">update_rewards</span><span style="color:var(--shiki-foreground)">(cpi_ctx, amount)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Reload the staking account to reflect the updated reward balance</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">staking_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">reload</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Log the updated reward balance</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;msg!</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">"Rewards: {}"</span><span style="color:var(--shiki-foreground)">, ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">staking_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">rewards);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Logic that uses ctx.accounts.staking_account.rewards</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><h2 id="arbitrary-cpi"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#arbitrary-cpi">Arbitrary CPI<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Arbitrary CPIs occur when a program invokes another program without verifying the target program's identity. This vulnerability exists because the Solana runtime allows any program to call another program if the caller has the callee's program ID and adheres to the callee's interface. If a program performs CPIs based on user input without validating the callee's program ID, it could execute code in an attacker-controlled program.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a program that distributes awards to participants based on their contributions to a project. After distributing the rewards, the program records the details in a separate ledger program for auditing and tracking purposes. The ledger program is assumed to be a trusted program, providing a public interface for keeping track of specific entries from authorized programs. The program includes a function to distribute and record rewards, which takes in the ledger program as an account. However, the function fails to verify the provided <code>ledger_program</code><strong> </strong>before making a CPI to it:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> distribute_and_record_rewards</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">DistributeAndRecord</span><span style="color:var(--shiki-foreground)">&gt;, reward_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Reward distribution logic</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> instruction </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> custom_ledger_program</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">instruction</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">record_transaction</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">ledger_program</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">reward_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;reward_amount,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;invoke</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;</span><span style="color:var(--shiki-foreground)">instruction,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;</span><span style="color:var(--shiki-foreground)">[</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">reward_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">clone</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">ledger_program</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">clone</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> DistributeAndRecord</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;reward_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;ledger_program</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>An attacker could exploit this by passing a malicious program's ID as the <code>ledger_program</code>, leading to unintended consequences.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To secure against this issue, developers can add a check that verifies the ledger program's identity before performing the CPI. This check would ensure that the CPI call is made to the intended program, preventing arbitrary CPIs:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> distribute_and_record_rewards</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">DistributeAndRecord</span><span style="color:var(--shiki-foreground)">&gt;, reward_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Reward distribution logic</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Verify the ledger_program is the expected custom ledger program</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">ledger_program</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">custom_ledger_program</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">ID {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">IncorrectProgramId</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">into</span><span style="color:var(--shiki-foreground)">())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> instruction </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> custom_ledger_program</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">instruction</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">record_transaction</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">ledger_program</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">reward_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;reward_amount,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;invoke</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;</span><span style="color:var(--shiki-foreground)">instruction,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;&amp;</span><span style="color:var(--shiki-foreground)">[</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">reward_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">clone</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">ledger_program</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">clone</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> DistributeAndRecord</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;reward_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;ledger_program</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>A program may have a publicly available CPI module if it was written using Anchor. This makes invoking the program from another Anchor program easy and secure. The Anchor CPI module automatically checks that the program's address passed in matches the program's address stored in the module. Alternatively, hardcoding the address can be a possible solution instead of having the user pass it in.</p><h2 id="authority-transfer-functionality"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#authority-transfer-functionality">Authority Transfer Functionality<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Solana programs often designate specific public keys as authorities for critical functions, such as updating program parameters or withdrawing funds. However, the inability to transfer this authority to another address can pose significant risks. This limitation becomes problematic in scenarios such as team changes, protocol sales, or if the authority becomes compromised.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a program where a global admin authority is responsible for setting specific protocol parameters through a <strong>set_params</strong> function. The program does not include a mechanism to change the global admin:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> set_params</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">SetParams</span><span style="color:var(--shiki-foreground)">&gt;, </span><span style="color:var(--shiki-token-comment)">/* parameters to be set */</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;require_keys_eq!</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">current_admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">(),</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">global_admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">authority,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Logic to set parameters</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>Here, the authority is statically defined without the ability to update it to a new address.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>A secure approach to mitigating this issue is to create a two-step process for transferring authority. This process would allow the current authority to nominate a new <strong>pending_authority</strong>, which must explicitly accept the role. Not only would this provide authority transfer functionality, but it would also protect against accidental transfers or malicious takeovers. The flow would be as follows:</p><ul class="list max-w-[42rem]"><li value="1"><strong>Nomination by the Current Authority</strong>: the current authority would nominate a new <strong>pending_authority</strong> by calling <strong>nominate_new_authority</strong>, which sets the <strong>pending_authority</strong> field in the program state</li><li value="2"><strong>Acceptance by New Authority</strong>: the nominated <strong>pending_authority</strong> calls <strong>accept_authority</strong> to take on their new role, transferring authority from the current authority to <strong>pending_authority</strong></li></ul><p>This would look something like:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> nominate_new_authority</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">NominateAuthority</span><span style="color:var(--shiki-foreground)">&gt;, new_authority</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> state </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">state;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;require_keys_eq!</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;state</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">authority, </span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">current_authority</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">()</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;state</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">pending_authority </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> Some</span><span style="color:var(--shiki-foreground)">(new_authority);</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> accept_authority</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">AcceptAuthority</span><span style="color:var(--shiki-foreground)">&gt;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> state </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">state;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;require_keys_eq!</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp; &nbsp; &nbsp;Some</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">new_authority</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">()), </span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;state</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">pending_authority</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;state</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">authority </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">new_authority</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;state</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">pending_authority </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> None</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> NominateAuthority</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;mut</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;has_one </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> authority,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> state</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">ProgramState</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> current_authority</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> system_program</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Program</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">System</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> AcceptAuthority</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;mut</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;constraint </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> state</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">pending_authority </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-token-function)"> Some</span><span style="color:var(--shiki-foreground)">(new_authority</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">key())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> state</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">ProgramState</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> new_authority</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> ProgramState</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> authority</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> pending_authority</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Option</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">Pubkey</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Other relevant program state fields</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>In this example, the <code>ProgramState</code><strong> </strong>account structure holds the current <code>authority</code><strong> </strong>and an optional <code>pending_authority</code>. The <strong>NominateAuthority </strong>context ensures that the current authority signs the transaction, allowing them to nominate a new authority. The <code>AcceptAuthority</code><strong> </strong>context checks that the <code>pending_authority</code><strong> </strong>matches the signer of the transaction, allowing them to accept and become the new authority. This setup ensures a secure and controlled transition of authority within the program.</p><h2 id="bump-seed-canonicalization"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#bump-seed-canonicalization">Bump Seed Canonicalization<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Bump seed canonicalization refers to using the highest valid bump seed (i.e., canonical bump) when deriving PDAs. Using the canonical bump is a deterministic and secure way to find an address given a set of seeds. Failing to use the canonical bump can lead to vulnerabilities, such as malicious actors creating or manipulating PDAs that compromise program logic or data integrity.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a program designed to create unique user profiles, each with an associated PDA derived explicitly using <code>create_program_address</code>. The program allows for creating a profile by taking a user-provided bump. However, this is problematic as it introduces the risk of using the non-canonical bump:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> create_profile</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">CreateProfile</span><span style="color:var(--shiki-foreground)">&gt;, user_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">, attributes</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Vec</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">u8</span><span style="color:var(--shiki-foreground)">&gt;, bump</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u8</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Explicitly derive the PDA using create_program_address and a user-provided bump</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> seeds</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-function)">u8</span><span style="color:var(--shiki-foreground)">]] </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-string-expression)">b"profile"</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">user_id</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_le_bytes</span><span style="color:var(--shiki-foreground)">(),</span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">[bump]];</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> (derived_address, _bump) </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">create_program_address</span><span style="color:var(--shiki-foreground)">(seeds, </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">program_id)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-foreground)"> derived_address </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">profile</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">() {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InvalidSeeds</span><span style="color:var(--shiki-foreground)">);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> profile_pda </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">profile;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;profile_pda</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">user_id </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> user_id;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;profile_pda</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">attributes </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> attributes;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> CreateProfile</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> user</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;/// The profile account, expected to be a PDA derived with the user_id and a user-provided bump seed</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> profile</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">UserProfile</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> system_program</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Program</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">System</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> UserProfile</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> user_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> attributes</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Vec</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">u8</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>In this scenario, the program derives a <code>UserProfile</code><strong> </strong>PDA using <code>create_program_address</code><strong> </strong>with seeds that include a user-provided bump. Using a user-provided bump is problematic because it fails to ensure the use of the canonical bump. This would allow a malicious actor to create multiple PDAs with different bumps for the same user ID.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate this issue, we can refactor our example to derive PDAs using <code>find_program_address</code><strong> </strong>and validate the bump seed explicitly:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> create_profile</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">CreateProfile</span><span style="color:var(--shiki-foreground)">&gt;, user_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">, attributes</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Vec</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">u8</span><span style="color:var(--shiki-foreground)">&gt;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Securely derive the PDA using find_program_address to ensure the canonical bump is used</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> seeds</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-function)">u8</span><span style="color:var(--shiki-foreground)">]] </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-string-expression)">b"profile"</span><span style="color:var(--shiki-foreground)">, user_id</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_le_bytes</span><span style="color:var(--shiki-foreground)">()];</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> (derived_address, bump) </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">find_program_address</span><span style="color:var(--shiki-foreground)">(seeds, </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">program_id);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Store the canonical bump in the profile for future validations</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> profile_pda </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">profile;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;profile_pda</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">user_id </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> user_id;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;profile_pda</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">attributes </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> attributes;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;profile_pda</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">bump </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> bump;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[instruction(user_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> CreateProfile</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;init, </span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;payer </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> user, </span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;space </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> 8 </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-foreground)"> 1024 </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-foreground)"> 1, </span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-string-expression)">b"profile"</span><span style="color:var(--shiki-foreground)">, user_id</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">to_le_bytes()</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">as_ref()], </span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;bump</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> profile</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">UserProfile</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> user</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> system_program</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Program</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">System</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> UserProfile</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> user_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> attributes</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Vec</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">u8</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> bump</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u8</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>Here, <code>find_program_address</code><strong> </strong>is used to derive the PDA with the canonical bump seed to ensure a deterministic and secure PDA creation. The canonical bump is stored in the <strong>UserProfile </strong>account, allowing for efficient and secure validation in subsequent operations. We prefer <code>find_program_address</code><strong> </strong>over <code>create_program_address</code><strong> </strong>because the latter creates a valid PDA <em>without searching for a bump seed</em>. Because it doesn't search for a bump seed, it may unpredictably return an error for any given set of seeds and is not generally suitable for creating PDAs. <code>find_program_address</code><strong> </strong>will <em>always</em> use the canonical bump when creating a PDA. This is because it iterates through various <code>create_program_address</code><strong> </strong>calls, starting with a bump of 255 and decrementing with each iteration. Once a valid address is found, the function returns the derived PDA and the canonical bump used to derive it.</p><div class="mx-auto w-full mb-4"><div role="alert" class="relative w-full rounded-lg p-4 [&amp;&gt;svg~*]:pl-7 [&amp;&gt;svg+div]:translate-y-[-3px] [&amp;&gt;svg]:absolute [&amp;&gt;svg]:left-4 [&amp;&gt;svg]:top-4 bg-gray-900 text-gray-300 [&amp;_p]:text-gray-400"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" class="h-5 w-5"><path fill-rule="evenodd" clip-rule="evenodd" d="M9 1.5a7.5 7.5 0 1 0 0 15 7.5 7.5 0 0 0 0-15ZM7.5 8.25a.75.75 0 0 1 .75-.75H9a.75.75 0 0 1 .75.75V12a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1-.75-.75Zm1.5-3a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Z" fill="currentColor"></path></svg><h5 class="mb-1 text-base font-medium leading-none tracking-tight">Note:</h5><div class="text-base [&amp;_p]:leading-relaxed [&amp;_a]:text-primary [&amp;_a]:underline [&amp;_a]:hover:text-primary-lightest"><div class="max-w-none prose sm:prose-md lg:prose-md"><p>Anchor enforces the canonical bump for PDA derivations through its <strong>seeds </strong>and <strong>bump </strong>constraints, streamlining this entire process to ensure secure and deterministic PDA creation and validation.</p></div></div></div></div><h2 id="closing-accounts"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#closing-accounts">Closing Accounts<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Improperly closing accounts in a program can lead to several vulnerabilities, including the potential for "closed" accounts to be reinitialized or misused. The issue arises from a failure to properly mark an account as closed or failing to prevent its reuse in subsequent transactions. This oversight can allow malicious actors to exploit a given account, leading to unauthorized action or access within the program.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a program that allows users to create and close data storage accounts. The program closes an account by transferring out its lamports:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> close_account</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">CloseAccount</span><span style="color:var(--shiki-foreground)">&gt;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> account </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">data_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_account_info</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> destination </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">destination</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_account_info</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;**</span><span style="color:var(--shiki-foreground)">destination</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">lamports</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow_mut</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> destination</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">lamports</span><span style="color:var(--shiki-foreground)">()</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">checked_add</span><span style="color:var(--shiki-foreground)">(account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">lamports</span><span style="color:var(--shiki-foreground)">())</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">unwrap</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;**</span><span style="color:var(--shiki-foreground)">account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">lamports</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow_mut</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-constant)"> 0</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> CloseAccount</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> data_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">Data</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> Data</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;data</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>This is problematic as the program fails to zero out the account's data or mark it as closed. Merely transferring out its remaining lamports does not close the account.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate this issue, not only should the program transfer out all lamposts, it should also zero out the account's data and mark it with a discriminator (i.e., <strong>"CLOSED_ACCOUNT_DISCRIMINATOR"</strong>). The program should also implement checks to prevent closed accounts from being reused in future transactions:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">use</span><span style="color:var(--shiki-foreground)"> anchor_lang</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">__private</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">CLOSED_ACCOUNT_DISCRIMINATOR</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">use</span><span style="color:var(--shiki-foreground)"> anchor_lang</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">prelude</span><span style="color:var(--shiki-token-keyword)">::*</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">use</span><span style="color:var(--shiki-foreground)"> std</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">io</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">Cursor</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">use</span><span style="color:var(--shiki-foreground)"> std</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">ops</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">DerefMut</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// Other code</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> close_account</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">CloseAccount</span><span style="color:var(--shiki-foreground)">&gt;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> account </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">data_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_account_info</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> destination </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">destination</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_account_info</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;**</span><span style="color:var(--shiki-foreground)">destination</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">lamports</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow_mut</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> destination</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">lamports</span><span style="color:var(--shiki-foreground)">()</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">checked_add</span><span style="color:var(--shiki-foreground)">(account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">lamports</span><span style="color:var(--shiki-foreground)">())</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">unwrap</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;**</span><span style="color:var(--shiki-foreground)">account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">lamports</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow_mut</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-constant)"> 0</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Zero out the account data</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-token-keyword)"> mut</span><span style="color:var(--shiki-foreground)"> data </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">try_borrow_mut_data</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;for</span><span style="color:var(--shiki-foreground)"> byte </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-foreground)"> data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">deref_mut</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">iter_mut</span><span style="color:var(--shiki-foreground)">() {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;*</span><span style="color:var(--shiki-foreground)">byte </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-constant)"> 0</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Mark the account as closed</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> dst</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-function)">u8</span><span style="color:var(--shiki-foreground)">] </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> data;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-token-keyword)"> mut</span><span style="color:var(--shiki-foreground)"> cursor </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> Cursor</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">new</span><span style="color:var(--shiki-foreground)">(dst);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;cursor</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">write_all</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">CLOSED_ACCOUNT_DISCRIMINATOR)</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">unwrap</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> force_defund</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">ForceDefund</span><span style="color:var(--shiki-foreground)">&gt;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> account </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">account;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> data </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">try_borrow_data</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-foreground)"> data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">len</span><span style="color:var(--shiki-foreground)">() &lt; </span><span style="color:var(--shiki-token-constant)">8</span><span style="color:var(--shiki-token-keyword)"> ||</span><span style="color:var(--shiki-foreground)"> data[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-token-keyword)">..</span><span style="color:var(--shiki-token-constant)">8</span><span style="color:var(--shiki-foreground)">] </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-foreground)"> CLOSED_ACCOUNT_DISCRIMINATOR {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InvalidAccountData</span><span style="color:var(--shiki-foreground)">);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> destination </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">destination</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">to_account_info</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;**</span><span style="color:var(--shiki-foreground)">destination</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">lamports</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow_mut</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> destination</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">lamports</span><span style="color:var(--shiki-foreground)">()</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">checked_add</span><span style="color:var(--shiki-foreground)">(account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">lamports</span><span style="color:var(--shiki-foreground)">())</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">unwrap</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;**</span><span style="color:var(--shiki-foreground)">account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">lamports</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow_mut</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-constant)"> 0</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> ForceDefund</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> CloseAccount</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> data_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">Data</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> Data</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;data</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>However, zeroing out the data and adding the closed discriminator is not enough. A user can keep an account from being garbage collected by refunding the account's lamports before the end of an instruction. This will put the account in a weird limbo state where it cannot be used or garbage collected. Thus, we added a <strong>force_defund </strong>function to address this edge case; now anyone can defund closed accounts.</p><p>Anchor simplifies this process with the <strong>#[account(close = destination)]</strong> constraint, automating the secure closure of accounts by transferring lamports, zeroing data, and setting the closed account discriminator, all in one operation.</p><h2 id="duplicate-mutable-accounts"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#duplicate-mutable-accounts">Duplicate Mutable Accounts<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Duplicate mutable accounts refers to a scenario where the same account is passed more than once as a mutable parameter to an instruction. This occurs when an instruction requires two mutable accounts of the same type. A malicious actor could pass in the same account twice, causing the account to be mutated in unintended ways (e.g., overwriting data). The severity of this vulnerability varies based on the specific scenario.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a program designed to reward users based on their participation in a certain on-chain activity. The program has an instruction to update the balance of two accounts: a reward account and a bonus account. A user should receive a standard reward in one account and a potential bonus in another account based on specific predetermined criteria:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> distribute_rewards</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">DistributeRewards</span><span style="color:var(--shiki-foreground)">&gt;, reward_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">, bonus_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> reward_account </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">reward_account;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> bonus_reward </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">bonus_account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Intended to increment the reward and bonus accounts separately</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;reward_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">balance </span><span style="color:var(--shiki-token-keyword)">+=</span><span style="color:var(--shiki-foreground)"> reward_amount;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;bonus_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">balance </span><span style="color:var(--shiki-token-keyword)">+=</span><span style="color:var(--shiki-foreground)"> bonus_amount;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> DistributeRewards</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;reward_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">RewardAccount</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;bonus_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">RewardAccount</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> RewardAccount</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> balance</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>If a malicious actor passes the same account for <strong>reward_account </strong>and <strong>bonus_account</strong>, the account's balance will be incorrectly updated twice.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate this issue, add a check within the instruction logic to verify that the public keys of the two accounts are not identical:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> distribute_rewards</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">DistributeRewards</span><span style="color:var(--shiki-foreground)">&gt;, reward_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">, bonus_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">reward_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">bonus_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">() {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InvalidArgument</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">into</span><span style="color:var(--shiki-foreground)">())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> reward_account </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">reward_account;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> bonus_reward </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">bonus_account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Intended to increment the reward and bonus accounts separately</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;reward_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">balance </span><span style="color:var(--shiki-token-keyword)">+=</span><span style="color:var(--shiki-foreground)"> reward_amount;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;bonus_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">balance </span><span style="color:var(--shiki-token-keyword)">+=</span><span style="color:var(--shiki-foreground)"> bonus_amount;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>Developers can use Anchor's account constraints to add a more explicit check on the account. This can be done using the <strong>#[account]</strong> attribute and the <strong>constraint</strong> keyword:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> distribute_rewards</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">DistributeRewards</span><span style="color:var(--shiki-foreground)">&gt;, reward_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">, bonus_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> reward_account </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">reward_account;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> bonus_reward </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">bonus_account;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Intended to increment the reward and bonus accounts separately</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;reward_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">balance </span><span style="color:var(--shiki-token-keyword)">+=</span><span style="color:var(--shiki-foreground)"> reward_amount;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;bonus_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">balance </span><span style="color:var(--shiki-token-keyword)">+=</span><span style="color:var(--shiki-foreground)"> bonus_amount;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> DistributeRewards</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;mut</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;constraint </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> reward_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">key() </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-foreground)"> bonus_account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">key()</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;reward_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">RewardAccount</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;bonus_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">RewardAccount</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> RewardAccount</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> balance</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><h2 id="frontrunning"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#frontrunning">Frontrunning<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>With the rising popularity of transaction bundlers, frontrunning is a concern that should be taken seriously by protocols built on Solana. <a class="" href="https://x.com/jito_labs/status/1766228889888514501?s=20">With the removal of Jito’s mempool</a>, we refer to frontrunning here as a malicious actor’s ability to manipulate expected versus actual values through carefully constructed transactions.&nbsp;</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Imagine a protocol that handles purchasing and bidding for a product, storing the seller's pricing information in an account named <strong>SellInfo</strong>:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> SellProduct</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;product_listing</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">ProductListing</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;sale_token_mint</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">Mint</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;sale_token_destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">TokenAccount</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;product_owner</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;purchaser_token_source</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">TokenAccount</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;product</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;info, </span><span style="color:var(--shiki-token-function)">Product</span><span style="color:var(--shiki-foreground)">&gt;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> PurchaseProduct</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;product_listing</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">ProductListing</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;token_destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">TokenAccount</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;token_source</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">TokenAccount</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;buyer</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;product_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">Product</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;token_mint_sale</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">Mint</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> ProductListing</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;sale_price</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;token_mint</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;destination_token_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;product_owner</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;product</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>To purchase a <strong>Product </strong>listed, a buyer must pass in the <strong>ProductListing </strong>account related to the product they want. But what if the seller can change the <strong>sale_price </strong>of their listing?</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> change_sale_price</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">ChangeSalePrice</span><span style="color:var(--shiki-foreground)">&gt;, new_price</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span><span style="color:var(--shiki-token-keyword)">...</span><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>This would introduce a frontrunning opportunity for the seller, especially if the buyer's purchasing transaction doesn't include <code>expected_price</code><strong> </strong>checks to ensure they are paying no more than expected for the product they want. If the purchaser submits a transaction to buy the given Product<strong> </strong>is would be possible for the seller to call <code>change_sale_price</code>, and, using Jito, ensure this transaction is included before the purchaser's transaction. A malicious seller could change the price in the <strong>ProductListing </strong>account to an exorbitant amount, unbeknownst to the purchaser, forcing them to pay much more than expected for the <code>Product!</code></p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>A simple solution would be including <strong>expected_price </strong>checks on the purchasing side of the deal, preventing the buyer from paying more than expected for the <strong>Product </strong>they want to buy:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> purchase_product</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">PurchaseProduct</span><span style="color:var(--shiki-foreground)">&gt;, expected_price</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp;assert!</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">product_listing</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">sale_price </span><span style="color:var(--shiki-token-keyword)">&lt;=</span><span style="color:var(--shiki-foreground)"> expected_price);</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp;...</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><h2 id="insecure-initialization"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#insecure-initialization">Insecure Initialization<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><p>Unlike contracts deployed to the EVM, Solana programs are not deployed with a constructor to set state variables. Instead, they are initialized manually (normally by a function called <strong>initialize </strong>or something similar). Initialization functions typically set data such as the program’s authority or create accounts that form the base of the program being deployed (i.e., a central state account or something of the sort).</p><p>Since the initialization function is called manually, and not automatically on program deployment, this instruction must be called by a known address under the control of the program’s development team. Otherwise, it is possible for an attacker to frontrun initialization, possibly setting up the program using accounts under the attacker's control.</p><p>A common practice is to use the program’s <strong>upgrade_authority </strong>as the authorized address to call the <strong>initialize </strong>function, if the program has an upgrade authority.</p><h3 id="insecure-example-and-how-to-mitigate"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#insecure-example-and-how-to-mitigate">Insecure Example and How to Mitigate<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> initialize</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">Initialize</span><span style="color:var(--shiki-foreground)">&gt;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">central_state</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">authority </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> authority</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">key</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp;...</span><span style="color:var(--shiki-foreground)"> &nbsp;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> Initialize</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;authority</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;init,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;payer </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> authority,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;space </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> CentralState</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">SIZE</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-string-expression)">b"central_state"</span><span style="color:var(--shiki-foreground)">],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;bump</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;central_state</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">CentralState</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp;...</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> CentralState</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp;authority</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp;...</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>The example above is a stripped-down initialize function that sets the authority of a <strong>CentralState </strong>account for the instruction caller. However, this could be any account that calls initialize! As previously mentioned, a common way to secure an initialization function is to use the program’s <strong>upgrade_authority</strong>, known at deployment.</p><p><a class="" rel="noopener noreferrer" target="_blank" href="https://docs.rs/anchor-lang/latest/anchor_lang/accounts/account/struct.Account.html#example-1">Below is an example from the Anchor documentation</a>, which uses constraint to ensure only the program's upgrade authority can call initialize:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">use</span><span style="color:var(--shiki-foreground)"> anchor_lang</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">prelude</span><span style="color:var(--shiki-token-keyword)">::*</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">use</span><span style="color:var(--shiki-token-keyword)"> crate::</span><span style="color:var(--shiki-foreground)">program</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">MyProgram</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)">declare_id!</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">"Cum9tTyj5HwcEiAmhgaS7Bbj4UczCwsucrCkxRECzM4e"</span><span style="color:var(--shiki-foreground)">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[program]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> mod</span><span style="color:var(--shiki-foreground)"> my_program {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;use</span><span style="color:var(--shiki-foreground)"> super</span><span style="color:var(--shiki-token-keyword)">::*</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> set_initial_admin</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">SetInitialAdmin</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;admin_key</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin_settings</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin_key </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> admin_key;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp; &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> set_admin</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-keyword)">...</span><span style="color:var(--shiki-foreground)">){</span><span style="color:var(--shiki-token-keyword)">...</span><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> set_settings</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-keyword)">...</span><span style="color:var(--shiki-foreground)">){</span><span style="color:var(--shiki-token-keyword)">...</span><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Default</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">Debug</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> AdminSettings</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;admin_key</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> SetInitialAdmin</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(init, payer </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> authority, seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-string-expression)">b"admin"</span><span style="color:var(--shiki-foreground)">], bump)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> admin_settings</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">AdminSettings</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> authority</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(constraint </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> program</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">programdata_address()</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-token-keyword)"> ==</span><span style="color:var(--shiki-token-function)"> Some</span><span style="color:var(--shiki-foreground)">(program_data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">key()))]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> program</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Program</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">MyProgram</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(constraint </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> program_data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">upgrade_authority_address </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-token-function)"> Some</span><span style="color:var(--shiki-foreground)">(authority</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">key()))]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> program_data</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">ProgramData</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> system_program</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Program</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">System</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><h2 id="loss-of-precision"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#loss-of-precision">Loss of Precision<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Loss of precision, albeit minuscule in appearance, can pose a significant threat to a program. It can lead to incorrect calculations, arbitrage opportunities, and unexpected program behavior.</p><p>Precision loss in arithmetic operations is a common source of errors. With Solana programs, fixed-point arithmetic is recommended whenever possible. This is because programs only support a<a class="" rel="noopener noreferrer" target="_blank" href="https://solana.com/docs/programs/limitations#float-rust-types-support"> limited subset of Rust's float operations</a>. If a program attempts to use an unsupported float operation, the runtime will return an unresolved symbol error. Additionally, float operations require more instructions compared to their integer equivalents. The use of fixed-point arithmetic and the need to handle large numbers of tokens and fractional amounts accurately can exacerbate precision loss.</p><h3 id="multiplication-after-division"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#multiplication-after-division">Multiplication After Division<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>While the<a class="" rel="noopener noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Associative_property"> associative property</a> holds for most mathematical operations, its application in computer arithmetic can lead to unexpected precision loss. A classic example of precision loss occurs when performing multiplication after division, which can yield different results from performing multiplication before division. For example, consider the following expressions: <strong>(a / c) * b</strong> and <strong>(a * b) / c</strong>. Mathematically, these expressions are associative - they <em>should</em> yield the same result. However, in the context of Solana and fixed-point arithmetic, the order of operations matters significantly. Performing division first <strong>(a / c)</strong> may result in a loss of precision if the quotient is rounded down before it's multiplied by <strong>b</strong>. This could result in a smaller result than expected. Conversely, multiplying <strong>(a * b)</strong> before dividing by <strong>c</strong> could preserve more of the original precision. This difference can lead to incorrect calculations, creating unexpected program behavior and/or arbitrage opportunities.</p><h3 id="saturating_-"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#saturating_-"><strong>saturating_* </strong>Arithmetic Functions<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>While <strong>saturating_*</strong> arithmetic functions prevent overflow and underflow by capping values at their maximum or minimum possible values, they can lead to subtle bugs and precision loss if this cap is reached unexpectedly. This occurs when the program's logic assumes that saturation alone will guarantee an accurate result and ignores handling the potential loss of precision or accuracy.</p><p>For example, imagine a program designed to calculate and distribute rewards to users based on the amount of tokens they trade within a specific period:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> calculate_reward</span><span style="color:var(--shiki-foreground)">(transaction_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">, reward_multiplier</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;transaction_amount</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">saturating_mul</span><span style="color:var(--shiki-foreground)">(reward_multiplier)</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>Consider the scenario where the <code>transaction_amount</code> is 100,000 tokens, and the <code>reward_multiplier</code> is 100 tokens per transaction. Multiplying the two will exceed the maximum value a <strong>u64</strong> can hold. This means their product will be capped, leading to a substantial loss of precision by under-rewarding the user.</p><h3 id="rounding-errors"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#rounding-errors">Rounding Errors<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Rounding operations are a common loss of precision in programming. The choice of rounding method can significantly impact the accuracy of calculations and the behavior of Solana programs. The <strong>try_round_u64()</strong> function rounds decimal values to the nearest whole number. Rounding up is problematic as it can artificially inflate values, leading to discrepancies between the actual and expected calculations.</p><p>Consider a Solana program that converts collateral into liquidity based on market conditions. The program uses <strong>try_round_u64()</strong> to round the result of a division operation:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> collateral_to_liquidity</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">self, collateral_amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">u64</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Decimal</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">from</span><span style="color:var(--shiki-foreground)">(collateral_amount)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">try_div</span><span style="color:var(--shiki-foreground)">(self</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-foreground)">)</span><span style="color:var(--shiki-token-keyword)">?</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;.</span><span style="color:var(--shiki-token-function)">try_round_u64</span><span style="color:var(--shiki-foreground)">()</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>In this scenario, rounding up can lead to issuing more liquidity tokens than the collateral amount justifies. Malicious actors can exploit this discrepancy to perform arbitrage attacks to extract value from the protocol via favorably influenced rounding outcomes. To mitigate, use <strong>try_floor_u64</strong> to round down to the nearest whole number. This approach minimizes the risk of artificially inflating values and ensures that any rounding does not give the user an advantage at the expense of the system. Alternatively, implement logic to handle scenarios where rounding could explicitly impact the outcome. This might include setting specific thresholds for rounding decisions or applying different logic based on the size of the values involved.</p><h2 id="missing-ownership-check"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#missing-ownership-check">Missing Ownership Check<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Ownership checks are crucial to validate that the expected program owns an account involved in a transaction or operation. Accounts include an<a class="" rel="noopener noreferrer" target="_blank" href="https://docs.rs/crate/solana-program/latest"> <strong>owner</strong></a> field, which indicates the program with the authority to write to the account's data. This field ensures that only authorized programs can modify an account's state. Moreover, this field is useful for ensuring that accounts passed into an instruction are owned by the expected program. Missing ownership checks can lead to severe vulnerabilities, including unauthorized fund transfers and the execution of privileged operations.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a program function defined to allow admin-only withdrawals from a vault. The function takes in a configuration account (i.e., <strong>config</strong>) and uses its <strong>admin </strong>field to check whether the provided admin account's public key is the same as the one stored in the <strong>config </strong>account. However, it fails to verify the <strong>config</strong> account's ownership, assuming it is trustworthy:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> admin_token_withdraw</span><span style="color:var(--shiki-foreground)">(program_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-token-function)">Pubkey</span><span style="color:var(--shiki-foreground)">, accounts</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-function)">AccountInfo</span><span style="color:var(--shiki-foreground)">], amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Account setup</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-foreground)"> config</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-foreground)"> admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">pubkey</span><span style="color:var(--shiki-foreground)">() {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InvalidAdminAccount</span><span style="color:var(--shiki-foreground)">)</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Transfer funds logic</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>A malicious actor could exploit this by supplying a <strong>config </strong>account they control with a matching <strong>admin </strong>field, effectively tricking the program into executing the withdrawal.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate this, perform an ownership check that verifies the <strong>owner </strong>field of the account:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> admin_token_withdraw</span><span style="color:var(--shiki-foreground)">(program_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-token-function)">Pubkey</span><span style="color:var(--shiki-foreground)">, accounts</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-function)">AccountInfo</span><span style="color:var(--shiki-foreground)">], amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Account setup</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-foreground)"> config</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-foreground)"> admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">pubkey</span><span style="color:var(--shiki-foreground)">() {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InvalidAdminAccount</span><span style="color:var(--shiki-foreground)">)</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-foreground)"> config</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">owner </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-foreground)"> program_id {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InvalidConfigAccount</span><span style="color:var(--shiki-foreground)">)</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Transfer funds logic</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>Anchor streamlines this check with the <strong>Account </strong>type. <strong>Account&lt;'info, T&gt;</strong> is a wrapper around <strong>AccountInfo</strong>, which verifies program ownership and deserializes the underlying data into <strong>T</strong> (i.e., the specified account type). This allows developers to use <strong>Account&lt;'info, T&gt;</strong> to validate account ownership easily. Developers can also use the <strong>#[account]</strong> attribute to add the<a class="" rel="noopener noreferrer" target="_blank" href="https://docs.rs/anchor-lang/latest/anchor_lang/trait.Owner.html"> <strong>Owner</strong></a><strong> </strong>trait to a given account. This trait defines an address expected to own the account. In addition, developers can use the <strong>owner </strong>constraint to define the program that should own a given account if it's different from the currently executing one. This is useful, for example, when writing an instruction that expects an account to be a PDA derived from a different program. The <strong>owner </strong>constraint is defined as <strong>#[account(owner = &lt;expr&gt;)]</strong>, where <strong>&lt;expr&gt;</strong> is an arbitrary expression.</p><h3 id="read-only-accounts"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#read-only-accounts">Read-Only Accounts<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>It's equally important to verify the validity of accounts specified as read-only within a program's execution context. This is crucial because a malicious actor could pass accounts with arbitrary or crafted data instead of legitimate accounts. This could lead to unexpected or harmful program behavior. Developers should still perform checks to ensure that accounts a program needs to read from are genuine and not tampered with. This could involve verifying the account's address against known values or confirming the account's owner is as expected, especially for sysvars (i.e., read-only system accounts, such as <strong>Clock </strong>or <strong>EpochSchedule</strong>). Access sysvars using the <strong>get()</strong> method, which doesn't require any manual address or ownership checks. This is a safer approach to accessing these accounts; however, not all sysvars support the <strong>get()</strong> method. In this case, access them using their public address.</p><h2 id="missing-signer-check"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#missing-signer-check">Missing Signer Check<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Transactions are signed with a wallet's private key to ensure authentication, integrity, non-repudiation, and the authorization of a specific transaction by a specific wallet. By requiring transactions to be signed with the sender's private key, Solana's runtime can verify that the proper account initiates a transaction and has not been tampered with. This mechanism underpins the trustless nature of decentralized networks. Without this verification, any account that supplies the correct account as an argument can execute a transaction. This could lead to unauthorized access to privileged information, funds, or functionality. This vulnerability arises from failing to validate whether an operation is signed by the appropriate account's private key before executing certain privileged functionality.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Take the following function:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> update_admin</span><span style="color:var(--shiki-foreground)">(program_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-token-function)">Pubkey</span><span style="color:var(--shiki-foreground)">, accounts </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-function)">AccountInfo</span><span style="color:var(--shiki-foreground)">]) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> account_iter </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">iter</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> config </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> ConfigAccount</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">unpack</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">next_account_info</span><span style="color:var(--shiki-foreground)">(account_iter)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> admin </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> next_account_info</span><span style="color:var(--shiki-foreground)">(account_iter)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> new_admin </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> next_account_info (account_iter)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-foreground)"> admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">pubkey</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-foreground)"> config</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InvalidAdminAccount</span><span style="color:var(--shiki-foreground)">);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;config</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> new_admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">pubkey</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>This function intends to update the program's admin. It includes a check to ensure that the current admin initiates the operation, which is good access control. However, the function fails to verify that the current admin's private key signed the transaction. Thus, anyone calling this function can pass the proper <strong>admin </strong>account such that <strong>admin.pubkey() = config.admin</strong>, irrespective of whether the account calling this function is actually the current admin. This allows a malicious actor to execute the instruction with their account passed in as the new admin, directly bypassing the need for the current admin's authorization.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Programs must include checks to verify that an account has been signed by the appropriate wallet. This can be done by checking the<a class="" rel="noopener noreferrer" target="_blank" href="https://docs.rs/solana-program/latest/solana_program/account_info/struct.AccountInfo.html#structfield.is_signer"> <strong>AccountInfo::is_signer</strong></a> field of the accounts involved in the transaction. The program can enforce that only authorized accounts can perform certain actions by checking whether the account executing the privileged operation has the <strong>is_signer </strong>flag set to <strong>true</strong>.</p><p>The updated code example would look like this:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> update_admin</span><span style="color:var(--shiki-foreground)">(program_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-token-function)">Pubkey</span><span style="color:var(--shiki-foreground)">, accounts </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-function)">AccountInfo</span><span style="color:var(--shiki-foreground)">]) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> account_iter </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">iter</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> config </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> ConfigAccount</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">unpack</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">next_account_info</span><span style="color:var(--shiki-foreground)">(account_iter)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> admin </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> next_account_info</span><span style="color:var(--shiki-foreground)">(account_iter)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> new_admin </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> next_account_info (account_iter)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-foreground)"> admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">pubkey</span><span style="color:var(--shiki-foreground)">() </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-foreground)"> config</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InvalidAdminAccount</span><span style="color:var(--shiki-foreground)">);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Add in a check for the admin's signature</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-token-keyword)"> !</span><span style="color:var(--shiki-foreground)">admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">is_signer {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">NotSigner</span><span style="color:var(--shiki-foreground)">);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;config</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">admin </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> new_admin</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">pubkey</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>Anchor streamlines this entire process with the <a class="" rel="noopener noreferrer" target="_blank" href="https://docs.rs/anchor-lang/latest/anchor_lang/accounts/signer/struct.Signer.html"><strong>Signer&lt;’info&gt;</strong> account type</a>.</p><h2 id="overflow-and-underflow"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#overflow-and-underflow">Overflow and Underflow<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>An integer is a number without a fractional component. Rust stores integers as fixed-size variables. These variables are defined by their<a class="" rel="noopener noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Signedness"> signedness</a> (i.e., signed or unsigned) and the amount of space they occupy in memory. For example, the <strong>u8</strong> type denotes an unsigned integer that occupies 8 bits of space. It's capable of holding values from 0 to 255. Storing a value outside of that range would result in an integer overflow or underflow. An integer overflow is when a variable exceeds its maximum capacity and wraps around to its minimum value. An integer underflow is when a variable drops below its minimum capacity and wraps around to its maximum value.</p><p>Rust includes checks for integer overflows and underflows when compiling in debug mode. These checks will cause the program to <em>panic</em> at runtime if such a condition is detected. However, Rust does not include checks that panic for integer overflows and underflows when compiling in release mode with the <strong>--release</strong> flag. This behavior can introduce subtle vulnerabilities as the overflow or underflow occurs silently. The<a class="" rel="noopener noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Signedness"> Berkley Packet Filter (BPF)</a> toolchain is integral to Solana's development environment as it compiles Solana programs. The <strong>cargo build-bpf</strong> command compiles Rust projects into BPF bytecode for deployment. <em>The issue with this is that it compiles programs in release mode by default</em>. Thus, Solana programs are vulnerable to integer overflows and underflows.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>An attacker can exploit this vulnerability by taking advantage of the silent overflow/underflow behavior in release mode, especially functions that handle token balances. Take the following example:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> process_instruction</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;_program_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;accounts</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-token-function)">AccountInfo</span><span style="color:var(--shiki-foreground)">],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;_instruction_data</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-function)">u8</span><span style="color:var(--shiki-foreground)">],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> account_info_iter </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">iter</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> account </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> next_account_info</span><span style="color:var(--shiki-foreground)">(account_info_iter)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-token-keyword)"> mut</span><span style="color:var(--shiki-foreground)"> balance</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u8</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-foreground)"> account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow</span><span style="color:var(--shiki-foreground)">()[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-foreground)">];</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> tokens_to_subtract</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u8</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-constant)"> 100</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;balance </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> balance </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-foreground)"> tokens_to_subtract;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow_mut</span><span style="color:var(--shiki-foreground)">()[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-foreground)">] </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> balance;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;msg!</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">"Updated balance to {}"</span><span style="color:var(--shiki-foreground)">, balance);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>This function assumes the balance is stored in the first byte for simplicity. It takes the account's balance and subtracts <strong>tokens_to_subtract </strong>from it. If the user's balance is less than <strong>tokens_to_subtract</strong>, it'll cause an underflow. For example, a user with 10 tokens would underflow to a total balance of 165 tokens</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><h4 id="overflow-checks"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#overflow-checks"><strong>overflow-checks</strong><svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h4><p>The easiest way to mitigate this vulnerability is to set the key <strong>overflow-checks</strong> to <strong>true </strong>in the project's <strong>Cargo.toml</strong> file. Here, Rust will add overflow and underflow checks in the compiler. However, adding overflow and underflow checks increases the<a class="" rel="noopener noreferrer" target="_blank" href="https://solana.com/docs/core/runtime#compute-budget"> compute cost</a> of a transaction. In cases where compute needs to be optimized for, it may be more beneficial to set <strong>overflow-checks</strong> to <strong>false</strong>.</p><h4 id="checked_-"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#checked_-"><strong>checked_* </strong>Arithmetic<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h4><p>Use Rust's <strong>checked_*</strong> arithmetic functions on each integer type to strategically check for overflows and underflows throughout your program. These functions will return <strong>None </strong>if an overflow or underflow occurs. This allows the program to handle the error gracefully. For example, you could refactor the previous code to:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> process_instruction</span><span style="color:var(--shiki-foreground)">(</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;_program_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;accounts</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-token-function)">AccountInfo</span><span style="color:var(--shiki-foreground)">],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;_instruction_data</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">[</span><span style="color:var(--shiki-token-function)">u8</span><span style="color:var(--shiki-foreground)">],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> account_info_iter </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;mut</span><span style="color:var(--shiki-foreground)"> accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">iter</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> account </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> next_account_info</span><span style="color:var(--shiki-foreground)">(account_info_iter)</span><span style="color:var(--shiki-token-keyword)">?</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-token-keyword)"> mut</span><span style="color:var(--shiki-foreground)"> balance</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u8</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-foreground)"> account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow</span><span style="color:var(--shiki-foreground)">()[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-foreground)">];</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> tokens_to_subtract</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u8</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-constant)"> 100</span><span style="color:var(--shiki-foreground)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;match</span><span style="color:var(--shiki-foreground)"> balance</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">checked_sub</span><span style="color:var(--shiki-foreground)">(tokens_to_subtract) {</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp; &nbsp; &nbsp;Some</span><span style="color:var(--shiki-foreground)">(new_balance) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;account</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow_mut</span><span style="color:var(--shiki-foreground)">()[</span><span style="color:var(--shiki-token-constant)">0</span><span style="color:var(--shiki-foreground)">] </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> new_balance;</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;msg!</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">"Updated balance to {}"</span><span style="color:var(--shiki-foreground)">, new_balance);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;},</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp; &nbsp; &nbsp;None</span><span style="color:var(--shiki-token-keyword)"> =&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramErrorr</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InsufficientFunds</span><span style="color:var(--shiki-foreground)">);</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>In the revised example, <strong>checked_sub </strong>is used to subtract <strong>tokens_to_subtract </strong>from <strong>balance</strong>. Thus, if <strong>balance </strong>is sufficient to cover the subtraction, <strong>checked_sub </strong>will return <strong>Some(new_balance)</strong>. The program continues to update the account's balance safely and logs it. However, if the subtraction would result in an underflow, <strong>checked_sub </strong>returns <strong>None</strong>, which we can handle by returning an error.</p><h4 id="checked-math-macro"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#checked-math-macro">Checked Math Macro<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h4><p><a class="" rel="noopener noreferrer" target="_blank" href="https://github.com/blockworks-foundation/checked-math">Checked Math</a> is a<a class="" rel="noopener noreferrer" target="_blank" href="https://doc.rust-lang.org/book/ch19-06-macros.html#procedural-macros-for-generating-code-from-attributes"> procedural macro</a> for changing the properties for checking mathematical expressions without altering those expressions, for the most part. The issue with <strong>checked_*</strong> arithmetic functions is the loss of mathematical notation. Instead, cumbersome methods like <strong>a.checked_add(b).unwrap()</strong> must be used instead of <strong>a + b</strong>. For example, if we want to write <strong>(x * y) + z</strong> using the checked arithmetic functions, we'd write <strong>x.checked_mul(y).unwrap().checked_add(z).unwrap()</strong>.</p><p>Instead, the following expression would look like this using the Checked Math macro:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">use</span><span style="color:var(--shiki-foreground)"> checked_math</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-foreground)">checked_math </span><span style="color:var(--shiki-token-keyword)">as</span><span style="color:var(--shiki-foreground)"> cm;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)">cm!</span><span style="color:var(--shiki-foreground)">((x </span><span style="color:var(--shiki-token-keyword)">*</span><span style="color:var(--shiki-foreground)"> y) </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-foreground)"> z)</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">unwrap</span><span style="color:var(--shiki-foreground)">()</span></span></code></pre></div></div></div></p><p>This is more convenient to write, preserves the expression's mathematical notation, and only requires one <strong>.unwrap()</strong>. This is because the macro converts normal math expressions into an expression that returns <strong>None </strong>if any of the checked steps return <strong>None</strong>. <strong>Some(_)</strong> is returned, if successful, which is why we unwrap the expression at the end.</p><h3 id="casting"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#casting">Casting<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Similarly, casting between integer types using the <strong>as</strong> keyword without proper checks can introduce an integer overflow or underflow vulnerability. This is because casting can either truncate or extend values in unintended ways. When casting from a larger integer type to a smaller one (e.g., <strong>u64 </strong>to <strong>u32</strong>), Rust will truncate the higher bits of the original value that do not fit into the target type. This is problematic when the original value exceeds the maximum value that the target type can store. When casting from a smaller integer type to a larger one (e.g., <strong>i16 </strong>to <strong>i32</strong>), Rust will extend the value. This is straightforward for unsigned types. However, this can lead to<a class="" rel="noopener noreferrer" target="_blank" href="https://en.wikipedia.org/wiki/Sign_extension"> sign extension</a> with signed integers to introduce unintended negative values.</p><h4 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h4><p>Use Rust's safe casting methods to mitigate this vulnerability. This includes methods such as<a class="" rel="noopener noreferrer" target="_blank" href="https://doc.rust-lang.org/std/convert/trait.TryFrom.html#tymethod.try_from"><strong> try_from</strong></a><strong> </strong>and<a class="" rel="noopener noreferrer" target="_blank" href="https://doc.rust-lang.org/std/convert/trait.From.html#tymethod.from"> <strong>from</strong></a>. Using <strong>try_from </strong>returns a <strong>Result </strong>type, allowing for the explicit handling of cases where the value does not fit into the target type gracefully. Using Rust's <strong>from </strong>method can be used for a safe, implicit conversion for conversions that are guaranteed to be lossless (e.g., <strong>u8 </strong>to <strong>u32</strong>). For example, suppose a program needs to safely convert a <strong>u64 </strong>token amount to a <strong>u32 </strong>type for processing. In that case, it can do the following:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> convert_token_amount</span><span style="color:var(--shiki-foreground)">(amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">u32</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;u32</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">try_from</span><span style="color:var(--shiki-foreground)">(amount)</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">map_err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-keyword)">|</span><span style="color:var(--shiki-foreground)">_</span><span style="color:var(--shiki-token-keyword)">|</span><span style="color:var(--shiki-foreground)"> ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InvalidArgument</span><span style="color:var(--shiki-foreground)">)</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>In this example, if <strong>amount </strong>exceeds the maximum value a <strong>u32 </strong>can hold (i.e., 4 294 967 295), the conversion fails, and the program returns an error. This prevents a potential overflow/underflow from occurring.</p><h2 id="pda-sharing"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#pda-sharing">PDA Sharing<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>PDA sharing is a common vulnerability that arises when the same PDA is used across multiple authority domains or roles. This could allow a malicious actor to access data or funds that do not belong to them via the misuse of PDAs as a signer without the proper access control checks in place.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a program designed to facilitate token staking and distributing rewards. The program uses a single PDA to transfer tokens into a given pool and withdraw rewards. The PDA is derived using a static seed (e.g., the name of the staking pool), making it common across all operations:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> stake_tokens</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">StakeTokens</span><span style="color:var(--shiki-foreground)">&gt;, amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Logic to stake tokens</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> withdraw_rewards</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">WithdrawRewards</span><span style="color:var(--shiki-foreground)">&gt;, amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Logic to withdraw rewards</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> StakeTokens</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;mut</span><span style="color:var(--shiki-foreground)">, </span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-string-expression)">b"staking_pool_pda"</span><span style="color:var(--shiki-foreground)">], </span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;bump</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;staking_pool</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Other staking-related accounts</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> WithdrawRewards</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;mut</span><span style="color:var(--shiki-foreground)">, </span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-string-expression)">b"staking_pool_pda"</span><span style="color:var(--shiki-foreground)">], </span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;bump</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;rewards_pool</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Other rewards withdrawal-related accounts</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>This is problematic as the staking and rewards withdrawal functionalities rely on the same PDA derived from <strong>staking_pool_pda</strong>. This could allow users to manipulate the contract into unauthorized reward withdrawal or staking manipulation.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate against this vulnerability, use distinct PDAs for different functionalities. Ensure that each PDA serves a specific context and is derived using unique, operation-specific seeds:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> stake_tokens</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">StakeTokens</span><span style="color:var(--shiki-foreground)">&gt;, amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Logic to stake tokens</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> withdraw_rewards</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">WithdrawRewards</span><span style="color:var(--shiki-foreground)">&gt;, amount</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Logic to withdraw rewards</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> StakeTokens</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;mut</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-string-expression)">b"staking_pool"</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">staking_pool</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">key()</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">as_ref()],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;bump</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;staking_pool</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Other staking-related accounts</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> WithdrawRewards</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;mut</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-string-expression)">b"rewards_pool"</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">rewards_pool</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">key()</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">as_ref()],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;bump</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;rewards_pool</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Other rewards withdrawal-related accounts</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>In the example above, the PDAs for staking tokens and withdrawing rewards are derived using distinct seeds (<strong>staking_pool</strong> and <strong>rewards_pool</strong>, respectively) combined with the specific account's key. This ensures that the PDAs are uniquely tied to their intended functionalities, mitigating the risk of unauthorized actions.</p><h2 id="remaining-accounts"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#remaining-accounts">Remaining Accounts<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p><strong>ctx.remaining_accounts </strong>provides a way to pass additional accounts into a function that weren’t specified in the <strong>Accounts </strong>struct initially. This gives more flexibility to the developer, allowing them to handle scenarios requiring a dynamic number of accounts (i.e., processing a variable number of users or interacting with different programs. However, this increased flexibility comes with a caveat: accounts passed through <strong>ctx.remaining_accounts </strong>do not undergo the same validation applied to accounts defined in the <strong>Accounts </strong>struct. Because <strong>ctx.remaining_accounts </strong>does not validate the accounts passed in, a malicious actor could exploit this by passing in accounts the program did not intend to interact with, leading to unauthorized actions or access.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a rewards program that uses <strong>ctx.remaining_accounts </strong>to receive user PDAs and calculate rewards dynamically:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> calculate_rewards</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">CalculateRewards</span><span style="color:var(--shiki-foreground)">&gt;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> Result</span><span style="color:var(--shiki-foreground)">&lt;()&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> rewards_account </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">rewards_account;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> authority </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> &amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">authority;</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Iterate over accounts passed in via ctx.remaining_accounts</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;for</span><span style="color:var(--shiki-foreground)"> user_pda_info </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-foreground)"> ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">remaining_accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">iter</span><span style="color:var(--shiki-foreground)">() {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp; &nbsp; &nbsp;// logic to check user activity and calculate rewards</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Logic to distribute calculated rewards</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> CalculateRewards</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> rewards_account</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">RewardsAccount</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> authority </span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[account]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> RewardsAccount</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> total_rewards</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> u64</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Other relevant fields</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>The issue here is that there aren’t any explicit checks to validate the accounts passed in via <strong>ctx.remaining_accounts</strong>, meaning it fails to ensure that only valid and eligible users’ accounts are processed in the rewards calculation and distribution. A malicious actor could, therefore, pass in accounts they do not own, or ones created by themselves, to receive more rewards than they are actually owed.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate this vulnerability, developers should manually verify each account’s validity within the function. This would include checking the account’s owner to ensure it matches an expected user’s and validate any relevant data within the account. By incorporating these manual checks, developers can leverage the flexibility of <strong>ctx.remaining_acocunts </strong>while mitigating the risk of unauthorized access or manipulation.</p><h2 id="rust-specific-errors"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#rust-specific-errors">Rust-Specific Errors<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><p>Rust is the <em>lingua franca</em> of program development on Solana. Developing in Rust brings forth a unique set of challenges and considerations, particularly around unsafe code and Rust-specific errors. Understanding Rust's caveats aids in developing secure, efficient, and reliable programs.</p><h3 id="unsafe-rust"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#unsafe-rust">Unsafe Rust<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Rust is celebrated for its memory safety guarantees, achieved through a strict ownership and borrowing system. However, these guarantees can sometimes hinder, so Rust offers the<a class="" rel="noopener noreferrer" target="_blank" href="https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html"> <strong>unsafe</strong></a> keyword to bypass Safety checks. <strong>unsafe </strong>Rust is used in four primary contexts:</p><ul class="list max-w-[42rem]"><li value="1"><strong>Unsafe Functions</strong>: functions that perform operations that may violate Rust's safety guarantees must be marked with the <strong>unsafe </strong>keyword. For example, <strong>unsafe fn dangerous_function() {}</strong></li><li value="2"><strong>Unsafe Blocks</strong>: blocks of code where unsafe operations are permitted. For example, <strong>unsafe { // Unsafe operations }</strong></li><li value="3"><strong>Unsafe Traits</strong>: traits that imply certain invariants that the compiler can't verify. For example, <strong>unsafe trait BadTrait {}</strong></li><li value="4"><strong>Implementing Unsafe Traits</strong>: implementations of <strong>unsafe </strong>traits must also be marked as <strong>unsafe</strong>. For example, <strong>unsafe impl UnsafeTrait for UnsafeType {}</strong></li></ul><p>Unsafe Rust exists because static analysis is conservative. When the compiler tries to determine if the code upholds a certain set of guarantees, it's better to reject a few instances of valid code than to accept a few instances of invalid code. Although the code might run perfectly fine, the Rust compiler will reject the code if it doesn’t have enough information to be confident in whether it upholds Rust's safety guarantees. Unsafe code allows developers to bypass these checks at their own risk. Moreover, computer hardware is inherently unsafe. Developers must be allowed to do unsafe operations to do low-level programming with Rust.</p><p>With the <strong>unsafe </strong>keyword, developers can:</p><ul class="list max-w-[42rem]"><li value="1"><strong>Dereference Raw Pointers</strong>: enables direct memory access to raw pointers that can point to any memory location, which might not hold valid data</li><li value="2"><strong>Call Unsafe Functions</strong>: these functions may not adhere to Rust's safety guarantees, and can lead to potentially undefined behavior</li><li value="3"><strong>Access Mutable Static Variables</strong>: global mutable state can cause data races</li></ul><p>The best way to mitigate unsafe Rust is to minimize the use of <strong>unsafe </strong>blocks. If <strong>unsafe </strong>code is absolutely necessary, for whatever reason, ensure that it is well-documented, regularly audited, and, if possible, is encapsulated in a safe abstraction that can be provided to the rest of the program.</p><h3 id="panics-and-error-management"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#panics-and-error-management">Panics and Error Management<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>A panic occurs when a Rust program encounters an unrecoverable error and terminates execution. Panics are used for unexpected errors that are not meant to be caught. In the context of Solana programs, a panic can lead to unexpected behavior as the runtime expects programs to handle errors gracefully without crashing.</p><p>When a panic occurs, Rust starts unwinding the stack and cleaning it up as it goes. This returns a stack trace, which includes detailed information on the error involved. This could supply an attacker with information about the underlying file structure. While this doesn't apply to Solana programs directly, the dependencies a program uses could be vulnerable to such an attack. Ensure dependencies are kept up-to-date and use versions that do not contain known vulnerabilities.</p><p>Common panic scenarios include:</p><ul class="list max-w-[42rem]"><li value="1"><strong>Division by Zero</strong>: Rust will panic when attempting to divide by zero. Thus, always check for a zero divisor before performing a division</li><li value="2"><strong>Array Index Out of Bounds</strong>: accessing an array with an index that exceeds its bounds will cause a panic. To mitigate, use methods that return an <strong>Option </strong>type (like <strong>get</strong>) to safely access array elements</li><li value="3"><strong>Unwrapping None Values</strong>: calling <strong>.unwrap()</strong> on an <strong>Option </strong>that holds a <strong>None </strong>value will cause a panic. Always use pattern matching or methods like <strong>unwrap_or</strong>, <strong>unwrap_or_else</strong>, or the <strong>? </strong>operator in functions that return a <strong>Result</strong></li></ul><p>To mitigate issues associated with panics, it's essential to avoid operations that cause panics, validate all inputs and conditions that could give rise to problematic operations, and use the <strong>Result </strong>and <strong>Option </strong>types for error handling. Additionally, writing comprehensive program tests will help uncover and address potential panic scenarios before deployment.</p><h2 id="seed-collisions"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#seed-collisions">Seed Collisions<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Seed collisions occur when different inputs (i.e., seeds and program IDs) used to generate a PDA result in the same PDA address. This is problematic when PDAs are used within a program for different purposes, as it can lead to unexpected behavior, including denial of service attacks or complete compromise.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a program for a decentralized voting platform for various proposals and initiatives. Each voting session for a given proposal or initiative is created with a unique identifier, and users submit votes. The program uses PDAs for both voting sessions and individual votes:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-comment)">// Creating a Voting Session PDA</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[instruction(session_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> String</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> CreateVotingSession</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> organizer</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;init,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;payer </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> organizer,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;space </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> 8 </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-token-function)"> Product</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">SIZE</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> [</span><span style="color:var(--shiki-token-string-expression)">b"session"</span><span style="color:var(--shiki-foreground)">, session_id</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">as_bytes()],</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> voting_session</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">VotingSession</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> system_program</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Program</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">System</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)">// Submitting a Vote PDA</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[instruction(session_id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> String</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> SubmitVote</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span><span style="color:var(--shiki-token-keyword)">mut</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> voter</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Signer</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;#[account(</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;init,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;payer </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> voter,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;space </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> 8 </span><span style="color:var(--shiki-token-keyword)">+</span><span style="color:var(--shiki-token-function)"> Vote</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">SIZE</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp; &nbsp; &nbsp;seeds </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> [session_id</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">as_bytes(), voter</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">key()</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">as_ref()]</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> vote</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Account</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">Vote</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;pub</span><span style="color:var(--shiki-foreground)"> system_program</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Program</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">System</span><span style="color:var(--shiki-foreground)">&gt;,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>In this scenario, an attacker would try to carefully craft a voting session that, when combined with the static seed <strong>"session"</strong>, would result in a PDA that coincidentally matches the PDA generated for a different voting session. Deliberately creating a PDA that clashes with another voting session's PDA could disrupt the platform's operations by, for example, preventing legitimate votes for proposals or denying new initiatives from being added to the platform since Solana's runtime cannot distinguish between the colliding PDAs.</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate the risk of seed collisions, developers can:</p><ul class="list max-w-[42rem]"><li value="1">Use unique prefixes for seeds across different PDAs in the same program. This approach will help ensure that PDAs remain distinct</li><li value="2">Use unique identifiers (e.g., timestamps, user IDs, nonce values) to guarantee that a unique PDA is generated every time</li><li value="3">Programmatically validate a generated PDA does not collide with existing PDAs</li></ul><h2 id="type-cosplay"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#type-cosplay">Type Cosplay<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><h3 id="the-vulnerability"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability">The Vulnerability<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Type cosplay is a vulnerability where one account type is misrepresented as another due to a lack of type checks during deserialization. This can lead to the execution of unauthorized actions or data corruption, as the program would operate based on the incorrect assumption of the account's role or permissions. Always check the account's intended type during deserialization explicitly.</p><h3 id="example-scenario"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario">Example Scenario<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>Consider a program that manages access to admin operations based on a user's role. Each user account includes a role discriminator to distinguish between regular users and administrators. The program contains a function to update admin settings intended only for administrators. However, the program fails to check the account's discriminator and deserializes user account data without confirming whether the account is an administrator:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> update_admin_settings</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">UpdateSettings</span><span style="color:var(--shiki-foreground)">&gt;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Deserialize without checking the discriminator</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> user </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> User</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">try_from_slice</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">user</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow</span><span style="color:var(--shiki-foreground)">())</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">unwrap</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Sensitive update logic</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;msg!</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">"Admin settings updated by: {}"</span><span style="color:var(--shiki-foreground)">, user</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">authority)</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> UpdateSettings</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;user</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">BorshSerialize</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">BorshDeserialize</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> User</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;authority</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>The issue is that <strong>update_admin_settings </strong>deserializes the user account passed in without checking the account's role discriminator, partly because the <strong>User </strong>struct is missing a discriminator field!</p><h3 id="recommended-mitigation"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation">Recommended Mitigation<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h3><p>To mitigate against this issue, developers can introduce a discriminator field in the <strong>User </strong>struct and verify it during the deserialization process:</p><p><div class="group dark:bg-white/2.5 border border-border rounded-lg p-1"><div class="flex items-center justify-between pl-5 pr-3 py-3"><div class="flex items-center gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="h-5 w-5"><path fill="currentColor" d="m30 12-4-2V6h-4l-2-4-4 2-4-2-2 4H6v4l-4 2 2 4-2 4 4 2v4h4l2 4 4-2 4 2 2-4h4v-4l4-2-2-4ZM6 16a9.9 9.9 0 0 1 .842-4H10v8H6.842A9.9 9.9 0 0 1 6 16m10 10a9.98 9.98 0 0 1-7.978-4H16v-2h-2v-2h4c.819.819.297 2.308 1.179 3.37a1.89 1.89 0 0 0 1.46.63h3.34A9.98 9.98 0 0 1 16 26m-2-12v-2h4a1 1 0 0 1 0 2Zm11.158 6H24a2.006 2.006 0 0 1-2-2 2 2 0 0 0-2-2 3 3 0 0 0 3-3q0-.08-.004-.161A3.115 3.115 0 0 0 19.83 10H8.022a9.986 9.986 0 0 1 17.136 10"></path></svg><span class="text-aflg font-medium">Code</span></div><button class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground"><span class="sr-only">Copy</span><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="h-5 w-5 "><path d="M5.833 10.167v2.5a1.5 1.5 0 0 0 1.5 1.5h5.334a1.5 1.5 0 0 0 1.5-1.5V7.333a1.5 1.5 0 0 0-1.5-1.5h-2.5m-1.5 4.334H3.333a1.5 1.5 0 0 1-1.5-1.5V3.333a1.5 1.5 0 0 1 1.5-1.5h5.334a1.5 1.5 0 0 1 1.5 1.5v5.334a1.5 1.5 0 0 1-1.5 1.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div class="relative"><div class="overflow-x-auto text-white prose-pre:m-0 prose-pre:px-5 rounded-sm shiki-line-numbers"><pre class="shiki css-variables" style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0"><code><span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> fn</span><span style="color:var(--shiki-token-function)"> update_admin_settings</span><span style="color:var(--shiki-foreground)">(ctx</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Context</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-function)">UpdateSettings</span><span style="color:var(--shiki-foreground)">&gt;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-token-function)"> ProgramResult</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;let</span><span style="color:var(--shiki-foreground)"> user </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-function)"> User</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">try_from_slice</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-keyword)">&amp;</span><span style="color:var(--shiki-foreground)">ctx</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">accounts</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">user</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">data</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">borrow</span><span style="color:var(--shiki-foreground)">())</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">unwrap</span><span style="color:var(--shiki-foreground)">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Verify the user's discriminator</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp;if</span><span style="color:var(--shiki-foreground)"> user</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">discriminant </span><span style="color:var(--shiki-token-keyword)">!=</span><span style="color:var(--shiki-token-function)"> AccountDiscriminant</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">Admin</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)"> &nbsp; &nbsp; &nbsp; &nbsp;return</span><span style="color:var(--shiki-token-function)"> Err</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-function)">ProgramError</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-token-function)">InvalidAccountData</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-token-function)">into</span><span style="color:var(--shiki-foreground)">())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;}</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Sensitive update logic</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;msg!</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">"Admin settings updated by: {}"</span><span style="color:var(--shiki-foreground)">, user</span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-foreground)">authority)</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Ok</span><span style="color:var(--shiki-foreground)">(())</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">Accounts</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> UpdateSettings</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt; {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;user</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountInfo</span><span style="color:var(--shiki-foreground)">&lt;'</span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-foreground)">&gt;</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">BorshSerialize</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">BorshDeserialize</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> struct</span><span style="color:var(--shiki-token-function)"> User</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;discriminant</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> AccountDiscriminant</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)"> &nbsp; &nbsp;authority</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> Pubkey</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-foreground)">#[derive(</span><span style="color:var(--shiki-token-function)">BorshSerialize</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">BorshDeserialize</span><span style="color:var(--shiki-foreground)">, </span><span style="color:var(--shiki-token-function)">PartialEq</span><span style="color:var(--shiki-foreground)">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pub</span><span style="color:var(--shiki-token-keyword)"> enum</span><span style="color:var(--shiki-token-function)"> AccountDiscriminant</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span class="line"><span style="color:var(--shiki-token-function)"> &nbsp; &nbsp;Admin</span><span style="color:var(--shiki-foreground)">,</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)"> &nbsp; &nbsp;// Other account types</span></span>
<span class="line"><span style="color:var(--shiki-foreground)">}</span></span></code></pre></div></div></div></p><p>Anchor simplifies the mitigation of type cosplay vulnerabilities by automatically managing discriminators for account times. This is done via the <strong>Account&lt;'info, T&gt;</strong> wrapper, where Anchor ensures type safety by automatically checking the discriminator during deserialization. This allows developers to focus more on their program's business logic rather than manually implementing various type checks.</p><h2 id="conclusion"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#conclusion">Conclusion<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><p>The importance of program security cannot be overstated. This article has traversed the spectrum of common vulnerabilities, from Rust-specific errors to the complexities of Anchor’s <strong>realloc </strong>method. The path to mastering each of these vulnerabilities, and program security in general, is ongoing and demands continuous learning, adaptation, and collaboration. As developers, our commitment to security is not just about safeguarding assets; it’s about fostering trust, ensuring the integrity of our applications, and contributing to Solana’s growth and stability.</p><p>If you’ve read this far, thank you anon! Be sure to enter your email address below so you’ll never miss an update about what’s new on Solana. Ready to dive deeper? Explore the latest articles on the<a class="" rel="noopener noreferrer" target="_blank" href="https://www.helius.dev/blog"> Helius blog</a> and continue your Solana journey, today.</p><h2 id="additional-resources"><a class="not-prose flex items-center group" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#additional-resources">Additional Resources<svg stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" shape-rendering="geometricPrecision" viewBox="0 0 24 24" height="24" width="24" fill="none" class="ml-3 opacity-0 group-hover:opacity-100 transition-all duration-300"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"></path></svg></a></h2><ul class="list max-w-[42rem]"><li value="1"><a class="" rel="noopener noreferrer" target="_blank" href="https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html">How to Become a Smart Contract Auditor</a></li><li value="2"><a class="" rel="noopener noreferrer" target="_blank" href="https://immunefi.com/explore/?filter=ecosystem%3DSolana">Immunefi</a></li><li value="3"><a class="" rel="noopener noreferrer" target="_blank" href="https://cmichel.io/how-to-become-a-smart-contract-auditor/">Neodyme’s Solana Security Workshop</a></li><li value="4"><a class="" rel="noopener noreferrer" target="_blank" href="https://github.com/coral-xyz/sealevel-attacks">Sealevel Attacks</a></li><li value="5"><a class="" rel="noopener noreferrer" target="_blank" href="https://osec.io/blog/2022-03-14-solana-security-intro">Solana: An Auditor’s Introduction</a></li><li value="6"><a class="" rel="noopener noreferrer" target="_blank" href="https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html">Unsafe Rust</a></li></ul></div></div></div><div class="hidden xl:block col-span-1"><nav data-toc="true" class="hidden lg:block sticky top-28 w-full transition-all duration-300 opacity-30 hover:opacity-100 px-4"><div class="mb-2 hidden xl:block">Table of Contents</div><div dir="ltr" class="relative overflow-hidden h-[360px] w-56 rounded-md border p-4" style="position: relative; --radix-scroll-area-corner-width: 0px; --radix-scroll-area-corner-height: 0px;"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit]" style="overflow: hidden scroll;"><div style="min-width: 100%; display: table;"><ul class="space-y-1 list-none p-0 m-0"><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#introduction" data-toc-link-active="false">Introduction</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-attacker-mindset-in-exploiting-solana-programs" data-toc-link-active="false">The Attacker Mindset in Exploiting Solana Programs</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#solanas-programming-model" data-toc-link-active="false">Solana’s Programming Model</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#solana-is-attacker-controlled" data-toc-link-active="false">Solana is Attacker-Controlled</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#potential-attack-vectors" data-toc-link-active="false">Potential Attack Vectors</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#mitigation-strategies" data-toc-link-active="false">Mitigation Strategies</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#account-data-matching" data-toc-link-active="false">Account Data Matching</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#account-data-reallocation" data-toc-link-active="false">Account Data Reallocation</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#account-reloading" data-toc-link-active="false">Account Reloading</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#arbitrary-cpi" data-toc-link-active="false">Arbitrary CPI</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#authority-transfer-functionality" data-toc-link-active="false">Authority Transfer Functionality</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#bump-seed-canonicalization" data-toc-link-active="false">Bump Seed Canonicalization</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#closing-accounts" data-toc-link-active="false">Closing Accounts</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#duplicate-mutable-accounts" data-toc-link-active="false">Duplicate Mutable Accounts</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#frontrunning" data-toc-link-active="false">Frontrunning</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#insecure-initialization" data-toc-link-active="false">Insecure Initialization</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#insecure-example-and-how-to-mitigate" data-toc-link-active="false">Insecure Example and How to Mitigate</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#loss-of-precision" data-toc-link-active="false">Loss of Precision</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#multiplication-after-division" data-toc-link-active="false">Multiplication After Division</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#saturating_-" data-toc-link-active="false">saturating_* </a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#rounding-errors" data-toc-link-active="false">Rounding Errors</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#missing-ownership-check" data-toc-link-active="false">Missing Ownership Check</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#read-only-accounts" data-toc-link-active="false">Read-Only Accounts</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#missing-signer-check" data-toc-link-active="false">Missing Signer Check</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#overflow-and-underflow" data-toc-link-active="false">Overflow and Underflow</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#casting" data-toc-link-active="false">Casting</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#pda-sharing" data-toc-link-active="false">PDA Sharing</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#remaining-accounts" data-toc-link-active="false">Remaining Accounts</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#rust-specific-errors" data-toc-link-active="false">Rust-Specific Errors</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#unsafe-rust" data-toc-link-active="false">Unsafe Rust</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#panics-and-error-management" data-toc-link-active="false">Panics and Error Management</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#seed-collisions" data-toc-link-active="false">Seed Collisions</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#type-cosplay" data-toc-link-active="false">Type Cosplay</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#the-vulnerability" data-toc-link-active="false">The Vulnerability</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#example-scenario" data-toc-link-active="false">Example Scenario</a></li><li class="pl-4"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#recommended-mitigation" data-toc-link-active="false">Recommended Mitigation</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#conclusion" data-toc-link-active="false">Conclusion</a></li><li class="pl-0"><a data-toc-link="true" class="text-gray-500 text-afsm transition-all duration-300 data-[toc-link-active=true]:text-primary data-[toc-link-active=true]:font-medium hover:text-gray-50 hover:data-[toc-link-active=true]:text-primary" href="https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security#additional-resources" data-toc-link-active="false">Additional Resources</a></li></ul></div></div></div></nav></div></div><div class="container mb-12 lg:grid lg:grid-cols-subgrid col-start-1 col-span-3 grid-rows-[2fr]"><h2 class="text-afdsm md:text-afdmd lg:text-afdxl font-bold mb-8">Related Articles</h2><div dir="ltr" class="relative overflow-hidden" style="position: relative; --radix-scroll-area-corner-width: 0px; --radix-scroll-area-corner-height: 0px;"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit]" style="overflow: scroll;"><div style="min-width: 100%; display: table;"><div class="flex lg:grid lg:grid-cols-3 lg:items-stretch gap-4 px-4 md:px-8 lg:px-0"><article class="rounded-lg overflow-hidden bg-gray-950 hover:cursor-pointer p-1 hover:bg-gray-800 transition-colors duration-300 w-[90vw] sm:w-[40vw] lg:w-auto"><div class="w-full mb-2 lg:h-[212px]"><img alt="Intro to Anchor" loading="lazy" width="564" height="318" decoding="async" data-nimg="1" class="rounded-md" srcset="/_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fintro-to-anchor.webp&amp;w=640&amp;q=90 1x, /_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fintro-to-anchor.webp&amp;w=1200&amp;q=90 2x" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/intro-to-anchor.jpg" style="color: transparent;"></div><div class="p-3"><div class="prose"><h3 class="text-gray-50 font-lausanne text-afd2xs font-[450]"><a class="not-prose" href="https://www.helius.dev/blog/an-introduction-to-anchor-a-beginners-guide-to-building-solana-programs">An Introduction to Anchor: A Beginner’s Guide to Building Solana Programs</a></h3></div><div class="mt-2 text-gray-500 mb-4 text-afmd"><p>Learn everything you need to know to get started building on Solana with Anchor</p></div></div></article><article class="rounded-lg overflow-hidden bg-gray-950 hover:cursor-pointer p-1 hover:bg-gray-800 transition-colors duration-300 w-[90vw] sm:w-[40vw] lg:w-auto"><div class="w-full mb-2 lg:h-[212px]"><img alt="The Solana Programming Model" loading="lazy" width="564" height="318" decoding="async" data-nimg="1" class="rounded-md" srcset="/_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fthe-solana-programming-model-an-introduction-to-developing-on-solana-1.webp&amp;w=640&amp;q=90 1x, /_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fthe-solana-programming-model-an-introduction-to-developing-on-solana-1.webp&amp;w=1200&amp;q=90 2x" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/the-solana-programming-model-an-introduction-to-developing-on-solana-1.jpg" style="color: transparent;"></div><div class="p-3"><div class="prose"><h3 class="text-gray-50 font-lausanne text-afd2xs font-[450]"><a class="not-prose" href="https://www.helius.dev/blog/the-solana-programming-model-an-introduction-to-developing-on-solana">The Solana Programming Model: An Introduction to Developing on Solana</a></h3></div><div class="mt-2 text-gray-500 mb-4 text-afmd"><p>Learn about the complexities of Solana's architecture, the role of accounts, and how transactions facilitate on-chain interactions.</p></div></div></article><article class="rounded-lg overflow-hidden bg-gray-950 hover:cursor-pointer p-1 hover:bg-gray-800 transition-colors duration-300 w-[90vw] sm:w-[40vw] lg:w-auto"><div class="w-full mb-2 lg:h-[212px]"><img alt="Build Solana Programs with TypeScript Poseidon" loading="lazy" width="564" height="318" decoding="async" data-nimg="1" class="rounded-md" srcset="/_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fbuild-solana-programs-with-typescript-poseidon.webp&amp;w=640&amp;q=90 1x, /_next/image?url=%2Fapi%2Fmedia%2Ffile%2Fbuild-solana-programs-with-typescript-poseidon.webp&amp;w=1200&amp;q=90 2x" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/build-solana-programs-with-typescript-poseidon.jpg" style="color: transparent;"></div><div class="p-3"><div class="prose"><h3 class="text-gray-50 font-lausanne text-afd2xs font-[450]"><a class="not-prose" href="https://www.helius.dev/blog/build-solana-programs-with-typescript-poseidon">Poseidon: Build Solana Programs with TypeScript</a></h3></div><div class="mt-2 text-gray-500 mb-4 text-afmd"><p>Poseidon is a new transpiler framework that empowers web developers to create Solana on-chain programs with TypeScript.</p></div></div></article></div></div></div></div></div><div class="container mb-16"><div class="rounded-lg overflow-hidden bg-gray-950 hover:cursor-pointer p-5 sm:p-10 flex gap-x-10 flex-col lg:flex-row gap-y-6 bg-gradient-to-b from-gray-950 from-80% to-gray-800 to-100%"><div class="lg:w-1/2 lg:p-3 lg:min-h-[300px]"><div class="inline-flex items-center justify-center bg-gray-800 rounded-full p-3 sm:p-4 mb-6"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 25" class="sm:w-6 sm:h-6 w-5 h-5 text-primary-lighter"><path d="M1.71 7.045C.23 5.865 1.065 3.48 2.957 3.48h18.07c1.535 0 2.498 1.66 1.736 2.993l-8.843 15.47c-.925 1.616-3.363 1.203-3.703-.628l-1.444-7.772 5.721-3.253a1 1 0 0 0-.988-1.738L7.722 11.84 1.71 7.045Z" fill="currentColor"></path></svg></div><h2 class="text-gray-50 font-lausanne text-afd2xs md:text-afdsm lg:text-afdmd font-[450]">Subscribe to Helius</h2><div class="mt-2 text-gray-500 sm:text-aflg"><p>Stay up-to-date with the latest in Solana development and receive updates when we post</p></div></div><div class="lg:w-1/2 h-[320px] lg:h-auto"><iframe src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/embed.html" width="100%" height="100%" class="rounded-lg" loading="lazy" title="Subscribe to Helius"></iframe></div></div></div></article><footer class="bg-gradient-to-b from-[#0E0E11] from-10% to-black to-50%"><div class="mx-auto max-w-7xl px-6 py-16 sm:py-30 lg:px-8"><div class="pt-12 xl:grid xl:grid-cols-8 xl:gap-8"><div class="xl:col-span-2 space-y-6 flex flex-col "><a href="https://www.helius.dev/"><img alt="Helius Logo" loading="lazy" width="114" height="24" decoding="async" data-nimg="1" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/logo-footer.svg" style="color: transparent;"></a><a target="_blank" rel="noopener noreferrer" href="https://security.helius.dev/"><img alt="SOC" loading="lazy" width="50" height="50" decoding="async" data-nimg="1" srcset="/_next/image?url=%2Flogo-SOC.png&amp;w=64&amp;q=90 1x, /_next/image?url=%2Flogo-SOC.png&amp;w=128&amp;q=90 2x" src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/logo-SOC.png" style="color: transparent;"></a></div><div class="mt-16 grid grid-cols-2 gap-8 xl:col-span-6 xl:mt-0"><div class="md:grid md:grid-cols-2 md:gap-8"><div><h3 class="font-medium text-gray-50 font-mono text-afsm uppercase">Product</h3><ul role="list" class="mt-6 space-y-4"><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/solana-rpc-nodes">RPC Nodes</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/laserstream">LaserStream</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/solana-grpc">gRPC</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/solana-webhooks-websockets">Webhooks &amp; WebSockets</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/solana-nft-apis">NFT APIs</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/solana-token-apis">Token APIs</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/solana-transaction-apis">Transaction APIs</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/zk-compression">ZK Compression</a></li></ul></div><div class="mt-10 md:mt-0"><h3 class="font-medium text-gray-50 font-mono text-afsm uppercase">Validator</h3><ul role="list" class="mt-6 space-y-4"><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/validator">Our Validator</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/validator-as-a-service">Validator-as-a-Service</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/stake">Stake with Us</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/blog/what-is-hsol">How to Buy hSOL</a></li></ul></div></div><div class="md:grid md:grid-cols-2 md:gap-8"><div><h3 class="font-medium text-gray-50 font-mono text-afsm uppercase">Resources</h3><ul role="list" class="mt-6 space-y-4"><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/blog">Blog</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/docs">Docs</a></li><li><a class="text-gray-500 hover:text-gray-400" target="_blank" rel="noopener noreferrer" href="https://helius.statuspage.io/">Status</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/pricing">Pricing</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/built-with-helius">Built with Helius</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/startup-launchpad">Startup Launchpad</a></li></ul></div><div class="mt-10 md:mt-0"><h3 class="font-medium text-gray-50 font-mono text-afsm uppercase">Company</h3><ul role="list" class="mt-6 space-y-4"><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/careers">Careers</a></li><li><a class="text-gray-500 hover:text-gray-400" target="_blank" rel="noopener noreferrer" href="https://form.typeform.com/to/KiacmxpZ">Contact Sales</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/docs/support">Support</a></li><li><a class="text-gray-500 hover:text-gray-400" target="_blank" rel="noopener noreferrer" href="https://drive.google.com/drive/folders/1Kko7VCzcoDuQICiOAHZGXwZ-gB_xvUYj?usp=sharing">Media Kit</a></li><li><a class="text-gray-500 hover:text-gray-400" target="_blank" rel="noopener noreferrer" href="https://security.helius.dev/">Security</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/privacy-policy">Privacy Policy</a></li><li><a class="text-gray-500 hover:text-gray-400" href="https://www.helius.dev/terms">Terms &amp; Conditions</a></li><li><a class="text-gray-500 hover:text-gray-400" target="_blank" rel="noopener noreferrer" href="https://www.solanaroadmap.com/">Solana Roadmap</a></li></ul></div></div></div></div><div class="mt-12 border-t border-gray-900 pt-6 md:flex md:items-center md:justify-between"><div class="flex gap-x-1 md:order-2"><a target="_blank" class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground text-gray-400 hover:text-primary-light" href="https://x.com/heliuslabs"><span class="sr-only">X</span><div class="size-4"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><g clip-path="url(#xb)"><path fill-rule="evenodd" clip-rule="evenodd" d="m11.96 17.25-4.163-5.932-5.21 5.932H.382L6.82 9.923.382.75h5.66l3.922 5.591L14.88.75h2.205l-6.138 6.987 6.673 9.513h-5.66Zm2.454-1.672H12.93L3.539 2.423h1.484L8.784 7.69l.65.914 4.98 6.974Z" fill="currentColor"></path></g><defs><clippath id="xb"><path fill="#fff" d="M0 0h18v18H0z"></path></clippath></defs></svg></div></a><a target="_blank" class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground text-gray-400 hover:text-primary-light" href="https://www.linkedin.com/company/heliusapi"><span class="sr-only">LinkedIn</span><div class="size-4"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><g clip-path="url(#linkedina)"><path d="M16.668 0H1.328C.595 0 0 .58 0 1.297V16.7C0 17.416.594 18 1.329 18h15.339c.734 0 1.332-.584 1.332-1.297V1.297C18 .58 17.402 0 16.668 0ZM5.34 15.339H2.668V6.746H5.34v8.593ZM4.004 5.576A1.548 1.548 0 1 1 4 2.48a1.548 1.548 0 0 1 .005 3.096Zm11.335 9.763H12.67v-4.177c0-.995-.017-2.278-1.388-2.278-1.389 0-1.6 1.086-1.6 2.208v4.247H7.017V6.746h2.56v1.175h.035c.355-.675 1.227-1.389 2.524-1.389 2.704 0 3.203 1.779 3.203 4.092v4.715Z" fill="currentColor"></path></g><defs><clippath id="linkedina"><path fill="#fff" d="M0 0h18v18H0z"></path></clippath></defs></svg></div></a><a target="_blank" class="inline-flex items-center justify-center whitespace-nowrap rounded-full text-afmd font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 w-10 hover:bg-card hover:text-accent-foreground text-gray-400 hover:text-primary-light" href="https://discord.com/invite/6GXdee3gBj"><span class="sr-only">Discord</span><div class="size-4"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M14.727 3.768a13.594 13.594 0 0 0-3.404-1.053 9.43 9.43 0 0 0-.436.89 12.61 12.61 0 0 0-3.778 0 9.464 9.464 0 0 0-.436-.89A13.69 13.69 0 0 0 3.266 3.77C1.112 6.974.528 10.1.82 13.18a13.694 13.694 0 0 0 4.175 2.106c.338-.457.637-.942.894-1.45a8.857 8.857 0 0 1-1.408-.675c.118-.086.234-.175.345-.26a9.764 9.764 0 0 0 8.348 0c.113.092.228.18.345.26-.45.267-.922.493-1.41.677.256.507.555.992.893 1.448a13.635 13.635 0 0 0 4.178-2.105c.343-3.572-.585-6.668-2.453-9.413ZM6.26 11.285c-.814 0-1.486-.742-1.486-1.656 0-.913.649-1.662 1.483-1.662.835 0 1.502.75 1.488 1.662-.015.914-.656 1.656-1.485 1.656Zm5.482 0c-.815 0-1.485-.742-1.485-1.656 0-.913.65-1.662 1.485-1.662.836 0 1.498.75 1.483 1.662-.014.914-.654 1.656-1.483 1.656Z" fill="currentColor"></path></svg></div></a></div><p class="mt-8 text-afsm text-gray-500 md:order-1 md:mt-0">© 2025 Helius, Inc. All rights reserved.</p></div></div></footer><section aria-label="Notifications alt+T" tabindex="-1" aria-live="polite" aria-relevant="additions text" aria-atomic="false"></section><script id="_next-ga-init" data-nscript="afterInteractive">
          window['dataLayer'] = window['dataLayer'] || [];
          function gtag(){window['dataLayer'].push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-5NGYGFEVGG' );</script><script src="./A Hitchhiker&#39;s Guide to Solana Program Security_files/js(1)" id="_next-ga" data-nscript="afterInteractive"></script><next-route-announcer style="position: absolute;"><template shadowrootmode="open"><div aria-live="assertive" id="__next-route-announcer__" role="alert" style="position: absolute; border: 0px; height: 1px; margin: -1px; padding: 0px; width: 1px; clip: rect(0px, 0px, 0px, 0px); overflow: hidden; white-space: nowrap; overflow-wrap: normal;"></div></template></next-route-announcer><w3m-modal style="--local-border-bottom-mobile-radius: 0px;"><template shadowrootmode="open"><!----></template></w3m-modal></body></html>