"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["4769"],{71682:function(e,t,s){s.d(t,{editImageAndRehost:()=>k,editImage:()=>p});var a=s(7409),r=s(99282),o=s(98848),i=s(14640),n=s(68833),l=s(48980),c=s(98914);s(66925);let u=["https://substack-stickers.s3.us-east-1.amazonaws.com/sticker-substack.png","https://substack-stickers.s3.us-east-1.amazonaws.com/sticker-substack-white.png","https://substack-stickers.s3.us-east-1.amazonaws.com/sticker-pencil.png","https://substack-stickers.s3.us-east-1.amazonaws.com/sticker-dice.png","https://substack-stickers.s3.us-east-1.amazonaws.com/sticker-clock.png","https://substack-stickers.s3.us-east-1.amazonaws.com/sticker-chair.png","https://substack-stickers.s3.us-east-1.amazonaws.com/sticker-broccoli.png","https://substack-stickers.s3.us-east-1.amazonaws.com/sticker-letter.png"];async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var{trackingProps:l,handleEvent:c}=t,p=(0,o._)(t,["trackingProps","handleEvent"]);return new Promise(t=>{var o;let k=(0,i.zj)((0,r._)((0,a._)({cropSelectPresetOptions:[[void 0,"Custom"],[1,"Square"],[4/3,"Landscape"],[1.91,"Social preview"],[9/16,"Stories"]]},p),{src:e,handleEvent:(e,s)=>{null==c||c(e,s),"process"===e?(t(s.dest),(0,n.j)(n.FP.IMAGE_EDITOR_SAVED,l)):"close"===e?(0,n.j)(n.FP.IMAGE_EDITOR_CLOSED,l):"loadabort"===e&&k.close()},utils:["crop","filter","finetune","annotate","sticker","redact"],stickers:null!==(o=null==p?void 0:p.stickers)&&void 0!==o?o:u,cropImageSelectionCornerStyle:"hook",stickerForceEnable:!0,finetuneOptions:[["brightness",e=>{var t;return null!==(t=e.finetuneLabelBrightness)&&void 0!==t?t:"Brightness"}],["contrast",e=>{var t;return null!==(t=e.finetuneLabelContrast)&&void 0!==t?t:"Contrast"}],["saturation",e=>{var t;return null!==(t=e.finetuneLabelSaturation)&&void 0!==t?t:"Saturation"}],["exposure",e=>{var t;return null!==(t=e.finetuneLabelExposure)&&void 0!==t?t:"Exposure"}],["clarity",e=>{var t;return null!==(t=e.finetuneLabelClarity)&&void 0!==t?t:"Clarity"}]],filterOptions:[["Default",[[void 0,e=>e.labelDefault]]],["Classic",[["chrome",e=>e.filterLabelChrome],["fade",e=>e.filterLabelFade]]],["Monochrome",[["monoDefault",e=>e.filterLabelMonoDefault],["monoNoir",e=>e.filterLabelMonoNoir]]],["Sepia",[["sepiaDefault",e=>e.filterLabelSepiaDefault],["sepiaColor",e=>e.filterLabelSepiaColor]]]],markupEditorToolbar:(0,i.fZ)(["sharpie","line","rectangle","ellipse","text"]),markupEditorToolStyles:(0,i.zv)({sharpie:{strokeWidth:"10%",strokeColor:(0,i.mb)().orange},line:{strokeColor:(0,i.mb)().orange},rectangle:{strokeColor:(0,i.mb)().white,backgroundColor:(0,i.mb)().orange},ellipse:{strokeColor:(0,i.mb)().white,backgroundColor:(0,i.mb)().orange},text:{color:(0,i.mb)().orange}}),imageReader:{preprocessImageFile:async e=>{if(!/heic/.test(e.type))return e;try{let{heicTo:t}=await s.e("1665").then(s.bind(s,24362)),a=await t({blob:e,type:"image/jpeg",quality:.94}),r=Array.isArray(a)?a[0]:a;if(!r)return console.error("Failed to convert HEIC to JPEG"),e;return(0,i.hl)(r,e.name)}catch(t){return console.error(t,"Failed to convert HEIC to JPEG"),e}}}}));(0,n.j)(n.FP.IMAGE_EDITOR_OPENED,l)})}async function k(e,t){var s;let o=(null==t?void 0:null===(s=t.pub)||void 0===s?void 0:s.logo_url)?["/api/v1/publication/logo"]:[],i=await p(e,(0,r._)((0,a._)({},t),{stickers:[...o,...u]})),n=await (0,c.Zk)(i);return await (0,l.rd)("/api/v1/image",{method:"POST",json:{image:n}})}}}]);