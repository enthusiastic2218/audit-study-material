"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["9276"],{21694:function(e,t,n){n.d(t,{Z:()=>o});let o={root:"root-LeqPP3",badge:"badge-WYVub3",circle:"circle-_ZTVoA"}},23970:function(e,t,n){n.d(t,{m:()=>r});var o=n(16584),i=n(4615);function r(e){let{children:t}=e;return(0,o.tZ)(i.f6,{theme:"substack-theme",children:t})}},28161:function(e,t,n){n.d(t,{Z:()=>a});var o=n(7409),i=n(99282),r=n(16584),s=n(64515);let a=e=>(0,r.BX)(s.l,(0,i._)((0,o._)({},e),{name:"SubstackLogoIcon",svgParams:{height:18,width:16,fill:"#ff6719",stroke:"none"},children:[(0,r.tZ)("path",{d:"M16 4H0V6H16V4Z"}),(0,r.tZ)("path",{d:"M0 8V18L7.9993 13.534L16 18V8H0Z"}),(0,r.tZ)("path",{d:"M16 0H0V2H16V0Z"})]}))},55294:function(e,t,n){n.d(t,{v:()=>er});var o=n(7409),i=n(16584),r=n(30396),s=n(94184),a=n.n(s),l=n(14293),d=n.n(l),c=n(56743),u=n(1852),m=n(28161),_=n(57577),p=n(33804),h=n(99282),v=n(49336),g=n(2564),f=n(94499),y=n(98422),b=n(19081),w=n(84747),x=n(17043);let Z={subMenuTrigger:"subMenuTrigger-SKUcXd",subMenuItem:"subMenuItem-zrY1yO",disabled:"disabled-TCpkl9",logo:"logo-Jt_Kvr",chevron:"chevron-_e2GYQ"};function P(e){let{className:t,hideBorders:n,items:o,menuItemClassName:s,selectedMenuItemClassName:l,selectedSlug:d,pub:u}=e,{isMobile:m}=(0,y.v9)(),_=(0,r.sO)(null),[p,h]=(0,r.eJ)(!1),[P,C]=(0,r.eJ)(!1);function I(e){let{scrollLeft:t,scrollWidth:n,clientWidth:o}=e;h(t>10),C(n-(o+t)>10)}let k=e=>()=>{let{current:t}=_;t&&t.scrollBy({left:250*e,behavior:"smooth"})};return(0,r.d4)(()=>{I(_.current)},[]),(0,i.tZ)("div",{className:a()("overflow-list-container",t),children:(0,i.BX)(b.gq,{borderBottom:n?void 0:"detail",borderTop:n||m?void 0:"detail",className:a()("section-bar",{scroll:!0,"overflow-left":p,"overflow-right":P}),font:"text",height:m?44:48,justifyContent:m?"start":"center",paddingX:4,position:"relative",children:[(0,i.tZ)("div",{ref:_,className:"overflow-items",onScroll:e=>I(e.target),children:o.map(e=>{let{label:t,href:n,slug:o,isNative:r,onClick:c,noFollow:m,subItems:_,newTab:p}=e;return _?(0,i.tZ)(w.M,{hideOnScroll:!0,layerOptions:{placement:"bottom-start",triggerOffset:6},title:t,trigger:(0,i.tZ)("div",{className:a()("menu-item",{selected:o===d},s,l&&{[l]:o===d}),children:(0,i.BX)(f.Z,{className:Z.subMenuTrigger,native:r,rel:m?"nofollow":null,onClick:c,children:[(0,i.tZ)("span",{className:"overflow-item-text",children:t}),(0,i.tZ)(v.Z,{className:Z.chevron,size:16})]})}),children:_.map(e=>{let{label:t,href:n,slug:o,isNative:r,onClick:s,noFollow:l,logoUrl:d}=e,c=!!o&&parseInt("".concat(o))===(null==u?void 0:u.id),m=d||(null==u?void 0:u.logo_url);return(0,i.tZ)(w.u,{className:a()(Z.subMenuItem,{[Z.disabled]:c}),disabled:c,href:n,native:r,priority:"primary",rel:l?"nofollow":void 0,onClick:s,children:(0,i.BX)(b.gq,{alignItems:"center",gap:12,style:{margin:"-4px 0 -4px -4px"},children:[m&&(0,i.tZ)("img",{className:Z.logo,src:(0,x.zF)(m,64),width:32}),t]})})})}):(0,i.tZ)("div",{className:a()("menu-item",{selected:o===d},s,l&&{[l]:o===d}),children:(0,i.tZ)(f.Z,{href:n,native:r,newTab:p,rel:m?"nofollow":null,onClick:c,children:(0,i.tZ)("span",{className:"overflow-item-text",children:t})})})})}),(0,i.tZ)("div",{className:"left-button",children:(0,i.tZ)("div",{className:"scroll-button-hitbox",role:"button",onClick:k(-1),children:(0,i.tZ)(c.Z,{strokeWidth:1.5})})}),(0,i.tZ)("div",{className:"right-button",children:(0,i.tZ)("div",{className:"scroll-button-hitbox",role:"button",onClick:k(1),children:(0,i.tZ)(g.Z,{strokeWidth:1.5})})})]})})}var C=n(95441),I=n(56629),k=n(40647),S=n(48884),R=n(76819),M=n(6070),N=n(63651),L=n(84864);let B={zeteo:{121146:"We’re Not Kidding"}},O=["/about","/chat","/archive","/newsletters"],A=e=>{let{isChatActive:t,isMeetingsActive:n,pub:o,selectedSectionId:r}=e,{language:s}=(0,C.M1)(),{getSettingFor:a}=(0,I.So)(),{getConfigFor:l}=(0,k.xR)(),d=!!l("publication_tabs_reorder"),c=!!a("notes_feed_enabled"),u=!!(a("reader_referrals_enabled")&&a("reader_referrals_leaderboard_enabled")),m=T({groupNewsletters:!!a("group_sections_and_podcasts_in_menu_enabled"),navBarItems:(0,R.Rx)(o.navigationBarItems||[],{isFeedEnabled:c,isChatActive:!!t,isChatEnabled:!!o.threads_v2_enabled,isMeetingsActive:!!n,hasMultipleNewsletters:o.sections&&o.sections.length>0,isReaderReferralsLeaderboardActive:u,language:s,useReordering:d}).filter(e=>!e.is_hidden),pub:o,language:s});return(0,i.tZ)(P,{items:m,className:"sections-overflow",selectedSlug:r,pub:o})},T=e=>{let{groupNewsletters:t,navBarItems:n,pub:o,language:i}=e,{iString:r}=S.mb.i(i),s=[];s.push({href:"/",label:r("Home"),slug:"/home"}),o.podcast_enabled&&o.show_pub_podcast_tab&&s.push({href:"/podcast",label:r("Podcast"),slug:"/podcast"});let a=[];return(0,M.jC)({pub:o})?a=q({navBarItems:n,groups:[{condition:e=>{var t;return(null===(t=e.section)||void 0===t?void 0:t.id)===118995},excludeFromOthers:!0,isStandalone:!0},{condition:e=>{var t;return(null===(t=e.section)||void 0===t?void 0:t.id)===121146},excludeFromOthers:!0,isStandalone:!0},{label:"Shows",condition:e=>{var t,n;return!!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)||(null===(n=e.postTag)||void 0===n?void 0:n.slug)==="townhall"}},{label:"Columns",condition:e=>{var t,n,o;return!!e.section&&!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)&&![132068,243259].includes(null!==(o=null===(n=e.section)||void 0===n?void 0:n.id)&&void 0!==o?o:-1)}},{label:"Documentaries",condition:e=>{var t,n;return[132068,214805,243259].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)}}]}):(0,M.VL)({pub:o})?(s.push({href:"/listen",label:"Shows",slug:"/listen"}),a=q({navBarItems:n.filter(e=>!e.section||!e.section.is_podcast||(0,L.sectionIsSpecificallyMarkedAsNewsletter)({section:e.section,pub:o})),groups:[{label:"Newsletters",condition:e=>!!e.section}]})):a=(0,M.p$)({pub:o})?q({navBarItems:n,groups:[{label:"Projects",condition:e=>{var t,n;return[146942,146943,150226].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)},excludeFromOthers:!0},{label:"News / Research",condition:e=>{var t,n;return[146936,146935].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)},excludeFromOthers:!0},{label:"Calls-to-Action",condition:e=>{var t,n;return[146939,146941,146949].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)},excludeFromOthers:!0},{label:"Recommendations",condition:e=>{var t,n;return[146958].includes(null!==(n=null===(t=e.section)||void 0===t?void 0:t.id)&&void 0!==n?n:-1)||"https://bookshop.org/shop/globalfreedoms"===e.link_url},excludeFromOthers:!0},{label:"Podcasts",condition:e=>{var t;return!!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)},excludeFromOthers:!0}]}):t?q({navBarItems:n,groups:[{label:r("Newsletters"),condition:e=>{var t;return!!e.section&&!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)}},{label:r("Podcasts"),condition:e=>{var t;return!!(null===(t=e.section)||void 0===t?void 0:t.is_podcast)}}]}):n,[...s,...F({groupedNavBarItems:a,pub:o})]},q=e=>{let{navBarItems:t,groups:n}=e,o=[...t],i=[],r=[...t];for(let e of n)if(e.isStandalone){let t=o.find(e.condition);if(!t)continue;i.push(t),r=r.filter(e=>e!==t),e.excludeFromOthers&&(o=o.filter(e=>e!==t))}else{var s;let t=o.filter(e.condition);if(0===t.length)continue;i.push({label:null!==(s=e.label)&&void 0!==s?s:"Other",navBarItems:t}),r=r.filter(t=>!e.condition(t)),e.excludeFromOthers&&(o=o.filter(t=>!e.condition(t)))}return[...i,...r]},F=e=>{let{groupedNavBarItems:t,pub:n}=e;return t.map(e=>"navBarItems"in e?{label:e.label,subItems:e.navBarItems.map(e=>E({navBarItem:e,pub:n}))}:E({navBarItem:e,pub:n}))},E=e=>{var t,n,i,r,s,a;let{navBarItem:l,pub:d}=e;if(l.section){let e=l.section,a=e.is_podcast&&null!==(r=null===(n=d.sections.find(t=>t.id===e.id))||void 0===n?void 0:null===(t=n.podcastSettings)||void 0===t?void 0:t.podcast_art_url)&&void 0!==r?r:e.logo_url;return(0,h._)((0,o._)({label:null!==(s=null===(i=B[d.subdomain])||void 0===i?void 0:i[e.id])&&void 0!==s?s:(0,L.truncateText)(e.name,30),href:(0,N.Ucy)(d,{section:e})},a?{logoUrl:a}:null),{slug:e.id})}let c=(0,R.Hs)(l),u="link"===c&&!(l.standard_key||O.includes(null!==(a=l.link_url)&&void 0!==a?a:"")),m=u&&d.tier<2;return(0,h._)((0,o._)({href:(0,N.Oz)(d,l,{addBase:u}),label:(0,L.truncateText)((0,R.ye)(l),30)},m?{noFollow:m}:null,"page"===c?{isNative:!0}:null),{slug:(0,N.Oz)(d,l,{addBase:!1}),newTab:u})};var X=n(39693),z=n.n(X),U=n(60308),V=n(36515);let D=e=>{let{hasMeetingsBooked:t,isMeetingsActive:n,pub:o,selectedSectionId:r,user:s}=e,{language:l}=(0,C.M1)(),{iString:d}=S.mb.i(l),c=[{href:(0,U.QK7)(o),label:d("Home"),slug:"/publish/home"},{href:"/publish/posts",label:d("Posts"),slug:"/publish/posts"},...(null==s?void 0:s.is_admin)?z()([{href:(0,U.dIB)(o),label:d("Subscribers"),slug:"/publish/subscribers"},{href:"/publish/stats",label:d("Stats"),slug:"/publish/stats"},{href:(0,U.jHQ)(o),label:d("Podcast"),slug:"/publish/podcasting"},{href:(0,V.r)(o,{noBase:!0}),label:d("Chat"),slug:"/publish/chat"},{href:"/publish/recommendations",label:d("Recommendations"),slug:"/publish/recommendations"},(n||!!t)&&{href:"/publish/meetings",label:d("Meetings"),slug:"/publish/meetings"},{href:(0,U.wI3)(o),label:d("Settings"),slug:"/publish/settings"}]):[]];return(0,i.tZ)(P,{items:c,className:a()("sections-overflow","publish-menu"),selectedSlug:r,pub:o})};var W=n(347),H=n(98914);let J=()=>Math.max(document.documentElement.scrollTop||document.body.scrollTop,0),j=e=>{let{alwaysShow:t,disable:n,menuContentRef:o,menuHeight:i}=e,s=(0,r.sO)(!1),a=(0,r.sO)(J()),l=(0,r.sO)(J()),d=(0,r.I4)((e,t)=>{a.current=t,o.current&&(o.current.style.position=e,o.current.style.top="fixed"===e&&t>=0?"":"".concat(t,"px"))},[o]),c=(0,r.I4)(()=>{d("absolute",J()-i),s.current=!1},[i,d]),u=(0,r.I4)(e=>{let t=e.target;((null==t?void 0:t.classList.contains("footnote-number"))||(null==t?void 0:t.classList.contains("footnote-anchor")))&&(s.current=!0,setTimeout(c,0))},[c]),m=(0,r.I4)(()=>{var e;if(t){d("fixed",0);return}if(s.current)return;let r=l.current;l.current=J();let c=l.current,u=(null===(e=o.current)||void 0===e?void 0:e.style.position)==="fixed",m=c<=0||0>=(0,H.bs)(),_=c>=(0,H.bs)(),p=c>r,h=c<r;if(m){d("fixed",0);return}if(n){d("absolute",0);return}if(!_){if(p){if(u&&a.current>=0){d("absolute",c);return}if(!u&&a.current<c-i){d("fixed",-i);return}}if(h){if(a.current>c){d("fixed",c);return}let e=Math.max(c-i,0);if(a.current<e){d("absolute",e);return}}}},[t,o,n,d,i]);(0,r.d4)(()=>{if("undefined"!=typeof window)return window.addEventListener("scroll",m),window.addEventListener("click",u),m(),()=>{window.removeEventListener("scroll",m),window.removeEventListener("click",u)}},[n,u,m,d])};var G=n(68833),Y=n(9682),$=n(15771),Q=n(38841),K=n(63474),ee=n(58175),et=n(64475),en=n(77614),eo=n(47929);let ei={mainMenuContent:"mainMenuContent-DME8DR",topBar:"topBar-pIF0J1",titleWithWordmark:"titleWithWordmark-GfqxEZ",titleContainer:"titleContainer-DJYq5v",title:"title-oOnUGd",buttonsContainer:"buttonsContainer-SJBuep",logoContainer:"logoContainer-p12gJb","fixed-screen-border":"fixed-screen-border-gLZ7nt",fixedScreenBorder:"fixed-screen-border-gLZ7nt"},er=e=>{var t;let{className:n,freeSignup:s,freeSignupEmail:l,hasMeetingsBooked:d,hasViralGiftsCount:p,hideNavBar:h,hideTitle:v,isAccountContext:g,isChatActive:f,isMeetingsActive:w,isPostView:x,isPublishContext:Z,pub:P,selectedSectionId:C,showCustomerSupportModeModal:I,user:S,profile:R}=e;v="profile"===P.homepage_type||v;let{getConfigFor:L}=(0,k.xR)(),{isMobile:B}=(0,y.v9)(),O=(0,u.useMediaQuery)({query:"(max-width: 650px)"}),[T]=(0,Y.tv)(),q=(0,r.sO)(null),F=(0,r.sO)(null),E=(0,r.sO)(null),X="profile"===P.homepage_type,z=X&&T.path.match(/\/profile\/(subscribers|followers|following)/),V=!X&&!!P.logo_url&&!(0,M.kb)({pub:P}),W=!!(!v&&P.logo_url_wide),H=x?!!L("show_menu_on_posts"):!h,J=(0,M.kb)({pub:P})||!!(L("larger_wordmark_on_publication_homepage")&&W),{currentMenuHeight:en,currentTopBarHeight:er,isMinimized:ed,maxMenuHeight:ec}=es({hasExpandableTopBar:J,forceMaximized:!x&&!g&&!Z,forceMinimized:!!(g||Z),isMobile:B,showNavBar:H,showWordmark:W}),eu=B?12:J?40:20,em=!B&&J&&ed?20:0,e_=B?J?32:20:J?72:36,ep=!B&&J&&ed?.5555555555555556:1;j({alwaysShow:!!Z,disable:!x,menuContentRef:q,menuHeight:en});let{shouldCenterTitle:eh}=ea({buttonsRef:E,titleRef:F,horizontalGap:12,horizontalPadding:J?40:20}),ev=B||!eh,eg=g||Z?(0,N.SVA)(P):"/",ef=0;return X&&!O&&("/"===T.path||"/profile/subscribers"===T.path)&&(ef=eu+(B?48:38)+12),(0,i.tZ)(el,{profile:R,pub:P,useAccentTheme:!!(g||Z),children:(0,i.BX)("div",{className:a()("main-menu",n),"data-testid":"navbar",children:[(0,i.BX)("div",{ref:q,className:ei.mainMenuContent,children:[X&&("/"===T.path||"/profile/subscribers"===T.path)&&(0,i.tZ)("div",{className:ei.fixedScreenBorder,style:{height:er}}),(0,i.BX)(b.gq,{alignItems:"center",borderBottom:H?void 0:"detail-themed",className:ei.topBar,gap:12,justifyContent:"space-between",paddingBottom:B?12*!H:void 0,paddingTop:B?12:void 0,paddingX:eu,style:B?void 0:{position:"relative",height:er},children:[(0,i.BX)("div",{className:ei.logoContainer,style:(0,o._)({display:X||V||!ev?null:"none",flexBasis:0,flexGrow:+!ev},J?{transform:"translateX(-".concat(em,"px)")}:null),children:[X&&(0,i.BX)(b.gq,{alignItems:"center",gap:40,children:[(0,i.tZ)(b.hs,{alignItems:"center",as:"a",height:20,href:(0,N.n1t)((0,N.SVA)(),{utm_content:eo.fZ.islandSubstackLogo}),justifyContent:"center",tabIndex:-1,width:20,children:B?(0,i.tZ)(m.Z,{height:24}):(0,i.tZ)(m.Z,{style:{transform:"scale(1.4)"}})}),z&&(0,i.tZ)($.hU,{className:ei.backButton,href:(0,U.TJI)(P),size:B?"sm":"md",children:(0,i.tZ)(c.Z,{size:20})})]}),V&&(0,i.tZ)(Q.jM,{href:eg,pub:P,size:B?32:40,onClick:()=>{(0,G.j)(G.FP.NAV_BAR_HOME_LINK_CLICKED)}})]}),!v&&(0,i.tZ)("div",{ref:F,className:ei.titleContainer,style:(0,o._)({flexGrow:0},J?{transform:"translateX(".concat(ev?-em:0,"px)")}:null),children:(0,i.tZ)(ee.xv,{as:"h1",className:a()(ei.title,{[null!==(t=ei.titleWithWordmark)&&void 0!==t?t:""]:P.logo_url_wide}),font:"pub-headings",children:(0,i.tZ)(K.A0,{href:eg,children:P.logo_url_wide?(0,i.tZ)("img",{alt:P.name,src:(0,N.zF4)(P.logo_url_wide,null,{height:2*e_,crop:"limit",leadingSegments:["e_trim:10:white","e_trim:10:transparent"]}),style:(0,o._)({display:"block",height:e_},J?{transform:"scale(".concat(ep,")"),transformOrigin:ev?"left":"center"}:null)}):P.name})})}),(0,i.BX)(b.gq,{alignItems:"center",justifyContent:"end",style:{flexBasis:0,flexGrow:1},children:[Z&&(0,i.tZ)(et.B,{}),(0,i.tZ)("div",{ref:E,className:ei.buttonsContainer,style:J?{transform:"translateX(".concat(em,"px)")}:void 0,children:(0,i.tZ)(_.Z,{freeSignup:s,freeSignupEmail:l,hasViralGiftsCount:p,isAccountContext:g,isMeetingsActive:w,isPublishContext:Z,pub:P,showCustomerSupportModeModal:I,user:S})})]}),X&&ef>0&&(0,i.tZ)("div",{style:{position:"absolute",bottom:B?"0px":"-1px",left:"0px",width:"".concat(ef,"px"),height:"1px",backgroundColor:"var(--color-bg-primary)",zIndex:1}})]}),H&&(Z?(0,i.tZ)(D,{hasMeetingsBooked:d,isMeetingsActive:w,pub:P,selectedSectionId:C,user:S}):(0,i.tZ)(A,{isChatActive:f,isMeetingsActive:w,pub:P,selectedSectionId:C}))]}),(0,i.tZ)("div",{style:{height:ec}})]})})},es=e=>{let{forceMaximized:t,forceMinimized:n,hasExpandableTopBar:o,isMobile:i,showNavBar:s,showWordmark:a}=e,[l,c]=(0,r.eJ)(!1),u=(0,r.sO)(null),m=!!n||!t&&l,_=e=>i?s?44:56:o?e?72:120:a?88:72,p=s?i?45:50:0,h=_(n)+p,v=_(m),g=(0,r.I4)(()=>{let e=u.current,t=document.documentElement.scrollTop||document.body.scrollTop;if(u.current=t,!d()(e))t>e?t>h+5&&c(!0):t<=0&&c(!1)},[h]);return(0,r.d4)(()=>(window.addEventListener("scroll",g),()=>window.removeEventListener("scroll",g)),[g]),{currentMenuHeight:v+p,currentTopBarHeight:v,isMinimized:m,maxMenuHeight:h}},ea=e=>{let{buttonsRef:t,titleRef:n,horizontalGap:o,horizontalPadding:i}=e,{isMobile:s}=(0,y.v9)(),[a,l]=(0,r.eJ)(!s),d=(0,r.I4)(()=>{if(!t.current||!n.current)return;if(s){l(!1);return}let e=t.current.getBoundingClientRect().width,r=n.current.getBoundingClientRect().width;l(.5*document.body.clientWidth-e-o-i>.5*r)},[t,o,i,s,n]);return(0,r.d4)(()=>(window.addEventListener("resize",d),d(),setTimeout(d,0),()=>{window.removeEventListener("resize",d)}),[d]),{shouldCenterTitle:a}},el=e=>{let{profile:t,pub:n,useAccentTheme:o,children:r}=e;return o?(0,i.tZ)(p.w,{children:r}):"profile"===n.homepage_type&&t?(0,i.tZ)(en.F,{profile:t,children:r}):(0,i.tZ)(W.h,{children:r})}},21061:function(e,t,n){n.d(t,{l:()=>a});var o=n(30396),i=n(24350),r=n.n(i),s=n(81977);let a=e=>{let{pub:t}=e,n=r()(t.sections,"id"),{setting:i,save:a}=(0,s.m)({key:"archived_section_ids",fallback:[]}),[l,d]=(0,o.eJ)(i),[c,u]=(0,o.eJ)(!1),m=async()=>{u(!0),await a({setting:l})};return{isSaving:c,ids:l,onChange:e=>{let{ids:t}=e;d(t.filter(e=>n[e]))},onSave:m}}},73207:function(e,t,n){n.d(t,{I:()=>d});var o=n(30396),i=n(24350),r=n.n(i),s=n(78718),a=n.n(s),l=n(81977);let d=e=>{let{pub:t,pubSetting:n="column_section_ids"}=e,i=r()(null==t?void 0:t.sections,"id"),{setting:s,save:d}=(0,l.m)({key:n,fallback:{metadata:{},order:[]}}),[c,u]=(0,o.eJ)(s.order),[m,_]=(0,o.eJ)(s.metadata),[p,h]=(0,o.eJ)(!1),v=async()=>{h(!0),await d({setting:{order:c,metadata:a()(m,c)}})};return{isSaving:p,metadata:m,ids:c,onChangeMetadata:e=>{let{metadata:t}=e;_(t)},onChangeOrder:e=>{let{ids:t}=e;u(t.filter(e=>i[e]))},onSave:v}}},98130:function(e,t,n){n.d(t,{L:()=>d});var o=n(30396),i=n(39693),r=n.n(i),s=n(24350),a=n.n(s),l=n(81977);let d=e=>{let{pub:t}=e,n=a()(t.sections,"id"),{setting:i,save:s}=(0,l.m)({key:"event_section_ids",fallback:[]}),[d,c]=(0,o.eJ)(i),[u,m]=(0,o.eJ)(!1),_=async()=>{m(!0),await s({setting:d})};return{initialSections:r()(i.map(e=>n[e])),isSaving:u,ids:d,sections:r()(d.map(e=>n[e])),onChange:e=>{let{ids:t}=e;c(t.filter(e=>n[e]))},onSave:_}}},81977:function(e,t,n){n.d(t,{m:()=>i});var o=n(56629);let i=e=>{let t,{key:n,fallback:i}=e,{getSettingFor:r,changeSetting:s}=(0,o.So)(),a=r(n);try{t=a?JSON.parse(a):i}catch(e){t=i}return{setting:t,save:async e=>{let{setting:t}=e;await s({[n]:JSON.stringify(t)})}}}},94778:function(e,t,n){n.d(t,{c:()=>m});var o=n(30396),i=n(39693),r=n.n(i),s=n(24350),a=n.n(s),l=n(78718),d=n.n(l),c=n(81977);let u=["mediumYellow","darkGreen","mediumRed","darkOrange","mediumPurple","mediumBlue"],m=e=>{let{pub:t}=e,n=a()(t.sections,"id"),{setting:i,save:s}=(0,c.m)({key:"video_section_ids",fallback:{metadata:{},order:[]}});for(let e=0;e<i.order.length;e++){var l,m,_;let t=i.order[e];t&&((null===(l=i.metadata[t])||void 0===l?void 0:l.carouselColor)||(i.metadata[t]={youtubeUrl:null!==(_=null===(m=i.metadata[t])||void 0===m?void 0:m.youtubeUrl)&&void 0!==_?_:"",carouselColor:u[e%u.length]}))}let[p,h]=(0,o.eJ)(i.order),[v,g]=(0,o.eJ)(i.metadata),[f,y]=(0,o.eJ)(!1),b=async()=>{y(!0),await s({setting:{order:p,metadata:d()(v,p)}}),window.location.reload()};return{initialSections:r()(i.order.map(e=>n[e])),isSaving:f,metadata:v,ids:p,sections:r()(p.map(e=>n[e])),onChangeMetadata:e=>{let{metadata:t}=e;g(t)},onChangeOrder:e=>{let{ids:t}=e;h(t.filter(e=>n[e]))},onSave:b}}},35543:function(e,t,n){n.d(t,{Sv:()=>M,Xe:()=>k,oJ:()=>S,oh:()=>R,yr:()=>N});var o=n(7409),i=n(99282),r=n(58865),s=n(16584),a=n(30396),l=n(82569),d=n.n(l),c=n(94734),u=n(17520),m=n(69241),_=n(19548),p=n(95441),h=n(60807),v=n(54371),g=n(6910),f=n(48980),y=n(63018),b=n(98914),w=n(84747),x=n(70379),Z=n(81043),P=n(23945);function C(){let e=(0,r._)(["Followed ",""]);return C=function(){return e},e}function I(){let e=(0,r._)(["Unfollowed ",""]);return I=function(){return e},e}function k(e){let t=(0,h.aF)();return(0,y._I)("/api/v1/feed/following",(0,o._)({auto:!!t},e))}function S(){let{mutate:e}=(0,m.kY)();return function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return e("/api/v1/feed/following",...n)}}function R(e,t,n){let{isFollowing:o,toggle:i}=M(e,t,n),r=(0,h.aF)(),a=(0,_.gc)(null==e?void 0:e.id),l=!!(r&&e&&r.id!==e.id)&&!a,d=[];return l&&d.push((0,s.tZ)(w.u,{leading:o?(0,s.tZ)(g.m,{stroke:"var(--color-fg-primary)"}):(0,s.tZ)(v.w,{stroke:"var(--color-fg-primary)"}),onClick:i,children:o?"Unfollow":"Follow"})),d}function M(e,t,n,r){let a=(0,h.aF)(),{onboardingModalRef:l,requireLogin:m}=(0,Z.SJ)(),_=function(e,t){let{data:n}=k(t);return(null!=n?n:[]).includes(null!=e?e:0)}(null==e?void 0:e.id,r),{mutate:v,data:g}=k(r),y=(0,x.pm)(),w=(0,P.Q1)((null==e?void 0:e.name)||""),{iString:S,iTemplate:R}=(0,p.M1)(),M=async r=>{if(e){if(!a&&l.current){m?m():l.current.open();return}v(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r?[...t,e.id]:d()(t,e.id)},{revalidate:!1});try{await (0,f.rd)("/api/v1/feed/".concat(e.id,"/follow"),{method:r?"POST":"DELETE",json:{surface:t,noteId:n}}),y.popToast(e=>(0,s.tZ)(x.FN,(0,i._)((0,o._)({},e),{Icon:r?c.Z:u.Z,text:r?R(C(),w):R(I(),w),cta:S("Undo"),onAccept:()=>M(!r)})))}catch(e){y.popToast(t=>(0,s.tZ)(x.FN,(0,i._)((0,o._)({},t),{text:(0,b.zx)(e)})));return}}};return{isFollowing:_,toggle:()=>M(!_),isLoaded:!!g}}function N(e,t,n){let{isFollowing:o,toggle:i}=M(e,t,n),[r,s]=(0,a.eJ)(!1);return{isFollowing:o,buttonProps:{onClick:()=>{i(),o||s(!0)},onMouseLeave:()=>s(!1)}}}},36518:function(e,t,n){n.d(t,{N$:()=>p,lR:()=>v});var o=n(16584),i=n(6400),r=n(30396),s=n(32351),a=n(14952),l=n(48980),d=n(8635),c=n(7882),u=n(98750),m=n(98914),_=n(6070);function p(e){let{defaultState:t,shouldLoad:n=!0,shouldPoll:i=!1,activityToken:r,children:s}=e;return(0,o.tZ)(g,{defaultState:null==t?void 0:t.activity,shouldLoad:n,shouldPoll:i,activityToken:r,children:s})}let h=(0,i.createContext)({lastViewedAt:null,activityUnreadCount:0,activityUnreadAtMax:!1,refetch:async()=>!0,markAllAsRead:async()=>{},hasLoadedOnce:!1});function v(){return(0,r.qp)(h)}function g(e){let{defaultState:t,shouldLoad:n=!0,shouldPoll:i=!1,activityToken:p,children:v}=e,g=(0,c.ib)({pathname:"/api/v1/activity/unread",deps:[],auto:n,initialResult:t,query:{token:p}}),f=(0,a.Ij)(),y=!!f&&(0,_.HD)({pub:f}),b=!(0,u.th)()&&!y,w=async()=>{let e=await (0,l.rd)("/api/v1/activity/unread",{method:"post",json:{after:new Date().toISOString(),token:p}});g.setResult(e)};(0,d.Z)(async()=>{if(i&&n&&(0,m.dr)()){var e;let t=(null===(e=g.result)||void 0===e?void 0:e.count)||0,n=await g.refetch();if(t!==(!(n instanceof Error)&&n.count||0))return!0}},6e4);let x=null!=g.result?g.result.count:0;return(0,r.d4)(()=>{try{var e,t;null===(e=(t=navigator).setAppBadge)||void 0===e||e.call(t,x)}catch(e){console.warn(e)}},[x]),(0,o.BX)(h.Provider,{value:{lastViewedAt:null!=g.result?g.result.lastViewedAt:null,activityUnreadCount:x,activityUnreadAtMax:null!=g.result&&g.result.max,refetch:g.refetch,markAllAsRead:w,hasLoadedOnce:g.hasLoadedOnce},children:[(0,o.tZ)(s.Metadata,{badge:b?x:void 0}),v]})}h.displayName="NotificationsContext"},42375:function(e,t,n){n.d(t,{$U:()=>m,rI:()=>p});var o=n(16584),i=n(98661),r=n(30396),s=n(25642),a=n(27744),l=n(75822),d=n(81043),c=n(75419),u=n(41233);function m(e){let{state:t,dispatch:n,surface:i,children:m}=e,{onboardingModalRef:p}=(0,d.SJ)(),h=(0,r.Ye)(()=>({dispatch:n}),[]);return(0,o.tZ)(_.Provider,{value:i,children:(0,o.tZ)(a.RR.Provider,{value:h,children:(0,o.tZ)(a.ev.Provider,{value:t,children:(0,o.tZ)(s.ju,{children:(0,o.tZ)(c.Au,{children:(0,o.BX)(l.qS,{children:[m,(0,o.tZ)(u.fA,{isOpen:!!t.isSigningIn,onCancel:()=>n({type:"sign_in",payload:{isSigningIn:!1}}),onSuccess:()=>{n({type:"sign_in",payload:{isSigningIn:!1}}),document.location.reload()},onSignup:()=>{var e;n({type:"sign_in",payload:{isSigningIn:!1}}),null===(e=p.current)||void 0===e||e.open()},noExit:t.signInNoExit})]})})})})})})}let _=(0,i.createContext)("feed");function p(){return(0,r.qp)(_)}},43251:function(e,t,n){n.d(t,{Lw:()=>i});var o=n(60308);function i(e,t){return(null==e?void 0:e.profile_set_up_at)?(0,o.NNq)(e,t):(0,o.Nhr)((null==t?void 0:t.utm_source)?{utm_source:t.utm_source}:void 0)}},34552:function(e,t,n){n.d(t,{Vc:()=>p});var o=n(16584),i=n(98661),r=n(30218),s=n(93666),a=n(96726),l=n(14952),d=n(60807),c=n(48980),u=n(98914),m=n(60308),_=n(26111);function p(){var e;let{showCustomerSupportModeModal:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,l.Ij)(),p=(0,d.aF)(),{canTurnOnCustomerSupportMode:h,isInCustomerSupportMode:v}={canTurnOnCustomerSupportMode:!!(null==(e=(0,d.aF)())?void 0:e.is_global_admin)&&!(null==e?void 0:e.is_admin),isInCustomerSupportMode:!!(null==e?void 0:e.is_global_admin)&&!!(null==e?void 0:e.is_admin)&&!(null==e?void 0:e.is_author)},g=(0,i.useRef)(null),f=async()=>{try{await (0,c.rd)("/api/v1/customer_support_mode",{method:"DELETE"}),document.location.href="/"}catch(e){alert((0,u.zx)(e))}},y=async()=>{if(null==n?void 0:n.custom_domain){let e=window.location.pathname;(0,u.uX)((0,m.Q6L)(e,n),{local_navigation:!1})}else{var e;null===(e=g.current)||void 0===e||e.open()}},b=h&&(0,o.tZ)(a.h,{children:(0,o.tZ)(s.p,{className:"account-info-customer-support-mode-modal",ref:g,openByDefault:t&&h,children:(0,o.tZ)(r.Z,{redirect:(0,_.x)("redirect")||"/publish/home",onCancel:e=>{var t;return null===(t=g.current)||void 0===t?void 0:t.close(e)},requiresMfa:null==p?void 0:p.requires_global_admin_mfa_challenge})})});return{enableCustomerServiceMode:h?y:void 0,disableCustomerServiceMode:v?f:void 0,modalElement:b}}},46234:function(e,t,n){n.d(t,{B:()=>d});var o=n(7409),i=n(16584),r=n(19081),s=n(58175),a=n(14773),l=n(63651);let d=e=>{let{firehoseFeedUrl:t,pub:n,section:d,trackingSource:c,variant:u="default"}=e,m=(0,a.n1)("/p/how-do-i-add-a-bulwark-member-only",(0,o._)({utm_source:c},d?{utm_content:d.id}:null)),_=(0,a.n1)("/account/add-all-podcasts",(0,o._)({utm_source:c},d?{utm_content:d.id}:null)),p=t?(0,i.BX)(s.xv.B3,{as:"li",font:"text",children:["Click here to set up your podcast app for"," ",(0,i.tZ)("a",{href:t,rel:"noopener noreferrer",target:"_blank",children:"everything in one feed"})]}):null,h=(0,l.W1P)(n,{params:{utm_source:c}});return(0,i.tZ)("div",{className:"container-o06YlK",children:"member-only"===u?(0,i.BX)(r.tu,{as:"ul",gap:4,children:[(0,i.BX)(s.xv.B3,{as:"li",font:"text",children:["Want to listen without ads? Join Bulwark+ for exclusive ad-free versions of all Bulwark shows."," ",(0,i.tZ)("a",{href:h,rel:"noopener noreferrer",target:"_blank",children:"Upgrade now"})]}),(0,i.BX)(s.xv.B3,{as:"li",font:"text",children:["Already a Bulwark+ member? Login to access premium shows. ",(0,i.tZ)("a",{href:m,children:"Learn more here"})]})]}):(0,i.BX)(r.tu,{as:"ul",gap:4,children:[(0,i.BX)(s.xv.B3,{as:"li",font:"text",children:["Learn about"," ",(0,i.tZ)("a",{href:m,rel:"noopener noreferrer",target:"_blank",children:"setting up your Bulwark+ private podcast feeds"})]}),p||(0,i.BX)(s.xv.B3,{as:"li",font:"text",children:["Add the Bulwark Premium Show"," ",(0,i.tZ)("a",{href:_,rel:"noopener noreferrer",target:"_blank",children:"super feed"})]})]})})}},30733:function(e,t,n){n.d(t,{N:()=>a});var o=n(16584),i=n(94184),r=n.n(i),s=n(71068);let a=e=>{let{children:t,columns:n=2,paddingTop:i=24}=e,a=(0,s.oB)({paddingTop:i,paddingX:16,paddingBottom:32});return(0,o.tZ)("div",{className:r()("container-kIrj2N",a,{"containerThreeColumn-Rot594":3===n,"containerFourColumn-vOHVwe":4===n}),children:t})}},84370:function(e,t,n){n.d(t,{T:()=>a});var o=n(16584),i=n(43570),r=n(58175),s=n(52503);function a(e){let{modifier:t,children:n,className:a}=e,l=function(e){let t=navigator.platform.toLowerCase().includes("mac");switch(null==e?void 0:e.toLowerCase()){case"cmd":return t?"⌘":"Ctrl + ";case"shift":return t?"⇧":"Shift + ";case"alt":case"opt":return t?"⌥":"Alt + ";case"ctrl":return t?"⌃":"Ctrl + ";case"esc":return"Esc";case"left":return"←";case"right":return"→";case"up":return"↑";case"down":return"↓";default:return""}}(t);return(0,o.tZ)(i.Vp,{priority:"secondary-outline",theme:"default",className:a,children:(0,o.BX)(r.xv,{as:"kbd",font:"text",weight:"regular",color:"secondary",className:s.Z.kbd,children:[l,n]})})}},15562:function(e,t,n){n.d(t,{W:()=>r});var o=n(16584);n(98661);var i=n(6490);let r=e=>{let{isOpen:t=!1,title:n,description:r,icon:s,onClose:a,primaryButton:l,secondaryButton:d}=e;return(0,o.BX)(i.u_,{isOpen:t,onClose:a,children:[n&&(0,o.tZ)(i.xB,{title:n,description:r,showClose:!1,icon:s}),(0,o.tZ)(i.ex,{}),(0,o.tZ)(i.mz,{primaryButton:l,secondaryButton:d})]})}},78096:function(e,t,n){n.d(t,{dm:()=>v,gd:()=>g,yo:()=>f});var o=n(7409),i=n(99282),r=n(98848),s=n(16584),a=n(94184),l=n.n(a),d=n(98661),c=n(86374),u=n(95441),m=n(15771),_=n(19081),p=n(84747),h=n(87815);let v=e=>{var{priority:t="secondary-outline",size:n="md"}=e,i=(0,r._)(e,["priority","size"]);"secondary-outline"===t&&(t="tertiary");let a="tertiary"===t;return(0,s.tZ)(b.Provider,{value:{priority:t,size:n},children:(0,s.tZ)(_.X2,(0,o._)({radius:"sm"===n?"xs":"sm",className:l()(h.Z.group,a&&h.Z.outlined)},i))})},g=e=>{var{children:t,priority:n="primary",size:a="md",menuItems:l,additionalMenuProps:d={}}=e,m=(0,r._)(e,["children","priority","size","menuItems","additionalMenuProps"]);let{iString:_}=(0,u.M1)();return(0,s.BX)(v,{priority:n,size:a,children:[(0,s.tZ)(f,(0,i._)((0,o._)({},m),{children:t})),(0,s.tZ)(p.M,(0,i._)((0,o._)({},d),{layerOptions:{placement:"bottom-end"},trigger:(0,s.tZ)(y,(0,i._)((0,o._)({},m),{"aria-label":_("Dropdown menu"),children:(0,s.tZ)(c.Z,{size:"sm"===a?16:"md"===a?20:24})})),children:l}))]})},f=(0,d.forwardRef)((e,t)=>{var{className:n}=e,a=(0,r._)(e,["className"]);let{priority:c,size:u}=(0,d.useContext)(b);return(0,s.tZ)(m.zx,(0,i._)((0,o._)({priority:c,size:u,className:l()(h.Z.segment,n)},a),{ref:t}))}),y=(0,d.forwardRef)((e,t)=>{var{className:n}=e,a=(0,r._)(e,["className"]);let{priority:c,size:u}=(0,d.useContext)(b);return(0,s.tZ)(m.hU,(0,i._)((0,o._)({priority:c,size:u,className:l()(h.Z.segment,n)},a),{ref:t}))}),b=(0,d.createContext)({priority:"primary",size:"md"})},87077:function(e,t,n){n.d(t,{$$:()=>w,u:()=>x});var o=n(7409),i=n(99282),r=n(98848),s=n(16584),a=n(19425),l=n(94184),d=n.n(l),c=n(98661),u=n(62372),m=n(29032),_=n(20888),p=n(71068),h=n(58076),v=n(19081),g=n(58175),f=n(165);let y=["top-start","top-center","top-end","bottom-start","bottom-center","bottom-end"],b=["left-start","left-center","left-end","right-start","right-center","right-end"],w=500,x=e=>{var{children:t,text:n,title:a,imageUrl:l,as:m="span",leading:_,trailing:p,preferPlacement:v="top-center",layerOptions:g,disabled:w,hoverOptions:x={},toggleOptions:P}=e,C=(0,r._)(e,["children","text","title","imageUrl","as","leading","trailing","preferPlacement","layerOptions","disabled","hoverOptions","toggleOptions"]);let{layerProps:I,triggerProps:k,hoverProps:S,transitionProps:R,renderLayer:M,shouldShow:N}=function(){var e;let{hoverOptions:t,layerOptions:n,toggleOptions:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[r,s]=(0,c.useState)(!1),[a,l]=(0,u.XI)((0,o._)({},t)),m=i?i.show:a,{triggerProps:_,layerProps:p,renderLayer:h}=(0,u.sJ)((0,o._)({isOpen:m,auto:!0,triggerOffset:8},n)),v=null!==(e=null==n?void 0:n.placement)&&void 0!==e?e:"top-center",g="",y="";switch(v){case"top-start":case"top-center":case"top-end":default:g=d()(f.Z.hide,f.Z.fromBelow),y=d()(f.Z.hide,f.Z.fromBelow);break;case"bottom-start":case"bottom-center":case"bottom-end":g=d()(f.Z.hide,f.Z.fromAbove),y=d()(f.Z.hide,f.Z.fromAbove);break;case"left-start":case"left-center":case"left-end":g=d()(f.Z.hide,f.Z.fromRight),y=d()(f.Z.hide,f.Z.fromRight);break;case"right-start":case"right-center":case"right-end":g=d()(f.Z.hide,f.Z.fromLeft),y=d()(f.Z.hide,f.Z.fromLeft)}return{layerProps:p,triggerProps:_,hoverProps:l,transitionProps:{show:m,beforeEnter:()=>s(!0),afterLeave:()=>s(!1),enterFrom:g,leaveTo:y},renderLayer:h,shouldShow:m||r}}({layerOptions:(0,o._)({placement:v,possiblePlacements:b.includes(v)?b:y},g),hoverOptions:(0,o._)({delayLeave:50},x),toggleOptions:P}),{style:L}=I,B=(0,r._)(I,["style"]);return w?(0,s.tZ)(s.HY,{children:t}):(0,s.BX)(s.HY,{children:[(0,s.tZ)(m,(0,i._)((0,o._)({},k,S,C),{children:t})),N&&M((0,s.tZ)(Z,{transitionProps:R,tooltipProps:(0,i._)((0,o._)({},B,S),{style:(0,i._)((0,o._)({},L),{maxWidth:320,zIndex:h.PU})}),text:n,title:a,imageUrl:l,leading:_,trailing:p}))]})};function Z(e){let{transitionProps:t,tooltipProps:n,leading:r,trailing:a,text:l,title:d,imageUrl:u}=e,p=l&&!d&&!u;return(0,s.tZ)("div",(0,i._)((0,o._)({},n),{children:(0,s.tZ)(R,(0,i._)((0,o._)({},t),{children:(0,s.tZ)(m.C,{children:(0,s.BX)(S,{textOnly:p,children:[u&&(0,s.tZ)(k,{children:(0,s.tZ)(_.e,{src:u,maxWidth:296,useRetinaSizing:!0,imageIsFixedWidth:!0})}),(0,s.BX)(I,{hasTitle:!!d,children:[r&&(0,s.tZ)(C,{children:r}),(0,s.BX)(P,{children:[d&&(0,s.tZ)(g.xv.B4,{weight:"medium",color:"primary",className:f.Z.title,children:d}),(0,s.tZ)(g.xv.B4,{color:"primary",opacity:80,lineHeight:16,children:"string"==typeof l?l.split("\n").map((e,t)=>(0,s.BX)(c.Fragment,{children:[t>0&&(0,s.tZ)("br",{}),e]},t)):l})]}),a&&(0,s.tZ)(C,{children:a})]})]})})}))}))}let P=(0,p.zo)({display:"flex",direction:"column",gap:2});function C(e){let{children:t}=e;return(0,s.tZ)(v.X2,{alignItems:"center",justifyContent:"center",className:f.Z.endcapContainer,flex:"auto",gap:8,children:t})}function I(e){let{hasTitle:t,children:n}=e;return(0,s.tZ)(v.X2,{alignItems:t?"start":"center",gap:8,children:n})}function k(e){let{children:t}=e;return(0,s.tZ)(v.sg,{border:"detail",radius:"sm",className:f.Z.imageContainer,overflow:"hidden",children:t})}function S(e){let{textOnly:t,children:n}=e;return(0,s.tZ)(v.sg,{alignItems:"center",paddingY:t?6:12,paddingX:t?8:12,gap:8,radius:"md",shadow:"md",border:"detail",bg:"secondary",children:n})}function R(e){return(0,s.tZ)(a.u,(0,o._)({appear:!0,unmount:!1,className:f.Z.animate,enterTo:f.Z.show,leaveFrom:f.Z.show},e))}},89263:function(e,t,n){n.d(t,{n:()=>c});var o=n(7409),i=n(99282),r=n(98848),s=n(16584),a=n(30396),l=n(82876),d=n(51776);let c=e=>{var{details:t,disabled:n,errors:c,helpText:u,inputRef:m,label:_,name:p,paddingBottom:h,paddingTop:v,value:g,onChange:f}=e,y=(0,r._)(e,["details","disabled","errors","helpText","inputRef","label","name","paddingBottom","paddingTop","value","onChange"]);let b=(0,a.I4)(e=>{f(e.target.value)},[f]);return(0,s.tZ)(l.g,{label:_,details:t,errors:c,helpText:u,paddingTop:v,paddingBottom:h,wrapWithLabel:!0,children:(0,s.tZ)(d.oi,(0,i._)((0,o._)({},y),{ref:m,error:!!(null==c?void 0:c.length),disabled:n,name:p,value:g,onChange:b}))})}},5171:function(e,t,n){n.d(t,{$:()=>N,f:()=>M});var o=n(7409),i=n(99282),r=n(16584),s=n(30396),a=n(94184),l=n.n(a),d=n(68494),c=n(23970),u=n(95441),m=n(36518),_=n(68833),p=n(7882),h=n(15771),v=n(19081),g=n(84747),f=n(87077),y=n(83010),b=n(74312),w=n(19425),x=n(20160),Z=n(57391),P=n(60807),C=n(98012);let I={alert:"alert-pEnrFa",transition:"transition-FsyEAS",enterFrom:"enterFrom-dljIVN",enterTo:"enterTo-HLLVxF",leaveFrom:"leaveFrom-aHkaAL",leaveTo:"leaveTo-k1oI5e"},k=e=>{(0,_.j)(_.FP.NOTIFICATIONS_ALERT_SHOWN,["comment_audience","comment_id","community_comment_id","created_at","id","mention_id","publication_id","sender_count","target_comment_id","target_community_comment_id","target_community_post_id","target_post_id","target_user_id","type"].reduce((t,n)=>(t[n]=null==e?void 0:e[n],t),{}))};function S(){var e;let{activityUnreadCount:t}=(0,m.lR)(),{exposeExperiment:o,getExperimentVariant:i}=(0,Z.jc)(),{isLoading:a,result:l,refetch:d}=(0,p.ib)({pathname:"/api/v1/activity-feed-web",query:{limit:1},auto:!1});(0,s.d4)(()=>{t>0&&d()},[t]);let[c,u]=(0,s.eJ)(!1),[_,h]=(0,s.eJ)(!1),{isLoading:g,fetch:f,result:y}=(0,b.Oe)({module:"./MiniNotificationsViewer",onRequest:()=>Promise.all([n.e("3751"),n.e("2280"),n.e("5239"),n.e("7833"),n.e("3030")]).then(n.bind(n,79075)),fetchImmediately:!1}),S=(0,C.Z)(),{userSettings:R,changeSetting:M}=(0,P.SE)(),N=null==l?void 0:null===(e=l.activityItems)||void 0===e?void 0:e[0],L=(null==N?void 0:N.created_at)?(0,C.Z)(null==N?void 0:N.created_at):S.subtract(100,"year"),B=(null==R?void 0:R.last_notification_alert_shown_at)?(0,C.Z)(R.last_notification_alert_shown_at):S.subtract(100,"year"),O=7>S.diff(L,"day")&&L.diff(B,"hour")>2,A=(0,s.sO)(null),T=()=>{A.current&&window.clearTimeout(A.current)},q=()=>{T(),A.current=window.setTimeout(()=>{u(!1)},6e3)};return(0,s.d4)(()=>{O&&t>0&&(o("notification_alert_improved"),"treatment"!==i("notification_alert_improved")||(y&&!c?window.setTimeout(()=>{u(!0),M("last_notification_alert_shown_at",(0,C.Z)().toISOString()),k(N),q()},2e3):y||g||f()))},[a,l,t,g,O,c,u]),(0,r.tZ)(r.HY,{children:(c||_)&&l&&(0,r.tZ)(w.u,{style:{position:"fixed",left:"auto",right:20,top:92,zIndex:100},appear:!0,show:c,beforeEnter:()=>h(!0),afterLeave:()=>h(!1),enter:I.transition,enterFrom:I.enterFrom,enterTo:I.enterTo,leave:I.transition,leaveFrom:I.leaveFrom,leaveTo:I.leaveTo,children:(0,r.tZ)(x.W,{children:(0,r.tZ)(v.hs,{radius:"md",border:"detail",className:I.alert,onMouseEnter:T,onMouseLeave:q,shadow:"lg",bg:"primary",children:(0,r.tZ)(b.cr,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsStack,onRequest:()=>Promise.all([n.e("3751"),n.e("2280"),n.e("5239"),n.e("7833"),n.e("3030")]).then(n.bind(n,79075)),result:l,isReadOnly:!0})})})})})}var R=n(21694);function M(e){let{canShowAlerts:t=!1}=e,a=(0,m.lR)(),l=(0,p.ib)({pathname:"/api/v1/activity-feed-web",query:{limit:12},auto:!1});(0,s.d4)(()=>{a.activityUnreadCount>0&&(0,_.j)(_.FP.NOTIFICATIONS_UNREAD_SHOWN,{unreadCount:a.activityUnreadCount})},[a.activityUnreadCount]);let w=()=>Promise.all([n.e("3751"),n.e("2280"),n.e("5239"),n.e("7833"),n.e("3030")]).then(n.bind(n,79075)),{iString:x}=(0,u.M1)();return(0,r.BX)(y.H,{trackingProps:{surface:"dropdown"},children:[(0,r.tZ)(g.M,{trigger:e=>(0,r.tZ)(f.u,{text:x("Activity"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:f.$$},children:(0,r.BX)(h.hU,(0,i._)((0,o._)({},e),{"aria-label":"View activity",priority:"tertiary",onMouseEnter:w,position:"relative",children:[(0,r.tZ)(d.Z,{"aria-hidden":!0,size:20}),a.activityUnreadCount>0&&(0,r.tZ)(N,{count:a.activityUnreadCount})]}))}),onOpen:()=>l.refetch(),maxHeight:"fit-content",padding:0,Theme:c.m,children:(0,r.tZ)(b.cr,{module:"@/frontend/reader2/activity/MiniNotificationsViewer",resolve:e=>e.MiniNotificationsViewer,onRequest:w,resource:l,bellCount:a.activityUnreadCount,whileLoading:(0,r.tZ)(v.hs,{width:400})})}),t&&(0,r.tZ)(S,{})]})}function N(e){let{count:t}=e;return(0,r.tZ)(v.hs,{className:l()(R.Z.badge,t<10&&R.Z.circle),alignItems:"center",justifyContent:"center",children:t<100?t:"99+"})}},83010:function(e,t,n){n.d(t,{H:()=>c,n:()=>u});var o=n(7409),i=n(99282),r=n(16584),s=n(6400),a=n(30396),l=n(68833);let d=(0,s.createContext)({surface:null,platform:"web"});function c(e){let{children:t,trackingProps:n}=e,i=(0,a.qp)(d),s=(0,a.Ye)(()=>(0,o._)({},i,n),Object.values(n));return(0,r.tZ)(d.Provider,{value:s,children:t})}function u(){let e=(0,a.qp)(d);return(t,n)=>(0,l.j)(t,(0,o._)((0,i._)((0,o._)({},e),{ui:"page"===e.surface?"activity-page":e.surface}),n))}},91684:function(e,t,n){n.d(t,{b:()=>g});var o=n(7409),i=n(99282),r=n(16584),s=n(30396),a=n(7617),l=n(23970),d=n(95441),c=n(68833),u=n(80026),m=n(84747),_=n(87077),p=n(97842),h=n(74312),v=n(5171);function g(){var e,t;let{iString:n}=(0,d.M1)(),g=null!==(t=null===(e=(0,p.WG)({},{focusThrottleInterval:3e5}).data)||void 0===e?void 0:e.unreadCount)&&void 0!==t?t:0;return(0,s.d4)(()=>{(0,c.j)(c.FP.CHAT_DROPDOWN_BADGE_SHOWN,{count:g})},[g]),(0,r.tZ)(m.M,{trigger:e=>(0,r.tZ)(_.u,{text:n("Chat"),layerOptions:{placement:"bottom-center",triggerOffset:4},hoverOptions:{delayEnter:_.$$},children:(0,r.BX)(u.hU,(0,i._)((0,o._)({},e),{"aria-label":"View chats",priority:"tertiary",onMouseEnter:f,position:"relative",children:[(0,r.tZ)(a.Z,{size:20}),g>0&&(0,r.tZ)(v.$,{count:g})]}))}),onClose:()=>{(0,c.j)(c.FP.CHAT_DROPDOWN_CLOSED)},maxHeight:"fit-content",padding:0,Theme:l.m,children:(0,r.tZ)(h.cr,{module:"./MiniInbox",onRequest:f,resolve:e=>e.MiniChatInbox,whileLoading:(0,r.tZ)(u.xu,{width:360})})})}let f=()=>Promise.all([n.e("9776"),n.e("7294"),n.e("4327"),n.e("2280"),n.e("1761"),n.e("2340"),n.e("1026"),n.e("8336"),n.e("5239"),n.e("7833"),n.e("9764"),n.e("3583"),n.e("61"),n.e("8500")]).then(n.bind(n,90370))},8828:function(e,t,n){n.d(t,{dd:()=>r,oH:()=>i});var o=n(48980);let i=function(){let{before:e,tab:t="all"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async n=>{try{var i,r;let s=await (0,o.rd)("/api/v1/messages/inbox",{query:{paginate:"true",tab:t,before:e}});n({type:"inbox-new_items",payload:{threads:null==s?void 0:s.threads,hasMore:null==s?void 0:s.more,directMessagesUnreadCount:null==s?void 0:s.directMessagesUnreadCount,pendingInviteCount:null==s?void 0:s.pendingInviteCount,pendingInviteUnreadCount:null!==(i=null==s?void 0:s.pendingInviteUnreadCount)&&void 0!==i?i:null==s?void 0:s.pendingInviteCount,pubChatUnreadCount:null!==(r=null==s?void 0:s.pubChatUnreadCount)&&void 0!==r?r:0,mostRecentChatTimestamp:s.mostRecentChatTimestamp}})}catch(e){if(console.warn("error",e),e instanceof o.kp)n({type:"inbox-new_error",payload:{error:e}});else throw e}}},r=e=>async t=>{"direct-message"===e&&t(i({tab:"people"})),t({type:"inbox-set_filter",payload:e})}},8113:function(e,t,n){n.d(t,{aM:()=>M});var o=n(7409),i=n(99282),r=n(16584),s=n(30396),a=n(39693),l=n.n(a),d=n(44908),c=n.n(d),u=n(45578),m=n.n(u),_=n(69241),p=n(60807),h=n(12765),v=n(48980),g=n(9682),f=n(98914),y=n(8828),b=n(78308),w=n(97842),x=n(54584),Z=n(86190),P=n(46603),C=n(16889),I=n(91400),k=n(92039),S=n(98012),R=n(17440);function M(e){let{children:t,surface:n}=e,{user:a,userSettings:l}=(0,p.SE)(),d=l.newest_seen_chat_item_published_at,[{path:c}]=(0,g.tv)(),u=(0,I.XA)(),m=(0,k.rG)(),_=(0,k.m)(),[v,f]=(0,h.L)(A,(0,i._)((0,o._)({},w.UX),{user:a,users:new Map(a?[[a.id,a]]:[])}));(0,w.WG)({auto:!!a},{onSuccess:e=>{f({type:"inbox-unread_count",payload:e})}});let b=(0,s.sO)(0);return(0,s.d4)(()=>{if(m&&a)return m.listen({["user:".concat(a.id)]:e=>{let{data:t}=e;if(null==t?void 0:t.message){let{message:e}=t;"dms:new-message"===e.type||"dms:updated-message"===e.type?f(K(e)):"chat:updated-post"===e.type?f(ee(e)):"chat:new-post"===e.type&&f(et(e))}}})},[m]),(0,s.d4)(()=>{"open"===_&&a&&f((0,y.oH)())},[_]),(0,s.d4)(()=>{if("open"!==_){let e;let t=()=>{let e=Date.now(),{visibilityState:t="visible"}=document;a&&e-b.current>5e3&&"hidden"!==t&&(b.current=e,f((0,y.oH)()))},n=()=>{t(),e=setTimeout(n,3e4+Math.floor(2e3*Math.random()))},o=(0,C.n)(t);return c.startsWith("/chat")&&!u?n():t(),()=>{e&&clearTimeout(e),o()}}},[d,c,u,f,_]),(0,r.tZ)(x.o.Provider,{value:n,children:(0,r.tZ)(w.ge.Provider,{value:f,children:(0,r.tZ)(w.ky.Provider,{value:v,children:t})})})}let N={before:{isLoading:!1,hasMore:!1,error:null},after:{isLoading:!1,hasMore:!1,error:null},posts:[],publication:null,muteStatus:void 0,isLoaded:!1},L={isLoading:!1,hasMore:!1,error:null},B={before:{isLoading:!0,cursor:null,error:null},after:{isLoading:!1,cursor:null,error:null},replyIds:[]},O={before:L,after:(0,i._)((0,o._)({},L),{isLoading:!0}),target:null,lastViewedAt:null,order:"asc",comments:[],isLoaded:!1};function A(e,t){return t.type.startsWith("publications-")?function(e,t){if("publications-set"===t.type){var n;let r=t.payload,s=null!==(n=e.chats.get(r.id))&&void 0!==n?n:N;return(0,i._)((0,o._)({},e),{chats:(0,R.Rg)(e.chats,r.id,(0,i._)((0,o._)({},s),{publication:r})),publications:(0,R.Rg)(e.publications,r.id,r)})}return e}(e,t):t.type.startsWith("inbox-")?function(e,t){switch(t.type){case"inbox-new_items":{let{threads:n,hasMore:r,directMessagesUnreadCount:s,pendingInviteCount:a,pendingInviteUnreadCount:d,mostRecentChatTimestamp:c}=t.payload,u=(0,i._)((0,o._)({},e),{users:new Map([...e.users,...n.flatMap(e=>"chat"===e.type?e.user?[e.user]:[]:e.messageThread.members.map(e=>e.user)).map(e=>[e.id,e])]),communityPosts:new Map([...e.communityPosts,...l()(n.map(e=>"chat"===e.type&&e.communityPost?[e.communityPost.id,{communityPost:e.communityPost,pubRole:null,isNew:!1}]:null))]),communityComments:new Map([...e.communityComments,...l()(n.map(t=>{if("direct-message"===t.type&&t.recentMessage){var n;let{recentMessage:r}=t,{id:s}=r;return[r.id,(0,i._)((0,o._)({},e.communityComments.get(s)),{comment:r,userId:r.user_id,quoteId:null!==(n=r.quote_id)&&void 0!==n?n:void 0,isNew:!1})]}}))]),chats:new Map([...e.chats,...l()(n.map(t=>{if("chat"===t.type&&t.publication){var n;let r=null!==(n=e.chats.get(t.publication.id))&&void 0!==n?n:N;return[t.publication.id,(0,i._)((0,o._)({},r),{publication:t.publication,muteStatus:t.muteStatus,isPinned:t.isPinned})]}return null}))]),conversations:new Map([...e.conversations,...l()(n.map(t=>{if("direct-message"===t.type){let n=e.conversations.get(t.messageThread.id);return[t.messageThread.id,(0,i._)((0,o._)({},B,n),{thread:t.messageThread})]}}))])}),m=n.map((t,n)=>{var r,s,a,l,d,c,u,m;return"chat"===t.type?(0,i._)((0,o._)({},t),{communityPostId:null!==(c=null===(r=t.communityPost)||void 0===r?void 0:r.id)&&void 0!==c?c:null,muteStatus:null!==(u=t.muteStatus)&&void 0!==u?u:{is_muted:!1,expires_at:null},isPrimary:0===n&&0===e.inbox.threads.size&&t.publication.id===(null===(a=e.user)||void 0===a?void 0:null===(s=a.primary_publication)||void 0===s?void 0:s.id)||(null===(l=e.inbox.threads.get(t.id))||void 0===l?void 0:l.isPrimary)}):(0,i._)((0,o._)({},t),{messageThreadId:t.messageThread.id,recentMessageId:null!==(m=null===(d=t.recentMessage)||void 0===d?void 0:d.id)&&void 0!==m?m:null,isPrimary:!1})}),_=Q(m),p=(0,R.zg)(e.inbox.threads,m,e=>e.id),h=Q([...p.values()]),{filter:v}=e.inbox,g=(0,b.A)(v);return z((0,i._)((0,o._)({},u),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[g]:{hasMore:r&&_===h,isLoading:!1}}),threads:p,directMessagesUnreadCount:s,pendingInviteCount:a,pendingInviteUnreadCount:d,mostRecentChatTimestamp:c})}))}case"inbox-pin":{let{itemId:n,isPinned:r}=t.payload;return z((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.F5)(e.inbox.threads,n,{isPinned:r})})}))}case"inbox-mark_viewed":{let{itemId:n}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.F5)(e.inbox.threads,n,{lastViewedAt:new Date().toISOString()})})})}case"inbox-set_filter":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{filter:t.payload})});case"inbox-unread_count":{let{unreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:s,pubChatUnreadCount:a}=t.payload;return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{directMessagesUnreadCount:n,pendingInviteCount:r,pendingInviteUnreadCount:s,pubChatUnreadCount:a})})}case"inbox-new_error":return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{resources:(0,i._)((0,o._)({},e.inbox.resources),{[(0,b.A)(e.inbox.filter)]:{error:t.payload.error}})})});default:return e}}(e,t):t.type.startsWith("pub_chat-")?function(e,t){switch(t.type){case"pub_chat-mute":{let{expires_at:n,pubId:r}=t.payload;return z((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.FN)(e.inbox.threads,W(r),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!0,expires_at:n}}))})}))}case"pub_chat-unmute":{let{pubId:n}=t.payload;return z((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.FN)(e.inbox.threads,W(n),e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1,expires_at:null}}))})}))}case"pub_chat-leave":{let n=t.payload,r=W(n.id);return(0,i._)((0,o._)({},e),{chats:(0,R.i4)(e.chats,n.id),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.i4)(e.inbox.threads,W(n.id)),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"pub_chat-join":{let n=t.payload;W(n.id);let r=(0,R.Rg)(e.inbox.threads,W(n.id),{id:W(n.id),type:"chat",publication:n,communityPostId:null,lastViewedAt:new Date().toISOString(),timestamp:null});return(0,o._)({},z((0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:r}),chats:(0,R.FN)(e.chats,n.id,e=>(0,i._)((0,o._)({},e),{muteStatus:{is_muted:!1}})),publications:(0,R.Rg)(e.publications,n.id,n)})))}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("conversation-")?function(e,t){var n,r;switch(t.type){case"conversation-request_initial":{let{conversationId:n}=t.payload,r=e.conversations.get(n);if(r&&r.replyIds.length>0)return e;return(0,i._)((0,o._)({},e),{conversations:(0,R.Rg)(e.conversations,n,(0,o._)({},r,B))})}case"conversation-delete":{let{conversationId:n}=t.payload;new Map(e.conversations).delete(n);let r=H(n);return(0,i._)((0,o._)({},e),{conversations:(0,R.i4)(e.conversations,n),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.i4)(e.inbox.threads,r),threadList:e.inbox.threadList.filter(e=>e!==r)})})}case"conversation-request_error":{let{conversationId:n,cursor:r,edge:s,error:a}=t.payload,l=e.conversations.get(n);if(!l)return console.error("Attempting to set an error on missing conversation"),e;if(l[s].cursor!==r)return console.warn("Attempting to set an error on a missing cursor. Ignoring."),e;return(0,i._)((0,o._)({},e),{conversations:(0,R.Rg)(e.conversations,n,(0,i._)((0,o._)({},l),{[s]:{isLoading:!1,cursor:r,error:a}}))})}case"conversation-load_more":{let r;let{edge:s,cursor:a,page:{thread:d,replies:c,publications:u,comments:m,pastCursor:_,futureCursor:p,profile:h,subscriberContext:v}}=t.payload,g=c.map(e=>e.comment.id),f=new Set(g),y=e.conversations.get(d.id);if(!y)return console.error("Attempting to load messages for missing conversation"),e;if(y[s].cursor!==a)return console.warn("Attempting to load messages for an old cursor. Ignoring."),e;let b=y.replyIds.filter(e=>!f.has(e));b="before"===s?g.concat(b):b.concat(g),r=a?{[s]:{isLoading:!1,cursor:"before"===s?_:p,error:null}}:{before:{isLoading:!1,cursor:_,error:null},after:{isLoading:!1,cursor:p,error:null}};let w=(0,i._)((0,o._)({},y,r),{thread:d,replyIds:b}),x=h&&(null===(n=d.members.find(e=>e.user_id===h.id))||void 0===n?void 0:n.user),Z=(0,i._)((0,o._)({},e),{conversations:(0,R.Rg)(e.conversations,d.id,w),communityComments:$(e.communityComments,c.flatMap(e=>l()([e,e.quote]).map(J)),e=>e.comment.id,e=>e.comment.created_at),users:(0,R.zg)(e.users,c.flatMap(e=>{var t;return l()([e.user,null===(t=e.quote)||void 0===t?void 0:t.user])}),e=>e.id),profiles:h?(0,R.Rg)(e.profiles,h.id,(0,i._)((0,o._)({},x,h),{subscriberContext:v})):e.profiles,publications:u?(0,R.zg)(e.publications,u,e=>e.id):e.publications,notes:m?(0,R.zg)(e.notes,m,e=>"c-".concat(e.id)):e.notes});if("after"===s||!a)return E(Z,d.id,null);return Z}case"conversation-comments-new":{let{conversationId:n,linkUrl:s,quoteReply:a}=t.payload,l=e.conversations.get(n);if(!l)throw Error("Attempted to post message to missing conversation");let d={comment:(0,i._)((0,o._)({},F(e,t.payload)),{quote_id:null!==(r=l.quoteReply)&&void 0!==r?r:null}),clientId:t.payload.clientId,isNew:!0,is_banned:!1,link_metadata:s?{url:s,host:(0,f.Fo)(s)}:void 0,quote:a,quoteId:null==a?void 0:a.comment.id},c=(0,i._)((0,o._)({},l),{quoteReply:null,replyIds:[...l.replyIds,d.comment.id]});return E((0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,d.comment.id,d),conversations:(0,R.Rg)(e.conversations,n,c)}),n,d.comment.id)}case"conversation-comments-commit":{let{tempId:n}=t.payload,{threadId:r,reply:s,publications:a,comments:l}=t.payload;n=null!=n?n:s.client_id;let d=e.conversations.get(r);if(!d)throw Error("Attempted to post message to missing conversation");let c=n&&e.communityComments.get(n),u=new Map(e.communityComments),m=J(s);u.set(s.comment.id,c?(0,i._)((0,o._)({},m),{clientId:c.clientId,comment:(0,i._)((0,o._)({},m.comment),{media_uploads:c.comment.media_uploads})}):m),s.quote&&u.set(s.quote.comment.id,J(s.quote));let _=d.replyIds,p=s.comment.id;return n&&(_=_.map(e=>e===n?p:e)),_.includes(p)||(_=[..._,p]),_=[...new Set(_)],E((0,i._)((0,o._)({},e),{conversations:(0,R.Rg)(e.conversations,r,(0,i._)((0,o._)({},d),{replyIds:_})),communityComments:u,publications:a?(0,R.zg)(e.publications,a,e=>e.id):e.publications,notes:l?(0,R.zg)(e.notes,l,e=>"c-".concat(e.id)):e.notes}),r,s.comment.id)}case"conversation-comments-error":{let{commentId:n,error:r}=t.payload,s=e.communityComments.get(n);if(!s)throw Error("Attempted to assing error to missing comment");if(!s.isNew)throw Error("Attempted to set error on persisted comment");return(0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{error:r}))})}case"conversation-quote-set":{let{conversationId:n,commentId:r}=t.payload,s=e.conversations.get(n);if(!s)throw Error("Tried to quote a message in a conversation that does not exist");return(0,i._)((0,o._)({},e),{conversations:(0,R.Rg)(e.conversations,n,(0,i._)((0,o._)({},s),{quoteReply:r}))})}case"conversation-invite-accept":{let{conversationId:n}=t.payload;return D(e,n,{membership_state:"accepted"})}case"conversation-invite-reject":{let n=new Map(e.conversations);return n.delete(t.payload.conversationId),(0,i._)((0,o._)({},e),{conversations:n})}case"conversation-invite-restore":{let{conversationId:n}=t.payload;return D(e,n,{membership_state:"pending"})}case"conversation-mute":{let{conversationId:n,time:o}=t.payload;return D(e,n,{unmute_at:o?(0,S.Z)().add(1,"hour").toISOString():null})}case"conversation-toggle_reaction":{let{messageId:n,reaction:r}=t.payload,s=e.communityComments.get(n);if(!s)return console.warn("chat item does not exist"),e;let a=r!==s.comment.reaction;return(0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{comment:X(s.comment,r,a)}))})}default:return e}}(e,t):t.type.startsWith("posts-")?function(e,t){var n,r,s,a,l,d;let{publication_id:u}=t.payload,m=null!==(n=e.chats.get(u))&&void 0!==n?n:N;switch(t.type){case"posts-request_initial":return(0,i._)((0,o._)({},e),{chats:(0,R.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{after:(0,i._)((0,o._)({},m.after),{isLoading:!0})}))});case"posts-request_more":return(0,i._)((0,o._)({},e),{chats:(0,R.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{before:(0,i._)((0,o._)({},m.before),{isLoading:!0})}))});case"posts-load_more":{let{result:n,direction:r}=t.payload,s=n.threads.find(e=>"deleted"!==e.communityPost.status),a=$(e.communityPosts,n.threads,e=>e.communityPost.id,e=>e.communityPost.created_at),l=W(u),d=(null==m?void 0:m.isLoaded)?{[r]:{isLoading:!1,hasMore:"before"===r?n.moreBefore:n.moreAfter,error:null}}:{before:{isLoading:!1,hasMore:n.moreBefore,error:null},after:{isLoading:!1,hasMore:n.moreAfter,error:null}},_=(0,i._)((0,o._)({},e),{users:(0,R.zg)(e.users,n.threads.map(e=>e.user),e=>e.id),communityPosts:a,chats:(0,R.Rg)(e.chats,u,(0,i._)((0,o._)({},m,d),{posts:c()([...m.posts,...n.threads.map(e=>e.communityPost.id)]).sort((e,t)=>{var n,o;return Y(null===(n=a.get(e))||void 0===n?void 0:n.communityPost.created_at,null===(o=a.get(t))||void 0===o?void 0:o.communityPost.created_at)}),muteStatus:n.muteStatus,lastViewedAt:n.lastViewedAt,isLoaded:!0})),inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.FN)(e.inbox.threads,l,e=>{var t,r;return"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!==(t=null==s?void 0:s.communityPost.id)&&void 0!==t?t:e.communityPostId,lastViewedAt:null!==(r=n.lastViewedAt)&&void 0!==r?r:null}):e})})});return(0,i._)((0,o._)({},_),{inbox:"before"===r?e.inbox:(0,i._)((0,o._)({},e.inbox),{threadList:U(_)})})}case"posts-error":{let{error:n,direction:r}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,R.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{[r]:{isLoading:!1,hasMore:!0,error:n}}))})}case"posts-mark_viewed":{let t=new Date().toISOString();return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.F5)(e.inbox.threads,W(u),{lastViewedAt:new Date().toISOString()})}),chats:(0,R.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{lastViewedAt:t}))})}case"posts-new":{let n=new Date().toISOString(),a={communityPost:(0,i._)((0,o._)({},t.payload),{status:"published",created_at:n,updated_at:n,is_locked:!1,is_edited:!1,user_id:null!==(s=null===(r=e.user)||void 0===r?void 0:r.id)&&void 0!==s?s:0,user:e.user,mediaAttachments:[],paywallInfo:null}),isNew:!0};return(0,i._)((0,o._)({},e),{communityPosts:(0,R.Rg)(e.communityPosts,a.communityPost.id,a),chats:(0,R.Rg)(e.chats,u,(0,i._)((0,o._)({},m),{posts:[a.communityPost.id,...m.posts]}))})}case"posts-updated":{let{id:n,chatItem:r}=t.payload;if(!m.posts.includes(n))return e;let s=new Map(e.communityPosts);return s.set(r.communityPost.id,r),(0,i._)((0,o._)({},e),{communityPosts:s})}case"posts-new_incoming":{let{chatItem:n,publication_id:r,id:s}=t.payload,a=new Map(e.communityPosts);a.set(s,n);let l=Array.from(new Set([s,...m.posts]));return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.F5)(e.inbox.threads,W(r),{communityPostId:n.communityPost.id})}),users:n.communityPost.user?(0,R.Rg)(e.users,n.communityPost.user.id,n.communityPost.user):e.users,communityPosts:a,chats:(0,R.Rg)(e.chats,r,(0,i._)((0,o._)({},m),{posts:l}))})}case"posts-commit":{let{id:n,chatItem:r,publication_id:s}=t.payload,a=new Map(e.communityPosts);a.delete(n),a.set(r.communityPost.id,r);let l=m.posts.includes(n)?m.posts.map(e=>e===n?r.communityPost.id:e):m.after.hasMore?m.posts:[r.communityPost.id,...m.posts];return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.F5)(e.inbox.threads,W(s),{communityPostId:r.communityPost.id})}),communityPosts:a,chats:(0,R.Rg)(e.chats,s,(0,i._)((0,o._)({},m),{posts:l}))})}case"posts-new_reaction":{let{id:n,reaction:r}=t.payload,s=e.communityPosts.get(n);if(!s||!j(s)||!(null===(a=s.communityPost)||void 0===a?void 0:a.reactions))return console.warn("chat item does not exist"),e;if(s.communityPost.reaction===r)return console.warn("already set this reaction",r),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,R.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:X(s.communityPost,r,!0)}))})}case"posts-remove_reaction":{let{id:n,reaction:r}=t.payload,s=e.communityPosts.get(n);if(!s||!j(s)||!(null===(l=s.communityPost)||void 0===l?void 0:l.reactions))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,R.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:X(s.communityPost,r,!1)}))})}case"posts-delete_post":{let{id:n,publication_id:r}=t.payload,s=e.communityPosts.get(n);if(!s)return console.warn("chat item does not exist"),e;let a=new Map(e.communityComments),l=e.comments.get(n);l&&l.comments.forEach(t=>{q(t,a);let n=e.replies.get(t);n&&n.comments.forEach(e=>{q(e,a)})});let c=null===(d=e.chats.get(r))||void 0===d?void 0:d.posts.filter(t=>{var o;if(t===n)return!1;let i=e.communityPosts.get(t);return(null==i?void 0:null===(o=i.communityPost)||void 0===o?void 0:o.status)!=="deleted"}).sort((t,n)=>{var o,i;let r=null===(o=e.communityPosts.get(t))||void 0===o?void 0:o.communityPost,s=null===(i=e.communityPosts.get(n))||void 0===i?void 0:i.communityPost;return Y(null==r?void 0:r.created_at,null==s?void 0:s.created_at)})[0],u=(0,i._)((0,o._)({},e),{communityPosts:(0,R.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:(0,i._)((0,o._)({},s.communityPost),{status:"deleted",updated_at:new Date().toISOString()})})),communityComments:a,inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.FN)(e.inbox.threads,W(r),e=>"chat"===e.type?(0,i._)((0,o._)({},e),{communityPostId:null!=c?c:null}):e)})});return(0,i._)((0,o._)({},u),{inbox:(0,i._)((0,o._)({},u.inbox),{threadList:U(u)})})}case"posts-flag_post":{let{id:n}=t.payload,r=e.communityPosts.get(n);if(!r||!j(r))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,R.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},r),{communityPost:(0,i._)((0,o._)({},r.communityPost),{reported_by_user:!0})}))})}case"posts-lock_replies":{let{id:n,isLocked:r}=t.payload,s=e.communityPosts.get(n);if(!s||!j(s))return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,R.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:(0,i._)((0,o._)({},s.communityPost),{is_locked:r})}))})}case"posts-link_metadata":{let{id:n,link_metadata:r}=t.payload,s=e.communityPosts.get(n);if(!s)return console.warn("chat item does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,R.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:(0,i._)((0,o._)({},s.communityPost),{link_metadata:r})}))})}case"posts-save_scroll_position":{let{publication_id:n,scrollOffset:r,scrollCache:s}=t.payload;return(0,i._)((0,o._)({},e),{chats:(0,R.Rg)(e.chats,n,(0,i._)((0,o._)({},m),{scrollOffset:r,scrollCache:s}))})}case"posts-update_post":{let{id:n,post:r}=t.payload,s=e.communityPosts.get(n);if(!s||!j(s))return console.warn("post does not exist"),e;return(0,i._)((0,o._)({},e),{communityPosts:(0,R.Rg)(e.communityPosts,n,(0,i._)((0,o._)({},s),{communityPost:(0,o._)({},s.communityPost,r)}))})}case"posts-edit_post":{let{post:n}=t.payload;return(0,i._)((0,o._)({},e),{editingPost:n})}default:throw Error("Invalid action type")}}(e,t):t.type.startsWith("replies-")||t.type.startsWith("comments-")?function(e,t){var n,r,s,a,d,u,m,_,p;let h,g=null,f=null;"parentCommentId"in(p=t).payload&&p.payload.parentCommentId?f=t.payload.parentCommentId:"postId"in t.payload&&(g=t.payload.postId);let y=e=>f?{replies:e}:{comments:e};h=f?null!==(n=e.replies.get(f))&&void 0!==n?n:O:g&&null!==(r=e.comments.get(g))&&void 0!==r?r:O;let b=f?e.replies:e.comments,w=null!=f?f:g;switch(t.type){case"replies-clear":case"comments-clear":return w?(0,o._)({},e,y((0,R.Rg)(b,w,O))):e;case"replies-request_initial":case"comments-request_initial":{let{order:n,target:r}=t.payload,a=(0,i._)((0,o._)({},L),{isLoading:!0,hasMore:!1}),l=r&&(null==h?void 0:h.comments.includes(r.id));return(0,o._)({},e,y((0,R.Rg)(b,w,(0,i._)((0,o._)({},h),{before:"desc"===n?a:L,after:"asc"===n?a:L,order:n,target:null!=r?r:null,isLoaded:(!r||!!l)&&null!==(s=null==h?void 0:h.isLoaded)&&void 0!==s&&s}))))}case"replies-request_edge":case"comments-request_edge":{let{edge:n}=t.payload;return(0,o._)({},e,y((0,R.Rg)(b,w,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{isLoading:!0,error:null})}))))}case"replies-load_edge":case"comments-load_edge":{let{edge:n,result:{post:r,parent:s,replies:a,more:d,moreAfter:u,moreBefore:m,lastViewedAt:_}}=t.payload,p=null;if((null==r?void 0:r.communityPost.publication_id)&&(null==r?void 0:r.communityPost.muted)){let t={is_muted:!0,type:r.communityPost.left_pub_chat?"leave":"mute"},n=e.chats.get(null==r?void 0:r.communityPost.publication_id)||N;n.muteStatus||(p=(0,R.Rg)(e.chats,r.communityPost.publication_id,(0,i._)((0,o._)({},n),{muteStatus:t})))}let v=a.map(e=>e.comment.id),g=$(e.communityComments,a.flatMap(e=>l()([e,e.quote]).map(J)),e=>e.comment.id,e=>e.comment.updated_at);if(s)g.set(s.comment.id,(0,i._)((0,o._)({},s),{userId:s.user.id}));let f=(0,R.zg)(e.users,l()([null==r?void 0:r.communityPost.user,null==s?void 0:s.user]),e=>e.id),x=w?b.get(w):null,Z=(null==x?void 0:x.isLoaded)?{[n]:{isLoading:!1,hasMore:d,error:null}}:{before:{isLoading:!1,hasMore:m,error:null},after:{isLoading:!1,hasMore:u,error:null}};return(0,o._)((0,i._)((0,o._)((0,i._)((0,o._)({},e),{communityPosts:r?(0,R.Rg)(e.communityPosts,r.communityPost.id,r):e.communityPosts,communityComments:g}),p?{chats:p}:{}),{users:new Map([...f,...a.map(e=>[e.user.id,e.user])])}),y((0,R.Rg)(b,w,(0,i._)((0,o._)((0,i._)((0,o._)({},h),{comments:c()([...h.comments,...v]).sort((e,t)=>{var n,o;return Y(null===(n=g.get(e))||void 0===n?void 0:n.comment.created_at,null===(o=g.get(t))||void 0===o?void 0:o.comment.created_at)}).filter(e=>{var t;return(null===(t=g.get(e))||void 0===t?void 0:t.comment.status)!=="flagged"})}),Z),{order:"after"!==n||d?h.order:"desc",isLoaded:!0,lastViewedAt:_}))))}case"replies-target":case"comments-target":return w?(0,o._)({},e,y((0,R.Rg)(b,w,(0,i._)((0,o._)({},h),{target:t.payload.target})))):e;case"replies-mark_viewed":case"comments-mark_viewed":{let{lastViewedAt:n}=t.payload;if("postId"in t.payload){let{postId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityPosts:(0,R.FN)(e.communityPosts,r,e=>(0,i._)((0,o._)({},e),{communityPost:(0,i._)((0,o._)({},e.communityPost),{user_last_viewed_timestamp:n})}))})}else{let{parentCommentId:r}=t.payload;e=(0,i._)((0,o._)({},e),{communityComments:(0,R.FN)(e.communityComments,r,e=>(0,i._)((0,o._)({},e),{comment:(0,i._)((0,o._)({},e.comment),{user_last_viewed_timestamp:n})}))})}return w?(0,o._)({},e,y((0,R.Rg)(b,w,(0,i._)((0,o._)({},h),{lastViewedAt:n})))):e}case"comments-quote_set":{let{commentId:n}=t.payload;return w?(0,o._)({},e,y((0,R.Rg)(b,w,(0,i._)((0,o._)({},h),{quoteReply:n})))):e}case"replies-new":case"comments-new":{let n=t.payload,r={comment:(0,i._)((0,o._)({},F(e,n)),{quote_id:null!==(u=null===(a=n.quoteReply)||void 0===a?void 0:a.comment.id)&&void 0!==u?u:null,post_id:n.postId,parent_id:f}),isNew:!0,is_banned:!1,quote:n.quoteReply,quoteId:null===(d=n.quoteReply)||void 0===d?void 0:d.comment.id,pub_roles:n.pubRoles},s=(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,r.comment.id,r)}),y((0,R.Rg)(b,w,(0,i._)((0,o._)({},h),{comments:[r.comment.id,...h.comments],lastViewedAt:new Date().toISOString()}))));if(f){let n=e.communityComments.get(f);if(n&&G(n)){let r=T(n.comment,e.user,t.payload.postId);s.communityComments.set(f,(0,i._)((0,o._)({},n),{comment:r}))}}let l=e.communityPosts.get(t.payload.postId);if(l&&j(l)){let n=T(l.communityPost,e.user,t.payload.postId);s.communityPosts=(0,R.Rg)(e.communityPosts,t.payload.postId,(0,i._)((0,o._)({},l),{communityPost:n}))}return s}case"replies-commit":case"comments-commit":{let{id:n,reply:r}=t.payload,s=new Map(e.communityComments);s.delete(n),s.set(r.comment.id,J(r));let a=h.comments.includes(n)?h.comments.map(e=>e===n?r.comment.id:e):h.after.hasMore?h.comments:[r.comment.id,...h.comments];return(0,o._)((0,i._)((0,o._)({},e),{communityComments:s}),y((0,R.Rg)(b,w,(0,i._)((0,o._)({},h),{comments:a}))))}case"comments-updated":{let{id:n,reply:r}=t.payload;if(!h.comments.includes(n))return e;let s=h.comments.map(e=>e===n?r.comment.id:e);return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,J(r))}),y((0,R.Rg)(b,w,(0,i._)((0,o._)({},h),{comments:s}))))}case"comments-new_incoming":{let{id:n,reply:r}=t.payload;return(0,o._)((0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,J(r)),users:r.user?(0,R.Rg)(e.users,r.userId,r.user):e.users}),y((0,R.Rg)(b,w,(0,i._)((0,o._)({},h),{comments:Array.from(new Set([r.comment.id,...h.comments]))}))))}case"replies-error":case"comments-error":{let{edge:n,error:r}=t.payload;if(r instanceof v.kp){let t=r.body.post;t&&(e=(0,i._)((0,o._)({},e),{communityPosts:(0,R.Rg)(e.communityPosts,t.communityPost.id,(0,i._)((0,o._)({},t),{pubRole:null})),users:t.user?(0,R.Rg)(e.users,t.user.id,t.user):e.users}))}return(0,o._)({},e,y((0,R.Rg)(b,w,(0,i._)((0,o._)({},h),{[n]:(0,i._)((0,o._)({},h[n]),{error:r})}))))}case"comments-new_reaction":{let{id:n,reaction:r}=t.payload,s=e.communityComments.get(n);if(!s||!G(s)||!(null===(m=s.comment)||void 0===m?void 0:m.reactions))return console.warn("comment does not exist"),e;if(s.comment.reaction===r)return console.warn("reaction already set"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{comment:X(s.comment,r,!0)}))})}case"comments-remove_reaction":{let{id:n,reaction:r}=t.payload,s=e.communityComments.get(n);if(!s||!G(s)||!(null===(_=s.comment)||void 0===_?void 0:_.reactions))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{comment:X(s.comment,r,!1)}))})}case"comments-delete_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r)return console.warn("comment does not exist, cannot delete"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{status:"deleted",updated_at:new Date().toISOString()})}))})}case"comments-update_comment":{let{id:n,comment:r}=t.payload,s=e.communityComments.get(n);if(!s||!G(s))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{comment:(0,o._)({},s.comment,r)}))})}case"comments-flag_comment":{let{id:n}=t.payload,r=e.communityComments.get(n);if(!r||!G(r))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,(0,i._)((0,o._)({},r),{comment:(0,i._)((0,o._)({},r.comment),{reported_by_user:!0})}))})}case"comments-ban_author":{let{id:n,ban:r}=t.payload,s=e.communityComments.get(n);if(!s||!G(s))return console.warn("comment does not exist"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{is_banned:r}))})}case"comments-lock_replies":{let{id:n,isLocked:r}=t.payload,s=e.communityComments.get(n);if(!s||!G(s))return console.warn("comment does not exist"),e;if(s.comment.parent_id)return console.warn("cannot lock replies on a reply to a comment"),e;return(0,i._)((0,o._)({},e),{communityComments:(0,R.Rg)(e.communityComments,n,(0,i._)((0,o._)({},s),{comment:(0,i._)((0,o._)({},s.comment),{is_locked:r})}))})}default:throw Error("Invalid type")}}(e,t):e}function T(e,t,n){var r,s;let a;return(t&&t.photo_url&&(a=[{id:t.id,name:t.name,photo_url:t.photo_url,post_id:n}],e.recent_commenters&&(a=m()([...a,...e.recent_commenters],e=>e.id))),"reply_count"in e)?(0,i._)((0,o._)({},e),{recent_commenters:a,reply_count:1+(null!==(r=e.reply_count)&&void 0!==r?r:0)}):"comment_count"in e?(0,i._)((0,o._)({},e),{recent_commenters:a,comment_count:1+(null!==(s=e.comment_count)&&void 0!==s?s:0)}):e}function q(e,t){let n=t.get(e);return!!n&&"deleted"!==n.comment.status&&(t.set(e,(0,i._)((0,o._)({},n),{comment:(0,i._)((0,o._)({},n.comment),{status:"deleted",updated_at:new Date().toISOString()})})),!0)}function F(e,t){var n,r,s;return(0,i._)((0,o._)({},function(){let e=new Date().toISOString();return{id:"",created_at:e,updated_at:e,user_id:0,post_id:"",body:"",raw_body:"",media_uploads:null,parent_id:null,is_locked:!1,quote_id:null,status:"published",reactions:{}}}()),{id:t.id,body:t.body,raw_body:t.mentions?t.body:void 0,media_uploads:null!==(r=t.mediaUploads)&&void 0!==r?r:null,user_id:null!==(s=null===(n=e.user)||void 0===n?void 0:n.id)&&void 0!==s?s:0,mentions:t.mentions,mediaAttachments:t.mediaAttachments,conversation_id:t.conversationId})}function E(e,t,n){let r=H(t),s=e.inbox.threads.get(r),a=(null==s?void 0:s.type)==="direct-message"?s:null,l=(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threads:(0,R.Rg)(e.inbox.threads,r,(0,i._)((0,o._)({timestamp:new Date().toISOString()},a),{id:r,type:"direct-message",messageThreadId:t,lastViewedAt:new Date().toISOString(),recentMessageId:n}))})});return(0,i._)((0,o._)({},l),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:U(l)})})}function X(e,t,n){var r,s;let a=e.reaction,l=(0,o._)({},e.reactions);return l[t]=(null!==(r=l[t])&&void 0!==r?r:0)+(n?1:-1),n&&a&&(l[a]=(null!==(s=l[a])&&void 0!==s?s:0)-1),(0,i._)((0,o._)({},e),{reactions:l,reaction:n?t:null})}function z(e){return(0,i._)((0,o._)({},e),{inbox:(0,i._)((0,o._)({},e.inbox),{threadList:U(e)})})}function U(e){return[...e.inbox.threads.values()].sort((t,n)=>n.isPrimary&&!t.isPrimary?1:!n.isPrimary&&t.isPrimary?-1:n.isPinned&&!t.isPinned?1:!n.isPinned&&t.isPinned?-1:Y(V(e,t),V(e,n))).map(e=>e.id)}function V(e,t){var n,o,i,r;return"chat"===t.type?null!==(i=t.communityPostId&&(null===(o=e.communityPosts.get(t.communityPostId))||void 0===o?void 0:o.communityPost.created_at))&&void 0!==i?i:t.timestamp:null!==(r=null===(n=(0,P._)(e,t))||void 0===n?void 0:n.comment.created_at)&&void 0!==r?r:t.timestamp}function D(e,t,n){let r=e.conversations.get(t),s=null==r?void 0:r.thread;if(!r||!s)throw Error("Tried to update a conversation that does not exist.");let a=e.user;if(!a)throw Error("Cannot update conversation if the user does not exist.");return(0,i._)((0,o._)({},e),{conversations:(0,R.Rg)(e.conversations,t,(0,i._)((0,o._)({},r),{thread:(0,i._)((0,o._)({},s),{members:s.members.map(e=>e.user_id===a.id?(0,o._)({},e,n):e)})}))})}function W(e){return"chat-".concat(e)}function H(e){return"direct-message-".concat(e)}function J(e){var t,n,r,s;return(0,i._)((0,o._)({},e),{userId:null===(t=e.user)||void 0===t?void 0:t.id,quoteId:null!==(s=null!==(r=null===(n=e.quote)||void 0===n?void 0:n.comment.id)&&void 0!==r?r:e.comment.quote_id)&&void 0!==s?s:void 0})}function j(e){return!0!==e.isNew}function G(e){return!0!==e.isNew}function Y(e,t){return e===t?0:!t||e&&e>t?-1:1}function $(e,t,n,i){let r=new Map(e);for(let e of t){let t=n(e),s=r.get(t);if(!s){r.set(t,e);continue}i(e)>=i(s)&&r.set(t,(0,o._)({},s,e))}return r}function Q(e){let t=new Date().toISOString();return e.reduce((e,n)=>{var o;let i=null!==(o=n.timestamp)&&void 0!==o?o:t;return i<e?i:e},t)}let K=e=>async(t,n)=>{let o=e.reply.comment.post_id;n().conversations.get(o)||await t((0,Z.U)(o)),t({type:"conversation-comments-commit",payload:{threadId:e.reply.comment.post_id,reply:e.reply}}),(0,_.JG)("/api/v1/messages/unread-count")},ee=e=>async t=>{var n,r;let{post:s}=e;if("deleted"===s.status){t({type:"posts-delete_post",payload:{id:s.id,publication_id:s.publication_id}});return}t({type:"posts-updated",payload:{id:s.id,chatItem:{communityPost:(0,i._)((0,o._)({},s),{user:s.author,user_id:s.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=s.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=s.user_pub_role_object)&&void 0!==r?r:null}}})},et=e=>async t=>{var n,r;let{post:s}=e;t({type:"posts-new_incoming",payload:{publication_id:s.publication_id,id:s.id,chatItem:{communityPost:(0,i._)((0,o._)({},s),{user:s.author,user_id:s.author.id,is_locked:!1,is_edited:!1,user_pub_role:null===(n=s.user_pub_role_object)||void 0===n?void 0:n.role}),pubRole:null!==(r=s.user_pub_role_object)&&void 0!==r?r:null}}})}},76819:function(e,t,n){n.d(t,{Hs:()=>s,Rx:()=>a,ye:()=>r});var o=n(7409),i=n(75561);function r(e){var t,n,o;return e.link_title||(null===(t=e.postTag)||void 0===t?void 0:t.name)||(null===(n=e.section)||void 0===n?void 0:n.name)||(null===(o=e.post)||void 0===o?void 0:o.title)||""}function s(e){var t;return e.postTag?"tag":e.section?"section":(null===(t=e.post)||void 0===t?void 0:t.type)==="page"?"page":e.post?"post":"link"}function a(e,t){let{isChatActive:n,isMeetingsActive:r,hasMultipleNewsletters:s,isChatEnabled:a,isFeedEnabled:l,isReaderReferralsLeaderboardActive:d,language:c="en",useReordering:u=!1}=t,m=e.filter(e=>!e.standard_key),_=new Map(e.filter(e=>e.standard_key).map(e=>[e.standard_key,e])),{iString:p}=I18N.i(c);for(let e of m){var h;(null===(h=e.section)||void 0===h?void 0:h.hide_from_navbar)&&(e.is_hidden=!0)}let v=[l&&{standard_key:"notes",link_title:"Notes",link_url:"/notes"},a&&{standard_key:"chat",link_title:"Chat",link_url:"/chat",is_hidden:!n},r&&{standard_key:"meetings",link_title:"Meetings",link_url:"/meetings"},...m,{standard_key:"archive",link_title:p("Archive"),link_url:"/archive"},s&&{standard_key:"newsletters",link_title:p("Newsletters"),link_url:"/newsletters",is_hidden:!0},d&&{standard_key:"leaderboard",link_title:p("Leaderboard"),link_url:"/leaderboard"},{standard_key:"about",link_title:p("About"),link_url:"/about"}].filter(e=>!!e).map(e=>{if(e.standard_key){let t=_.get(e.standard_key);if(t)return(0,i.CD)((0,o._)({},e),t)}return e});if(u){let e=["about","notes","chat","archive"];return[...v.filter(t=>!e.includes(t.standard_key||"")),...e.map(e=>v.find(t=>t.standard_key===e)).filter(e=>!!e)].filter(e=>!!e)}return v}},62515:function(e,t,n){n.d(t,{Ds:()=>l,Rm:()=>r,aD:()=>s,gp:()=>a});var o=n(14773),i=n(63651);function r(e,t){return(0,o.Q2)("/chat/".concat(e),t)}function s(e,t){return(0,o.Q2)("/chat/".concat(e),t)}function a(e){return(0,o.Q2)("/chat/new",e)}function l(e){let{userId:t,userName:n}=e,r=(0,i.JlE)({userId:t,userName:n});return"".concat((0,o.ZX)(),"/chat/dm/user/").concat(r)}},36515:function(e,t,n){n.d(t,{r:()=>s});var o=n(7409),i=n(99282),r=n(14773);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.Q2)("/publish/chat",(0,i._)((0,o._)({},t),{pub:e}))}}}]);