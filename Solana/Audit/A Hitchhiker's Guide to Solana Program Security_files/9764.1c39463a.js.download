"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["9764"],{16104:function(e,t,i){i(16584),i(64515)},32582:function(e,t,i){i.d(t,{G6:()=>E,PH:()=>A});var n=i(7409),l=i(99282),r=i(16584),o=i(6400),a=i(30396),s=i(85564),c=i.n(s),d=i(84753),u=i.n(d),h=i(43174),p=i.n(h),b=i(89734),v=i.n(b),m=i(45578),w=i.n(m),Z=i(20042),f=i(80569),g=i.n(f),y=i(20253),k=i(39535),N=i(94499),S=i(30363),X=i(32261),_=i(98914),B=i(15771),x=i(43570),C=i(98012),z=i(60308),P=i(26111),T=i(47929);let I=e=>{let{onClick:t,checked:i}=e;return(0,r.BX)("div",{className:"select-all",children:[(0,r.tZ)("input",{name:"all",type:"checkbox",onInput:t,checked:i}),(0,r.BX)("label",{for:"all",onClick:t,children:["Select ",i?"none":"all"]})]})},J=e=>{let{disabled:t,onClick:i,children:n}=e;return(0,r.tZ)(B.zx,{type:"submit",priority:"primary",size:"lg",disabled:t,onClick:i,children:n})},A=e=>{let{extraProps:t={},linkType:i=null,discoverable:o=null,text:a,icon:s=!0,onClick:c=null}=e,d={};null!==i&&(d.type=i),null!==o&&(d.discoverable=o);let u=(0,z.nRe)(d);return(0,r.tZ)("div",(0,l._)((0,n._)({className:"twitter-discover"},t),{children:(0,r.tZ)("a",(0,l._)((0,n._)({className:"twitter-link",href:u},c&&{onClick:c}),{native:!0,children:(0,r.BX)("div",{className:"inner",children:[s&&(0,r.tZ)(k.Z,{fill:"white"}),(0,r.tZ)("span",{className:"twitter-link-text",children:a||"Find writers and creators I follow"})]})}))}))},D=e=>{let{pub:t,checked:i,onToggle:n,isSubscribed:l,author:o,screenName:a}=e;return(0,r.tZ)("li",{className:"linked-pub",children:(0,r.BX)("div",{className:"linked-pub",children:[(0,r.BX)("div",{className:"photo",children:[(0,r.tZ)("div",{className:"subscribed-status",children:(0,r.tZ)("input",{type:"checkbox",checked:i||l,disabled:l,onInput:()=>n(t.id)})}),(0,r.tZ)(X.fi,{size:60,photo_url:o.photo_url}),(0,r.BX)("div",{className:"twitter-handle",children:[(0,r.tZ)("span",{className:"author",children:null==o?void 0:o.name}),(0,r.BX)("span",{className:"handle",children:[" @",a]})]})]}),(0,r.tZ)("div",{className:"info",children:(0,r.tZ)("div",{className:"publication-row",children:(0,r.tZ)("a",{className:"publication",href:(0,z.rhs)("".concat((0,z.SVA)(t),"/"),{utm_source:T.b3.substack,utm_medium:T.lP.web,utm_content:T.fZ.discoverTwitter}),target:"_blank",native:!0,children:(0,r.tZ)(S.ZP,{publication:t,logo_size:30,children:l?(0,r.tZ)("div",{className:"subscribed",children:(0,r.tZ)(x.Vp,{children:"Subscribed"})}):null})})})})]})})},F=e=>{var t;let{result:i,selectedPubs:n,onToggle:l}=e,{publicationAuthor:o,screen_name:a,publication_id:s}=i,{name:c,ownedPublications:d}=o,u=w()(d,e=>e.id),h=v()(u,e=>{var t;return(null===(t=e.latestPost)||void 0===t?void 0:t[0])?(0,C.Z)(e.latestPost[0].post_date).toDate():C.Z.unix(1).toDate()}).reverse(),p=o.photo_url||(null===(t=d.find(e=>e.id===s))||void 0===t?void 0:t.logo_url);return h.map(e=>{var t;let i=!!(null===(t=e.subscriptions)||void 0===t?void 0:t.length);return(0,r.tZ)(D,{author:o,screenName:a,authorName:c,showLogo:p!==o.photo_url,pub:e,checked:n.has(e.id),onToggle:l,isSubscribed:i})})},W=e=>{let{user:t,freeSignupEmail:i,twitterEmail:n,twitterToken:l,onConfirmed:o,onSubscribed:s,formAction:c,pubIds:d,subscribeToken:u,redirect:h,showDiscover:p,editable:b,showLogout:v}=e,m=(null==t?void 0:t.email)||i||n,[w,Z]=(0,a.eJ)(!1),[f,g]=(0,a.eJ)(!0),[k,N]=(0,a.eJ)(m);h=d?(0,z.rhs)(h,{pubIds:d,t:l}):(0,z.rhs)(h,{t:l,d:f});let S=e=>{let{userExists:t,subscribed:i}=e.body;i?null==s||s(i):t?t&&(0,_.uX)((0,z.n1t)("".concat((0,z.ZJn)(),"/sign-in"),{with_password:!1,email:k,redirect:h})):null==o||o()};return(0,r.tZ)("div",{className:"twitter-publications container",children:(0,r.tZ)("section",{children:(0,r.tZ)("div",{className:"terms-check",children:(0,r.BX)(y.ZP,{onSuccess:e=>S(e),method:"post",action:c,loading:!1,autoLock:!0,children:[(0,r.tZ)("input",{name:"t",type:"hidden",value:l}),d&&(0,r.tZ)("input",{name:"pubIds",type:"hidden",value:d}),u&&(0,r.tZ)("input",{name:"subscribeToken",type:"hidden",value:u}),(0,r.tZ)("input",{name:"email",type:"text",disabled:!b&&!!m,value:k,onInput:e=>{N(e.target.value)}}),(0,r.BX)("label",{children:[(0,r.tZ)("input",{type:"checkbox",checked:w,onInput:()=>Z(!w)}),"I accept the"," ",(0,r.tZ)("a",{href:"/tos",target:"_blank",native:!0,children:"Terms of Use"})]}),p&&(0,r.BX)("label",{children:[(0,r.tZ)("input",{name:"allow_discover",type:"checkbox",checked:f,onInput:()=>g(!w)}),"Allow people to find my publications via Twitter"]}),v&&(0,r.tZ)("label",{children:(0,r.tZ)("a",{className:"login-button",href:(0,z.ZPN)(),native:!0,children:"Not you?"})}),(0,r.tZ)(J,{disabled:!w,children:"Next â†’"})]})})})})},E=e=>{let t,{user:i,stage:n,twitterEmail:l,freeSignupEmail:s,twitterToken:d,buttonText:u=null,onSignup:h=null,requireSignup:p=!0,needsEmailConfirm:b=!0,renderIfNoneFound:v=null,useProfilePrefix:m=!1}=e,[w,f]=(0,a.eJ)(null),[y,k]=(0,a.eJ)(null),[N,S]=(0,a.eJ)(null),[X,_]=(0,a.eJ)(null),[B,x]=(0,a.eJ)(!b),[C,z]=(0,a.eJ)(null),[T,I]=(0,a.eJ)(!1),[J,D]=(0,a.eJ)(new Set),[F,E]=(0,a.eJ)(null),L=(0,P.x)("subscribed"),M=m?"/profile":"";L?h?h():(S(L.split(",")),(0,Z.route)("/discover-twitter/success")):!n||"connect"===n||w||N||(0,Z.route)("/discover-twitter");let V=e=>c()(e.map(e=>{var t;return(null===(t=e.publicationAuthor)||void 0===t?void 0:t.ownedPublications)||[]}));(0,a.d4)(()=>{(async()=>{if(!T){I(!0);try{let e=(await g().get("/api/v1/twitter/publications")).body;if("needsConnect"in e&&e.needsConnect)(0,Z.route)("/discover-twitter/connect");else{let t;let{results:i,subscribeToken:n,needsTwitterConfirm:l}=e,r=V(i),o=new Set(r.filter(e=>{var t;return(null===(t=e.subscriptions)||void 0===t?void 0:t.length)===0}).map(e=>e.id));t=o.size<=30?new Set(o):new Set,f(i),z(!1),E(n),k(o),D(t),_(!l)}}catch(e){z(e)}I(!1)}})()},[]),w&&(w.length>0?t=X?"We found ".concat(w.length," account").concat(w.length>1?"s":""," you follow on Twitter"):"Confirm your email to see ".concat(w.length," account").concat(w.length>1?"s":""," you follow on Twitter"):X||(t="Confirm your email to continue")),"confirm"===n&&(t="Confirm your email"),N&&(t="Success!");let Y=w?V(w):null,$=async()=>{I(!0);try{let e=await g().post("/api/v1/twitter/subscribe").send({pubIds:[...J].join(","),t:d,subscribeToken:F});if(h)h();else{let{subscribed:t}=e.body;S(t),(0,Z.route)("/discover-twitter/success")}}catch(e){console.error("error subscribing",e)}I(!1)};return(0,r.BX)("div",{className:"twitter-publications pub-list",children:[(0,r.tZ)("h2",{className:n,children:t}),T&&(0,r.tZ)("p",{className:"loading",children:"Loading..."}),C&&(0,r.BX)(o.Fragment,{children:[(0,r.tZ)("p",{className:"error",children:"Sorry, there was an error getting your results!"}),(0,r.tZ)("div",{className:"banner",children:(0,r.tZ)(A,{})})]}),(0,r.BX)(Z.default,{children:[w&&!N&&X&&!T&&(0,r.tZ)(U,{path:"".concat(M,"/discover-twitter"),results:w,selectedPubs:J,subscribablePubs:null!=y?y:new Set([]),onToggleChecked:e=>{let t=new Set(J);J.has(e)?t.delete(e):t.add(e),D(t)},onToggleAll:e=>{let t;D(e?new Set(y):new Set)},onNext:()=>{!b||B?$():(0,Z.route)("/discover-twitter/confirm")},loading:T,buttonText:u,requireSignup:p,renderIfNoneFound:v}),!1==X&&(0,r.tZ)(W,{path:"".concat(M,"/discover-twitter"),formAction:"/api/v1/twitter/confirm",redirect:"/api/v1/twitter/continue-confirm",user:i,onConfirmed:()=>{x(!0),_(!0)},twitterEmail:l,twitterToken:d,freeSignupEmail:s,pubIds:[...J],showDiscover:!0}),!B&&(0,r.tZ)(W,{path:"".concat(M,"/discover-twitter/confirm"),redirect:"/api/v1/twitter/continue-subscribe",formAction:"/api/v1/twitter/subscribe",user:i,onSubscribed:e=>{S(e),(0,Z.route)("/discover-twitter/success")},twitterEmail:l,twitterToken:d,freeSignupEmail:s,pubIds:[...J],subscribeToken:F,editable:!1,showLogout:!0}),w&&N&&(0,r.tZ)(H,{path:"".concat(M,"/discover-twitter/success"),user:i,subscribed:N,pubs:null!=Y?Y:[],results:w})]})]})},L=e=>{let{pub:t,result:i}=e,{hero_text:n,stripeAccount:l,logo_url:o}=t,{screen_name:a,publicationAuthor:{name:s,photo_url:c}}=i,d=null==l?void 0:l.plans;return(0,r.tZ)("li",{className:"linked-pub subscribed",children:(0,r.BX)("div",{className:"linked-pub",children:[(0,r.tZ)("div",{className:"photo",children:(0,r.tZ)(X.fi,{size:60,photo_url:o||c})}),(0,r.tZ)("div",{className:"info",children:(0,r.BX)("div",{className:"publication-row",children:[(0,r.BX)("div",{className:"publication",children:[(0,r.BX)("div",{className:"name",children:["@",a," - ",s]}),(0,r.tZ)("div",{className:"description",children:n})]}),(0,r.tZ)("div",{children:d&&(0,r.tZ)(N.Z,{className:"outline small button",href:"".concat((0,z.SVA)(t),"/subscribe"),target:"_blank",children:"Upgrade"})})]})})]})})},H=e=>{let{subscribed:t,pubs:i,results:n}=e,l=w()(i.filter(e=>t.find(t=>t===e.subdomain)),e=>e.id),[a,s]=p()(l,e=>{var t;return null===(t=e.stripeAccount)||void 0===t?void 0:t.plans}),c=[...a,...s].length>1,d=a.length>1;return(0,r.BX)("ul",{children:[(0,r.tZ)("div",{className:"sign-up",children:a.length>0?(0,r.BX)(o.Fragment,{children:[d?"".concat(a.length," of the newsletters"):c?"One of the newsletters":"The newsletter"," ","you subscribed to ",d?"have":"has"," a paid version. You can upgrade"," ",d?"those subscriptions":"that subscription"," now or later."]}):"You're subscribed to the free version of ".concat(c?"these newsletters":"this newsletter",".  Happy reading!")}),[...a,...s].map(e=>{let t=n.find(t=>{var i;return t.screen_name===(null===(i=e.twitterAccount)||void 0===i?void 0:i.screen_name)});return t?(0,r.tZ)(L,{pub:e,result:t}):null})]})},M=e=>{let{onNext:t}=e;return(0,r.tZ)("div",{children:(0,r.BX)("ul",{children:[(0,r.tZ)("p",{children:"It doesn't appear anyone you follow on Twitter has a Substack yet. We'll let you know if that changes."}),(0,r.tZ)(N.Z,{className:"primary button",onClick:()=>{t()},children:"Continue"})]})})},U=e=>{let{results:t,selectedPubs:i,onNext:n,onToggleChecked:l,onToggleAll:a,subscribablePubs:s,loading:c,buttonText:d,requireSignup:h,renderIfNoneFound:b}=e;if(0===t.length)return b||(0,r.tZ)(M,{onNext:n});let m=v()(t,e=>{var t,i,n;let l;return(null==(l=(null===(t=e.publicationAuthor)||void 0===t?void 0:t.ownedPublications)?u()(e.publicationAuthor.ownedPublications,e=>{var t;return(null===(t=e.latestPost)||void 0===t?void 0:t[0])?(0,C.Z)(e.latestPost[0].post_date).toDate():null}):null)?void 0:null===(i=l.latestPost)||void 0===i?void 0:i[0])?(0,C.Z)(null===(n=l.latestPost[0])||void 0===n?void 0:n.post_date).toDate():C.Z.unix(1).toDate()}).reverse(),[w,Z]=p()(m,e=>(e.publicationAuthor.ownedPublications||[]).some(e=>{var t;return(null===(t=e.subscriptions)||void 0===t?void 0:t.length)===0})),f=s.size===i.size,g=(!h||i.size>0)&&!c,y=!h||s.size>0?(0,r.tZ)(J,{onClick:n,disabled:!g,children:d?(i.size>0?"Subscribe and ":"")+d:"Sign up â†’"}):null;return(0,r.BX)("div",{children:[(0,r.tZ)("section",{className:"sign-up",children:"Subscribe to free newsletters from the people you already follow on Twitter"}),(0,r.BX)("ul",{children:[(!h||s.size>0)&&(0,r.BX)(o.Fragment,{children:[(s.size>3||!h)&&y,(0,r.tZ)("li",{children:s.size<30&&(0,r.tZ)(I,{checked:f,onClick:()=>{f?a(!1):a(!0)}})})]}),[...w,...Z].map(e=>(0,r.tZ)(F,{result:e,selectedPubs:i,onToggle:l})),y]})]})}},39341:function(e,t,i){i(16584);var n=i(6400);i(30396),(0,n.createContext)({}).displayName="WWWContext"},62514:function(e,t,i){i(30396),i(20042),i(39341),i(68833),i(48980)},41427:function(e,t,i){function n(e,t){return e.startsWith(t.replace(/\?.*$/,""))}function l(e,t){return e.replace(/\?.*$/,"")===t.replace(/\?.*$/,"")}i.d(t,{M:()=>l,h:()=>n})},94827:function(e,t,i){i.d(t,{Rj:()=>h});var n=i(16584);i(6400);var l=i(30396),r=i(94184),o=i.n(r),a=i(32224),s=i(1852);i(16104),i(35047),i(94499),i(32582);var c=i(95441);i(62514),i(68833),i(98914);var d=i(15771);i(38841),i(60308);let u={desktop:15,mobile:6},h=e=>{let{className:t,hasFeatured:i,categories:r,categoryId:h,categoryIds:p,loadingCategoryId:b,ranking:v,onCategoryClicked:m,defaultExpanded:w}=e,[Z,f]=(0,l.eJ)(w||!1),[g,y]=(0,l.eJ)(new Set),k=u[(0,s.useMediaQuery)({query:"only screen and (max-width: 650px)"})?"mobile":"desktop"],{iString:N}=(0,c.M1)(),S=r?Z?r:r.slice(0,k):[],X=e=>e.id===h||(null==p?void 0:p.includes(e.id)),_=e=>{y(t=>{let i=new Set(t);return i.has(e)?i.delete(e):i.add(e),i})};return(0,n.BX)("div",{className:o()("categories",t),children:[i&&(0,n.tZ)(d.zx,{priority:"featured"!==h||b&&"featured"!==b?"secondary":"primary-mono",loading:"featured"===b&&"featured"!==h,onClick:()=>{m({categoryId:"featured",ranking:"all",categories:r})},children:N("Featured")}),S.map(e=>{var t;let i=g.has(e.id),l=e.subcategories&&e.subcategories.length>0,o=X(e)&&(!b||b===e.id),a=b===e.id&&h!==e.id;return(0,n.BX)(n.HY,{children:[(0,n.tZ)(d.zx,{priority:o?"primary-mono":"secondary-outline",loading:a,onClick:()=>{m({categoryId:e.id,ranking:v,categories:r}),l&&_(e.id)},className:o?"test-active":"test-inactive",children:N(e.name||"")}),i&&l&&(null==e?void 0:null===(t=e.subcategories)||void 0===t?void 0:t.map(e=>{let t=X(e)&&(!b||b===e.id),i=b===e.id&&h!==e.id;return(0,n.tZ)(d.zx,{priority:t?"primary-mono":"secondary",loading:i,onClick:()=>m({categoryId:e.id,ranking:v,categories:r}),children:N(e.name)},e.id)}))]})}),r&&r.length>k&&!Z&&(0,n.tZ)(d.hU,{priority:"secondary-outline",onClick:()=>f(!0),children:(0,n.tZ)(a.Z,{size:20})})]})}}}]);