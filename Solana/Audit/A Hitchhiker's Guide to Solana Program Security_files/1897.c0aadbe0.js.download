"use strict";(self.webpackChunksubstack=self.webpackChunksubstack||[]).push([["1897"],{7523:function(t,e,r){r.d(e,{Z:()=>d});var i=r(7409),l=r(98848),a=r(6400),o=r(94184),n=r.n(o),s=r(4777);let d=t=>{let{align:e,as:r="div",children:o,clamp:d,className:u,color:c="primary",innerRef:p,preset:g,whiteSpace:h,wrap:v}=t,m=(0,l._)(t,["align","as","children","clamp","className","color","innerRef","preset","whiteSpace","wrap"]),f=n()(u,s.Z.container,s.Z["preset-".concat(g)],s.Z["color-".concat(c)],e&&s.Z["align-".concat(e)],d&&s.Z.clamp,d&&s.Z["clamp-".concat(d)],v&&s.Z["wrap-".concat(v)],h&&s.Z["white-space-".concat(h)]);return(0,a.h)(r,(0,i._)({className:f,ref:p},m),o)}},23398:function(t,e,r){r.d(e,{u:()=>l});var i=r(84864);function l(t){let e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,l=!(arguments.length>2)||void 0===arguments[2]||arguments[2];t.match(/^([a-z]+:)?\/\//i)||(t="http://".concat(t));try{e=new URL(t)}catch(e){return console.error("Failed to parse URL",t,e),t}e.hostname=e.hostname.replace(/^www\./,""),e.pathname=e.pathname.replace(/\/+$/,""),e.hash="";let a=new Set;e.hostname.includes("youtube")&&a.add("v"),e.searchParams.forEach((t,r)=>{a.has(r)||e.searchParams.delete(r)});let o=e.toString().replace(/^\w+:\/\//,"").replace(/\/+$/,"");return o?l?(0,i.truncateText)(o,r):o:t}},57639:function(t,e,r){r.d(e,{$y:()=>h,MQ:()=>w,N9:()=>y,Nh:()=>m,RK:()=>v});var i=r(7409),l=r(94184),a=r.n(l),o=r(98661),n=r(26445),s=r(98914),d=r(60308),u=r(63651),c=r(19520),p=r(30548);let g=t=>t.attrs.fullscreen?"full":t.attrs.imageSize||"normal",h={attrs:{src:{default:""},srcNoWatermark:{default:null},fullscreen:{default:null},imageSize:{default:null},height:{default:null},width:{default:null},resizeWidth:{default:null},bytes:{default:null},alt:{default:null},title:{default:null},type:{default:null},href:{default:null},belowTheFold:{default:!1},topImage:{default:!1},internalRedirect:{default:null},isProcessing:{default:!1},align:{default:null},offset:{default:!1}},inline:!1,atom:!0,group:"block",draggable:!0,selectable:!0,isolating:!0,defining:!0,parseDOM:[{tag:"p",priority:100,getAttrs:t=>{if(t.textContent.trim())return!1;let[e]=t.getElementsByTagName("img");return!!e&&m(e)}},{tag:"img[src]",getAttrs:t=>!(t.getAttribute("height")&&1>=Number(t.getAttribute("height"))||t.getAttribute("width")&&1>=Number(t.getAttribute("width")))&&m(t)}],toDOM:t=>{let{ImageActions:e}=r(55918);try{let r,i,l;let s=f(t),c=g(t),p=d.s2v.map(e=>({width:e,imageSrc:f(t,{maxWidth:e})})),h=d.s2v.map(e=>({width:e,imageSrc:f(t,{maxWidth:e,imageProps:{format:"webp"}})})),{isProcessing:v}=t.attrs;t.attrs.height&&t.attrs.width&&(r=t.attrs.height,i=t.attrs.width,t.attrs.resizeWidth?(r=t.attrs.resizeWidth*r/i,i=t.attrs.resizeWidth):_(t.attrs)&&i<d.kPM&&(r*=d.kPM/i,i=d.kPM),"full"===c&&(i=Math.min(i,d.qN9)));let m=t.attrs.width/t.attrs.height,y=t.attrs.resizeWidth?t.attrs.resizeWidth/m:t.attrs.height,b=t.attrs.resizeWidth?t.attrs.resizeWidth/y:m,w=!(t.attrs.href&&t.attrs.href!=t.attrs.src);w=(w=w&&t.attrs.height>240&&y>240)&&m<4&&b<4;let k="undefined"==typeof window;l=t.attrs.href?(0,u.chL)(t.attrs.href)?(0,d.zF4)(t.attrs.href):t.attrs.href:(0,d.zF4)(t.attrs.src);let $=document.createElement("div");if(w&&k){$.className="image-link-expand";try{$.innerHTML=(0,n.Dq)((0,o.createElement)(e,{size:20}))}catch(t){console.error("Error rendering ImageActions",t)}}return["a",{class:a()("image-link image2","left"===t.attrs.align&&"image2-align-left","right"===t.attrs.align&&"image2-align-right",t.attrs.offset&&"left"===t.attrs.align&&"image2-offset-left",t.attrs.offset&&"right"===t.attrs.align&&"image2-offset-right",w&&"is-viewable-img",v&&"processing"),target:"_blank",href:l,"data-component-name":"Image2ToDOM"},["div",{class:"image2-inset".concat("full"===c?" image2-full-screen":"")},["picture",{},["source",{type:"image/webp",srcset:h.map(t=>"".concat(t.imageSrc," ").concat(t.width,"w")).join(", "),sizes:"100vw"}],["img",{src:s,width:"full"===c?void 0:i,height:"full"===c?void 0:r,"data-attrs":JSON.stringify(t.attrs),class:"full"===c?"sizing-fullscreen":"large"===c?"sizing-large":"sizing-normal",alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,srcset:p.map(t=>"".concat(t.imageSrc," ").concat(t.width,"w")).join(", "),sizes:"100vw",loading:t.attrs.belowTheFold?"lazy":null,fetchpriority:t.attrs.topImage?"high":null}]],$]]}catch(e){return console.error("Error rendering Maximize2",e),(0,c.s)({msg:null,node:t,err:e,group:"block"})}},toDOMStatic:t=>{var e,r;let i=g(t),l=t.attrs.href||t.attrs.internalRedirect||(0,d.zF4)(t.attrs.src,void 0,{quality:"normal"===i?"auto:good":"auto:best"});if(t.attrs.height&&t.attrs.width&&"full"!==i){let{width:e,height:r}=t.attrs,i=e;t.attrs.resizeWidth?i=t.attrs.resizeWidth:_(t.attrs)&&(i=Math.min(Math.max(e,d.kPM),d.JWy));let a=Math.min(i,d.bxL),o=r*a/e,n=i>d.bxL,s={"data-attrs":JSON.stringify(t.attrs),alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,width:a,height:o,class:n?"wide-image":"",src:(0,d.zF4)(t.attrs.src,Math.min(!_(t.attrs)&&n?2*i:i,2*d.bxL),{lossy:k(t.attrs)})};return["table",{class:"image-wrapper",width:"100%",border:"0",cellSpacing:"0",cellPadding:"0","data-component-name":"Image2ToDOMStatic"},["tr",{},["td"],["td",{align:"left",class:"content",width:i},["a",{class:"image-link",target:"_blank",href:l},["img",s]]],["td"]]]}return"full"===i?["a",{class:"image-link",target:"_blank",href:l},["img",{src:(0,d.zF4)(t.attrs.src,2*d.bxL,{lossy:k(t.attrs),crop:"limit",aspect:"full"===i?"1":void 0}),"data-attrs":JSON.stringify(t.attrs),alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,height:t.attrs.height,width:t.attrs.width}]]:["a",{class:"image-link",target:"_blank",href:l},["img",{src:(0,d.zF4)(t.attrs.src,2*d.bxL,{lossy:k(t.attrs)}),"data-attrs":JSON.stringify(t.attrs),alt:t.attrs.alt||"",title:t.attrs.title||t.attrs.alt,width:t.attrs.resizeWidth||t.attrs.width,height:t.attrs.resizeWidth?(e=t.attrs.width,r=t.attrs.height,r*t.attrs.resizeWidth/e):t.attrs.height}]]}},v=(0,p.S)({name:"image2",nodeSpec:h}),m=function(t,e){let r,i,l,{bytes:a,internalRedirect:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.getAttribute("data-attrs");if(n)try{return JSON.parse(n)}catch(t){}t.getAttribute("imageSize")&&(r=t.getAttribute("imageSize"));let s=t.getAttribute("style");if(s){let t=/max-height:\s*(\d+)px/.exec(s);t&&(i=Number(t[1]));let e=/max-width:\s*(\d+)px/.exec(s);e&&(l=Number(e[1]))}else t.getAttribute("width")&&t.getAttribute("height")&&(i=Number(t.getAttribute("height")),l=Number(t.getAttribute("width")));return t.complete&&t.naturalHeight&&t.naturalWidth&&(i=t.naturalHeight,l=t.naturalWidth),{src:(0,d.UH4)(t.getAttribute("data-medium-file")||t.getAttribute("src")),type:e,title:t.getAttribute("title"),alt:t.getAttribute("alt"),height:i,width:l,bytes:a,internalRedirect:o,imageSize:r,href:t.getAttribute("href"),align:t.getAttribute("align"),offset:"true"===t.getAttribute("offset")}},f=function(t){let{maxWidth:e=null,imageProps:r={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=g(t),a="full"===l?2*d.hI6:"large"===l?2*d.urw:2*d.qN9;return e&&(a=Math.min(e,a)),(0,d.zF4)(t.attrs.src,a,(0,i._)({lossy:k(t.attrs)},r))},y=function(t){var e;let{customSchema:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r&&!r.nodes.image2)return null;let i=/(https?:\/\/(giphy\.com\/gifs|gph.is\/g|media\d*\.giphy\.com\/media)\/[^\s]+)/.exec(t);return null!==(e=i&&i[1])&&void 0!==e?e:null},b=async t=>{let e=(await Promise.resolve().then(r.t.bind(r,80569,23))).default,i="image/gif",l=await e.get("/api/v1/giphy").query({url:t});return m(await new Promise(t=>(0,s.pt)(f({attrs:{type:i,src:l.body.url}}),t)),i,{bytes:l.body.bytes})},w=async function(t){let{customSchema:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(e?{schema:e}:await Promise.resolve().then(r.bind(r,37175))).schema.nodes.image2.create(await b(t))};function k(t){return _(t)&&(!t.bytes||t.bytes>5e6)}function _(t){return!!(t.type&&"image/gif"===t.type||t.src&&t.src.split("?")[0].split("#")[0].endsWith(".gif"))}},37175:function(t,e,r){r.r(e),r.d(e,{EMPTY_DOC:()=>eg,HEADER_IMAGE_ATTRS_FROM_NODE_TYPE:()=>eh,addIdsToHeaders:()=>eC,checkForUnpublishableComments:()=>e4,checkForUnsafeLinks:()=>e8,createStringDoc:()=>e7,customMediaNodes:()=>em,extractTags:()=>eJ,fromHtml:()=>eq,getCoverImage:()=>ej,getCoverImages:()=>eX,getDefaultPodcastDescriptionWithoutFeedCTAs:()=>e6,getDescription:()=>eZ,getDimensionsFromImageUrl:()=>ep,getFirstImageFromBody:()=>eG,getHeaderImageFromBody:()=>eK,getImageUrlsFromPostBody:()=>eQ,getImagesFromBody:()=>eY,getLinks:()=>e2,getPreviewImageUrl:()=>e0,hasExplicitPaywall:()=>rt,migrateMarkdown:()=>eH,migratePost:()=>eV,migrateProsemirrorToTiptap:()=>eF,migratePublication:()=>eR,migrateTiptapToProsemirror:()=>eI,nodeToHtml:()=>eD,normalizeDbPodcastDescriptionToHtmlString:()=>e5,purgeUnsafeLinks:()=>e9,schema:()=>ew,schemaStatic:()=>ek,serializeDoc:()=>eP,serializedToPodcastDescription:()=>eU,setBelowTheFoldAttribute:()=>e3,setButtonActions:()=>e1,tipTapNodes:()=>eN,tipTapSchema:()=>eA,toHtml:()=>eL,toText:()=>eB,trackedCustomNodes:()=>ey,unserializeDoc:()=>eW,unserializeDocAsync:()=>eE,unserializeJson:()=>eM});var i=r(7409),l=r(99282),a=r(88897),o=r(19512),n=r(56070),s=r(18490),d=r(24717),u=r(56782),c=r(43557),p=r(99961),g=r(18e3),h=r(51127),v=r(67338),m=r(75481),f=r(55786),y=r(32018),b=r(91077),w=r(87597),k=r(94886),_=r(99218),$=r(55963),z=r(21803),x=r(76405),S=r(39693),N=r.n(S),A=r(14293),O=r.n(A),T=r(44908),F=r.n(T),I=r(60826),M=r(24791),W=r(40121),E=r(5889),P=r(60308),D=r(84864),C=r(5835),L=r(26603),B=r(57937),U=r(55633),J=r(1451),q=r(44262),H=r(41676),V=r(82032),R=r(95068),Z=r(99605),j=r(12568),Y=r(65626),G=r(37622),K=r(36621),Q=r(31188),X=r(71993),tt=r(88954),te=r(13991),tr=r(36122),ti=r(72270),tl=r(82167),ta=r(47456),to=r(32978),tn=r(40924),ts=r(86725),td=r(59383),tu=r(5660),tc=r(1415),tp=r(98616),tg=r(82708),th=r(73984),tv=r(11105),tm=r(10218),tf=r(98738),ty=r(81519),tb=r(59662),tw=r(60511),tk=r(75837),t_=r(29961),t$=r(24653),tz=r(80334),tx=r(94413),tS=r(75970),tN=r(715),tA=r(87113),tO=r(98450),tT=r(87413),tF=r(69323),tI=r(61601),tM=r(57639),tW=r(54793),tE=r(29511),tP=r(49640),tD=r(99975),tC=r(41128),tL=r(23431),tB=r(73078),tU=r(85197),tJ=r(53797),tq=r(99741),tH=r(3185),tV=r(8220),tR=r(18119),tZ=r(44288),tj=r(13938),tY=r(54757),tG=r(11006),tK=r(11470),tQ=r(66928),tX=r(19805),t0=r(46393),t1=r(2107),t2=r(99149),t4=r(79592),t8=r(62645),t9=r(39111),t3=r(42034),t5=r(41505),t6=r(57950),t7=r(78483),et=r(57881),ee=r(84766),er=r(62092),ei=r(68303),el=r(88956),ea=r(22498),eo=r(22365),en=r(60802),es=r(45913),ed=r(12076),eu=r(34612),ec=r(32751);let ep=t=>{var e,r,i,l;let[a,o]=((null===(l=t.split("_"))||void 0===l?void 0:null===(i=l[1])||void 0===i?void 0:null===(r=i.split("."))||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.split("x"))||[0,0]).map(Number);return{width:a||0,height:o||0}},eg={type:"doc",content:[{type:"paragraph"}]},eh={captionedImage:t=>{var e,r,i,l;let a=null===(e=t.content)||void 0===e?void 0:e.find(t=>{var e,r;return"image2"===t.type&&(null===(e=t.attrs)||void 0===e?void 0:e.width)>=300&&(null==t?void 0:null===(r=t.attrs)||void 0===r?void 0:r.height)>=300});if(!a)return{url:null,caption:void 0,alt:void 0};let o=null==t?void 0:null===(r=t.content)||void 0===r?void 0:r.find(t=>"caption"===t.type);return{url:null==a?void 0:null===(i=a.attrs)||void 0===i?void 0:i.src,caption:o,alt:null==a?void 0:null===(l=a.attrs)||void 0===l?void 0:l.alt}},image2:t=>{var e,r,i,l;return"number"!=typeof(null===(e=t.attrs)||void 0===e?void 0:e.width)&&"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.height)||t.attrs.width>=300&&t.attrs.height>=300?{url:null==t?void 0:null===(i=t.attrs)||void 0===i?void 0:i.src,alt:null==t?void 0:null===(l=t.attrs)||void 0===l?void 0:l.alt}:{url:null,caption:void 0,alt:void 0}},image3:t=>{var e,r,i,l,a;let o=ep(null===(e=t.attrs)||void 0===e?void 0:e.src);return"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.width)&&"number"!=typeof(null===(i=t.attrs)||void 0===i?void 0:i.height)||t.attrs.width>=300&&t.attrs.height>=300||o.width>=300&&o.height>=300?{url:null===(l=t.attrs)||void 0===l?void 0:l.src,caption:t.content,alt:null===(a=t.attrs)||void 0===a?void 0:a.alt}:{url:null,caption:void 0,alt:void 0}}},ev={image:t=>{var e;return e0(null===(e=t.attrs)||void 0===e?void 0:e.src)},image2:t=>{var e,r,i;return"number"!=typeof(null===(e=t.attrs)||void 0===e?void 0:e.width)&&"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.height)||t.attrs.width>=300&&t.attrs.height>=300?e0(null===(i=t.attrs)||void 0===i?void 0:i.src):null},image3:t=>{var e,r,i,l;let a=ep(null===(e=t.attrs)||void 0===e?void 0:e.src);return"number"!=typeof(null===(r=t.attrs)||void 0===r?void 0:r.width)&&"number"!=typeof(null===(i=t.attrs)||void 0===i?void 0:i.height)||t.attrs.width>=300&&t.attrs.height>=300||a.width>=300&&a.height>=300?e0(null===(l=t.attrs)||void 0===l?void 0:l.src):null},imageGallery:t=>{var e,r,i;return e0(null===(i=t.attrs)||void 0===i?void 0:null===(r=i.gallery.images)||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.src)},spotify:t=>{var e;return e0(null===(e=t.attrs)||void 0===e?void 0:e.image)},spotify2:t=>{var e;return e0(null===(e=t.attrs)||void 0===e?void 0:e.image)},opensea:t=>{var e;return e0(null===(e=t.attrs)||void 0===e?void 0:e.image)},twitter2:t=>{var e,r;if(null===(e=t.attrs)||void 0===e?void 0:e.photos){for(let e of t.attrs.photos)if(e.img_url)return e0(e.img_url)}return(null===(r=t.attrs)||void 0===r?void 0:r.expanded_url)&&t.attrs.expanded_url.image?t.attrs.expanded_url.image.url?e0(t.attrs.expanded_url.image.url):e0(t.attrs.expanded_url.image):null},vimeo:t=>{var e;return es.Jn(null===(e=t.attrs)||void 0===e?void 0:e.videoId,{playButton:!1})},youtube:t=>{var e;return ec.Jn(null===(e=t.attrs)||void 0===e?void 0:e.videoId,{playButton:!1})},youtube2:t=>{var e;return ec.Jn(null===(e=t.attrs)||void 0===e?void 0:e.videoId,{playButton:!1})},kindle:t=>{var e;return(0,P.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.imageUrl)},applePodcast:t=>{var e;return(0,P.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.imageUrl)},tiktok:t=>{var e;return(0,P.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},prediction_market:t=>{var e;return(0,P.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},manifold:t=>{var e;return(0,P.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},lichess:t=>{var e;return(0,P.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},datawrapper:t=>{var e;return(0,P.zF4)(null===(e=t.attrs)||void 0===e?void 0:e.thumbnail_url)},pinterest:t=>{var e;return e0(null===(e=t.attrs)||void 0===e?void 0:e.image)}},em={augmentation_placeholder:J.$,youtube2:ec.$y,youtube:eu.$,vimeo:es.$y,install_substack_app:tP.$,preview_in_substack_app:tY.$,opensea:tJ.$y,twitter2:ee.$y,twitter:et.$,communityChat:tt.$y,communityPost:te.$y,comment:X.$y,spotify2:t4.$y,spotify:t2.$,soundcloud:t0.$y,instagram:tE.$y,image2:tM.$y,image:tF.$,button:R.$y,comic:Q.Z.nodeSpec,file:Q.Z.nodeSpec,pdf:tH.Z.nodeSpec,xlsx:ed.Z.nodeSpec,ebook:to.Z.nodeSpec,referral_link:tQ.$,bandcamp:q.$y,kindle:tD.$y,gitgist:tT.$y,embeddedPost:tn.$y,embeddedPublication:ts.$y,applePodcast:C.$y,audio:B.$y,video:en.$,audioUrl:U.$y,tiktok:t7.$y,bluesky:V.$y,poll:tR.$,sponsorshipCampaign:t1.$,imageGallery:tI.$y,image3:tW.$y,cashtag:K.$,substack_mentions:tU.$,prediction_market:tZ.$y,manifold:tZ.$y,lichess:tL.$y,datawrapper:ti.$y,digestPostEmbed:tl.$y,assetError:L.$,directMessage:ta.$y,recipe:tK.$,pinterest:tV.$y},ef=(0,l._)((0,i._)({},em),{blockquote:H.$,calloutBlock:Z.$,fragmentNode:tO.$,captionedImage:G.$,caption:j.$,ctaCaption:tr.$,footnote:tN.$,footnoteAnchor:tA.$,latex_block:tC.$y,paywall:tq.$,preformatted_text_block:tj.$,pullquote:tG.$,subscribeWidget:t9.$,captionedShareButton:(0,Y.$y)({url:I.W.SHARE_URL}),captionedWriterReferralButton:(0,Y.$y)({hasDynamicSubstitutions:!1}),templateComment:t6.$,meeting:tB.$,referralTier:tX.$y}),ey=(0,l._)((0,i._)({},em),{subscribeWidget:t9.$,paywall:tq.$,templateComment:t6.$}),eb={strikethrough:t8.J,superscript:t5.O,subscript:t3.l},ew=new x.V_({nodes:eO(),marks:eT()}),ek=new x.V_({nodes:eO({isStatic:!0}),marks:eT({isStatic:!0})}),e_=Object.keys(ef).filter(t=>!["blockquote","pullquote","calloutBlock"].includes(t)).map(t=>{let e=(0,ei.Co)(t,ef[t]),r=(0,i._)({},ef[t],e);return"youtube2"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new ec.dQ(e)}:"tiktok"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new t7.QZ(e)}:"lichess"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new tL.$1(e)}:"datawrapper"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new ti.s3(e)}:"prediction_market"===t||"manifold"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new tZ.eC(e)}:"paywall"===t?r.addNodeView=()=>t=>new tq.b:"latex_block"===t?r.addNodeView=()=>t=>{let{node:e}=t;return new tC.Jd(e)}:"comic"===t?r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return Q.Z.getNodeView({node:e,editor:r,getPos:i})}:"pdf"===t?r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return tH.Z.getNodeView({node:e,editor:r,getPos:i})}:"xlsx"===t?r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return ed.Z.getNodeView({node:e,editor:r,getPos:i})}:"ebook"===t&&(r.addNodeView=()=>t=>{let{node:e,editor:r,getPos:i}=t;return to.Z.getNodeView({node:e,editor:r,getPos:i})}),a.NB.create(r)}),e$=o.V6.extend({addCommands(){return{toggleBlockquote:()=>t=>{let{state:e,commands:r}=t;return!(!(0,a.Ig)(e,"paragraph")||(0,a.Ig)(e,"pullquote")||(0,a.Ig)(e,"calloutBlock"))&&r.toggleWrap(this.name)}}},parseHTML:()=>H.$.parseDOM}),ez=o.V6.extend({name:"calloutBlock",addCommands(){return{toggleCalloutBlock:()=>t=>{let{state:e,commands:r}=t;if((0,a.Ig)(e,"calloutBlock"))return r.lift("calloutBlock");if((0,a.Ig)(e,"paragraph")||(0,a.Ig)(e,"button"))return!((0,a.Ig)(e,"pullquote")||(0,a.Ig)(e,"blockquote"))&&r.toggleWrap(this.name);let i=[e.schema.nodes.paragraph,e.schema.nodes.button].filter(t=>!!t),l=!0;return e.doc.nodesBetween(e.selection.from,e.selection.to,(t,r,a,o)=>{if(a===e.doc&&(t.type===e.schema.nodes.blockquote||t.type===e.schema.nodes.pullquote||!i.includes(t.type)))return l=!1,!1}),!(!l||(0,a.Ig)(e,"pullquote")||(0,a.Ig)(e,"blockquote"))&&r.toggleWrap(this.name)}}},parseHTML:()=>[{tag:"div[data-callout]",priority:100},{tag:"div.callout-block",priority:99}],renderHTML:()=>["div",{class:"callout-block","data-callout":"true"},0]}),ex=v.b.extend({addCommands:()=>({insertHorizontalRule:()=>t=>{let{state:e,dispatch:r}=t;return r&&e.schema.nodes.horizontalRule&&r((0,ei.o4)(e,e.schema.nodes.horizontalRule.create())),!0},setHorizontalRule:()=>t=>{let{state:e,dispatch:r}=t;if(r){if(!e.schema.nodes.horizontalRule)return console.error("horizontalRule is missing"),!1;r((0,ei.o4)(e,e.schema.nodes.horizontalRule.create()))}return!0}})}),eS=u.dn.extend({marks:"_"}),eN=[e$,n.d8,s.DY,tu.z,ez,d.EK,eS,tp.l,c.B,th.w,p.U,g.X,h.A,ex,td.M,tS.f,tm._,ty.r,tk.q,tz.a,t_.R,tw.q,tv.y,m.Tx,tf.d,f.H,y.GS,b.n,tb.f,tG.z,w.Re,k.a,_.$,$.x,tc.n,tx.T,tg.k,ta.e1,...e_],eA=(0,a.J1)(eN);function eO(){let{isStatic:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=z.fK.spec.nodes;for(let r of Object.keys(ef)){let i=Object.assign({},ef[r]);t&&i.toDOMStatic&&(i.toDOM=i.toDOMStatic),delete i.toDOMStatic,e=e.get(r)?e.update(r,i):e.addToEnd(r,i)}return e}function eT(){let{isStatic:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=z.fK.spec.marks;for(let r of Object.keys(eb)){let i=Object.assign({},eb[r]);t&&i.toDOMStatic&&(i.toDOM=i.toDOMStatic),delete i.toDOMStatic,e=e.get(r)?e.update(r,i):e.addToEnd(r,i)}return e}function eF(t){let{postId:e,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t;return"string"==typeof i&&(i=eM(i,{postId:e,pubId:r})),(0,ei.cb)(i,t=>{let e=ei.qj.find(e=>e[0]===t.type);return e&&(t.type=e[1],t.attrs&&"orderedList"===e[1]&&(t.attrs.start=t.attrs.order)),t.marks&&t.marks.forEach(t=>{let e=ei.PH.find(e=>e[0]===t.type);e&&(t.type=e[1])}),t}),i}function eI(t){let{postId:e,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t;return"string"==typeof i&&(i=eM(i,{postId:e,pubId:r})),(0,ei.cb)(i,t=>{let e=ei.qj.find(e=>e[1]===t.type);return e&&(t.type=e[0],t.attrs&&"ordered_list"===e[0]&&(t.attrs.order=t.attrs.start)),t.marks&&t.marks.forEach(t=>{let e=ei.PH.find(e=>e[1]===t.type);e&&(t.type=e[0])}),t}),i}function eM(t){let e,{postId:r,pubId:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t&&(t=(t=t.replace("http://substack-post-media","https://substack-post-media")).replace("http://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984","https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984")),t=eH(t))try{e=JSON.parse(t)}catch(e){console.error("unserializeJson for post [".concat(r,"], pubId [").concat(i,"], could not parse serialized:"),t,e)}return null!=e?e:void 0}function eW(t){let{customSchema:e,useTiptap:r,mutateJson:i,shouldSetBelowTheFoldAttribute:l=!1,shouldThrowOnInvalid:a,postId:o,pubId:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=eM(t,{postId:o,pubId:n})||eg;i&&i(a);let s=e9(a);if(!s)throw Error("could not purgeUnsafeLinks");let d=s;return l&&(d=e3(d)),d=r?eF(d,{postId:o,pubId:n}):eI(d,{postId:o,pubId:n}),(e||ew).nodeFromJSON(d)}catch(r){if(console.error("Failed to parse JSON for post [".concat(o,"], serialized:"),t,r),a)throw Error("Failed to parse JSON:  ".concat(r.message));return(e||ew).nodeFromJSON(eg)}}async function eE(t){let{customSchema:e,useTiptap:r,mutateJson:i,shouldSetBelowTheFoldAttribute:l=!1,shouldThrowOnInvalid:a,postId:o,pubId:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=eM(t,{postId:o,pubId:n})||eg;i&&await i(a);let s=e9(a);if(!s)throw Error("could not purgeUnsafeLinks");let d=s;return l&&(d=e3(d)),d=r?eF(d,{postId:o,pubId:n}):eI(d,{postId:o,pubId:n}),(e||ew).nodeFromJSON(d)}catch(r){if(console.error("Failed to parse JSON for post [".concat(o,"], serialized:"),t,r),a)throw Error("Failed to parse JSON:  ".concat(r.message));return(e||ew).nodeFromJSON(eg)}}function eP(t){let{runMigrations:e=!1,postId:r,pubId:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=t.toJSON();return e&&(l=eI(l=e9(l=function(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="string"==typeof t?eM(t,{postId:e}):t;return(0,ei.cb)(r,t=>{t.text&&(t.text=(0,D.stripInvalidBytes)(t.text))},{nodeTypes:["text"]}),r}(l)),{postId:r,pubId:i})),JSON.stringify(l)}function eD(t,e){let r=document.createElement("div");return r.appendChild(x.PW.fromSchema(e?ek:ew).serializeFragment(x.HY.fromArray([t]),{document})),r}function eC(t){Array.from(t.querySelectorAll("h2, h3, h4, h5, h6")).forEach(t=>{if(!t.getAttribute("id")){var e,r;let i=(r=t.textContent||"",(0,W.Hm)((0,D.truncateText)(r,500,{ellipsis:""}),{allowUnicode:!0})),l=document.createElement("div");l.setAttribute("id",i),l.setAttribute("class","anchor-target"),null===(e=t.parentNode)||void 0===e||e.insertBefore(l,t);let a=document.createElement("a");for(a.setAttribute("href","#".concat(i));t.firstChild;)a.appendChild(t.firstChild);t.appendChild(a)}})}function eL(t,e){let{isAmp:r,transform:i,useTipTap:l,pubId:a,postId:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(l){let r=eF(eM(t,{postId:o,pubId:a}),{postId:o,pubId:a});if(!r)throw Error("could not serialize json doc");return(0,eo.e)({doc:r,extensions:(0,t$.p)({isStatic:null!=e&&e}),customDocument:document})}let n=eW(t,{shouldSetBelowTheFoldAttribute:!0,postId:o,pubId:a}),s=x.PW.fromSchema(e?ek:ew),d=document.createElement("div");try{s.serializeFragment(n.content,{document},d)}catch(t){return console.error("could not serialize fragment, for pubId [".concat(a,"], postId [").concat(o,"]"),t),d.innerHTML}return i&&i(d),r&&function(t){Array.from(t.querySelectorAll("img")).forEach(t=>{let e=document.createElement("amp-img");e.setAttribute("layout","intrinsic"),t.getAttributeNames().forEach(r=>{var i;"srcset"!==r&&e.setAttribute(r,null!==(i=t.getAttribute(r))&&void 0!==i?i:"null")}),t.replaceWith(e)})}(d),d.innerHTML}function eB(t,e){let{postId:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,ei.lr)(eW(t,{postId:r}),e)}function eU(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ei.fX)(eW(t,{postId:e}))}function eJ(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,ei.E5)(eW(t,{postId:e}))}function eq(t){let{stripEmptyParagraphs:e,postId:r,pubId:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=x.aw.fromSchema(ew).parse(new DOMParser().parseFromString(t,"text/html"));return(e&&(l=(0,el.Y)(l,t=>!t.type||"paragraph"!==t.type.name||!!(0,ei.lr)(t))),l)?eP(l,{postId:r,pubId:i}):null}function eH(t){return t&&"{"!==t[0]&&"null"!==t?eP(z.EU.parse(t)):t}function eV(t){var e,r;return t.body=null!==(e=eH(t.body))&&void 0!==e?e:null,t.draft_body=null!==(r=eH(t.draft_body))&&void 0!==r?r:null,t}function eR(t){var e,r,i,l,a;return t.subscribe_content=null!==(e=eH(t.subscribe_content))&&void 0!==e?e:null,t.welcome_email_content=null!==(r=eH(t.welcome_email_content))&&void 0!==r?r:null,t.tos_content=null!==(i=eH(t.tos_content))&&void 0!==i?i:null,t.privacy_content=null!==(l=eH(t.privacy_content))&&void 0!==l?l:null,t.disclosures_content=null!==(a=eH(t.disclosures_content))&&void 0!==a?a:null,t}function eZ(t,e){let{post:r=null,pubId:i,minCharacters:l=6,maxStopAfter:a=null,singleSentence:o=!0,language:n="en",excludeMediaPrefix:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{iString:d}=I18N.i(n),u=(null==r?void 0:r.type)==="thread"?145:250;(a||0===a)&&(u=Math.min(a,u));let c=(null==r?void 0:r.type)==="thread",p="";if(e)p+=e;else if(0!==u){var g;let e={paragraph:!0,blockquote:!0,list_item:!0,listItem:!0,heading:!0,code_block:!0,codeBlock:!0,hardbreak:!0,hard_break:!0,hardBreak:!0},a={caption:!0,footnote:!0};(0,ei.cb)("string"==typeof t?eM(t,{postId:null!==(g=null==r?void 0:r.id)&&void 0!==g?g:null,pubId:i}):t,t=>{if(u&&p.length>=u||t.type&&a[t.type])return!1;if("text"===t.type){let{text:e}=t;if(e){let t=e.match(/[.?!] /);if(o&&(null==t?void 0:t.index))return p+=e.slice(0,t.index+1),ea.aT;p+=e}}else if(t.type&&e[t.type]&&p){if(p.length>l)return ea.aT;" "!==p[p.length-1]&&(p+=" ")}else if("substack_mentions"===t.type){var r,i;p+=null!==(i=null===(r=t.attrs)||void 0===r?void 0:r.name)&&void 0!==i?i:""}})}if(p=p.replace(/\s+/g," ").trim(),c&&u&&p.length>=u&&(p=(0,D.truncateText)(p,u)),((null==r?void 0:r.type)==="podcast"||(null==r?void 0:r.type)==="video")&&!s){let t=(0,M.XV)(r);p="".concat(d((null==r?void 0:r.type)==="video"||(null==r?void 0:r.videoUpload)?"Watch now":"Listen now")," ").concat(t?"(".concat((0,D.secondsToLargestUnit)(t,{minutesCutoff:10800,language:n}),") "):"","| ").concat(p)}return p}function ej(t,e){var r;return null!==(r=eX(t,e)[0])&&void 0!==r?r:null}function eY(t){let{postId:e,pubId:r,width:i,height:l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=eM(t,{postId:e,pubId:r});return a?F()(N()((0,ei.fp)(a,t=>{var e;return!!ev[null!==(e=t.type)&&void 0!==e?e:""]}).map(t=>{var e,r;let a=null===(e=ev[null!==(r=t.type)&&void 0!==r?r:""])||void 0===e?void 0:e.call(ev,t);return a?(0,P.zF4)(a,i,{height:l}):null}))):[]}function eG(t){let{postId:e,pubId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=eY(t,{postId:e,pubId:r});return i.length>0&&!O()(i[0])?i[0]:null}function eK(t){let{body:e}=t,r=eM(e);if(r)return(0,ei.fp)(r,t=>{var e;return!!eh[null!==(e=t.type)&&void 0!==e?e:""]}).map(t=>{var e,r;return null===(e=eh[null!==(r=t.type)&&void 0!==r?r:""])||void 0===e?void 0:e.call(eh,t)})[0]}async function eQ(t){let{body:e,postId:r}=t,i=eW(e,{postId:r}),l=[];return(0,ei.je)(i,t=>{switch(t.type.name){case"image":case"image2":t.attrs.src&&l.push(t.attrs.src);break;case"imageGallery":var e;null===(e=t.attrs.gallery.images)||void 0===e||e.map(t=>{t.src&&l.push(t.src)})}}),l}function eX(t,e){var r;let i=[];"podcast_episode_image_info"in e&&e.podcast_episode_image_info&&!e.podcast_episode_image_info.isDefaultArt&&i.unshift(e.podcast_episode_image_info.url),i.unshift(...eY(t,{postId:e.id}));let l="podcastUpload"in e&&e.podcastUpload||"draftPodcastUpload"in e&&e.draftPodcastUpload||void 0;if((null==l?void 0:l.state)==="transcoded"&&(null!==(r=null==l?void 0:l.thumbnail_id)&&void 0!==r?r:1)>1){let t=(0,P.ow1)(l);t&&i.unshift(t)}let a="videoUpload"in e&&e.videoUpload||"draftVideoUpload"in e&&e.draftVideoUpload||void 0;if((null==a?void 0:a.state)==="transcoded"){let t=(0,P.ow1)(a);t&&i.unshift(t)}return"podcast_art_url"in e&&e.podcast_art_url&&i.unshift(e.podcast_art_url),i}function e0(t){return"string"!=typeof t?null:(t=t.replace(/\/l_twitter_play_button_rvaygk[^/]+/g,""),(0,P.zF4)(t,void 0,{height:600}))}function e1(t){(0,ei.cb)(t,t=>{var e;return"button"===t.type&&((null===(e=t.attrs)||void 0===e?void 0:e.url)&&"string"==typeof t.attrs.url&&t.attrs.url.startsWith("%%")&&(t.attrs.action=t.attrs.url.replace(/%%/g,"")),!0)},{nodeTypes:"button"})}function e2(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t;if("string"==typeof r){let t=eM(r,{postId:e});if(!t)return[];r=t}e1(r);let i=[];return(0,ei.cb)(r,t=>{var e,r,l;if("button"===t.type&&(null===(e=t.attrs)||void 0===e?void 0:e.url)&&!t.attrs.action)i.push({text:t.attrs.text,url:t.attrs.url});else if("image2"===t.type&&(null===(r=t.attrs)||void 0===r?void 0:r.href))i.push({text:t.attrs.href,url:t.attrs.href});else if(t.marks){for(let e of t.marks)if("link"===e.type&&(null===(l=e.attrs)||void 0===l?void 0:l.href)){i.push({text:t.text,url:e.attrs.href});break}}}),i}function e4(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return!1;let r=t;if("string"==typeof r){let t=eM(r,{postId:e});if(!t)return!1;r=t}return!!(0,ei.DY)(r,t=>"templateComment"===t.type)}function e8(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return!1;let r=t;if("string"==typeof r){let t=eM(r,{postId:e});if(!t)return!1;r=t}return!!(0,ei.DY)(r,t=>{for(let n of["href","src","url"]){var e,r,i,l,a,o;if((null==t?void 0:null===(l=t.attrs)||void 0===l?void 0:null===(i=l[n])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:"))||(null==t?void 0:null===(o=t.marks)||void 0===o?void 0:o.find(t=>{var e,r,i,l,a;return null===(l=t.attrs)||void 0===l?void 0:null===(i=l[n])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:")})))return!0}return!1})}function e9(t){let e,{postId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t){let i=eM(t,{postId:r});if(!i)return null;e=i}else e=t;return(0,er.f5)(e)?(0,el.Y)(e,t=>{for(let n of["href","src","url"]){var e,r,i,l,a,o;if((null==t?void 0:null===(l=t.attrs)||void 0===l?void 0:null===(i=l[n])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:"))||(null==t?void 0:null===(o=t.marks)||void 0===o?void 0:o.find(t=>{var e,r,i,l,a;return null===(l=t.attrs)||void 0===l?void 0:null===(i=l[n])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:")})))return!1}return!0}):(0,el.Y)(e,t=>{for(let n of["href","src","url"]){var e,r,i,l,a,o;if((null==t?void 0:null===(l=t.attrs)||void 0===l?void 0:null===(i=l[n])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:"))||(null==t?void 0:null===(o=t.marks)||void 0===o?void 0:o.find(t=>{var e,r,i,l,a;return null===(l=t.attrs)||void 0===l?void 0:null===(i=l[n])||void 0===i?void 0:null===(r=i.trim)||void 0===r?void 0:null===(e=(a=r.call(i)).toLowerCase)||void 0===e?void 0:e.call(a).startsWith("javascript:")})))return!1}return!0})}function e3(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,{postId:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i="string"==typeof t?eM(t,{postId:r}):t;if(!i)return;let l=!1;return"doc"===i.type&&i.content&&i.content.map((t,r)=>{r>e?(0,ei.cb)(t,t=>{!t.content&&t.attrs&&(t.attrs.belowTheFold=!0)}):l||(0,ei.cb)(t,t=>{!t.content&&(null==t?void 0:t.type)=="image2"&&t.attrs&&(t.attrs.topImage=!0,l=!0)})}),i}function e5(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return JSON.parse(t),eU(t,{postId:e})}catch(e){return t}}function e6(t,e){let{body:r,hasPodcastPreview:i}=e;if(!t||!r)return null;let l=r;return i&&(l=JSON.stringify((0,ei.N5)(eM(r,{postId:t.id}),{maxLength:"post_preview_limit"in t&&t.post_preview_limit&&"number"==typeof t.post_preview_limit?t.post_preview_limit:356}))),eU(l,{postId:t.id})}function e7(t){return eP(ew.node("doc",null,t.split("\n").map(t=>t.trim()).filter(t=>t.length>0).map(t=>{let e=[],r=(0,E.m)(t);if(r.length>0){let i=t;for(;;){let t=r.map(t=>[i.indexOf(t.value),t.value]).sort().find(t=>{let[e]=t;return e>=0});if(!t)break;let[l,a]=t;if(l>0&&e.push(ew.text(i.substring(0,l))),!ew.marks.link){console.error("link is missing from schema");continue}e.push(ew.text(a,[ew.marks.link.create({title:a,href:a,target:"_blank"})])),i=i.substring(l+a.length)}i&&e.push(ew.text(i))}else e.push(ew.text(t));return ew.node("paragraph",null,e)})))}function rt(t){let{postId:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return!1;let r=t;if("string"==typeof t){let i=eM(t,{postId:e});if(!i)return!1;r=i}else r=t;return(0,ei.C4)(r)}Object.entries(eA.nodes).forEach(t=>{let[e,r]=t;void 0!==ef[e]&&(r.spec=(0,i._)({},ef[e],r.spec))})}}]);